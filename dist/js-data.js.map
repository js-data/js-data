{"version":3,"file":"js-data.js","sources":["../src/utils.ts","../src/Settable.ts","../src/Component.ts","../src/Query.ts","../src/Relation.ts","../src/Record.ts","../src/mindex/_utils.ts","../src/mindex/index.ts","../src/Collection.ts","../src/TsDataError.ts","../src/Schema.ts","../src/Relation/BelongsTo.ts","../src/Relation/HasMany.ts","../src/Relation/HasOne.ts","../src/relations.ts","../src/decorators.ts","../src/Mapper.ts","../src/Container.ts","../src/SimpleStore.ts","../src/LinkedCollection.ts","../src/DataStore.ts","../src/index.ts"],"sourcesContent":["/**\n * Utility methods used by JSData.\n *\n * @example\n * import { utils } from 'js-data';\n * console.log(utils.isString('foo')); // true\n *\n * @namespace utils\n * @type {Object}\n */\n\nconst DOMAIN = 'utils'\n\nconst INFINITY = 1 / 0\nconst MAX_INTEGER = 1.7976931348623157e308\nconst BOOL_TAG = '[object Boolean]'\nconst DATE_TAG = '[object Date]'\nconst FUNC_TAG = '[object Function]'\nconst NUMBER_TAG = '[object Number]'\nconst OBJECT_TAG = '[object Object]'\nconst REGEXP_TAG = '[object RegExp]'\nconst STRING_TAG = '[object String]'\nconst objToString = Object.prototype.toString\nconst PATH = /^(.+)\\.(.+)$/\n\nconst ERRORS = {\n  '400' (...args) {\n    return `expected: ${args[0]}, found: ${args[2] ? args[1] : typeof args[1]}`\n  },\n  '404' (...args) {\n    return `${args[0]} not found`\n  }\n}\n\nconst toInteger = value => {\n  if (!value) {\n    return 0\n  }\n  // Coerce to number\n  value = +value\n  if (value === INFINITY || value === -INFINITY) {\n    const sign = value < 0 ? -1 : 1\n    return sign * MAX_INTEGER\n  }\n  const remainder = value % 1\n  return value === value ? (remainder ? value - remainder : value) : 0; // eslint-disable-line\n}\n\nconst toStr = value => objToString.call(value)\n\nconst isPlainObject = value => !!value && typeof value === 'object' && value.constructor === Object\n\nconst mkdirP = (object, path) => {\n  if (!path) {\n    return object\n  }\n  const parts = path.split('.')\n  parts.forEach(key => {\n    if (!object[key]) {\n      object[key] = {}\n    }\n    object = object[key]\n  })\n  return object\n}\n\nconst utils = {\n  /**\n   * Shallow copy properties that meet the following criteria from `src` to\n   * `dest`:\n   *\n   * - own enumerable\n   * - not a function\n   * - does not start with \"_\"\n   *\n   * @method utils._\n   * @param {object} dest Destination object.\n   * @param {object} src Source object.\n   * @private\n   * @since 3.0.0\n   */\n  _ (dest, src) {\n    utils.forOwn(src, (value, key) => {\n      if (key && dest[key] === undefined && !utils.isFunction(value) && key.indexOf('_') !== 0) {\n        dest[key] = value\n      }\n    })\n  },\n\n  /**\n   * Recursively iterates over relations found in `opts.with`.\n   *\n   * @method utils._forRelation\n   * @param {object} opts Configuration options.\n   * @param {Relation} def Relation definition.\n   * @param {Function} fn Callback function.\n   * @param {*} [thisArg] Execution context for the callback function.\n   * @private\n   * @since 3.0.0\n   */\n  _forRelation (opts: any = {}, def, fn, thisArg) {\n    const relationName = def.relation\n    let containedName = null\n    let index\n    opts.with = opts.with || []\n\n    if ((index = utils._getIndex(opts.with, relationName)) >= 0) {\n      containedName = relationName\n    } else if ((index = utils._getIndex(opts.with, def.localField)) >= 0) {\n      containedName = def.localField\n    }\n\n    if (opts.withAll) {\n      fn.call(thisArg, def, {})\n      return\n    } else if (!containedName) {\n      return\n    }\n    const optsCopy: any = {}\n    utils.fillIn(optsCopy, def.getRelation())\n    utils.fillIn(optsCopy, opts)\n    optsCopy.with = opts.with.slice()\n    optsCopy._activeWith = optsCopy.with.splice(index, 1)[0]\n    optsCopy.with.forEach((relation, i) => {\n      if (\n        relation &&\n        relation.indexOf(containedName) === 0 &&\n        relation.length >= containedName.length &&\n        relation[containedName.length] === '.'\n      ) {\n        optsCopy.with[i] = relation.substr(containedName.length + 1)\n      } else {\n        optsCopy.with[i] = ''\n      }\n    })\n    fn.call(thisArg, def, optsCopy)\n  },\n\n  /**\n   * Find the index of a relation in the given list\n   *\n   * @method utils._getIndex\n   * @param {string[]} list List to search.\n   * @param {string} relation Relation to find.\n   * @private\n   * @returns {number}\n   */\n  _getIndex (list, relation) {\n    let index = -1\n    list.forEach((_relation, i) => {\n      if (_relation === relation) {\n        index = i\n        return false\n      } else if (utils.isObject(_relation)) {\n        if (_relation.relation === relation) {\n          index = i\n          return false\n        }\n      }\n    })\n    return index\n  },\n\n  /**\n   * Define hidden (non-enumerable), writable properties on `target` from the\n   * provided `props`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * function Cat () {}\n   * utils.addHiddenPropsToTarget(Cat.prototype, {\n   *   say () {\n   *     console.log('meow');\n   *   }\n   * });\n   * const cat = new Cat();\n   * cat.say(); // \"meow\"\n   *\n   * @method utils.addHiddenPropsToTarget\n   * @param {object} target That to which `props` should be added.\n   * @param {object} props Properties to be added to `target`.\n   * @since 3.0.0\n   */\n  addHiddenPropsToTarget (target, props) {\n    const map = {}\n    Object.keys(props).forEach(propName => {\n      const descriptor = Object.getOwnPropertyDescriptor(props, propName)\n\n      descriptor.enumerable = false\n      map[propName] = descriptor\n    })\n    Object.defineProperties(target, map)\n  },\n\n  /**\n   * Return whether the two objects are deeply different.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * utils.areDifferent({}, {}); // false\n   * utils.areDifferent({ a: 1 }, { a: 1 }); // false\n   * utils.areDifferent({ foo: 'bar' }, {}); // true\n   *\n   * @method utils.areDifferent\n   * @param newObject\n   * @param oldObject\n   * @param {object} [opts] Configuration options.\n   * @param {Function} [opts.equalsFn={@link utils.deepEqual}] Equality function.\n   * @param {array} [opts.ignore=[]] Array of strings or RegExp of fields to ignore.\n   * @returns {boolean} Whether the two objects are deeply different.\n   * @see utils.diffObjects\n   * @since 3.0.0\n   */\n  areDifferent (newObject, oldObject, opts: any = {}) {\n    const diff = utils.diffObjects(newObject, oldObject, opts)\n    const diffCount =\n      Object.keys(diff.added).length + Object.keys(diff.removed).length + Object.keys(diff.changed).length\n    return diffCount > 0\n  },\n\n  /**\n   * Deep copy a value.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { foo: { bar: 'baz' } };\n   * const b = utils.copy(a);\n   * a === b; // false\n   * utils.areDifferent(a, b); // false\n   *\n   * @param {*} from Value to deep copy.\n   * @param {*} [to] Destination object for the copy operation.\n   * @param {*} [stackFrom] For internal use.\n   * @param {*} [stackTo] For internal use.\n   * @param {string[]|RegExp[]} [blacklist] List of strings or RegExp of\n   * properties to skip.\n   * @param {boolean} [plain] Whether to make a plain copy (don't try to use\n   * original prototype).\n   * @returns {*} Deep copy of `from`.\n   * @since 3.0.0\n   */\n  copy (from, to?, stackFrom?, stackTo?, blacklist?, plain?) {\n    if (!to) {\n      to = from\n      if (from) {\n        if (utils.isArray(from)) {\n          to = utils.copy(from, [], stackFrom, stackTo, blacklist, plain)\n        } else if (utils.isDate(from)) {\n          to = new Date(from.getTime())\n        } else if (utils.isRegExp(from)) {\n          to = new RegExp(from.source, from.toString().match(/[^/]*$/)[0])\n          to.lastIndex = from.lastIndex\n        } else if (utils.isObject(from)) {\n          if (plain) {\n            to = utils.copy(from, {}, stackFrom, stackTo, blacklist, plain)\n          } else {\n            to = utils.copy(from, Object.create(Object.getPrototypeOf(from)), stackFrom, stackTo, blacklist, plain)\n          }\n        }\n      }\n    } else {\n      if (from === to) {\n        throw utils.err(`${DOMAIN}.copy`)(500, 'Cannot copy! Source and destination are identical.')\n      }\n\n      stackFrom = stackFrom || []\n      stackTo = stackTo || []\n\n      if (utils.isObject(from)) {\n        const index = stackFrom.indexOf(from)\n        if (index !== -1) {\n          return stackTo[index]\n        }\n\n        stackFrom.push(from)\n        stackTo.push(to)\n      }\n\n      let result\n      if (utils.isArray(from)) {\n        let i\n        to.length = 0\n        for (i = 0; i < from.length; i++) {\n          result = utils.copy(from[i], null, stackFrom, stackTo, blacklist, plain)\n          if (utils.isObject(from[i])) {\n            stackFrom.push(from[i])\n            stackTo.push(result)\n          }\n          to.push(result)\n        }\n      } else {\n        if (utils.isArray(to)) {\n          to.length = 0\n        } else {\n          utils.forOwn(to, (value, key) => {\n            delete to[key]\n          })\n        }\n        for (const key in from) {\n          if (from.hasOwnProperty(key)) {\n            if (utils.isBlacklisted(key, blacklist)) {\n              continue\n            }\n            result = utils.copy(from[key], null, stackFrom, stackTo, blacklist, plain)\n            if (utils.isObject(from[key])) {\n              stackFrom.push(from[key])\n              stackTo.push(result)\n            }\n            to[key] = result\n          }\n        }\n      }\n    }\n    return to\n  },\n\n  /**\n   * Recursively shallow fill in own enumerable properties from `source` to\n   * `dest`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { foo: { bar: 'baz' }, beep: 'boop' };\n   * const b = { beep: 'bip' };\n   * utils.deepFillIn(b, a);\n   * console.log(b); // {\"foo\":{\"bar\":\"baz\"},\"beep\":\"bip\"}\n   *\n   * @method utils.deepFillIn\n   * @param {object} dest The destination object.\n   * @param {object} source The source object.\n   * @see utils.fillIn\n   * @see utils.deepMixIn\n   * @since 3.0.0\n   */\n  deepFillIn (dest, source?) {\n    if (source) {\n      utils.forOwn(source, (value, key) => {\n        const existing = dest[key]\n        if (isPlainObject(value) && isPlainObject(existing)) {\n          utils.deepFillIn(existing, value)\n        } else if (!dest.hasOwnProperty(key) || dest[key] === undefined) {\n          dest[key] = value\n        }\n      })\n    }\n    return dest\n  },\n\n  /**\n   * Recursively shallow copy enumerable properties from `source` to `dest`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { foo: { bar: 'baz' }, beep: 'boop' };\n   * const b = { beep: 'bip' };\n   * utils.deepFillIn(b, a);\n   * console.log(b); // {\"foo\":{\"bar\":\"baz\"},\"beep\":\"boop\"}\n   *\n   * @method utils.deepMixIn\n   * @param {object} dest The destination object.\n   * @param {object} source The source object.\n   * @see utils.fillIn\n   * @see utils.deepFillIn\n   * @since 3.0.0\n   */\n  deepMixIn (dest, source?) {\n    if (source) {\n      // tslint:disable-next-line:forin\n      for (const key in source) {\n        const value = source[key]\n        const existing = dest[key]\n        if (isPlainObject(value) && isPlainObject(existing)) {\n          utils.deepMixIn(existing, value)\n        } else {\n          dest[key] = value\n        }\n      }\n    }\n    return dest\n  },\n\n  /**\n   * Return a diff of the base object to the comparison object.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const oldObject = { foo: 'bar', a: 1234 };\n   * const newObject = { beep: 'boop', a: 5678 };\n   * const diff = utils.diffObjects(oldObject, newObject);\n   * console.log(diff.added); // {\"beep\":\"boop\"}\n   * console.log(diff.changed); // {\"a\":5678}\n   * console.log(diff.removed); // {\"foo\":undefined}\n   *\n   * @method utils.diffObjects\n   * @param {object} newObject Comparison object.\n   * @param {object} oldObject Base object.\n   * @param {object} [opts] Configuration options.\n   * @param {Function} [opts.equalsFn={@link utils.deepEqual}] Equality function.\n   * @param {array} [opts.ignore=[]] Array of strings or RegExp of fields to ignore.\n   * @returns {Object} The diff from the base object to the comparison object.\n   * @see utils.areDifferent\n   * @since 3.0.0\n   */\n  diffObjects (newObject, oldObject, opts: any = {}) {\n    let equalsFn = opts.equalsFn\n    const blacklist = opts.ignore\n    const diff = {\n      added: {},\n      changed: {},\n      removed: {}\n    }\n    if (!utils.isFunction(equalsFn)) {\n      equalsFn = utils.deepEqual\n    }\n\n    const newKeys = Object.keys(newObject).filter(key => !utils.isBlacklisted(key, blacklist))\n    const oldKeys = Object.keys(oldObject).filter(key => !utils.isBlacklisted(key, blacklist))\n\n    // Check for properties that were added or changed\n    newKeys.forEach(key => {\n      const oldValue = oldObject[key]\n      const newValue = newObject[key]\n      if (equalsFn(oldValue, newValue)) {\n        return\n      }\n      if (oldValue === undefined) {\n        diff.added[key] = newValue\n      } else {\n        diff.changed[key] = newValue\n      }\n    })\n\n    // Check for properties that were removed\n    oldKeys.forEach(key => {\n      const oldValue = oldObject[key]\n      const newValue = newObject[key]\n      if (newValue === undefined && oldValue !== undefined) {\n        diff.removed[key] = undefined\n      }\n    })\n\n    return diff\n  },\n\n  /**\n   * Return whether the two values are equal according to the `==` operator.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * console.log(utils.equal(1,1)); // true\n   * console.log(utils.equal(1,'1')); // true\n   * console.log(utils.equal(93, 66)); // false\n   *\n   * @method utils.equal\n   * @param {*} a First value in the comparison.\n   * @param {*} b Second value in the comparison.\n   * @returns {boolean} Whether the two values are equal according to `==`.\n   * @since 3.0.0\n   */\n  equal (a, b) {\n    // tslint:disable-next-line:triple-equals\n    return a == b; // eslint-disable-line\n  },\n\n  /**\n   * Produce a factory function for making Error objects with the provided\n   * metadata. Used throughout the various js-data components.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const errorFactory = utils.err('domain', 'target');\n   * const error400 = errorFactory(400, 'expected type', 'actual type');\n   * console.log(error400); // [Error: [domain:target] expected: expected type, found: string\n   * http://www.js-data.io/v3.0/docs/errors#400]\n   * @method utils.err\n   * @param {string} domain Namespace.\n   * @param {string} target Target.\n   * @returns {Function} Factory function.\n   * @since 3.0.0\n   */\n  err (domain, target?) {\n    return (code, ...args) => {\n      const prefix = `[${domain}:${target}] `\n      let message = ERRORS[code].apply(null, args)\n      message = `${prefix}${message}\nhttp://www.js-data.io/v3.0/docs/errors#${code}`\n      return new Error(message)\n    }\n  },\n\n  /**\n   * Add eventing capabilities into the target object.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const user = { name: 'John' };\n   * utils.eventify(user);\n   * user.on('foo', () => console.log(arguments));\n   * user.emit('foo', 1, 'bar'); // should log to console values (1, \"bar\")\n   *\n   * @method utils.eventify\n   * @param {object} target Target object.\n   * @param {Function} [getter] Custom getter for retrieving the object's event\n   * listeners.\n   * @param {Function} [setter] Custom setter for setting the object's event\n   * listeners.\n   * @since 3.0.0\n   */\n  eventify (target, getter?, setter?) {\n    target = target || this\n    let _events = {}\n    if (!getter && !setter) {\n      getter = () => _events\n      setter = value => (_events = value)\n    }\n    Object.defineProperties(target, {\n      emit: {\n        value (...args) {\n          const events = getter.call(this) || {}\n          const type = args.shift()\n          let listeners = events[type] || []\n          let i\n          for (i = 0; i < listeners.length; i++) {\n            listeners[i].f.apply(listeners[i].c, args)\n          }\n          listeners = events.all || []\n          args.unshift(type)\n          for (i = 0; i < listeners.length; i++) {\n            listeners[i].f.apply(listeners[i].c, args)\n          }\n        }\n      },\n      off: {\n        value (type, func) {\n          const events = getter.call(this)\n          const listeners = events[type]\n          if (!listeners) {\n            setter.call(this, {})\n          } else if (func) {\n            for (let i = 0; i < listeners.length; i++) {\n              if (listeners[i].f === func) {\n                listeners.splice(i, 1)\n                break\n              }\n            }\n          } else {\n            listeners.splice(0, listeners.length)\n          }\n        }\n      },\n      on: {\n        value (type, func, thisArg) {\n          if (!getter.call(this)) {\n            setter.call(this, {})\n          }\n          const events = getter.call(this)\n          events[type] = events[type] || []\n          events[type].push({\n            c: thisArg,\n            f: func\n          })\n        }\n      }\n    })\n  },\n\n  /**\n   * Shallow copy own enumerable properties from `src` to `dest` that are on\n   * `src` but are missing from `dest.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { foo: 'bar', beep: 'boop' };\n   * const b = { beep: 'bip' };\n   * utils.fillIn(b, a);\n   * console.log(b); // {\"foo\":\"bar\",\"beep\":\"bip\"}\n   *\n   * @method utils.fillIn\n   * @param {object} dest The destination object.\n   * @param src\n   * @see utils.deepFillIn\n   * @see utils.deepMixIn\n   * @since 3.0.0\n   */\n  fillIn (dest, src) {\n    utils.forOwn(src, (value, key) => {\n      if (!dest.hasOwnProperty(key) || dest[key] === undefined) {\n        dest[key] = value\n      }\n    })\n  },\n\n  /**\n   * Find the last index of an item in an array according to the given checker function.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   *\n   * const john = { name: 'John', age: 20 };\n   * const sara = { name: 'Sara', age: 25 };\n   * const dan = { name: 'Dan', age: 20 };\n   * const users = [john, sara, dan];\n   *\n   * console.log(utils.findIndex(users, (user) => user.age === 25)); // 1\n   * console.log(utils.findIndex(users, (user) => user.age > 19)); // 2\n   * console.log(utils.findIndex(users, (user) => user.name === 'John')); // 0\n   * console.log(utils.findIndex(users, (user) => user.name === 'Jimmy')); // -1\n   *\n   * @method utils.findIndex\n   * @param {array} array The array to search.\n   * @param {Function} fn Checker function.\n   * @returns {number} Index if found or -1 if not found.\n   * @since 3.0.0\n   */\n  findIndex (array, fn) {\n    let index = -1\n    if (!array) {\n      return index\n    }\n    array.forEach((record, i) => {\n      if (fn(record)) {\n        index = i\n        return false\n      }\n    })\n    return index\n  },\n\n  /**\n   * Recursively iterate over a {@link Mapper}'s relations according to\n   * `opts.with`.\n   *\n   * @method utils.forEachRelation\n   * @param {Mapper} mapper Mapper.\n   * @param {object} opts Configuration options.\n   * @param {Function} fn Callback function.\n   * @param {*} thisArg Execution context for the callback function.\n   * @since 3.0.0\n   */\n  forEachRelation (mapper, opts, fn, thisArg?) {\n    const relationList = mapper.relationList || []\n    if (!relationList.length) {\n      return\n    }\n    relationList.forEach(def => {\n      utils._forRelation(opts, def, fn, thisArg)\n    })\n  },\n\n  /**\n   * Iterate over an object's own enumerable properties.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { b: 1, c: 4 };\n   * let sum = 0;\n   * utils.forOwn(a, function (value, key) {\n   *   sum += value;\n   * });\n   * console.log(sum); // 5\n   *\n   * @method utils.forOwn\n   * @param obj\n   * @param {Function} fn Iteration function.\n   * @param {object} [thisArg] Content to which to bind `fn`.\n   * @since 3.0.0\n   */\n  forOwn (obj, fn, thisArg?) {\n    const keys = Object.keys(obj)\n    const len = keys.length\n    let i\n    for (i = 0; i < len; i++) {\n      if (fn.call(thisArg, obj[keys[i]], keys[i], obj) === false) {\n        break\n      }\n    }\n  },\n\n  /**\n   * Proxy for `JSON.parse`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   *\n   * const a = utils.fromJson('{\"name\" : \"John\"}');\n   * console.log(a); // { name: 'John' }\n   *\n   * @method utils.fromJson\n   * @param {string} json JSON to parse.\n   * @returns {Object} Parsed object.\n   * @see utils.toJson\n   * @since 3.0.0\n   */\n  fromJson (json) {\n    return utils.isString(json) ? JSON.parse(json) : json\n  },\n\n  /**\n   * Retrieve the specified property from the given object. Supports retrieving\n   * nested properties.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { foo: { bar: 'baz' }, beep: 'boop' };\n   * console.log(utils.get(a, 'beep')); // \"boop\"\n   * console.log(utils.get(a, 'foo.bar')); // \"baz\"\n   *\n   * @method utils.get\n   * @param {object} object Object from which to retrieve a property's value.\n   * @param {string} prop Property to retrieve.\n   * @returns {*} Value of the specified property.\n   * @see utils.set\n   * @since 3.0.0\n   */\n  get (object, prop) {\n    if (!prop) {\n      return\n    }\n    const parts = prop.split('.')\n    const last = parts.pop()\n\n    while ((prop = parts.shift())) {\n      // eslint-disable-line\n      object = object[prop]\n      if (object == null) {\n        // eslint-disable-line\n        return\n      }\n    }\n\n    return object[last]\n  },\n\n  /**\n   * Return the superclass for the given instance or subclass. If an instance is\n   * provided, then finds the parent class of the instance's constructor.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * // using ES2015 classes\n   * class Foo {}\n   * class Bar extends Foo {}\n   * const barInstance = new Bar();\n   * let baseType = utils.getSuper(barInstance);\n   * console.log(Foo === baseType); // true\n   *\n   * // using Function constructor with utils.extend\n   * function Foo () {}\n   * Foo.extend = utils.extend;\n   * const Bar = Foo.extend();\n   * const barInstance = new Bar();\n   * let baseType = utils.getSuper(barInstance);\n   * console.log(Foo === baseType); // true\n   *\n   * @method utils.getSuper\n   * @param {Object|Function} instance Instance or constructor.\n   * @param {boolean} [isCtor=false] Whether `instance` is a constructor.\n   * @returns {Constructor} The superclass (grandparent constructor).\n   * @since 3.0.0\n   */\n  getSuper (instance, isCtor?) {\n    const ctor = isCtor ? instance : instance.constructor\n    if (ctor.hasOwnProperty('__super__')) {\n      return ctor.__super__\n    }\n    return Object.getPrototypeOf(ctor) || ctor.__proto__; // eslint-disable-line\n  },\n\n  /**\n   * Return the intersection of two arrays.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const arrA = ['green', 'red', 'blue', 'red'];\n   * const arrB = ['green', 'yellow', 'red'];\n   * const intersected = utils.intersection(arrA, arrB);\n   *\n   * console.log(intersected); // ['green', 'red'])\n   *\n   * @method utils.intersection\n   * @param {array} array1 First array.\n   * @param {array} array2 Second array.\n   * @returns {Array} Array of elements common to both arrays.\n   * @since 3.0.0\n   */\n  intersection (array1, array2) {\n    if (!array1 || !array2) {\n      return []\n    }\n    array1 = Array.isArray(array1) ? array1 : [array1]\n    array2 = Array.isArray(array2) ? array2 : [array2]\n    const result = []\n    let item\n    let i\n    const len = array1.length\n    for (i = 0; i < len; i++) {\n      item = array1[i]\n      if (result.indexOf(item) !== -1) {\n        continue\n      }\n      if (array2.indexOf(item) !== -1) {\n        result.push(item)\n      }\n    }\n    return result\n  },\n\n  /**\n   * Proxy for `Array.isArray`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = [1,2,3,4,5];\n   * const b = { foo: \"bar\" };\n   * console.log(utils.isArray(a)); // true\n   * console.log(utils.isArray(b)); // false\n   *\n   * @method utils.isArray\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is an array.\n   * @since 3.0.0\n   */\n  isArray: Array.isArray,\n\n  /**\n   * Return whether `prop` is matched by any string or regular expression in\n   * `blacklist`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const blacklist = [/^\\$hashKey/g, /^_/g, 'id'];\n   * console.log(utils.isBlacklisted(\"$hashKey\", blacklist)); // true\n   * console.log(utils.isBlacklisted(\"id\", blacklist)); // true\n   * console.log(utils.isBlacklisted(\"_myProp\", blacklist)); // true\n   * console.log(utils.isBlacklisted(\"my_id\", blacklist)); // false\n   *\n   * @method utils.isBlacklisted\n   * @param {string} prop The name of a property to check.\n   * @param {array} blacklist Array of strings and regular expressions.\n   * @returns {boolean} Whether `prop` was matched.\n   * @since 3.0.0\n   */\n  isBlacklisted (prop, blacklist) {\n    if (!blacklist || !blacklist.length) {\n      return false\n    }\n    let matches\n    for (const item of blacklist) {\n      if ((toStr(item) === REGEXP_TAG && item.test(prop)) || item === prop) {\n        matches = prop\n        return !!matches\n      }\n    }\n    return !!matches\n  },\n\n  /**\n   * Return whether the provided value is a boolean.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = true;\n   * const b = { foo: \"bar\" };\n   * console.log(utils.isBoolean(a)); // true\n   * console.log(utils.isBoolean(b)); // false\n   *\n   * @method utils.isBoolean\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is a boolean.\n   * @since 3.0.0\n   */\n  isBoolean (value) {\n    return toStr(value) === BOOL_TAG\n  },\n\n  /**\n   * Return whether the provided value is a date.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = new Date();\n   * const b = { foo: \"bar\" };\n   * console.log(utils.isDate(a)); // true\n   * console.log(utils.isDate(b)); // false\n   *\n   * @method utils.isDate\n   * @param {*} value The value to test.\n   * @returns {Date} Whether the provided value is a date.\n   * @since 3.0.0\n   */\n  isDate (value) {\n    return value && typeof value === 'object' && toStr(value) === DATE_TAG\n  },\n\n  /**\n   * Return whether the provided value is a function.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = function () { console.log('foo bar'); };\n   * const b = { foo: \"bar\" };\n   * console.log(utils.isFunction(a)); // true\n   * console.log(utils.isFunction(b)); // false\n   *\n   * @method utils.isFunction\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is a function.\n   * @since 3.0.0\n   */\n  isFunction (value) {\n    return typeof value === 'function' || (value && toStr(value) === FUNC_TAG)\n  },\n\n  /**\n   * Return whether the provided value is an integer.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = 1;\n   * const b = 1.25;\n   * const c = '1';\n   * console.log(utils.isInteger(a)); // true\n   * console.log(utils.isInteger(b)); // false\n   * console.log(utils.isInteger(c)); // false\n   *\n   * @method utils.isInteger\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is an integer.\n   * @since 3.0.0\n   */\n  isInteger (value) {\n    // tslint:disable-next-line:triple-equals\n    return toStr(value) === NUMBER_TAG && value == toInteger(value); // eslint-disable-line\n  },\n\n  /**\n   * Return whether the provided value is `null`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = null;\n   * const b = { foo: \"bar\" };\n   * console.log(utils.isNull(a)); // true\n   * console.log(utils.isNull(b)); // false\n   *\n   * @method utils.isNull\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is `null`.\n   * @since 3.0.0\n   */\n  isNull (value) {\n    return value === null\n  },\n\n  /**\n   * Return whether the provided value is a number.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = 1;\n   * const b = -1.25;\n   * const c = '1';\n   * console.log(utils.isNumber(a)); // true\n   * console.log(utils.isNumber(b)); // true\n   * console.log(utils.isNumber(c)); // false\n   *\n   * @method utils.isNumber\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is a number.\n   * @since 3.0.0\n   */\n  isNumber (value) {\n    const type = typeof value\n    return type === 'number' || (value && type === 'object' && toStr(value) === NUMBER_TAG)\n  },\n\n  /**\n   * Return whether the provided value is an object.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { foo: \"bar\" };\n   * const b = 'foo bar';\n   * console.log(utils.isObject(a)); // true\n   * console.log(utils.isObject(b)); // false\n   *\n   * @method utils.isObject\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is an object.\n   * @since 3.0.0\n   */\n  isObject (value) {\n    return toStr(value) === OBJECT_TAG\n  },\n\n  /**\n   * Return whether the provided value is a regular expression.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = /^\\$.+$/ig;\n   * const b = new RegExp('^\\$.+$', 'ig');\n   * const c = { foo: \"bar\" };\n   * console.log(utils.isRegExp(a)); // true\n   * console.log(utils.isRegExp(b)); // true\n   * console.log(utils.isRegExp(c)); // false\n   *\n   * @method utils.isRegExp\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is a regular expression.\n   * @since 3.0.0\n   */\n  isRegExp (value) {\n    return toStr(value) === REGEXP_TAG\n  },\n\n  /**\n   * Return whether the provided value is a string or a number.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * console.log(utils.isSorN('')); // true\n   * console.log(utils.isSorN(-1.65)); // true\n   * console.log(utils.isSorN('my string')); // true\n   * console.log(utils.isSorN({})); // false\n   * console.log(utils.isSorN([1,2,4])); // false\n   *\n   * @method utils.isSorN\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is a string or a number.\n   * @since 3.0.0\n   */\n  isSorN (value) {\n    return utils.isString(value) || utils.isNumber(value)\n  },\n\n  /**\n   * Return whether the provided value is a string.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * console.log(utils.isString('')); // true\n   * console.log(utils.isString('my string')); // true\n   * console.log(utils.isString(100)); // false\n   * console.log(utils.isString([1,2,4])); // false\n   *\n   * @method utils.isString\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is a string.\n   * @since 3.0.0\n   */\n  isString (value) {\n    return typeof value === 'string' || (value && typeof value === 'object' && toStr(value) === STRING_TAG)\n  },\n\n  /**\n   * Return whether the provided value is a `undefined`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = undefined;\n   * const b = { foo: \"bar\"};\n   * console.log(utils.isUndefined(a)); // true\n   * console.log(utils.isUndefined(b.baz)); // true\n   * console.log(utils.isUndefined(b)); // false\n   * console.log(utils.isUndefined(b.foo)); // false\n   *\n   * @method utils.isUndefined\n   * @param {*} value The value to test.\n   * @returns {boolean} Whether the provided value is a `undefined`.\n   * @since 3.0.0\n   */\n  isUndefined (value) {\n    return value === undefined\n  },\n\n  /**\n   * Mix in logging capabilities to the target.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { foo: \"bar\"};\n   *\n   * // Add standard logging to an object\n   * utils.logify(a);\n   * a.log('info', 'test log info'); // output 'test log info' to console.\n   *\n   * // Toggle debug output of an object\n   * a.dbg('test debug output'); // does not output because debug is off.\n   * a.debug = true;\n   * a.dbg('test debug output'); // output 'test debug output' to console.\n   *\n   * @method utils.logify\n   * @param {*} target The target.\n   * @since 3.0.0\n   */\n  logify (target) {\n    utils.addHiddenPropsToTarget(target, {\n      dbg (...args) {\n        if (utils.isFunction(this.log)) {\n          this.log('debug', ...args)\n        }\n      },\n      log (level, ...args) {\n        if (level && !args.length) {\n          args.push(level)\n          level = 'debug'\n        }\n        if (level === 'debug' && !this.debug) {\n          return\n        }\n        const prefix = `${level.toUpperCase()}: (${this.name || this.constructor.name})`\n        if (utils.isFunction(console[level])) {\n          console[level](prefix, ...args)\n        } else {\n          console.log(prefix, ...args)\n        }\n      }\n    })\n  },\n\n  /**\n   * Adds the given record to the provided array only if it's not already in the\n   * array.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const colors = ['red', 'green', 'yellow'];\n   *\n   * console.log(colors.length); // 3\n   * utils.noDupeAdd(colors, 'red');\n   * console.log(colors.length); // 3, red already exists\n   *\n   * utils.noDupeAdd(colors, 'blue');\n   * console.log(colors.length); // 4, blue was added\n   *\n   * @method utils.noDupeAdd\n   * @param {array} array The array.\n   * @param {*} record The value to add.\n   * @param {Function} fn Callback function passed to {@link utils.findIndex}.\n   * @since 3.0.0\n   */\n  noDupeAdd (array, record?, fn?) {\n    if (!array) {\n      return\n    }\n    const index = this.findIndex(array, fn)\n    if (index < 0) {\n      array.push(record)\n    }\n  },\n\n  /**\n   * Return a shallow copy of the provided object, minus the properties\n   * specified in `keys`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { name: 'John', $hashKey: 1214910 };\n   *\n   * let b = utils.omit(a, ['$hashKey']);\n   * console.log(b); // { name: 'John' }\n   *\n   * @method utils.omit\n   * @param {object} props The object to copy.\n   * @param {string[]} keys Array of strings, representing properties to skip.\n   * @returns {Object} Shallow copy of `props`, minus `keys`.\n   * @since 3.0.0\n   */\n  omit (props, keys) {\n    const _props = {}\n    utils.forOwn(props, (value, key) => {\n      if (keys.indexOf(key) === -1) {\n        _props[key] = value\n      }\n    })\n    return _props\n  },\n\n  /**\n   * Return a shallow copy of the provided object, but only include the\n   * properties specified in `keys`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { name: 'John', $hashKey: 1214910 };\n   *\n   * let b = utils.pick(a, ['$hashKey']);\n   * console.log(b); // { $hashKey: 1214910 }\n   *\n   * @method utils.pick\n   * @param {object} props The object to copy.\n   * @param {string[]} keys Array of strings, representing properties to keep.\n   * @returns {Object} Shallow copy of `props`, but only including `keys`.\n   * @since 3.0.0\n   */\n  pick (props, keys) {\n    return keys.reduce((map, key) => {\n      map[key] = props[key]\n      return map\n    }, {})\n  },\n\n  /**\n   * Return a plain copy of the given value.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   * const a = { name: 'John' };\n   * let b = utils.plainCopy(a);\n   * console.log(a === b); // false\n   *\n   * @method utils.plainCopy\n   * @param {*} value The value to copy.\n   * @returns {*} Plain copy of `value`.\n   * @see utils.copy\n   * @since 3.0.0\n   */\n  plainCopy (value) {\n    return utils.copy(value, undefined, undefined, undefined, undefined, true)\n  },\n\n  /**\n   * Shortcut for `utils.Promise.reject(value)`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   *\n   * utils.reject(\"Testing static reject\").then(function (data) {\n   *   // not called\n   * }).catch(function (reason) {\n   *   console.log(reason); // \"Testing static reject\"\n   * });\n   *\n   * @method utils.reject\n   * @param {*} [value] Value with which to reject the Promise.\n   * @returns {Promise} Promise reject with `value`.\n   */\n  reject (value) {\n    return Promise.reject(value)\n  },\n\n  /**\n   * Remove the last item found in array according to the given checker function.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   *\n   * const colors = ['red', 'green', 'yellow', 'red'];\n   * utils.remove(colors, (color) => color === 'red');\n   * console.log(colors); // ['red', 'green', 'yellow']\n   *\n   * @method utils.remove\n   * @param {array} array The array to search.\n   * @param {Function} fn Checker function.\n   */\n  remove (array, fn?) {\n    if (!array || !array.length) {\n      return\n    }\n    const index = this.findIndex(array, fn)\n    if (index >= 0) {\n      array.splice(index, 1) // todo should this be recursive?\n    }\n  },\n\n  /**\n   * Shortcut for `utils.Promise.resolve(value)`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   *\n   * utils.resolve(\"Testing static resolve\").then(function (data) {\n   *   console.log(data); // \"Testing static resolve\"\n   * }).catch(function (reason) {\n   *   // not called\n   * });\n   *\n   * @param {*} [value] Value with which to resolve the Promise.\n   * @returns {Promise} Promise resolved with `value`.\n   */\n  resolve (value?) {\n    return Promise.resolve(value)\n  },\n\n  /**\n   * Set the value at the provided key or path.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   *\n   * const john = {\n   *   name: 'John',\n   *   age: 25,\n   *   parent: {\n   *     name: 'John's Mom',\n   *     age: 50\n   *   }\n   * };\n   * // set value by key\n   * utils.set(john, 'id', 98);\n   * console.log(john.id); // 98\n   *\n   * // set value by path\n   * utils.set(john, 'parent.id', 20);\n   * console.log(john.parent.id); // 20\n   *\n   * // set value by path/value map\n   * utils.set(john, {\n   *   'id': 1098,\n   *   'parent': { id: 1020 },\n   *   'parent.age': '55'\n   * });\n   * console.log(john.id); // 1098\n   * console.log(john.parent.id); // 1020\n   * console.log(john.parent.age); // 55\n   *\n   * @method utils.set\n   * @param {object} object The object on which to set a property.\n   * @param {(string|Object)} path The key or path to the property. Can also\n   * pass in an object of path/value pairs, which will all be set on the target\n   * object.\n   * @param {*} [value] The value to set.\n   */\n  set (object, path, value?, opts?) {\n    if (utils.isObject(path)) {\n      utils.forOwn(path, (value, _path) => {\n        utils.set(object, _path, value)\n      })\n    } else {\n      const parts = PATH.exec(path)\n      if (parts) {\n        mkdirP(object, parts[1])[parts[2]] = value\n      } else {\n        object[path] = value\n      }\n    }\n  },\n\n  /**\n   * Check whether the two provided objects are deeply equal.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   *\n   * const objA = {\n   *   name: 'John',\n   *   id: 27,\n   *   nested: {\n   *     item: 'item 1',\n   *     colors: ['red', 'green', 'blue']\n   *   }\n   * };\n   *\n   * const objB = {\n   *   name: 'John',\n   *   id: 27,\n   *   nested: {\n   *     item: 'item 1',\n   *     colors: ['red', 'green', 'blue']\n   *   }\n   * };\n   *\n   * console.log(utils.deepEqual(a,b)); // true\n   * objB.nested.colors.add('yellow'); // make a change to a nested object's array\n   * console.log(utils.deepEqual(a,b)); // false\n   *\n   * @method utils.deepEqual\n   * @param {object} a First object in the comparison.\n   * @param {object} b Second object in the comparison.\n   * @returns {boolean} Whether the two provided objects are deeply equal.\n   * @see utils.equal\n   * @since 3.0.0\n   */\n  deepEqual (a, b) {\n    if (a === b) {\n      return true\n    }\n    let _equal = true\n    if (utils.isArray(a) && utils.isArray(b)) {\n      if (a.length !== b.length) {\n        return false\n      }\n      for (let i = a.length; i--;) {\n        if (!utils.deepEqual(a[i], b[i])) {\n          // Exit loop early\n          return false\n        }\n      }\n    } else if (utils.isObject(a) && utils.isObject(b)) {\n      utils.forOwn(a, (value, key) => {\n        if (!(_equal = utils.deepEqual(value, b[key]))) {\n          // Exit loop early\n          return false\n        }\n      })\n      if (_equal) {\n        utils.forOwn(b, (value, key) => {\n          if (!(_equal = utils.deepEqual(value, a[key]))) {\n            // Exit loop early\n            return false\n          }\n        })\n      }\n    } else {\n      return false\n    }\n    return _equal\n  },\n\n  /**\n   * Proxy for `JSON.stringify`.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   *\n   * const a = { name: 'John' };\n   * let jsonVal = utils.toJson(a);\n   * console.log(jsonVal); // '{\"name\" : \"John\"}'\n   *\n   * @method utils.toJson\n   * @param {*} value Value to serialize to JSON.\n   * @returns {string} JSON string.\n   * @see utils.fromJson\n   * @since 3.0.0\n   */\n  toJson: JSON.stringify,\n\n  /**\n   * Unset the value at the provided key or path.\n   *\n   * @example\n   * import { utils } from 'js-data';\n   *\n   * const john = {\n   *   name: 'John',\n   *   age: 25,\n   *   parent: {\n   *     name: 'John's Mom',\n   *     age: 50\n   *   }\n   * };\n   *\n   * utils.unset(john, age);\n   * utils.unset(john, parent.age);\n   *\n   * console.log(john.age); // null\n   * console.log(john.parent.age); // null\n   *\n   * @method utils.unset\n   * @param {object} object The object from which to delete the property.\n   * @param {string} path The key or path to the property.\n   * @see utils.set\n   * @since 3.0.0\n   */\n  unset (object, path: string) {\n    const parts = path.split('.')\n    const last = parts.pop()\n\n    while ((path = parts.shift())) {\n      // eslint-disable-line\n      object = object[path]\n      if (object == null) {\n        // eslint-disable-line\n        return\n      }\n    }\n\n    object[last] = undefined\n  }\n}\n\nexport const safeSetProp = (record, field, value) => {\n  if (record?._set) {\n    record._set(`props.${field}`, value)\n  } else {\n    utils.set(record, field, value)\n  }\n}\n\nexport const safeSetLink = (record, field, value) => {\n  if (record?._set) {\n    record._set(`links.${field}`, value)\n  } else {\n    utils.set(record, field, value)\n  }\n}\n\nexport default utils\n","import utils from './utils'\n\n/**\n * A base class which gives instances private properties.\n *\n * Typically you won't instantiate this class directly, but you may find it\n * useful as an abstract class for your own components.\n *\n * @example\n * import {Settable} from 'js-data';\n *\n * class CustomSettableClass extends Settable {\n *   foo () { return 'bar'; }\n *   static beep () { return 'boop'; }\n * }\n *\n * const customSettable = new CustomSettableClass();\n * console.log(customSettable.foo());\n * console.log(CustomSettableClass.beep());\n *\n * @since 3.0.0\n */\nexport default class Settable {\n  [customAttr: string]: any;\n\n  /**\n   * Get a private property of this instance.\n   *\n   * __Don't use the method unless you know what you're doing.__\n   *\n   * @method Settable#_get\n   * @param {string} key The property to retrieve.\n   * @returns {*} The value of the property.\n   * @since 3.0.0\n   */\n  protected _get: (key: string) => any;\n\n  /**\n   * Set a private property of this instance.\n   *\n   * __Don't use the method unless you know what you're doing.__\n   *\n   * @method __Don't use the method unless you know what you're doing.__#_set\n   * @param {(string|Object)} key The key or path to the property. Can also\n   * pass in an object of key/value pairs, which will all be set on the instance.\n   * @param {*} [value] The value to set.\n   * @since 3.0.0\n   */\n  protected _set: (key, value?) => any;\n\n  /**\n   * Unset a private property of this instance.\n   *\n   * __Don't use the method unless you know what you're doing.__\n   *\n   * @method __Don't use the method unless you know what you're doing.__#_unset\n   * @param {string} key The property to unset.\n   * @since 3.0.0\n   */\n  protected _unset: (key) => any;\n\n  constructor () {\n    const _props = {}\n\n    Object.defineProperties(this, {\n      _get: {\n        value (key) {\n          return utils.get(_props, key)\n        }\n      },\n      _set: {\n        value (key, value) {\n          return utils.set(_props, key, value)\n        }\n      },\n      _unset: {\n        value (key) {\n          return utils.unset(_props, key)\n        }\n      }\n    })\n  }\n}\n","import utils from './utils'\nimport Settable from './Settable'\n\nexport interface ComponentOpts {\n  debug?: boolean\n}\n\n/**\n * The base class from which all JSData components inherit some basic\n * functionality.\n *\n * Typically you won't instantiate this class directly, but you may find it\n * useful as an abstract class for your own components.\n *\n * @example\n * import {Component} from 'js-data'\n *\n * class CustomComponentClass extends Component {\n *   foo () { return 'bar'; }\n *   static beep () { return 'boop'; }\n * }\n * const customComponent = new CustomComponentClass();\n * console.log(customComponent.foo());\n * console.log(CustomComponentClass.beep());\n * ```\n *\n * @param {object} [opts] Configuration options.\n * @param {boolean} [opts.debug=false] See {@link Component#debug}.\n * @returns {Component} A new {@link Component} instance.\n * @since 3.0.0\n */\nexport default class Component extends Settable {\n  /**\n   * Whether to enable debug-level logs for this component. Anything that\n   * extends `Component` inherits this option and the corresponding logging\n   * functionality.\n   *\n   * @example <caption>Component#debug</caption>\n   * const JSData = require('js-data');\n   * const { Component } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const component = new Component();\n   * component.log('debug', 'some message'); // nothing gets logged\n   * // Display debug logs:\n   * component.debug = true;\n   * component.log('debug', 'other message'); // this DOES get logged\n   *\n   * @default false\n   * @name Component#debug\n   * @since 3.0.0\n   * @type {boolean}\n   */\n  protected debug: boolean;\n\n  /**\n   * Event listeners attached to this Component. __Do not modify.__ Use\n   * {@link Component#on} and {@link Component#off} instead.\n   *\n   * @name Component#_listeners\n   * @private\n   * @instance\n   * @since 3.0.0\n   * @type {Object}\n   */\n  _listeners = {};\n\n  /**\n   * Log the provided values at the \"debug\" level. Debug-level logs are only\n   * logged if {@link Component#debug} is `true`.\n   *\n   * `.dbg(...)` is shorthand for `.log('debug', ...)`.\n   *\n   * @method Component#dbg\n   * @param {...*} [args] Values to log.\n   * @since 3.0.0\n   */\n  dbg: (...args) => void;\n\n  /**\n   * Log the provided values. By default sends values to `console[level]`.\n   * Debug-level logs are only logged if {@link Component#debug} is `true`.\n   *\n   * Will attempt to use appropriate `console` methods if they are available.\n   *\n   * @method Component#log\n   * @param {string} level Log level.\n   * @param {...*} [args] Values to log.\n   * @since 3.0.0\n   */\n  log: (...args) => void;\n\n  /**\n   * Register a new event listener on this Component.\n   *\n   * @example\n   * // Listen for all \"afterCreate\" events in a DataStore\n   * store.on('afterCreate', (mapperName, props, opts, result) => {\n   *   console.log(mapperName); // \"post\"\n   *   console.log(props.id); // undefined\n   *   console.log(result.id); // 1234\n   * });\n   * store.create('post', { title: 'Modeling your data' }).then((post) => {\n   *   console.log(post.id); // 1234\n   * });\n   *\n   * @example\n   * // Listen for the \"add\" event on a collection\n   * collection.on('add', (records) => {\n   *   console.log(records); // [...]\n   * });\n   *\n   * @example\n   * // Listen for \"change\" events on a record\n   * post.on('change', (record, changes) => {\n   *   console.log(changes); // { changed: { title: 'Modeling your data' } }\n   * });\n   * post.title = 'Modeling your data';\n   *\n   * @method Component#on\n   * @param {string} event Name of event to subscribe to.\n   * @param {Function} listener Listener function to handle the event.\n   * @param {*} [ctx] Optional content in which to invoke the listener.\n   * @since 3.0.0\n   */\n  on: (name: string, listener: Function, ctx?) => void;\n\n  /**\n   * Remove an event listener from this Component. If no listener is provided,\n   * then all listeners for the specified event will be removed. If no event is\n   * specified then all listeners for all events will be removed.\n   *\n   * @example\n   * // Remove a particular listener for a particular event\n   * collection.off('add', handler);\n   *\n   * @example\n   * // Remove all listeners for a particular event\n   * record.off('change');\n   *\n   * @example\n   * // Remove all listeners to all events\n   * store.off();\n   *\n   * @method Component#off\n   * @param {string} [event] Name of event to unsubscribe to.\n   * @param {Function} [listener] Listener to remove.\n   * @since 3.0.0\n   */\n  off: (event: string, listener?: Function, thisArg?) => void;\n\n  /**\n   * Trigger an event on this Component.\n   *\n   * @example <caption>Component#emit</caption>\n   * // import { Collection, DataStore } from 'js-data';\n   * const JSData = require('js-data');\n   * const { Collection, DataStore } = JSData;\n   *\n   * const collection = new Collection();\n   * collection.on('foo', function (msg) {\n   *   console.log(msg);\n   * });\n   * collection.emit('foo', 'bar');\n   *\n   * const store = new DataStore();\n   * store.on('beep', function (msg) {\n   *   console.log(msg);\n   * });\n   * store.emit('beep', 'boop');\n   *\n   * @method Component#emit\n   * @param {string} event Name of event to emit.\n   * @param {...*} [args] Arguments to pass to any listeners.\n   * @since 3.0.0\n   */\n  emit: (event: string, ...args) => void;\n\n  constructor (opts: ComponentOpts | any = {}) {\n    super()\n    this.debug = opts.debug ?? false\n  }\n}\n\nutils.logify(Component.prototype)\n\nutils.eventify(\n  Component.prototype,\n  function () {\n    return this._listeners\n  },\n  function (value) {\n    this._listeners = value\n  }\n)\n","import utils from './utils'\nimport Component from './Component'\n\nconst DOMAIN = 'Query'\nconst INDEX_ERR = 'Index inaccessible after first operation'\n\n// Reserved words used by JSData's Query Syntax\nconst reserved = {\n  limit: '',\n  offset: '',\n  orderBy: '',\n  skip: '',\n  sort: '',\n  where: ''\n}\n\n// Used by our JavaScript implementation of the LIKE operator\nconst escapeRegExp = /([.*+?^=!:${}()|[\\]/\\\\])/g\nconst percentRegExp = /%/g\nconst underscoreRegExp = /_/g\n\nfunction escape (pattern) {\n  return pattern.replace(escapeRegExp, '\\\\$1')\n}\n\nexport interface QueryDefinition {\n  [attr: string]: any\n  where?: any\n  orderBy?: any\n  sort?: any\n  skip?: number\n  limit?: number\n  offset?: number\n}\n\n/**\n * A class used by the {@link Collection} class to build queries to be executed\n * against the collection's data. An instance of `Query` is returned by\n * {@link Collection#query}. Query instances are typically short-lived, and you\n * shouldn't have to create them yourself. Just use {@link Collection#query}.\n *\n * ```javascript\n * import { Query } from 'js-data';\n * ```\n *\n * @example <caption>Query intro</caption>\n * const JSData = require('js-data');\n * const { DataStore } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * const store = new DataStore();\n * store.defineMapper('post');\n * const posts = [\n *   { author: 'John', age: 30, status: 'published', id: 1 },\n *   { author: 'Sally', age: 31, status: 'draft', id: 2 },\n *   { author: 'Mike', age: 32, status: 'draft', id: 3 },\n *   { author: 'Adam', age: 33, status: 'deleted', id: 4 },\n *   { author: 'Adam', age: 33, status: 'draft', id: 5 }\n * ]\n * store.add('post', posts);\n * const drafts = store.query('post').filter({ status: 'draft' }).limit(2).run();\n * console.log(drafts);\n *\n * @class Query\n * @extends Component\n * @param {Collection} collection The collection on which this query operates.\n * @since 3.0.0\n */\nexport default class Query extends Component {\n  /**\n   * The current data result of this query.\n   *\n   * @name Query#data\n   * @since 3.0.0\n   * @type {Array}\n   */\n  private data = null;\n\n  constructor (public collection?) {\n    super()\n  }\n\n  _applyWhereFromObject (where) {\n    const fields = []\n    const ops = []\n    const predicates = []\n    utils.forOwn(where, (clause, field) => {\n      if (!utils.isObject(clause)) {\n        clause = {\n          '==': clause\n        }\n      }\n      utils.forOwn(clause, (expr, op) => {\n        fields.push(field)\n        ops.push(op)\n        predicates.push(expr)\n      })\n    })\n    return {\n      fields,\n      ops,\n      predicates\n    }\n  }\n\n  _applyWhereFromArray (where) {\n    const groups: any = []\n    where.forEach((_where, i) => {\n      if (utils.isString(_where)) {\n        return\n      }\n      const prev = where[i - 1]\n      const parser = utils.isArray(_where) ? this._applyWhereFromArray : this._applyWhereFromObject\n      const group = parser.call(this, _where)\n      if (prev === 'or') {\n        group.isOr = true\n      }\n      groups.push(group)\n    })\n    groups.isArray = true\n    return groups\n  }\n\n  _testObjectGroup (keep, first, group, item) {\n    let i\n    const fields = group.fields\n    const ops = group.ops\n    const predicates = group.predicates\n    const len = ops.length\n    for (i = 0; i < len; i++) {\n      let op = ops[i]\n      const isOr = op.charAt(0) === '|'\n      op = isOr ? op.substr(1) : op\n      const expr = this.evaluate(utils.get(item, fields[i]), op, predicates[i])\n      if (expr !== undefined) {\n        keep = first ? expr : isOr ? keep || expr : keep && expr\n      }\n      first = false\n    }\n    return { keep, first }\n  }\n\n  _testArrayGroup (keep, first, groups, item) {\n    let i\n    const len = groups.length\n    for (i = 0; i < len; i++) {\n      const group = groups[i]\n      const parser = group.isArray ? this._testArrayGroup : this._testObjectGroup\n      const result = parser.call(this, true, true, group, item)\n      if (groups[i - 1]) {\n        if (group.isOr) {\n          keep = keep || result.keep\n        } else {\n          keep = keep && result.keep\n        }\n      } else {\n        keep = result.keep\n      }\n      first = result.first\n    }\n    return { keep, first }\n  }\n\n  /**\n   * Find all entities between two boundaries.\n   *\n   * @example <caption>Get the users ages 18 to 30.</caption>\n   * const JSData = require('js-data');\n   * const { DataStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new DataStore();\n   * store.defineMapper('user');\n   * const users = [\n   *   { name: 'Peter', age: 25, id: 1 },\n   *   { name: 'Jim', age: 19, id: 2 },\n   *   { name: 'Mike', age: 17, id: 3 },\n   *   { name: 'Alan', age: 29, id: 4 },\n   *   { name: 'Katie', age: 33, id: 5 }\n   * ];\n   * store.add('user', users)\n   * const filteredUsers = store\n   *   .query('user')\n   *   .between(18, 30, { index: 'age' })\n   *   .run();\n   * console.log(filteredUsers);\n   *\n   * @example <caption>Same as above.</caption>\n   * const JSData = require('js-data');\n   * const { DataStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new DataStore();\n   * store.defineMapper('user');\n   * const users = [\n   *   { name: 'Peter', age: 25, id: 1 },\n   *   { name: 'Jim', age: 19, id: 2 },\n   *   { name: 'Mike', age: 17, id: 3 },\n   *   { name: 'Alan', age: 29, id: 4 },\n   *   { name: 'Katie', age: 33, id: 5 }\n   * ];\n   * store.add('user', users)\n   * const filteredUsers = store\n   *   .query('user')\n   *   .between([18], [30], { index: 'age' })\n   *   .run();\n   * console.log(filteredUsers);\n   *\n   * @method Query#between\n   * @param {array} leftKeys Keys defining the left boundary.\n   * @param {array} rightKeys Keys defining the right boundary.\n   * @param {object} [opts] Configuration options.\n   * @param {string} [opts.index] Name of the secondary index to use in the\n   * query. If no index is specified, the main index is used.\n   * @param {boolean} [opts.leftInclusive=true] Whether to include entities\n   * on the left boundary.\n   * @param {boolean} [opts.rightInclusive=false] Whether to include entities\n   * on the left boundary.\n   * @param {boolean} [opts.limit] Limit the result to a certain number.\n   * @param {boolean} [opts.offset] The number of resulting entities to skip.\n   * @returns {Query} A reference to itself for chaining.\n   * @since 3.0.0\n   */\n  between (leftKeys?, rightKeys?, opts: any = {}) {\n    if (this.data) {\n      throw utils.err(`${DOMAIN}#between`)(500, 'Cannot access index')\n    }\n    this.data = this.collection.getIndex(opts.index).between(leftKeys, rightKeys, opts)\n    return this\n  }\n\n  /**\n   * The comparison function used by the {@link Query} class.\n   *\n   * @method Query#compare\n   * @param {array} orderBy An orderBy clause used for sorting and sub-sorting.\n   * @param {number} index The index of the current orderBy clause being used.\n   * @param {*} a The first item in the comparison.\n   * @param {*} b The second item in the comparison.\n   * @returns {number} -1 if `b` should preceed `a`. 0 if `a` and `b` are equal.\n   * 1 if `a` should preceed `b`.\n   * @since 3.0.0\n   */\n  compare (orderBy, index, a, b) {\n    const def = orderBy[index]\n    let cA = utils.get(a, def[0])\n    let cB = utils.get(b, def[0])\n    if (cA && utils.isString(cA)) {\n      cA = cA.toUpperCase()\n    }\n    if (cB && utils.isString(cB)) {\n      cB = cB.toUpperCase()\n    }\n    if (a === undefined) {\n      a = null\n    }\n    if (b === undefined) {\n      b = null\n    }\n    if (def[1].toUpperCase() === 'DESC') {\n      const temp = cB\n      cB = cA\n      cA = temp\n    }\n    if (cA < cB) {\n      return -1\n    } else if (cA > cB) {\n      return 1\n    } else {\n      if (index < orderBy.length - 1) {\n        return this.compare(orderBy, index + 1, a, b)\n      } else {\n        return 0\n      }\n    }\n  }\n\n  /**\n   * Predicate evaluation function used by the {@link Query} class.\n   *\n   * @method Query#evaluate\n   * @param {*} value The value to evaluate.\n   * @param {string} op The operator to use in this evaluation.\n   * @param {*} predicate The predicate to use in this evaluation.\n   * @returns {boolean} Whether the value passed the evaluation or not.\n   * @since 3.0.0\n   */\n  evaluate (value, op, predicate) {\n    const ops = Query.ops\n    if (ops[op]) {\n      return ops[op](value, predicate)\n    }\n    if (op.indexOf('like') === 0) {\n      return this.like(predicate, op.substr(4)).exec(value) !== null\n    } else if (op.indexOf('notLike') === 0) {\n      return this.like(predicate, op.substr(7)).exec(value) === null\n    }\n  }\n\n  /**\n   * Find the record or records that match the provided query or are accepted by\n   * the provided filter function.\n   *\n   * @example <caption>Get the draft posts by authors younger than 30</caption>\n   * const JSData = require('js-data');\n   * const { DataStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new DataStore();\n   * store.defineMapper('post')\n   * const posts = [\n   *   { author: 'John', age: 30, status: 'published', id: 1 },\n   *   { author: 'Sally', age: 31, status: 'published', id: 2 },\n   *   { author: 'Mike', age: 32, status: 'draft', id: 3 },\n   *   { author: 'Adam', age: 33, status: 'deleted', id: 4 },\n   *   { author: 'Adam', age: 33, status: 'published', id: 5 }\n   *   { author: 'Peter', age: 25, status: 'deleted', id: 6 },\n   *   { author: 'Sally', age: 21, status: 'draft', id: 7 },\n   *   { author: 'Jim', age: 27, status: 'draft', id: 8 },\n   *   { author: 'Jim', age: 27, status: 'published', id: 9 },\n   *   { author: 'Jason', age: 55, status: 'published', id: 10 }\n   * ];\n   * store.add('post', posts);\n   * const results = store\n   *   .query('post')\n   *   .filter({\n   *     where: {\n   *       status: {\n   *         '==': 'draft'\n   *       },\n   *       age: {\n   *         '<': 30\n   *       }\n   *     }\n   *   })\n   *   .run();\n   * console.log(results);\n   *\n   * @example <caption>Use a custom filter function</caption>\n   * const posts = query\n   *   .filter(function (post) {\n   *     return post.isReady();\n   *   })\n   *   .run();\n   *\n   * @method Query#filter\n   * @param {(Object|Function)} [query={}] Selection query or filter\n   * function.\n   * @param {Function} [thisArg] Context to which to bind `queryOrFn` if\n   * `queryOrFn` is a function.\n   * @returns {Query} A reference to itself for chaining.\n   * @since 3.0.0\n   */\n  filter (query: QueryDefinition = {}, thisArg?: Function): Query {\n    /**\n     * Selection query as defined by JSData's [Query Syntax][querysyntax].\n     *\n     * [querysyntax]: http://www.js-data.io/v3.0/docs/query-syntax\n     *\n     * @example <caption>Empty \"findAll\" query</caption>\n     * const JSData = require('js-data');\n     * const { DataStore } = JSData;\n     * console.log('Using JSData v' + JSData.version.full);\n     *\n     * const store = new DataStore();\n     * store.defineMapper('post')\n     * store.findAll('post').then((posts) => {\n     *   console.log(posts); // [...]\n     * });\n     *\n     * @example <caption>Empty \"filter\" query</caption>\n     * const JSData = require('js-data');\n     * const { DataStore } = JSData;\n     * console.log('Using JSData v' + JSData.version.full);\n     *\n     * const store = new DataStore();\n     * store.defineMapper('post');\n     * const posts = store.filter('post');\n     * console.log(posts); // [...]\n     *\n     * @example <caption>Complex \"filter\" query</caption>\n     * const JSData = require('js-data');\n     * const { DataStore } = JSData;\n     * console.log('Using JSData v' + JSData.version.full);\n     *\n     * const store = new DataStore();\n     * const PAGE_SIZE = 2;\n     * let currentPage = 3;\n     *\n     * store.defineMapper('post');\n     * const posts = [\n     *   { author: 'John', age: 30, status: 'published', id: 1 },\n     *   { author: 'Sally', age: 31, status: 'published', id: 2 },\n     *   { author: 'Mike', age: 32, status: 'draft', id: 3 },\n     *   { author: 'Adam', age: 33, status: 'deleted', id: 4 },\n     *   { author: 'Adam', age: 33, status: 'published', id: 5 }\n     *   { author: 'Peter', age: 25, status: 'deleted', id: 6 },\n     *   { author: 'Sally', age: 21, status: 'draft', id: 7 },\n     *   { author: 'Jim', age: 27, status: 'draft', id: 8 },\n     *   { author: 'Jim', age: 27, status: 'published', id: 9 },\n     *   { author: 'Jason', age: 55, status: 'published', id: 10 }\n     * ];\n     * store.add('post', posts);\n     * // Retrieve a filtered page of blog posts\n     * // Would typically replace filter with findAll\n     * const results = store.filter('post', {\n     *   where: {\n     *     status: {\n     *       // WHERE status = 'published'\n     *       '==': 'published'\n     *     },\n     *     author: {\n     *       // AND author IN ('bob', 'alice')\n     *       'in': ['bob', 'alice'],\n     *       // OR author IN ('karen')\n     *       '|in': ['karen']\n     *     }\n     *   },\n     *   orderBy: [\n     *     // ORDER BY date_published DESC,\n     *     ['date_published', 'DESC'],\n     *     // ORDER BY title ASC\n     *     ['title', 'ASC']\n     *   ],\n     *   // LIMIT 2\n     *   limit: PAGE_SIZE,\n     *   // SKIP 4\n     *   offset: PAGE_SIZE * (currentPage - 1)\n     * });\n     * console.log(results);\n     *\n     * @namespace query\n     * @property {number} [limit] See {@link query.limit}.\n     * @property {number} [offset] See {@link query.offset}.\n     * @property {string|Array[]} [orderBy] See {@link query.orderBy}.\n     * @property {number} [skip] Alias for {@link query.offset}.\n     * @property {string|Array[]} [sort] Alias for {@link query.orderBy}.\n     * @property {Object} [where] See {@link query.where}.\n     * @since 3.0.0\n     * @tutorial [\"http://www.js-data.io/v3.0/docs/query-syntax\",\"JSData's Query Syntax\"]\n     */\n    this.getData()\n    if (utils.isObject(query)) {\n      let where = {}\n\n      /**\n       * Filtering criteria. Records that do not meet this criteria will be exluded\n       * from the result.\n       *\n       * @example <caption>Return posts where author is at least 32 years old</caption>\n       * const JSData = require('js-data');\n       * const { DataStore } = JSData;\n       * console.log('Using JSData v' + JSData.version.full);\n       *\n       * const store = new DataStore();\n       * store.defineMapper('post')\n       * const posts = [\n       *   { author: 'John', age: 30, id: 5 },\n       *   { author: 'Sally', age: 31, id: 6 },\n       *   { author: 'Mike', age: 32, id: 7 },\n       *   { author: 'Adam', age: 33, id: 8 },\n       *   { author: 'Adam', age: 33, id: 9 }\n       * ];\n       * store.add('post', posts);\n       * const results = store.filter('post', {\n       *   where: {\n       *     age: {\n       *       '>=': 30\n       *     }\n       *   }\n       * });\n       * console.log(results);\n       *\n       * @name query.where\n       * @type {Object}\n       * @see http://www.js-data.io/v3.0/docs/query-syntax\n       * @since 3.0.0\n       */\n      if (utils.isObject(query.where) || utils.isArray(query.where)) {\n        where = query.where\n      }\n      utils.forOwn(query, (value, key) => {\n        if (!(key in reserved) && !(key in where)) {\n          where[key] = {\n            '==': value\n          }\n        }\n      })\n      let groups\n\n      // Apply filter for each field\n      if (utils.isObject(where) && Object.keys(where).length !== 0) {\n        groups = this._applyWhereFromArray([where])\n      } else if (utils.isArray(where)) {\n        groups = this._applyWhereFromArray(where)\n      }\n\n      if (groups) {\n        this.data = this.data.filter(item => this._testArrayGroup(true, true, groups, item).keep)\n      }\n\n      // Sort\n      let orderBy = query.orderBy || query.sort\n\n      if (utils.isString(orderBy)) {\n        orderBy = [[orderBy, 'ASC']]\n      }\n      if (!utils.isArray(orderBy)) {\n        orderBy = null\n      }\n\n      /**\n       * Determines how records should be ordered in the result.\n       *\n       * @example <caption>Order posts by `author` then by `id` descending </caption>\n       * const JSData = require('js-data');\n       * const { DataStore } = JSData;\n       * console.log('Using JSData v' + JSData.version.full);\n       *\n       * const store = new DataStore();\n       * store.defineMapper('post')\n       * const posts = [\n       *   { author: 'John', age: 30, id: 5 },\n       *   { author: 'Sally', age: 31, id: 6 },\n       *   { author: 'Mike', age: 32, id: 7 },\n       *   { author: 'Adam', age: 33, id: 8 },\n       *   { author: 'Adam', age: 33, id: 9 }\n       * ];\n       * store.add('post', posts);\n       * const results = store.filter('post', {\n       *     orderBy:[['author','ASC'],['id','DESC']]\n       * });\n       * console.log(results);\n       *\n       * @name query.orderBy\n       * @type {string|Array[]}\n       * @see http://www.js-data.io/v3.0/docs/query-syntax\n       * @since 3.0.0\n       */\n      if (orderBy) {\n        const index = 0\n        orderBy.forEach((def, i) => {\n          if (utils.isString(def)) {\n            orderBy[i] = [def, 'ASC']\n          }\n        })\n        this.data.sort((a, b) => this.compare(orderBy, index, a, b))\n      }\n\n      /**\n       * Number of records to skip.\n       *\n       * @example <caption>Retrieve the first \"page\" of blog posts using findAll</caption>\n       * const JSData = require('js-data');\n       * const { DataStore } = JSData;\n       * console.log('Using JSData v' + JSData.version.full);\n       *\n       * const store = new DataStore();\n       * store.defineMapper('post');\n       * const PAGE_SIZE = 10;\n       * let currentPage = 1;\n       * store.findAll('post', {\n       *   offset: PAGE_SIZE * (currentPage 1)\n       *   limit: PAGE_SIZE\n       * });\n       *\n       * @example <caption>Retrieve the last \"page\" of blog posts using filter</caption>\n       * const JSData = require('js-data');\n       * const { DataStore } = JSData;\n       * console.log('Using JSData v' + JSData.version.full);\n       *\n       * const store = new DataStore();\n       *\n       * const PAGE_SIZE = 5;\n       * let currentPage = 2;\n       * store.defineMapper('post');\n       * const posts = [\n       *   { author: 'John', age: 30, id: 1 },\n       *   { author: 'Sally', age: 31, id: 2 },\n       *   { author: 'Mike', age: 32, id: 3 },\n       *   { author: 'Adam', age: 33, id: 4 },\n       *   { author: 'Adam', age: 33, id: 5 },\n       *   { author: 'Peter', age: 25, id: 6 },\n       *   { author: 'Sally', age: 21, id: 7 },\n       *   { author: 'Jim', age: 27, id: 8 },\n       *   { author: 'Jim', age: 27, id: 9 },\n       *   { author: 'Jason', age: 55, id: 10 }\n       * ];\n       * store.add('post', posts);\n       * const results = store.filter('post', {\n       *   offset: PAGE_SIZE * (currentPage 1)\n       *   limit: PAGE_SIZE\n       * });\n       * console.log(results)\n       *\n       * @name query.offset\n       * @type {number}\n       * @see http://www.js-data.io/v3.0/docs/query-syntax\n       * @since 3.0.0\n       */\n      if (utils.isNumber(query.skip)) {\n        this.skip(query.skip)\n      } else if (utils.isNumber(query.offset)) {\n        this.skip(query.offset)\n      }\n\n      /**\n       * Maximum number of records to retrieve.\n       *\n       * @example <caption>Retrieve the first \"page\" of blog posts using findAll</caption>\n       * const JSData = require('js-data');\n       * const { DataStore } = JSData;\n       * console.log('Using JSData v' + JSData.version.full);\n       *\n       * const store = new DataStore();\n       * store.defineMapper('post');\n       *\n       * const PAGE_SIZE = 10\n       * let currentPage = 1\n       * store.findAll('post', {\n       *   offset: PAGE_SIZE * (currentPage 1)\n       *   limit: PAGE_SIZE\n       * });\n       *\n       * @example <caption>Retrieve the last \"page\" of blog posts using filter</caption>\n       * const JSData = require('js-data');\n       * const { DataStore } = JSData;\n       * console.log('Using JSData v' + JSData.version.full);\n       *\n       * const store = new DataStore();\n       *\n       * const PAGE_SIZE = 5\n       * let currentPage = 2\n       * store.defineMapper('post')\n       * const posts = [\n       *   { author: 'John', age: 30, id: 1 },\n       *   { author: 'Sally', age: 31, id: 2 },\n       *   { author: 'Mike', age: 32, id: 3 },\n       *   { author: 'Adam', age: 33, id: 4 },\n       *   { author: 'Adam', age: 33, id: 5 },\n       *   { author: 'Peter', age: 25, id: 6 },\n       *   { author: 'Sally', age: 21, id: 7 },\n       *   { author: 'Jim', age: 27, id: 8 },\n       *   { author: 'Jim', age: 27, id: 9 },\n       *   { author: 'Jason', age: 55, id: 10 }\n       * ];\n       * store.add('post', posts);\n       * const results = store.filter('post', {\n       *   offset: PAGE_SIZE * (currentPage 1)\n       *   limit: PAGE_SIZE\n       * });\n       * console.log(results)\n       *\n       * @name query.limit\n       * @type {number}\n       * @see http://www.js-data.io/v3.0/docs/query-syntax\n       * @since 3.0.0\n       */\n      if (utils.isNumber(query.limit)) {\n        this.limit(query.limit)\n      }\n    } else if (utils.isFunction(query)) {\n      this.data = this.data.filter(query, thisArg)\n    }\n    return this\n  }\n\n  /**\n   * Iterate over all entities.\n   *\n   * @method Query#forEach\n   * @param {Function} forEachFn Iteration function.\n   * @param {*} [thisArg] Context to which to bind `forEachFn`.\n   * @returns {Query} A reference to itself for chaining.\n   * @since 3.0.0\n   */\n  forEach (forEachFn: Function, thisArg?) {\n    this.getData().forEach(forEachFn, thisArg)\n    return this\n  }\n\n  /**\n   * Find the entity or entities that match the provided key.\n   *\n   * @example <caption>Get the entity whose primary key is 25.</caption>\n   * const entities = query.get(25).run();\n   *\n   * @example <caption>Same as above.</caption>\n   * const entities = query.get([25]).run();\n   *\n   * @example <caption>Get all users who are active and have the \"admin\" role.</caption>\n   * const activeAdmins = query.get(['active', 'admin'], {\n   *   index: 'activityAndRoles'\n   * }).run();\n   *\n   * @example <caption>Get all entities that match a certain weather condition.</caption>\n   * const niceDays = query.get(['sunny', 'humid', 'calm'], {\n   *   index: 'weatherConditions'\n   * }).run();\n   *\n   * @method Query#get\n   * @param {array} keyList Key(s) defining the entity to retrieve. If\n   * `keyList` is not an array (i.e. for a single-value key), it will be\n   * wrapped in an array.\n   * @param {object} [opts] Configuration options.\n   * @param {string} [opts.string] Name of the secondary index to use in the\n   * query. If no index is specified, the main index is used.\n   * @returns {Query} A reference to itself for chaining.\n   * @since 3.0.0\n   */\n  get (keyList = [], opts: any = {}) {\n    if (this.data) {\n      throw utils.err(`${DOMAIN}#get`)(500, INDEX_ERR)\n    }\n    if (keyList && !utils.isArray(keyList)) {\n      keyList = [keyList]\n    }\n    if (!keyList.length) {\n      this.getData()\n      return this\n    }\n    this.data = this.collection.getIndex(opts.index).get(keyList)\n    return this\n  }\n\n  /**\n   * Find the entity or entities that match the provided keyLists.\n   *\n   * @example <caption>Get the posts where \"status\" is \"draft\" or \"inReview\".</caption>\n   * const posts = query.getAll('draft', 'inReview', { index: 'status' }).run();\n   *\n   * @example <caption>Same as above.</caption>\n   * const posts = query.getAll(['draft'], ['inReview'], { index: 'status' }).run();\n   *\n   * @method Query#getAll\n   * @param {...Array} [keyList] Provide one or more keyLists, and all\n   * entities matching each keyList will be retrieved. If no keyLists are\n   * provided, all entities will be returned.\n   * @param {object} [opts] Configuration options.\n   * @param {string} [opts.index] Name of the secondary index to use in the\n   * query. If no index is specified, the main index is used.\n   * @returns {Query} A reference to itself for chaining.\n   * @since 3.0.0\n   */\n  getAll(keyList?: [], opts?);\n  getAll (...args) {\n    let opts: any = {}\n    if (this.data) {\n      throw utils.err(`${DOMAIN}#getAll`)(500, INDEX_ERR)\n    }\n    if (!args.length || (args.length === 1 && utils.isObject(args[0]))) {\n      this.getData()\n      return this\n    } else if (args.length && utils.isObject(args[args.length - 1])) {\n      opts = args[args.length - 1]\n      args.pop()\n    }\n    const index = this.collection.getIndex(opts.index)\n    this.data = []\n    args.forEach(keyList => {\n      this.data = this.data.concat(index.get(keyList))\n    })\n    return this\n  }\n\n  /**\n   * Return the current data result of this query.\n   *\n   * @method Query#getData\n   * @returns {Array} The data in this query.\n   * @since 3.0.0\n   */\n  getData () {\n    if (!this.data) {\n      this.data = this.collection.index.getAll()\n    }\n    return this.data\n  }\n\n  /**\n   * Implementation used by the `like` operator. Takes a pattern and flags and\n   * returns a `RegExp` instance that can test strings.\n   *\n   * @method Query#like\n   * @param {string} pattern Testing pattern.\n   * @param {string} flags Flags for the regular expression.\n   * @returns {RegExp} Regular expression for testing strings.\n   * @since 3.0.0\n   */\n  like (pattern, flags) {\n    return new RegExp(\n      `^${escape(pattern)\n        .replace(percentRegExp, '.*')\n        .replace(underscoreRegExp, '.')}$`,\n      flags\n    )\n  }\n\n  /**\n   * Limit the result.\n   *\n   * @example <caption>Get only the first 2 posts.</caption>\n   * const store = new JSData.DataStore();\n   * store.defineMapper('post');\n   * const posts = [\n   *   { author: 'John', age: 30, status: 'published', id: 1 },\n   *   { author: 'Sally', age: 31, status: 'draft', id: 2 },\n   *   { author: 'Mike', age: 32, status: 'draft', id: 3 },\n   *   { author: 'Adam', age: 33, status: 'deleted', id: 4 },\n   *   { author: 'Adam', age: 33, status: 'draft', id: 5 }\n   * ];\n   * store.add('post', posts);\n   * const results = store.query('post').limit(2).run();\n   * console.log(results);\n   *\n   * @method Query#limit\n   * @param {number} num The maximum number of entities to keep in the result.\n   * @returns {Query} A reference to itself for chaining.\n   * @since 3.0.0\n   */\n  limit (num) {\n    if (!utils.isNumber(num)) {\n      throw utils.err(`${DOMAIN}#limit`, 'num')(400, 'number', num)\n    }\n    const data = this.getData()\n    this.data = data.slice(0, Math.min(data.length, num))\n    return this\n  }\n\n  /**\n   * Apply a mapping function to the result data.\n   *\n   * @example\n   * const JSData = require('js-data');\n   * const { DataStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new DataStore();\n   * store.defineMapper('user');\n   * const users = [\n   *   { name: 'Peter', age: 25, id: 1 },\n   *   { name: 'Jim', age: 19, id: 2 },\n   *   { name: 'Mike', age: 17, id: 3 },\n   *   { name: 'Alan', age: 29, id: 4 },\n   *   { name: 'Katie', age: 33, id: 5 }\n   * ];\n   * store.add('user', users);\n   * const ages = store\n   *   .query('user')\n   *   .map(function (user) {\n   *     return user.age;\n   *   })\n   *   .run();\n   * console.log(ages);\n   *\n   * @method Query#map\n   * @param {Function} mapFn Mapping function.\n   * @param {*} [thisArg] Context to which to bind `mapFn`.\n   * @returns {Query} A reference to itself for chaining.\n   * @since 3.0.0\n   */\n  map (mapFn, thisArg?) {\n    this.data = this.getData().map(mapFn, thisArg)\n    return this\n  }\n\n  /**\n   * Return the result of calling the specified function on each item in this\n   * collection's main index.\n   *\n   * @example\n   * const stringAges = UserCollection.query().mapCall('toString').run();\n   *\n   * @method Query#mapCall\n   * @param {string} funcName Name of function to call\n   * @param args Remaining arguments to be passed to the function.\n   * @returns {Query} A reference to itself for chaining.\n   * @since 3.0.0\n   */\n  mapCall (funcName, ...args) {\n    this.data = this.getData().map(item => item[funcName](...args))\n    return this\n  }\n\n  /**\n   * Complete the execution of the query and return the resulting data.\n   *\n   * @method Query#run\n   * @returns {Array} The result of executing this query.\n   * @since 3.0.0\n   */\n  run () {\n    const data = this.data\n    this.data = null\n    return data\n  }\n\n  /**\n   * Skip a number of results.\n   *\n   * @example <caption>Get all but the first 2 posts.</caption>\n   * const JSData = require('js-data');\n   * const { DataStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new DataStore();\n   * store.defineMapper('post');\n   * const posts = [\n   *   { author: 'John', age: 30, status: 'published', id: 1 },\n   *   { author: 'Sally', age: 31, status: 'draft', id: 2 },\n   *   { author: 'Mike', age: 32, status: 'draft', id: 3 },\n   *   { author: 'Adam', age: 33, status: 'deleted', id: 4 },\n   *   { author: 'Adam', age: 33, status: 'draft', id: 5 }\n   * ];\n   * store.add('post', posts);\n   * const results = store.query('post').skip(2).run();\n   * console.log(results);\n   *\n   * @method Query#skip\n   * @param {number} num The number of entities to skip.\n   * @returns {Query} A reference to itself for chaining.\n   * @since 3.0.0\n   */\n  skip (num) {\n    if (!utils.isNumber(num)) {\n      throw utils.err(`${DOMAIN}#skip`, 'num')(400, 'number', num)\n    }\n    const data = this.getData()\n    if (num < data.length) {\n      this.data = data.slice(num)\n    } else {\n      this.data = []\n    }\n    return this\n  }\n\n  /**\n   * The filtering operators supported by {@link Query#filter}, and which are\n   * implemented by adapters (for the most part).\n   *\n   * @example <caption>Variant 1</caption>\n   * const JSData = require('js-data');\n   * const { DataStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new DataStore();\n   * store.defineMapper('post');\n   * const posts = [\n   *   { author: 'John', age: 30, status: 'published', id: 1 },\n   *   { author: 'Sally', age: 31, status: 'published', id: 2 },\n   *   { author: 'Mike', age: 32, status: 'published', id: 3 },\n   *   { author: 'Adam', age: 33, status: 'deleted', id: 4 },\n   *   { author: 'Adam', age: 33, status: 'published', id: 5 }\n   * ];\n   * store.add('post', posts);\n   * const publishedPosts = store.filter('post', {\n   *   status: 'published',\n   *   limit: 2\n   * });\n   * console.log(publishedPosts);\n   *\n   *\n   * @example <caption>Variant 2</caption>\n   * const JSData = require('js-data');\n   * const { DataStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new DataStore();\n   * store.defineMapper('post')\n   * const posts = [\n   *   { author: 'John', age: 30, status: 'published', id: 1 },\n   *   { author: 'Sally', age: 31, status: 'published', id: 2 },\n   *   { author: 'Mike', age: 32, status: 'published', id: 3 },\n   *   { author: 'Adam', age: 33, status: 'deleted', id: 4 },\n   *   { author: 'Adam', age: 33, status: 'published', id: 5 }\n   * ];\n   * store.add('post', posts);\n   * const publishedPosts = store.filter('post', {\n   *   where: {\n   *     status: {\n   *       '==': 'published'\n   *     }\n   *   },\n   *   limit: 2\n   * });\n   * console.log(publishedPosts);\n   *\n   * @example <caption>Variant 3</caption>\n   * const JSData = require('js-data');\n   * const { DataStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new DataStore();\n   * store.defineMapper('post');\n   * const posts = [\n   *   { author: 'John', age: 30, status: 'published', id: 1 },\n   *   { author: 'Sally', age: 31, status: 'published', id: 2 },\n   *   { author: 'Mike', age: 32, status: 'published', id: 3 },\n   *   { author: 'Adam', age: 33, status: 'deleted', id: 4 },\n   *   { author: 'Adam', age: 33, status: 'published', id: 5 }\n   * ];\n   * store.add('post', posts);\n   * const publishedPosts = store\n   *   .query('post')\n   *   .filter({ status: 'published' })\n   *   .limit(2)\n   *   .run();\n   * console.log(publishedPosts);\n   *\n   * @example <caption>Variant 4</caption>\n   * const JSData = require('js-data');\n   * const { DataStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new DataStore();\n   * store.defineMapper('post');\n   * const posts = [\n   *   { author: 'John', age: 30, status: 'published', id: 1 },\n   *   { author: 'Sally', age: 31, status: 'published', id: 2 },\n   *   { author: 'Mike', age: 32, status: 'published', id: 3 },\n   *   { author: 'Adam', age: 33, status: 'deleted', id: 4 },\n   *   { author: 'Adam', age: 33, status: 'published', id: 5 }\n   * ];\n   * store.add('post', posts);\n   * const publishedPosts = store\n   *   .query('post')\n   *   .filter({\n   *     where: {\n   *       status: {\n   *         '==': 'published'\n   *       }\n   *     }\n   *   })\n   *   .limit(2)\n   *   .run();\n   * console.log(publishedPosts);\n   *\n   * @example <caption>Multiple operators</caption>\n   * const JSData = require('js-data');\n   * const { DataStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new DataStore();\n   * store.defineMapper('post');\n   * const posts = [\n   *   { author: 'John', age: 30, status: 'published', id: 1 },\n   *   { author: 'Sally', age: 31, status: 'published', id: 2 },\n   *   { author: 'Mike', age: 32, status: 'published', id: 3 },\n   *   { author: 'Adam', age: 33, status: 'deleted', id: 4 },\n   *   { author: 'Adam', age: 33, status: 'published', id: 5 }\n   * ];\n   * store.add('post', posts);\n   *\n   * const myPublishedPosts = store.filter('post', {\n   *   where: {\n   *     status: {\n   *       '==': 'published'\n   *     },\n   *     user_id: {\n   *       '==': currentUser.id\n   *     }\n   *   }\n   * });\n   *\n   * console.log(myPublishedPosts);\n   *\n   * @name Query.ops\n   * @property {Function} == Equality operator.\n   * @property {Function} != Inequality operator.\n   * @property {Function} > Greater than operator.\n   * @property {Function} >= Greater than (inclusive) operator.\n   * @property {Function} < Less than operator.\n   * @property {Function} <= Less than (inclusive) operator.\n   * @property {Function} isectEmpty Operator that asserts that the intersection\n   * between two arrays is empty.\n   * @property {Function} isectNotEmpty Operator that asserts that the\n   * intersection between two arrays is __not__ empty.\n   * @property {Function} in Operator that asserts whether a value is in an\n   * array.\n   * @property {Function} notIn Operator that asserts whether a value is __not__\n   * in an array.\n   * @property {Function} contains Operator that asserts whether an array\n   * contains a value.\n   * @property {Function} notContains Operator that asserts whether an array\n   * does __not__ contain a value.\n   * @since 3.0.0\n   * @type {Object}\n   */\n  static ops = {\n    '=' (value, predicate) {\n      // tslint:disable-next-line:triple-equals\n      return value == predicate; // eslint-disable-line\n    },\n    '==' (value, predicate) {\n      // tslint:disable-next-line:triple-equals\n      return value == predicate; // eslint-disable-line\n    },\n    '===' (value, predicate) {\n      return value === predicate\n    },\n    '!=' (value, predicate) {\n      // tslint:disable-next-line:triple-equals\n      return value != predicate; // eslint-disable-line\n    },\n    '!==' (value, predicate) {\n      return value !== predicate\n    },\n    '>' (value, predicate) {\n      return value > predicate\n    },\n    '>=' (value, predicate) {\n      return value >= predicate\n    },\n    '<' (value, predicate) {\n      return value < predicate\n    },\n    '<=' (value, predicate) {\n      return value <= predicate\n    },\n    isectEmpty (value, predicate) {\n      return !utils.intersection(value || [], predicate || []).length\n    },\n    isectNotEmpty (value, predicate) {\n      return utils.intersection(value || [], predicate || []).length\n    },\n    in (value, predicate) {\n      return predicate.indexOf(value) !== -1\n    },\n    notIn (value, predicate) {\n      return predicate.indexOf(value) === -1\n    },\n    contains (value, predicate) {\n      return (value || []).indexOf(predicate) !== -1\n    },\n    notContains (value, predicate) {\n      return (value || []).indexOf(predicate) === -1\n    }\n  };\n}\n","import utils from './utils'\n\n// TODO: remove this when the rest of the project is cleaned\nexport const belongsToType = 'belongsTo'\nexport const hasManyType = 'hasMany'\nexport const hasOneType = 'hasOne'\n\nconst DOMAIN = 'Relation'\n\nexport interface RelationOpts {\n  type?: string\n}\n\nexport abstract class Relation {\n  protected TYPE_NAME = DOMAIN;\n  protected add;\n  protected mapper;\n  protected relation;\n  name: string;\n  private readonly localField;\n  private readonly localKey;\n  protected foreignKey;\n  protected relatedMapper;\n  protected inverse;\n\n  constructor (relatedMapper, options: RelationOpts = {}) {\n    options.type = (this.constructor as any).TYPE_NAME\n    this.validateOptions(relatedMapper, options)\n\n    if (typeof relatedMapper === 'object') {\n      this.relatedMapper = relatedMapper\n    }\n\n    utils.fillIn(this, options)\n  }\n\n  get canAutoAddLinks () {\n    return this.add === undefined || !!this.add\n  }\n\n  get relatedCollection () {\n    return this.mapper.datastore.getCollection(this.relation)\n  }\n\n  validateOptions (related, opts) {\n    const DOMAIN_ERR = `new ${DOMAIN}`\n\n    const localField = opts.localField\n    if (!localField) {\n      throw utils.err(DOMAIN_ERR, 'opts.localField')(400, 'string', localField)\n    }\n\n    const foreignKey = (opts.foreignKey = opts.foreignKey || opts.localKey)\n    if (!foreignKey && (opts.type === belongsToType || opts.type === hasOneType)) {\n      throw utils.err(DOMAIN_ERR, 'opts.foreignKey')(400, 'string', foreignKey)\n    }\n\n    if (utils.isString(related)) {\n      opts.relation = related\n      if (!utils.isFunction(opts.getRelation)) {\n        throw utils.err(DOMAIN_ERR, 'opts.getRelation')(400, 'function', opts.getRelation)\n      }\n    } else if (related) {\n      opts.relation = related.name\n    } else {\n      throw utils.err(DOMAIN_ERR, 'related')(400, 'Mapper or string', related)\n    }\n  }\n\n  assignTo (mapper) {\n    this.name = mapper.name\n    Object.defineProperty(this, 'mapper', { value: mapper })\n\n    if (!mapper.relationList) Object.defineProperty(mapper, 'relationList', { value: [] })\n    if (!mapper.relationFields) Object.defineProperty(mapper, 'relationFields', { value: [] })\n    mapper.relationList.push(this)\n    mapper.relationFields.push(this.localField)\n  }\n\n  canFindLinkFor (record?) {\n    return !!(this.foreignKey || this.localKey)\n  }\n\n  getRelation () {\n    return this.relatedMapper\n  }\n\n  getForeignKey (record) {\n    return utils.get(record, this.mapper.idAttribute)\n  }\n\n  setForeignKey (record, relatedRecord) {\n    if (!record || !relatedRecord) {\n      return\n    }\n\n    this._setForeignKey(record, relatedRecord)\n  }\n\n  _setForeignKey (record, relatedRecords) {\n    const idAttribute = this.mapper.idAttribute\n\n    if (!utils.isArray(relatedRecords)) {\n      relatedRecords = [relatedRecords]\n    }\n\n    relatedRecords.forEach(relatedRecord => {\n      utils.set(relatedRecord, this.foreignKey, utils.get(record, idAttribute))\n    })\n  }\n\n  getLocalField (record) {\n    return utils.get(record, this.localField)\n  }\n\n  setLocalField (record, relatedData) {\n    return utils.set(record, this.localField, relatedData)\n  }\n\n  getInverse (mapper) {\n    if (!this.inverse) {\n      this.findInverseRelation(mapper)\n    }\n\n    return this.inverse\n  }\n\n  findInverseRelation (mapper) {\n    this.getRelation().relationList.forEach(def => {\n      if (def.getRelation() === mapper && this.isInversedTo(def) && this !== def) {\n        this.inverse = def\n        return true\n      }\n    })\n  }\n\n  isInversedTo (def) {\n    return !def.foreignKey || def.foreignKey === this.foreignKey\n  }\n\n  addLinkedRecords (records) {\n    const datastore = this.mapper.datastore\n\n    records.forEach(record => {\n      let relatedData = this.getLocalField(record)\n\n      if (utils.isFunction(this.add)) {\n        relatedData = this.add(datastore, this, record)\n      } else if (relatedData) {\n        relatedData = this.linkRecord(record, relatedData)\n      }\n\n      const isEmptyLinks = !relatedData || (utils.isArray(relatedData) && !relatedData.length)\n\n      if (isEmptyLinks && this.canFindLinkFor(record)) {\n        relatedData = this.findExistingLinksFor(record)\n      }\n\n      if (relatedData) {\n        this.setLocalField(record, relatedData)\n      }\n    })\n  }\n\n  removeLinkedRecords (relatedMapper, records) {\n    const localField = this.localField\n    records.forEach(record => {\n      utils.set(record, localField, undefined)\n    })\n  }\n\n  linkRecord (record, relatedRecord) {\n    const relatedId = utils.get(relatedRecord, this.mapper.idAttribute)\n\n    if (relatedId === undefined) {\n      const unsaved = this.relatedCollection.unsaved()\n      if (unsaved.indexOf(relatedRecord) === -1) {\n        if (this.canAutoAddLinks) {\n          relatedRecord = this.relatedCollection.add(relatedRecord)\n        }\n      }\n    } else {\n      if (relatedRecord !== this.relatedCollection.get(relatedId)) {\n        this.setForeignKey(record, relatedRecord)\n\n        if (this.canAutoAddLinks) {\n          relatedRecord = this.relatedCollection.add(relatedRecord)\n        }\n      }\n    }\n\n    return relatedRecord\n  }\n\n  // e.g. user hasMany post via \"foreignKey\", so find all posts of user\n  findExistingLinksByForeignKey (id) {\n    if (id === undefined || id === null) {\n      return\n    }\n    return this.relatedCollection.filter({\n      [this.foreignKey]: id\n    })\n  }\n\n  ensureLinkedDataHasProperType (props, opts) {\n    const relatedMapper = this.getRelation()\n    const relationData = this.getLocalField(props)\n\n    if (utils.isArray(relationData) && (!relationData.length || relatedMapper.is(relationData[0]))) {\n      return\n    }\n\n    if (relationData && !relatedMapper.is(relationData)) {\n      utils.set(props, this.localField, relatedMapper.createRecord(relationData, opts))\n    }\n  }\n\n  isRequiresParentId () {\n    return false\n  }\n\n  isRequiresChildId () {\n    return false\n  }\n\n  createChildRecord (props, relationData, opts) {\n    this.setForeignKey(props, relationData)\n\n    return this.createLinked(relationData, opts).then(result => {\n      this.setLocalField(props, result)\n    })\n  }\n\n  createLinked (props, opts) {\n    const create = utils.isArray(props) ? 'createMany' : 'create'\n\n    return this.getRelation()[create](props, opts)\n  }\n\n  abstract findExistingLinksFor(relatedMapper, record);\n  abstract findExistingLinksFor(...record);\n\n  static belongsTo;\n  static hasMany;\n  static hasOne;\n}\n","import utils, { safeSetLink } from './utils'\nimport Settable from './Settable'\nimport { hasManyType, hasOneType } from './Relation'\nimport Mapper from './Mapper'\n\nconst DOMAIN = 'Record'\n\nfunction superMethod (mapper, name) {\n  const store = mapper.datastore\n  if (store?.[name]) {\n    return (...args) => store[name](mapper.name, ...args)\n  }\n  return mapper[name].bind(mapper)\n}\n\n// Cache these strings\nconst creatingPath = 'creating'\nconst noValidatePath = 'noValidate'\nconst keepChangeHistoryPath = 'keepChangeHistory'\nconst previousPath = 'previous'\n\n/**\n * js-data's Record class. An instance of `Record` corresponds to an in-memory\n * representation of a single row or document in a database, Firebase,\n * localstorage, etc. Basically, a `Record` instance represents whatever kind of\n * entity in your persistence layer that has a primary key.\n *\n * ```javascript\n * import {Record} from 'js-data'\n * ```\n *\n * @example <caption>Record#constructor</caption>\n * const JSData = require('js-data');\n * const { Record } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * // Instantiate a plain record\n * let record = new Record();\n * console.log('record: ' + JSON.stringify(record));\n *\n * // You can supply properties on instantiation\n * record = new Record({ name: 'John' });\n * console.log('record: ' + JSON.stringify(record));\n *\n * @example <caption>Record#constructor2</caption>\n * const JSData = require('js-data');\n * const { Mapper } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * // Instantiate a record that's associated with a Mapper:\n * const UserMapper = new Mapper({ name: 'user' });\n * const User = UserMapper.recordClass;\n * const user = UserMapper.createRecord({ name: 'John' });\n * const user2 = new User({ name: 'Sally' });\n * console.log('user: ' + JSON.stringify(user));\n * console.log('user2: ' + JSON.stringify(user2));\n *\n * @example <caption>Record#constructor3</caption>\n * const JSData = require('js-data');\n * const { Container } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * const store = new Container();\n * store.defineMapper('user');\n *\n * // Instantiate a record that's associated with a store's Mapper\n * const user = store.createRecord('user', { name: 'John' });\n * console.log('user: ' + JSON.stringify(user));\n *\n * @example <caption>Record#constructor4</caption>\n * const JSData = require('js-data');\n * const { Container } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * const store = new Container();\n * store.defineMapper('user', {\n *   schema: {\n *     properties: {\n *       name: { type: 'string' }\n *     }\n *   }\n * });\n *\n * // Validate on instantiation\n * const user = store.createRecord('user', { name: 1234 });\n * console.log('user: ' + JSON.stringify(user));\n *\n * @example <caption>Record#constructor5</caption>\n * const JSData = require('js-data');\n * const { Container } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * const store = new Container();\n * store.defineMapper('user', {\n *   schema: {\n *     properties: {\n *       name: { type: 'string' }\n *     }\n *   }\n * });\n *\n * // Skip validation on instantiation\n * const user = store.createRecord('user', { name: 1234 }, { noValidate: true });\n * console.log('user: ' + JSON.stringify(user));\n * console.log('user.isValid(): ' + user.isValid());\n *\n * @class Record\n * @extends Settable\n * @param {object} [props] The initial properties of the new Record instance.\n * @param {object} [opts] Configuration options.\n * @param {boolean} [opts.noValidate=false] Whether to skip validation on the\n * initial properties.\n * @param {boolean} [opts.validateOnSet=true] Whether to enable setter\n * validation on properties after the Record has been initialized.\n * @since 3.0.0\n */\nexport default class Record extends Settable {\n  static mapper: Mapper;\n\n  constructor (props: any = {}, opts: any = {}) {\n    super()\n    const _set = this._set\n    const mapper = (this.constructor as any).mapper\n\n    _set(creatingPath, true)\n    _set(noValidatePath, !!opts.noValidate)\n    _set(\n      keepChangeHistoryPath,\n      opts.keepChangeHistory === undefined ? (mapper ? mapper.keepChangeHistory : true) : opts.keepChangeHistory\n    )\n\n    // Set the idAttribute value first, if it exists.\n    const id = mapper ? utils.get(props, mapper.idAttribute) : undefined\n    if (id !== undefined) {\n      utils.set(this, mapper.idAttribute, id)\n    }\n\n    utils.fillIn(this, props)\n    _set(creatingPath, false)\n    if (opts.validateOnSet !== undefined) {\n      _set(noValidatePath, !opts.validateOnSet)\n    } else if (mapper?.validateOnSet !== undefined) {\n      _set(noValidatePath, !mapper.validateOnSet)\n    } else {\n      _set(noValidatePath, false)\n    }\n    _set(previousPath, mapper ? mapper.toJSON(props) : utils.plainCopy(props))\n  }\n\n  /**\n   * Returns the {@link Mapper} paired with this record's class, if any.\n   *\n   * @method Record#_mapper\n   * @returns {Mapper} The {@link Mapper} paired with this record's class, if any.\n   * @since 3.0.0\n   */\n  _mapper () {\n    const mapper = (this.constructor as any).mapper\n    if (!mapper) {\n      throw utils.err(`${DOMAIN}#_mapper`, '')(404, 'mapper')\n    }\n    return mapper\n  }\n\n  /**\n   * Lifecycle hook.\n   *\n   * @method Record#afterLoadRelations\n   * @param {string[]} relations The `relations` argument passed to {@link Record#loadRelations}.\n   * @param {object} opts The `opts` argument passed to {@link Record#loadRelations}.\n   * @since 3.0.0\n   */\n  afterLoadRelations (relations: string[], opts?) {}\n\n  /**\n   * Lifecycle hook.\n   *\n   * @method Record#beforeLoadRelations\n   * @param {string[]} relations The `relations` argument passed to {@link Record#loadRelations}.\n   * @param {object} opts The `opts` argument passed to {@link Record#loadRelations}.\n   * @since 3.0.0\n   */\n  beforeLoadRelations (relations: string[], opts?) {}\n\n  /**\n   * Return the change history of this record since it was instantiated or\n   * {@link Record#commit} was called.\n   *\n   * @method Record#changeHistory\n   * @since 3.0.0\n   */\n  changeHistory () {\n    return (this._get('history') || []).slice()\n  }\n\n  /**\n   * Return changes to this record since it was instantiated or\n   * {@link Record#commit} was called.\n   *\n   * @example <caption>Record#changes</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new Container();\n   * store.defineMapper('user');\n   * const user = store.createRecord('user');\n   * console.log('user changes: ' + JSON.stringify(user.changes()));\n   * user.name = 'John';\n   * console.log('user changes: ' + JSON.stringify(user.changes()));\n   *\n   * @method Record#changes\n   * @param [opts] Configuration options.\n   * @param {Function} [opts.equalsFn={@link utils.deepEqual}] Equality function.\n   * @param {array} [opts.ignore=[]] Array of strings or RegExp of fields to ignore.\n   * @returns {Object} Object describing the changes to this record since it was\n   * instantiated or its {@link Record#commit} method was last called.\n   * @since 3.0.0\n   */\n  changes (opts: any = {}) {\n    return utils.diffObjects(typeof this.toJSON === 'function' ? this.toJSON(opts) : this, this._get('previous'), opts)\n  }\n\n  /**\n   * Make the record's current in-memory state it's only state, with any\n   * previous property values being set to current values.\n   *\n   * @example <caption>Record#commit</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new Container();\n   * store.defineMapper('user');\n   * const user = store.createRecord('user');\n   * console.log('user hasChanges: ' + user.hasChanges());\n   * user.name = 'John';\n   * console.log('user hasChanges: ' + user.hasChanges());\n   * user.commit();\n   * console.log('user hasChanges: ' + user.hasChanges());\n   *\n   * @method Record#commit\n   * @param {object} [opts] Configuration options. Passed to {@link Record#toJSON}.\n   * @since 3.0.0\n   */\n  commit (opts?) {\n    this._set('changed') // unset\n    this._set('changing', false)\n    this._set('history', []) // clear history\n    this._set('previous', this.toJSON(opts))\n  }\n\n  /**\n   * Call {@link Mapper#destroy} using this record's primary key.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * import { RethinkDBAdapter } from 'js-data-rethinkdb';\n   *\n   * const store = new Container();\n   * store.registerAdapter('rethink', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('user');\n   * store.find('user', 1234).then((user) => {\n   *   console.log(user.id); // 1234\n   *\n   *   // Destroy this user from the database\n   *   return user.destroy();\n   * });\n   *\n   * @method Record#destroy\n   * @param {object} [opts] Configuration options passed to {@link Mapper#destroy}.\n   * @returns {Promise} The result of calling {@link Mapper#destroy} with the\n   * primary key of this record.\n   * @since 3.0.0\n   */\n  destroy (opts: any = {}) {\n    const mapper = this._mapper()\n    return superMethod(mapper, 'destroy')(utils.get(this, mapper.idAttribute), opts)\n  }\n\n  /**\n   * Return the value at the given path for this instance.\n   *\n   * @example <caption>Record#get</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   * const store = new Container();\n   * store.defineMapper('user');\n   *\n   * const user = store.createRecord('user', { name: 'Bob' });\n   * console.log('user.get(\"name\"): ' + user.get('name'));\n   *\n   * @method Record#get\n   * @param {string} key Path of value to retrieve.\n   * @returns {*} Value at path.\n   * @since 3.0.0\n   */\n  get (key) {\n    return utils.get(this, key)\n  }\n\n  /**\n   * Return whether this record has changed since it was instantiated or\n   * {@link Record#commit} was called.\n   *\n   * @example <caption>Record#hasChanges</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   * const store = new Container();\n   * store.defineMapper('user');\n   * const user = store.createRecord('user');\n   * console.log('user hasChanges: ' + user.hasChanges());\n   * user.name = 'John';\n   * console.log('user hasChanges: ' + user.hasChanges());\n   * user.commit();\n   * console.log('user hasChanges: ' + user.hasChanges());\n   *\n   * @method Record#hasChanges\n   * @param [opts] Configuration options.\n   * @param {Function} [opts.equalsFn={@link utils.deepEqual}] Equality function.\n   * @param {array} [opts.ignore=[]] Array of strings or RegExp of fields to ignore.\n   * @returns {boolean} Return whether the record has changed since it was\n   * instantiated or since its {@link Record#commit} method was called.\n   * @since 3.0.0\n   */\n  hasChanges (opts?) {\n    const quickHasChanges = !!(this._get('changed') || []).length\n    return (\n      quickHasChanges ||\n      utils.areDifferent(typeof this.toJSON === 'function' ? this.toJSON(opts) : this, this._get('previous'), opts)\n    )\n  }\n\n  /**\n   * Return whether the record is unsaved. Records that have primary keys are\n   * considered \"saved\". Records without primary keys are considered \"unsaved\".\n   *\n   * @example <caption>Record#isNew</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   * const store = new Container();\n   * store.defineMapper('user');\n   * const user = store.createRecord('user', {\n   *   id: 1234\n   * });\n   * const user2 = store.createRecord('user');\n   * console.log('user isNew: ' + user.isNew()); // false\n   * console.log('user2 isNew: ' + user2.isNew()); // true\n   *\n   * @method Record#isNew\n   * @returns {boolean} Whether the record is unsaved.\n   * @since 3.0.0\n   */\n  isNew (opts?) {\n    return utils.get(this, this._mapper().idAttribute) === undefined\n  }\n\n  /**\n   * Return whether the record in its current state passes validation.\n   *\n   * @example <caption>Record#isValid</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   * const store = new Container();\n   * store.defineMapper('user', {\n   *   schema: {\n   *     properties: {\n   *       name: { type: 'string' }\n   *     }\n   *   }\n   * });\n   * const user = store.createRecord('user', {\n   *   name: 1234\n   * }, {\n   *   noValidate: true // this allows us to put the record into an invalid state\n   * });\n   * console.log('user isValid: ' + user.isValid());\n   * user.name = 'John';\n   * console.log('user isValid: ' + user.isValid());\n   *\n   * @method Record#isValid\n   * @param {object} [opts] Configuration options. Passed to {@link Mapper#validate}.\n   * @returns {boolean} Whether the record in its current state passes\n   * validation.\n   * @since 3.0.0\n   */\n  isValid (opts) {\n    return !this._mapper().validate(this, opts)\n  }\n\n  removeInverseRelation (currentParent, id, inverseDef, idAttribute) {\n    if (inverseDef.type === hasOneType) {\n      safeSetLink(currentParent, inverseDef.localField, undefined)\n    } else if (inverseDef.type === hasManyType) {\n      // e.g. remove comment from otherPost.comments\n      const children = utils.get(currentParent, inverseDef.localField)\n      if (id === undefined) {\n        utils.remove(children, child => child === this)\n      } else {\n        utils.remove(children, child => child === this || id === utils.get(child, idAttribute))\n      }\n    }\n  }\n\n  setupInverseRelation (record, id, inverseDef, idAttribute) {\n    // Update (set) inverse relation\n    if (inverseDef.type === hasOneType) {\n      // e.g. someUser.profile = profile\n      safeSetLink(record, inverseDef.localField, this)\n    } else if (inverseDef.type === hasManyType) {\n      // e.g. add comment to somePost.comments\n      const children = utils.get(record, inverseDef.localField)\n      if (id === undefined) {\n        utils.noDupeAdd(children, this, child => child === this)\n      } else {\n        utils.noDupeAdd(children, this, child => child === this || id === utils.get(child, idAttribute))\n      }\n    }\n  }\n\n  /**\n   * Lazy load relations of this record, to be attached to the record once their\n   * loaded.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * import { RethinkDBAdapter } from 'js-data-rethinkdb';\n   *\n   * const store = new Container();\n   * store.registerAdapter('rethink', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('user', {\n   *   relations: {\n   *     hasMany: {\n   *       post: {\n   *         localField: 'posts',\n   *         foreignKey: 'user_id'\n   *       }\n   *     }\n   *   }\n   * });\n   * store.defineMapper('post', {\n   *   relations: {\n   *     belongsTo: {\n   *       user: {\n   *         localField: 'user',\n   *         foreignKey: 'user_id'\n   *       }\n   *     }\n   *   }\n   * });\n   * store.find('user', 1234).then((user) => {\n   *   console.log(user.id); // 1234\n   *\n   *   // Load the user's post relations\n   *   return user.loadRelations(['post']);\n   * }).then((user) => {\n   *   console.log(user.posts); // [{...}, {...}, ...]\n   * });\n   *\n   * @method Record#loadRelations\n   * @param {string[]} [relations] List of relations to load. Can use localField\n   * names or Mapper names to pick relations.\n   * @param {object} [opts] Configuration options.\n   * @returns {Promise} Resolves with the record, with the loaded relations now\n   * attached.\n   * @since 3.0.0\n   */\n  loadRelations (relations: string[] | string | any = [], opts: any = {}) {\n    let op\n    const mapper = this._mapper()\n\n    if (utils.isString(relations)) {\n      relations = [relations]\n    }\n    opts.with = relations\n\n    // Fill in \"opts\" with the Model's configuration\n    utils._(opts, mapper)\n    opts.adapter = mapper.getAdapterName(opts)\n\n    // beforeLoadRelations lifecycle hook\n    op = opts.op = 'beforeLoadRelations'\n    return utils\n      .resolve(this[op](relations, opts))\n      .then(() => {\n        // Now delegate to the adapter\n        op = opts.op = 'loadRelations'\n        mapper.dbg(op, this, relations, opts)\n        const tasks = []\n        let task\n        utils.forEachRelation(mapper, opts, (def, optsCopy) => {\n          const relatedMapper = def.getRelation()\n          optsCopy.raw = false\n          if (utils.isFunction(def.load)) {\n            task = def.load(mapper, def, this, opts)\n          } else if (def.type === 'hasMany' || def.type === 'hasOne') {\n            if (def.foreignKey) {\n              task = superMethod(relatedMapper, 'findAll')(\n                {\n                  [def.foreignKey]: utils.get(this, mapper.idAttribute)\n                },\n                optsCopy\n              ).then(relatedData =>\n                def.type === 'hasOne' ? (relatedData.length ? relatedData[0] : undefined) : relatedData\n              )\n            } else if (def.localKeys) {\n              task = superMethod(\n                relatedMapper,\n                'findAll'\n              )({\n                where: {\n                  [relatedMapper.idAttribute]: {\n                    in: utils.get(this, def.localKeys)\n                  }\n                }\n              })\n            } else if (def.foreignKeys) {\n              task = superMethod(relatedMapper, 'findAll')(\n                {\n                  where: {\n                    [def.foreignKeys]: {\n                      contains: utils.get(this, mapper.idAttribute)\n                    }\n                  }\n                },\n                opts\n              )\n            }\n          } else if (def.type === 'belongsTo') {\n            const key = utils.get(this, def.foreignKey)\n            if (utils.isSorN(key)) {\n              task = superMethod(relatedMapper, 'find')(key, optsCopy)\n            }\n          }\n          if (task) {\n            task = task.then(relatedData => {\n              def.setLocalField(this, relatedData)\n            })\n            tasks.push(task)\n          }\n        })\n        return Promise.all(tasks)\n      })\n      .then(() => {\n        // afterLoadRelations lifecycle hook\n        op = opts.op = 'afterLoadRelations'\n        return utils.resolve(this[op](relations, opts)).then(() => this)\n      })\n  }\n\n  /**\n   * Return the properties with which this record was instantiated.\n   *\n   * @example <caption>Record#previous</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   * const store = new Container();\n   * store.defineMapper('user');\n   * const user = store.createRecord('user', {\n   *   name: 'William'\n   * });\n   * console.log('user previous: ' + JSON.stringify(user.previous()));\n   * user.name = 'Bob';\n   * console.log('user previous: ' + JSON.stringify(user.previous()));\n   * user.commit();\n   * console.log('user previous: ' + JSON.stringify(user.previous()));\n   *\n   * @method Record#previous\n   * @param {string} [key] If specified, return just the initial value of the\n   * given key.\n   * @returns {Object} The initial properties of this record.\n   * @since 3.0.0\n   */\n  previous (key) {\n    if (key) {\n      return this._get(`previous.${key}`)\n    }\n    return this._get('previous')\n  }\n\n  /**\n   * Revert changes to this record back to the properties it had when it was\n   * instantiated.\n   *\n   * @example <caption>Record#revert</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   * const store = new Container();\n   * store.defineMapper('user');\n   * const user = store.createRecord('user', {\n   *   name: 'William'\n   * });\n   * console.log('user: ' + JSON.stringify(user));\n   * user.name = 'Bob';\n   * console.log('user: ' + JSON.stringify(user));\n   * user.revert();\n   * console.log('user: ' + JSON.stringify(user));\n   *\n   * @method Record#revert\n   * @param {object} [opts] Configuration options.\n   * @param {string[]} [opts.preserve] Array of strings or Regular Expressions\n   * denoting properties that should not be reverted.\n   * @since 3.0.0\n   */\n  revert (opts: any = {}) {\n    const previous = this._get('previous')\n    opts.preserve = opts.preserve || []\n    utils.forOwn(this, (value, key) => {\n      if (\n        key !== this._mapper().idAttribute &&\n        !previous.hasOwnProperty(key) &&\n        this.hasOwnProperty(key) &&\n        opts.preserve.indexOf(key) === -1\n      ) {\n        delete this[key]\n      }\n    })\n    utils.forOwn(previous, (value, key) => {\n      if (opts.preserve.indexOf(key) === -1) {\n        this[key] = value\n      }\n    })\n    this.commit()\n  }\n\n  /**\n   * Delegates to {@link Mapper#create} or {@link Mapper#update}.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * import { RethinkDBAdapter } from 'js-data-rethinkdb';\n   *\n   * const store = new Container();\n   * store.registerAdapter('rethink', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('session');\n   * const session = store.createRecord('session', { topic: 'Node.js' });\n   *\n   * // Create a new record in the database\n   * session.save().then(() => {\n   *   console.log(session.id); // 1234\n   *\n   *   session.skill_level = 'beginner';\n   *\n   *   // Update the record in the database\n   *   return session.save();\n   * });\n   *\n   * @method Record#save\n   * @param {object} [opts] Configuration options. See {@link Mapper#create} and\n   * {@link Mapper#update}.\n   * @param {boolean} [opts.changesOnly] Equality function. Default uses `===`.\n   * @param {Function} [opts.equalsFn] Passed to {@link Record#changes} when\n   * `opts.changesOnly` is `true`.\n   * @param {array} [opts.ignore] Passed to {@link Record#changes} when\n   * `opts.changesOnly` is `true`.\n   * @returns {Promise} The result of calling {@link Mapper#create} or\n   * {@link Mapper#update}.\n   * @since 3.0.0\n   */\n  save (opts: any = {}) {\n    const mapper = this._mapper()\n    const id = utils.get(this, mapper.idAttribute)\n    let props: any = this\n\n    const postProcess = result => {\n      const record = opts.raw ? result.data : result\n      if (record) {\n        utils.deepMixIn(this, record)\n        this.commit()\n      }\n      return result\n    }\n\n    if (id === undefined) {\n      return superMethod(mapper, 'create')(props, opts).then(postProcess)\n    }\n    if (opts.changesOnly) {\n      const changes = this.changes(opts)\n      props = {}\n      utils.fillIn(props, changes.added)\n      utils.fillIn(props, changes.changed)\n    }\n    return superMethod(mapper, 'update')(id, props, opts).then(postProcess)\n  }\n\n  /**\n   * Set the value for a given key, or the values for the given keys if \"key\" is\n   * an object. Triggers change events on those properties that have `track: true`\n   * in {@link Mapper#schema}.\n   *\n   * @example <caption>Record#set</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   * const store = new Container();\n   * store.defineMapper('user');\n   *\n   * const user = store.createRecord('user');\n   * console.log('user: ' + JSON.stringify(user));\n   *\n   * user.set('name', 'Bob');\n   * console.log('user: ' + JSON.stringify(user));\n   *\n   * user.set({ age: 30, role: 'admin' });\n   * console.log('user: ' + JSON.stringify(user));\n   *\n   * @fires Record#change\n   * @method Record#set\n   * @param {(string|Object)} key Key to set or hash of key-value pairs to set.\n   * @param {*} [value] Value to set for the given key.\n   * @param {object} [opts] Configuration options.\n   * @param {boolean} [opts.silent=false] Whether to trigger change events.\n   * @since 3.0.0\n   */\n  set (key: string | any, value?, opts?) {\n    if (utils.isObject(key)) {\n      opts = value\n    }\n    opts = opts || {}\n    if (opts.silent) {\n      this._set('silent', true)\n    }\n    utils.set(this, key, value)\n    if (!this._get('eventId')) {\n      this._set('silent') // unset\n    }\n  }\n\n  /**\n   * Return a plain object representation of this record. If the class from\n   * which this record was created has a Mapper, then {@link Mapper#toJSON} will\n   * be called with this record instead.\n   *\n   * @example <caption>Record#toJSON</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   * const store = new Container();\n   * store.defineMapper('user', {\n   *   schema: {\n   *     properties: {\n   *       name: { type: 'string' }\n   *     }\n   *   }\n   * });\n   *\n   * const user = store.createRecord('user', {\n   *   name: 'John',\n   *   $$hashKey: '1234'\n   * });\n   * console.log('user: ' + JSON.stringify(user.toJSON()));\n   *\n   * @method Record#toJSON\n   * @param {object} [opts] Configuration options.\n   * @param {string[]} [opts.with] Array of relation names or relation fields\n   * to include in the representation. Only available as an option if the class\n   * from which this record was created has a Mapper and this record resides in\n   * an instance of {@link DataStore}.\n   * @returns {Object} Plain object representation of this record.\n   * @since 3.0.0\n   */\n  toJSON (opts?) {\n    const mapper = (this.constructor as any).mapper\n    if (mapper) {\n      return mapper.toJSON(this, opts)\n    } else {\n      const json = {}\n      utils.forOwn(this, (prop, key) => {\n        json[key] = utils.plainCopy(prop)\n      })\n      return json\n    }\n  }\n\n  /**\n   * Unset the value for a given key. Triggers change events on those properties\n   * that have `track: true` in {@link Mapper#schema}.\n   *\n   * @example <caption>Record#unset</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   * const store = new Container();\n   * store.defineMapper('user');\n   *\n   * const user = store.createRecord('user', {\n   *   name: 'John'\n   * });\n   * console.log('user: ' + JSON.stringify(user));\n   *\n   * user.unset('name');\n   * console.log('user: ' + JSON.stringify(user));\n   *\n   * @method Record#unset\n   * @param {string} key Key to unset.\n   * @param {object} [opts] Configuration options.\n   * @param {boolean} [opts.silent=false] Whether to trigger change events.\n   * @since 3.0.0\n   */\n  unset (key: string, opts?) {\n    this.set(key, undefined, opts)\n  }\n\n  /**\n   * Validate this record based on its current properties.\n   *\n   * @example <caption>Record#validate</caption>\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   * const store = new Container();\n   * store.defineMapper('user', {\n   *   schema: {\n   *     properties: {\n   *       name: { type: 'string' }\n   *     }\n   *   }\n   * });\n   * const user = store.createRecord('user', {\n   *   name: 1234\n   * }, {\n   *   noValidate: true // this allows us to put the record into an invalid state\n   * });\n   * console.log('user validation: ' + JSON.stringify(user.validate()));\n   * user.name = 'John';\n   * console.log('user validation: ' + user.validate());\n   *\n   * @method Record#validate\n   * @param {object} [opts] Configuration options. Passed to {@link Mapper#validate}.\n   * @returns {*} Array of errors or `undefined` if no errors.\n   * @since 3.0.0\n   */\n  validate (opts) {\n    return this._mapper().validate(this, opts)\n  }\n\n  static creatingPath = creatingPath;\n  static noValidatePath = noValidatePath;\n  static keepChangeHistoryPath = keepChangeHistoryPath;\n  static previousPath = previousPath;\n}\n\n/**\n * Allow records to emit events.\n *\n * An record's registered listeners are stored in the record's private data.\n */\nutils.eventify(\n  Record.prototype,\n  function () {\n    return this._get('events')\n  },\n  function (value) {\n    this._set('events', value)\n  }\n)\n\n/**\n * Fired when a record changes. Only works for records that have tracked fields.\n * See {@link Record~changeListener} on how to listen for this event.\n *\n * @event Record#change\n * @see Record~changeListener\n */\n\n/**\n * Callback signature for the {@link Record#event:change} event.\n *\n * @example\n * function onChange (record, changes) {\n *   // do something\n * }\n * record.on('change', onChange);\n *\n * @callback Record~changeListener\n * @param {Record} The Record that changed.\n * @param {object} The changes.\n * @see Record#event:change\n * @since 3.0.0\n */\n\n/**\n * Create a subclass of this Record:\n * @example <caption>Record.extend</caption>\n * const JSData = require('js-data');\n * const { Record } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * // Extend the class using ES2015 class syntax.\n * class CustomRecordClass extends Record {\n *   foo () { return 'bar'; }\n *   static beep () { return 'boop'; }\n * }\n * const customRecord = new CustomRecordClass();\n * console.log(customRecord.foo());\n * console.log(CustomRecordClass.beep());\n *\n * // Extend the class using alternate method.\n * const OtherRecordClass = Record.extend({\n *   foo () { return 'bar'; }\n * }, {\n *   beep () { return 'boop'; }\n * });\n * const otherRecord = new OtherRecordClass();\n * console.log(otherRecord.foo());\n * console.log(OtherRecordClass.beep());\n *\n * // Extend the class, providing a custom constructor.\n * function AnotherRecordClass () {\n *   Record.call(this);\n *   this.created_at = new Date().getTime();\n * }\n * Record.extend({\n *   constructor: AnotherRecordClass,\n *   foo () { return 'bar'; }\n * }, {\n *   beep () { return 'boop'; }\n * });\n * const anotherRecord = new AnotherRecordClass();\n * console.log(anotherRecord.created_at);\n * console.log(anotherRecord.foo());\n * console.log(AnotherRecordClass.beep());\n *\n * @method Record.extend\n * @param {object} [props={}] Properties to add to the prototype of the\n * subclass.\n * @param {object} [props.constructor] Provide a custom constructor function\n * to be used as the subclass itself.\n * @param {object} [classProps={}] Static properties to add to the subclass.\n * @returns {Constructor} Subclass of this Record class.\n * @since 3.0.0\n */\n","export function sort (a, b, hashCode) {\n  // Short-circuit comparison if a and b are strictly equal\n  // This is absolutely necessary for indexed objects that\n  // don't have the idAttribute field\n  if (a === b) {\n    return 0\n  } else if (hashCode) {\n    a = hashCode(a)\n    b = hashCode(b)\n  }\n  return (a === null && b === null) || (a === undefined && b === undefined)\n    ? -1\n    : a === null || a === undefined\n      ? -1\n      : b === null || b === undefined\n        ? 1\n        : a < b\n          ? -1\n          : a > b\n            ? 1\n            : 0\n}\n\nexport function insertAt (array, index, value) {\n  array.splice(index, 0, value)\n  return array\n}\n\nexport function removeAt (array, index) {\n  array.splice(index, 1)\n  return array\n}\n\nexport function binarySearch (array, value, field?) {\n  let lo = 0\n  let hi = array.length\n  let compared\n  let mid\n\n  while (lo < hi) {\n    // tslint:disable-next-line:no-bitwise\n    mid = ((lo + hi) / 2) | 0\n    compared = sort(value, array[mid], field)\n    if (compared === 0) {\n      return {\n        found: true,\n        index: mid\n      }\n    } else if (compared < 0) {\n      hi = mid\n    } else {\n      lo = mid + 1\n    }\n  }\n\n  return {\n    found: false,\n    index: hi\n  }\n}\n","// Copyright (c) 2015, InternalFX.\n\n// Permission to use, copy, modify, and/or distribute this software for any purpose with or\n// without fee is hereby granted, provided that the above copyright notice and this permission\n// notice appear in all copies.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO\n// THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT\n// SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR\n// ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION\n// OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE\n// USE OR PERFORMANCE OF THIS SOFTWARE.\n\n// Modifications\n// Copyright 2015-2016 Jason Dobry\n//\n// Summary of modifications:\n// Reworked dependencies so as to re-use code already in js-data\n// Removed unused code\nimport utils from '../../src/utils'\nimport { binarySearch, insertAt, removeAt } from './_utils'\n\nexport interface IndexOpts {\n  fieldGetter?\n  hashCode?\n}\n\nexport default class Index {\n  fieldList: any[];\n  fieldGetter: any;\n  hashCode: any;\n  isIndex: boolean;\n  keys: any[];\n  values: any[];\n\n  constructor (fieldList = [], opts: IndexOpts = {}) {\n    if (!utils.isArray(fieldList)) {\n      throw new Error('fieldList must be an array.')\n    }\n\n    this.fieldList = fieldList\n    this.fieldGetter = opts.fieldGetter\n    this.hashCode = opts.hashCode\n    this.isIndex = true\n    this.keys = []\n    this.values = []\n  }\n\n  set (keyList, value) {\n    if (!utils.isArray(keyList)) {\n      keyList = [keyList]\n    }\n\n    const key = keyList.shift() || undefined\n    const pos = binarySearch(this.keys, key)\n\n    if (keyList.length === 0) {\n      if (pos.found) {\n        const dataLocation = binarySearch(this.values[pos.index], value, this.hashCode)\n        if (!dataLocation.found) {\n          insertAt(this.values[pos.index], dataLocation.index, value)\n        }\n      } else {\n        insertAt(this.keys, pos.index, key)\n        insertAt(this.values, pos.index, [value])\n      }\n    } else {\n      if (pos.found) {\n        this.values[pos.index].set(keyList, value)\n      } else {\n        insertAt(this.keys, pos.index, key)\n        const newIndex = new Index([], { hashCode: this.hashCode })\n        newIndex.set(keyList, value)\n        insertAt(this.values, pos.index, newIndex)\n      }\n    }\n  }\n\n  get (keyList?) {\n    if (!utils.isArray(keyList)) {\n      keyList = [keyList]\n    }\n\n    const key = keyList.shift() || undefined\n    const pos = binarySearch(this.keys, key)\n\n    if (keyList.length === 0) {\n      if (pos.found) {\n        if (this.values[pos.index].isIndex) {\n          return this.values[pos.index].getAll()\n        } else {\n          return this.values[pos.index].slice()\n        }\n      } else {\n        return []\n      }\n    } else {\n      if (pos.found) {\n        return this.values[pos.index].get(keyList)\n      } else {\n        return []\n      }\n    }\n  }\n\n  getAll (opts: any = {}) {\n    let results = []\n    const values = this.values\n    if (opts.order === 'desc') {\n      for (let i = values.length - 1; i >= 0; i--) {\n        const value = values[i]\n        if (value.isIndex) {\n          results = results.concat(value.getAll(opts))\n        } else {\n          results = results.concat(value)\n        }\n      }\n    } else {\n      for (const value of values) {\n        if (value.isIndex) {\n          results = results.concat(value.getAll(opts))\n        } else {\n          results = results.concat(value)\n        }\n      }\n    }\n    return results\n  }\n\n  visitAll (cb, thisArg?) {\n    this.values.forEach(value => {\n      if (value.isIndex) {\n        value.visitAll(cb, thisArg)\n      } else {\n        value.forEach(cb, thisArg)\n      }\n    })\n  }\n\n  between (leftKeys, rightKeys, opts: any = {}) {\n    if (!utils.isArray(leftKeys)) {\n      leftKeys = [leftKeys]\n    }\n    if (!utils.isArray(rightKeys)) {\n      rightKeys = [rightKeys]\n    }\n    utils.fillIn(opts, {\n      leftInclusive: true,\n      rightInclusive: false,\n      limit: undefined,\n      offset: 0\n    })\n\n    const results = this._between(leftKeys, rightKeys, opts)\n\n    if (opts.limit) {\n      return results.slice(opts.offset, opts.limit + opts.offset)\n    } else {\n      return results.slice(opts.offset)\n    }\n  }\n\n  _between (leftKeys, rightKeys, opts) {\n    let results = []\n\n    const leftKey = leftKeys.shift()\n    const rightKey = rightKeys.shift()\n\n    let pos\n\n    if (leftKey !== undefined) {\n      pos = binarySearch(this.keys, leftKey)\n    } else {\n      pos = {\n        found: false,\n        index: 0\n      }\n    }\n\n    if (leftKeys.length === 0) {\n      if (pos.found && opts.leftInclusive === false) {\n        pos.index += 1\n      }\n\n      for (let i = pos.index; i < this.keys.length; i += 1) {\n        if (rightKey !== undefined) {\n          if (opts.rightInclusive) {\n            if (this.keys[i] > rightKey) {\n              break\n            }\n          } else {\n            if (this.keys[i] >= rightKey) {\n              break\n            }\n          }\n        }\n\n        if (this.values[i].isIndex) {\n          results = results.concat(this.values[i].getAll())\n        } else {\n          results = results.concat(this.values[i])\n        }\n\n        if (opts.limit) {\n          if (results.length >= opts.limit + opts.offset) {\n            break\n          }\n        }\n      }\n    } else {\n      for (let i = pos.index; i < this.keys.length; i += 1) {\n        const currKey = this.keys[i]\n        if (currKey > rightKey) {\n          break\n        }\n\n        if (this.values[i].isIndex) {\n          if (currKey === leftKey) {\n            results = results.concat(\n              this.values[i]._between(\n                utils.copy(leftKeys),\n                rightKeys.map(() => undefined),\n                opts\n              )\n            )\n          } else if (currKey === rightKey) {\n            results = results.concat(\n              this.values[i]._between(\n                leftKeys.map(() => undefined),\n                utils.copy(rightKeys),\n                opts\n              )\n            )\n          } else {\n            results = results.concat(this.values[i].getAll())\n          }\n        } else {\n          results = results.concat(this.values[i])\n        }\n\n        if (opts.limit) {\n          if (results.length >= opts.limit + opts.offset) {\n            break\n          }\n        }\n      }\n    }\n\n    if (opts.limit) {\n      return results.slice(0, opts.limit + opts.offset)\n    } else {\n      return results\n    }\n  }\n\n  peek () {\n    return this.values.length ? (this.values[0].isIndex ? this.values[0].peek() : this.values[0]) : []\n  }\n\n  clear () {\n    this.keys = []\n    this.values = []\n  }\n\n  insertRecord (data) {\n    const keyList = this.fieldList.map(field =>\n      utils.isFunction(field) ? field(data) || undefined : data[field] || undefined\n    )\n    this.set(keyList, data)\n  }\n\n  removeRecord (data) {\n    let removed\n    const isUnique = this.hashCode(data) !== undefined\n    this.values.forEach((value, i) => {\n      if (value.isIndex) {\n        if (value.removeRecord(data)) {\n          if (value.keys.length === 0) {\n            removeAt(this.keys, i)\n            removeAt(this.values, i)\n          }\n          removed = true\n          return false\n        }\n      } else {\n        let dataLocation: any = {}\n        if (this.keys[i] === undefined || !isUnique) {\n          for (let j = value.length - 1; j >= 0; j--) {\n            if (value[j] === data) {\n              dataLocation = {\n                found: true,\n                index: j\n              }\n              break\n            }\n          }\n        } else if (isUnique) {\n          dataLocation = binarySearch(value, data, this.hashCode)\n        }\n        if (dataLocation.found) {\n          removeAt(value, dataLocation.index)\n          if (value.length === 0) {\n            removeAt(this.keys, i)\n            removeAt(this.values, i)\n          }\n          removed = true\n          return false\n        }\n      }\n    })\n    return removed ? data : undefined\n  }\n\n  updateRecord (data) {\n    const removed = this.removeRecord(data)\n    if (removed !== undefined) {\n      this.insertRecord(data)\n    }\n  }\n}\n","import utils from './utils'\nimport Component, { ComponentOpts } from './Component'\nimport Query from './Query'\nimport Record from './Record'\nimport Index from './mindex'\n\nconst { noValidatePath } = Record\n\nconst DOMAIN = 'Collection'\n\nexport interface CollectionOpts extends ComponentOpts {\n  /**\n   * Whether to call {@link Record#commit} on records that are added to the\n   * collection and already exist in the collection.\n   *\n   * @name Collection#commitOnMerge\n   * @type {boolean}\n   * @default true\n   */\n  commitOnMerge?: boolean\n\n  /**\n   * Whether record events should bubble up and be emitted by the collection.\n   *\n   * @name Collection#emitRecordEvents\n   * @type {boolean}\n   * @default true\n   */\n  emitRecordEvents?: boolean\n\n  /**\n   * Field to be used as the unique identifier for records in this collection.\n   * Defaults to `\"id\"` unless {@link Collection#mapper} is set, in which case\n   * this will default to {@link Mapper#idAttribute}.\n   *\n   * @name Collection#idAttribute\n   * @type {string}\n   * @default \"id\"\n   */\n  idAttribute?: string\n\n  /**\n   * What to do when inserting a record into this Collection that shares a\n   * primary key with a record already in this Collection.\n   *\n   * Possible values:\n   * merge\n   * replace\n   * skip\n   *\n   * Merge:\n   *\n   * Recursively shallow copy properties from the new record onto the existing\n   * record.\n   *\n   * Replace:\n   *\n   * Shallow copy top-level properties from the new record onto the existing\n   * record. Any top-level own properties of the existing record that are _not_\n   * on the new record will be removed.\n   *\n   * Skip:\n   *\n   * Ignore new record, keep existing record.\n   *\n   * @default \"merge\"\n   */\n  onConflict?: 'merge' | 'replace' | 'skip'\n}\n\nconst COLLECTION_DEFAULTS: CollectionOpts = {\n  commitOnMerge: true,\n  emitRecordEvents: true,\n  idAttribute: 'id',\n  onConflict: 'merge'\n}\n\n/**\n * An ordered set of {@link Record} instances.\n *\n * @example <caption>Collection#constructor</caption>\n * // import { Collection, Record } from 'js-data';\n * const JSData = require('js-data');\n * const {Collection, Record} = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * const user1 = new Record({ id: 1 });\n * const user2 = new Record({ id: 2 });\n * const UserCollection = new Collection([user1, user2]);\n * console.log(UserCollection.get(1) === user1);\n *\n * @class Collection\n * @extends Component\n * @param {array} [records] Initial set of records to insert into the\n * collection.\n * @param {object} [opts] Configuration options.\n * @param {string} [opts.commitOnMerge] See {@link Collection#commitOnMerge}.\n * @param {string} [opts.idAttribute] See {@link Collection#idAttribute}.\n * @param {string} [opts.onConflict=\"merge\"] See {@link Collection#onConflict}.\n * @param {string} [opts.mapper] See {@link Collection#mapper}.\n * @since 3.0.0\n */\nexport default class Collection extends Component {\n  queryClass\n  emitRecordEvents: any\n  onConflict: string\n  /**\n   * Default Mapper for this collection. Optional. If a Mapper is provided, then\n   * the collection will use the {@link Mapper#idAttribute} setting, and will\n   * wrap records in {@link Mapper#recordClass}.\n   *\n   * @example <caption>Collection#mapper</caption>\n   * const JSData = require('js-data');\n   * const {Collection, Mapper} = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * class MyMapperClass extends Mapper {\n   *   foo () { return 'bar'; }\n   * }\n   * const myMapper = new MyMapperClass({ name: 'myMapper' });\n   * const collection = new Collection(null, { mapper: myMapper });\n   *\n   * @name Collection#mapper\n   * @type {Mapper}\n   * @default null\n   * @since 3.0.0\n   */\n  mapper: any\n  /**\n   * The main index, which uses @{link Collection#recordId} as the key.\n   *\n   * @name Collection#index\n   * @type {Index}\n   */\n  index: Index\n  /**\n   * Object that holds the secondary indexes of this collection.\n   *\n   * @name Collection#indexes\n   * @type {Object.<string, Index>}\n   */\n  indexes: { [key: string]: Index } = {}\n  idAttribute: any\n  _added = {}\n  emit: any\n\n  constructor (records: any = {}, opts: CollectionOpts | string | any = {}) {\n    super(opts)\n\n    if (records && !utils.isArray(records)) {\n      opts = records\n      records = []\n    }\n    if (utils.isString(opts)) {\n      opts = { idAttribute: opts }\n    }\n\n    // Apply user-provided configuration\n    utils.fillIn(this, opts)\n    // Fill in any missing options with the defaults\n    utils.fillIn(this, utils.copy(COLLECTION_DEFAULTS))\n\n    if (!this.queryClass) {\n      this.queryClass = Query\n    }\n\n    const idAttribute = this.recordId()\n\n    this.index = new Index([idAttribute], {\n      hashCode (obj) {\n        return utils.get(obj, idAttribute)\n      }\n    })\n\n    // Insert initial data into the collection\n    if (utils.isObject(records) || (utils.isArray(records) && records.length)) {\n      this.add(records)\n    }\n  }\n\n  /**\n   * Used to bind to events emitted by records in this Collection.\n   *\n   * @method Collection#_onRecordEvent\n   * @since 3.0.0\n   * @private\n   * @param {...*} [args] Args passed to {@link Collection#emit}.\n   */\n  _onRecordEvent (...args) {\n    if (this.emitRecordEvents) {\n      this.emit(...args)\n    }\n  }\n\n  /**\n   * Insert the provided record or records.\n   *\n   * If a record is already in the collection then the provided record will\n   * either merge with or replace the existing record based on the value of the\n   * `onConflict` option.\n   *\n   * The collection's secondary indexes will be updated as each record is\n   * visited.\n   *\n   * @method Collection#add\n   * @since 3.0.0\n   * @param {(Object|Object[]|Record|Record[])} records The record or records to insert.\n   * @param {object} [opts] Configuration options.\n   * @param {boolean} [opts.commitOnMerge=true] See {@link Collection#commitOnMerge}.\n   * @param {boolean} [opts.noValidate] See {@link Record#noValidate}.\n   * @param {string} [opts.onConflict] See {@link Collection#onConflict}.\n   * @returns {(Object|Object[]|Record|Record[])} The added record or records.\n   */\n  add (records, opts: any = {}) {\n    // Fill in \"opts\" with the Collection's configuration\n    utils._(opts, this)\n    records = this.beforeAdd(records, opts) || records\n\n    // Track whether just one record or an array of records is being inserted\n    let singular = false\n    const idAttribute = this.recordId()\n    if (!utils.isArray(records)) {\n      if (utils.isObject(records)) {\n        records = [records]\n        singular = true\n      } else {\n        throw utils.err(`${DOMAIN}#add`, 'records')(\n          400,\n          'object or array',\n          records\n        )\n      }\n    }\n\n    // Map the provided records to existing records.\n    // New records will be inserted. If any records map to existing records,\n    // they will be merged into the existing records according to the onConflict\n    // option.\n    records = records.map(record => {\n      const id = this.recordId(record)\n      // Grab existing record if there is one\n      const existing = id === undefined ? id : this.get(id)\n      // If the currently visited record is just a reference to an existing\n      // record, then there is nothing to be done. Exit early.\n      if (record === existing) {\n        return existing\n      }\n\n      if (existing) {\n        // Here, the currently visited record corresponds to a record already\n        // in the collection, so we need to merge them\n        const onConflict = opts.onConflict || this.onConflict\n        if (\n          onConflict !== 'merge' &&\n          onConflict !== 'replace' &&\n          onConflict !== 'skip'\n        ) {\n          throw utils.err(`${DOMAIN}#add`, 'opts.onConflict')(\n            400,\n            'one of (merge, replace, skip)',\n            onConflict,\n            true\n          )\n        }\n        const existingNoValidate = existing._get(noValidatePath)\n        if (opts.noValidate) {\n          // Disable validation\n          existing._set(noValidatePath, true)\n        }\n        if (onConflict === 'merge') {\n          utils.deepMixIn(existing, record)\n        } else if (onConflict === 'replace') {\n          utils.forOwn(existing, (value, key) => {\n            if (key !== idAttribute && record[key] === undefined) {\n              existing[key] = undefined\n            }\n          })\n          existing.set(record)\n        } // else if(onConflict === 'skip'){ do nothing }\n\n        if (opts.noValidate) {\n          // Restore previous `noValidate` value\n          existing._set(noValidatePath, existingNoValidate)\n        }\n        record = existing\n        if (opts.commitOnMerge && utils.isFunction(record.commit)) {\n          record.commit()\n        }\n        // Update all indexes in the collection\n        this.updateIndexes(record)\n      } else {\n        // Here, the currently visited record does not correspond to any record\n        // in the collection, so (optionally) instantiate this record and insert\n        // it into the collection\n        record = this.mapper ? this.mapper.createRecord(record, opts) : record\n        this.index.insertRecord(record)\n        utils.forOwn(this.indexes, (index, name) => {\n          index.insertRecord(record)\n        })\n        if (record && utils.isFunction(record.on)) {\n          record.on('all', this._onRecordEvent, this)\n        }\n      }\n      return record\n    })\n    // Finally, return the inserted data\n    const result = singular ? records[0] : records\n    if (!opts.silent) {\n      this.emit('add', result)\n    }\n    return this.afterAdd(records, opts, result) || result\n  }\n\n  /**\n   * Lifecycle hook called by {@link Collection#add}. If this method returns a\n   * value then {@link Collection#add} will return that same value.\n   *\n   * @method Collection#method\n   * @since 3.0.0\n   * @param {(Object|Object[]|Record|Record[])} record The record or records\n   * that were added to this Collection by {@link Collection#add}.\n   * @param {object} opts The `opts` argument passed to {@link Collection#add}.\n   * @param result\n   */\n  afterAdd (record, opts, result) {\n    return null\n  }\n\n  /**\n   * Lifecycle hook called by {@link Collection#remove}. If this method returns\n   * a value then {@link Collection#remove} will return that same value.\n   *\n   * @method Collection#afterRemove\n   * @since 3.0.0\n   * @param {(string|number)} id The `id` argument passed to {@link Collection#remove}.\n   * @param {object} opts The `opts` argument passed to {@link Collection#remove}.\n   * @param {object} record The result that will be returned by {@link Collection#remove}.\n   */\n  afterRemove (id, opts, record) {\n    return null\n  }\n\n  /**\n   * Lifecycle hook called by {@link Collection#removeAll}. If this method\n   * returns a value then {@link Collection#removeAll} will return that same\n   * value.\n   *\n   * @method Collection#afterRemoveAll\n   * @since 3.0.0\n   * @param {object} query The `query` argument passed to {@link Collection#removeAll}.\n   * @param {object} opts The `opts` argument passed to {@link Collection#removeAll}.\n   * @param {object} records The result that will be returned by {@link Collection#removeAll}.\n   */\n  afterRemoveAll (query, opts, records) {\n    return null\n  }\n\n  /**\n   * Lifecycle hook called by {@link Collection#add}. If this method returns a\n   * value then the `records` argument in {@link Collection#add} will be\n   * re-assigned to the returned value.\n   *\n   * @method Collection#beforeAdd\n   * @since 3.0.0\n   * @param {(Object|Object[]|Record|Record[])} records The `records` argument passed to {@link Collection#add}.\n   * @param {object} opts The `opts` argument passed to {@link Collection#add}.\n   */\n  beforeAdd (records, opts) {\n    return null\n  }\n\n  /**\n   * Lifecycle hook called by {@link Collection#remove}.\n   *\n   * @method Collection#beforeRemove\n   * @since 3.0.0\n   * @param {(string|number)} id The `id` argument passed to {@link Collection#remove}.\n   * @param {object} opts The `opts` argument passed to {@link Collection#remove}.\n   */\n  beforeRemove (id, opts) {\n    return null\n  }\n\n  /**\n   * Lifecycle hook called by {@link Collection#removeAll}.\n   *\n   * @method Collection#beforeRemoveAll\n   * @since 3.0.0\n   * @param {object} query The `query` argument passed to {@link Collection#removeAll}.\n   * @param {object} opts The `opts` argument passed to {@link Collection#removeAll}.\n   */\n  beforeRemoveAll (query, opts) {\n    return null\n  }\n\n  /**\n   * Find all records between two boundaries.\n   *\n   * Shortcut for `collection.query().between(18, 30, { index: 'age' }).run()`\n   *\n   * @example\n   * // Get all users ages 18 to 30\n   * const users = collection.between(18, 30, { index: 'age' });\n   *\n   * @example\n   * // Same as above\n   * const users = collection.between([18], [30], { index: 'age' });\n   *\n   * @method Collection#between\n   * @since 3.0.0\n   * @param {array} leftKeys Keys defining the left boundary.\n   * @param {array} rightKeys Keys defining the right boundary.\n   * @param {object} [opts] Configuration options.\n   * @param {string} [opts.index] Name of the secondary index to use in the\n   * query. If no index is specified, the main index is used.\n   * @param {boolean} [opts.leftInclusive=true] Whether to include records\n   * on the left boundary.\n   * @param {boolean} [opts.rightInclusive=false] Whether to include records\n   * on the left boundary.\n   * @param {boolean} [opts.limit] Limit the result to a certain number.\n   * @param {boolean} [opts.offset] The number of resulting records to skip.\n   * @returns {Object[]|Record[]} The result.\n   */\n  between (leftKeys, rightKeys, opts) {\n    return this.query()\n      .between(leftKeys, rightKeys, opts)\n      .run()\n  }\n\n  /**\n   * Create a new secondary index on the contents of the collection.\n   *\n   * @example\n   * // Index users by age\n   * collection.createIndex('age');\n   *\n   * @example\n   * // Index users by status and role\n   * collection.createIndex('statusAndRole', ['status', 'role']);\n   *\n   * @method Collection#createIndex\n   * @since 3.0.0\n   * @param {string} name The name of the new secondary index.\n   * @param {string[]} [fieldList] Array of field names to use as the key or\n   * compound key of the new secondary index. If no fieldList is provided, then\n   * the name will also be the field that is used to index the collection.\n   * @param opts\n   */\n  createIndex (name, fieldList?, opts: any = {}) {\n    if (utils.isString(name) && fieldList === undefined) {\n      fieldList = [name]\n    }\n    opts.hashCode = opts.hashCode || (obj => this.recordId(obj))\n    const index = (this.indexes[name] = new Index(fieldList, opts))\n    this.index.visitAll(index.insertRecord, index)\n  }\n\n  /**\n   * Find the record or records that match the provided query or pass the\n   * provided filter function.\n   *\n   * Shortcut for `collection.query().filter(queryOrFn[, thisArg]).run()`\n   *\n   * @example <caption>Collection#filter</caption>\n   * const JSData = require('js-data');\n   * const { Collection } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const collection = new Collection([\n   *   { id: 1, status: 'draft', created_at_timestamp: new Date().getTime() }\n   * ]);\n   *\n   * // Get the draft posts created less than three months ago\n   * let posts = collection.filter({\n   *   where: {\n   *     status: {\n   *       '==': 'draft'\n   *     },\n   *     created_at_timestamp: {\n   *       '>=': (new Date().getTime() - (1000 \\* 60 \\* 60 \\* 24 \\* 30 \\* 3)) // 3 months ago\n   *     }\n   *   }\n   * });\n   * console.log(posts);\n   *\n   * // Use a custom filter function\n   * posts = collection.filter((post) => post.id % 2 === 0);\n   *\n   * @method Collection#filter\n   * @param {(Object|Function)} [queryOrFn={}] Selection query or filter\n   * function.\n   * @param {object} [thisArg] Context to which to bind `queryOrFn` if\n   * `queryOrFn` is a function.\n   * @returns {Array} The result.\n   * @see query\n   * @since 3.0.0\n   */\n  filter (queryOrFn, thisArg?) {\n    return this.query()\n      .filter(queryOrFn, thisArg)\n      .run()\n  }\n\n  /**\n   * Iterate over all records.\n   *\n   * @example\n   * collection.forEach(function (record) {\n   *   // do something\n   * });\n   *\n   * @method Collection#forEach\n   * @since 3.0.0\n   * @param {Function} forEachFn Iteration function.\n   * @param {*} [thisArg] Context to which to bind `forEachFn`.\n   * @returns {Array} The result.\n   */\n  forEach (forEachFn, thisArg?) {\n    this.index.visitAll(forEachFn, thisArg)\n  }\n\n  /**\n   * Get the record with the given id.\n   *\n   * @method Collection#get\n   * @since 3.0.0\n   * @param {(string|number)} id The primary key of the record to get.\n   * @returns {(Object|Record)} The record with the given id.\n   */\n  get (id) {\n    const instances =\n      id === undefined\n        ? []\n        : this.query()\n          .get(id)\n          .run()\n    return instances.length ? instances[0] : undefined\n  }\n\n  /**\n   * Find the record or records that match the provided keyLists.\n   *\n   * Shortcut for `collection.query().getAll(keyList1, keyList2, ...).run()`\n   *\n   * @example\n   * // Get the posts where \"status\" is \"draft\" or \"inReview\"\n   * const posts = collection.getAll('draft', 'inReview', { index: 'status' });\n   *\n   * @example\n   * // Same as above\n   * const posts = collection.getAll(['draft'], ['inReview'], { index: 'status' });\n   *\n   * @method Collection#getAll\n   * @since 3.0.0\n   * @param {...Array} [keyList] Provide one or more keyLists, and all\n   * records matching each keyList will be retrieved. If no keyLists are\n   * provided, all records will be returned.\n   * @param {object} [opts] Configuration options.\n   * @param {string} [opts.index] Name of the secondary index to use in the\n   * query. If no index is specified, the main index is used.\n   * @returns {Array} The result.\n   */\n  getAll(keyList?: Array<string | number> | string | number, opts?)\n  getAll(keyList?: Array<string | number> | string | number, ...args)\n  getAll (...args) {\n    return this.query()\n      .getAll(...args)\n      .run()\n  }\n\n  /**\n   * Return the index with the given name. If no name is provided, return the\n   * main index. Throws an error if the specified index does not exist.\n   *\n   * @method Collection#getIndex\n   * @since 3.0.0\n   * @param {string} [name] The name of the index to retrieve.\n   */\n  getIndex (name): Index {\n    const index = name ? this.indexes[name] : this.index\n    if (!index) {\n      throw utils.err(`${DOMAIN}#getIndex`, name)(404, 'index')\n    }\n    return index\n  }\n\n  /**\n   * Limit the result.\n   *\n   * Shortcut for `collection.query().limit(maximumNumber).run()`\n   *\n   * @example\n   * const posts = collection.limit(10);\n   *\n   * @method Collection#limit\n   * @since 3.0.0\n   * @param {number} num The maximum number of records to keep in the result.\n   * @returns {Array} The result.\n   */\n  limit (num) {\n    return this.query()\n      .limit(num)\n      .run()\n  }\n\n  /**\n   * Apply a mapping function to all records.\n   *\n   * @example\n   * const names = collection.map((user) => user.name);\n   *\n   * @method Collection#map\n   * @since 3.0.0\n   * @param {Function} mapFn Mapping function.\n   * @param {*} [thisArg] Context to which to bind `mapFn`.\n   * @returns {Array} The result of the mapping.\n   */\n  map (cb, thisArg) {\n    const data = []\n    this.index.visitAll(value => {\n      data.push(cb.call(thisArg, value))\n    })\n    return data\n  }\n\n  /**\n   * Return the result of calling the specified function on each record in this\n   * collection's main index.\n   *\n   * @method Collection#mapCall\n   * @since 3.0.0\n   * @param {string} funcName Name of function to call\n   * @param {...*} [args] Remaining arguments to be passed to the function.\n   * @returns {Array} The result.\n   */\n  mapCall (funcName, ...args) {\n    const data = []\n    this.index.visitAll(record => {\n      data.push(record[funcName](...args))\n    })\n    return data\n  }\n\n  /**\n   * Return all \"unsaved\" (not uniquely identifiable) records in this colleciton.\n   *\n   * @method Collection#prune\n   * @param {object} [opts] Configuration options, passed to {@link Collection#removeAll}.\n   * @since 3.0.0\n   * @returns {Array} The removed records, if any.\n   */\n  prune (opts) {\n    return this.removeAll(this.unsaved(), opts)\n  }\n\n  /**\n   * Create a new query to be executed against the contents of the collection.\n   * The result will be all or a subset of the contents of the collection.\n   *\n   * @example\n   * // Grab page 2 of users between ages 18 and 30\n   * collection.query()\n   *   .between(18, 30, { index: 'age' }) // between ages 18 and 30\n   *   .skip(10) // second page\n   *   .limit(10) // page size\n   *   .run();\n   *\n   * @method Collection#query\n   * @since 3.0.0\n   * @returns {Query} New query object.\n   */\n  query (): Query {\n    const Ctor = this.queryClass\n    return new Ctor(this)\n  }\n\n  /**\n   * Return the primary key of the given, or if no record is provided, return the\n   * name of the field that holds the primary key of records in this Collection.\n   *\n   * @method Collection#recordId\n   * @since 3.0.0\n   * @param {(Object|Record)} [record] The record whose primary key is to be\n   * returned.\n   * @returns {(string|number)} Primary key or name of field that holds primary\n   * key.\n   */\n  recordId (record?) {\n    if (record) {\n      return utils.get(record, this.recordId())\n    }\n    return this.mapper ? this.mapper.idAttribute : this.idAttribute\n  }\n\n  /**\n   * Reduce the data in the collection to a single value and return the result.\n   *\n   * @example\n   * const totalVotes = collection.reduce((prev, record) => {\n   *   return prev + record.upVotes + record.downVotes;\n   * }, 0);\n   *\n   * @method Collection#reduce\n   * @since 3.0.0\n   * @param {Function} cb Reduction callback.\n   * @param {*} initialValue Initial value of the reduction.\n   * @returns {*} The result.\n   */\n  reduce (cb, initialValue) {\n    const data = this.getAll()\n    return data.reduce(cb, initialValue)\n  }\n\n  /**\n   * Remove the record with the given id from this Collection.\n   *\n   * @method Collection#remove\n   * @since 3.0.0\n   * @param {(string|number|object|Record)} idOrRecord The primary key of the\n   * record to be removed, or a reference to the record that is to be removed.\n   * @param {object} [opts] Configuration options.\n   * @returns {Object|Record} The removed record, if any.\n   */\n  remove (idOrRecord, opts: any = {}) {\n    this.beforeRemove(idOrRecord, opts)\n    let record = utils.isSorN(idOrRecord) ? this.get(idOrRecord) : idOrRecord\n\n    // The record is in the collection, remove it\n    if (utils.isObject(record)) {\n      record = this.index.removeRecord(record)\n      if (record) {\n        utils.forOwn(this.indexes, (index, name) => {\n          index.removeRecord(record)\n        })\n        if (utils.isFunction(record.off)) {\n          record.off('all', this._onRecordEvent, this)\n        }\n        if (!opts.silent) {\n          this.emit('remove', record)\n        }\n      }\n    }\n    return this.afterRemove(idOrRecord, opts, record) || record\n  }\n\n  /**\n   * Remove from this collection the given records or the records selected by\n   * the given \"query\".\n   *\n   * @method Collection#removeAll\n   * @since 3.0.0\n   * @param {Object|Object[]|Record[]} [queryOrRecords={}] Records to be removed or selection query. See {@link query}.\n   * @param {object} [queryOrRecords.where] See {@link query.where}.\n   * @param {number} [queryOrRecords.offset] See {@link query.offset}.\n   * @param {number} [queryOrRecords.limit] See {@link query.limit}.\n   * @param {string|Array[]} [queryOrRecords.orderBy] See {@link query.orderBy}.\n   * @param {object} [opts] Configuration options.\n   * @returns {(Object[]|Record[])} The removed records, if any.\n   */\n  removeAll (queryOrRecords, opts: any = {}) {\n    this.beforeRemoveAll(queryOrRecords, opts)\n    let records = utils.isArray(queryOrRecords)\n      ? queryOrRecords.slice()\n      : this.filter(queryOrRecords)\n\n    // Remove each selected record from the collection\n    const optsCopy = utils.plainCopy(opts)\n    optsCopy.silent = true\n    records = records\n      .map(record => this.remove(record, optsCopy))\n      .filter(record => record)\n    if (!opts.silent) {\n      this.emit('remove', records)\n    }\n    return this.afterRemoveAll(queryOrRecords, opts, records) || records\n  }\n\n  /**\n   * Skip a number of results.\n   *\n   * Shortcut for `collection.query().skip(numberToSkip).run()`\n   *\n   * @example\n   * const posts = collection.skip(10);\n   *\n   * @method Collection#skip\n   * @since 3.0.0\n   * @param {number} num The number of records to skip.\n   * @returns {Array} The result.\n   */\n  skip (num) {\n    return this.query()\n      .skip(num)\n      .run()\n  }\n\n  /**\n   * Return the plain JSON representation of all items in this collection.\n   * Assumes records in this collection have a toJSON method.\n   *\n   * @method Collection#toJSON\n   * @since 3.0.0\n   * @param {object} [opts] Configuration options.\n   * @param {string[]} [opts.with] Array of relation names or relation fields\n   * to include in the representation.\n   * @returns {Array} The records.\n   */\n  toJSON (opts?) {\n    return this.mapCall('toJSON', opts)\n  }\n\n  /**\n   * Return all \"unsaved\" (not uniquely identifiable) records in this colleciton.\n   *\n   * @method Collection#unsaved\n   * @since 3.0.0\n   * @returns {Array} The unsaved records, if any.\n   */\n  unsaved (opts?) {\n    return this.index.get()\n  }\n\n  /**\n   * Update a record's position in a single index of this collection. See\n   * {@link Collection#updateIndexes} to update a record's position in all\n   * indexes at once.\n   *\n   * @method Collection#updateIndex\n   * @since 3.0.0\n   * @param {object} record The record to update.\n   * @param {object} [opts] Configuration options.\n   * @param {string} [opts.index] The index in which to update the record's\n   * position. If you don't specify an index then the record will be updated\n   * in the main index.\n   */\n  updateIndex (record, opts: { index?: string } = {}) {\n    this.getIndex(opts.index).updateRecord(record)\n  }\n\n  /**\n   * Updates all indexes in this collection for the provided record. Has no\n   * effect if the record is not in the collection.\n   *\n   * @method Collection#updateIndexes\n   * @since 3.0.0\n   * @param {object} record TODO\n   */\n  updateIndexes (record) {\n    this.index.updateRecord(record)\n    utils.forOwn(this.indexes, index => index.updateRecord(record))\n  }\n}\n\n/**\n * Fired when a record changes. Only works for records that have tracked changes.\n * See {@link Collection~changeListener} on how to listen for this event.\n *\n * @event Collection#change\n * @see Collection~changeListener\n */\n\n/**\n * Callback signature for the {@link Collection#event:change} event.\n *\n * @example\n * function onChange (record, changes) {\n *   // do something\n * }\n * collection.on('change', onChange);\n *\n * @callback Collection~changeListener\n * @param {Record} The Record that changed.\n * @param {object} The changes.\n * @see Collection#event:change\n * @since 3.0.0\n */\n\n/**\n * Fired when one or more records are added to the Collection. See\n * {@link Collection~addListener} on how to listen for this event.\n *\n * @event Collection#add\n * @see Collection~addListener\n * @see Collection#event:add\n * @see Collection#add\n */\n\n/**\n * Callback signature for the {@link Collection#event:add} event.\n *\n * @example\n * function onAdd (recordOrRecords) {\n *   // do something\n * }\n * collection.on('add', onAdd);\n *\n * @callback Collection~addListener\n * @param {Record|Record[]} The Record or Records that were added.\n * @see Collection#event:add\n * @see Collection#add\n * @since 3.0.0\n */\n\n/**\n * Fired when one or more records are removed from the Collection. See\n * {@link Collection~removeListener} for how to listen for this event.\n *\n * @event Collection#remove\n * @see Collection~removeListener\n * @see Collection#event:remove\n * @see Collection#remove\n * @see Collection#removeAll\n */\n\n/**\n * Callback signature for the {@link Collection#event:remove} event.\n *\n * @example\n * function onRemove (recordsOrRecords) {\n *   // do something\n * }\n * collection.on('remove', onRemove);\n *\n * @callback Collection~removeListener\n * @param {Record|Record[]} Record or Records that were removed.\n * @see Collection#event:remove\n * @see Collection#remove\n * @see Collection#removeAll\n * @since 3.0.0\n */\n\n/**\n * Create a subclass of this Collection:\n * @example <caption>Collection.extend</caption>\n * const JSData = require('js-data');\n * const { Collection } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * // Extend the class using ES2015 class syntax.\n * class CustomCollectionClass extends Collection {\n *   foo () { return 'bar'; }\n *   static beep () { return 'boop'; }\n * }\n * const customCollection = new CustomCollectionClass();\n * console.log(customCollection.foo());\n * console.log(CustomCollectionClass.beep());\n *\n * // Extend the class using alternate method.\n * const OtherCollectionClass = Collection.extend({\n *   foo () { return 'bar'; }\n * }, {\n *   beep () { return 'boop'; }\n * });\n * const otherCollection = new OtherCollectionClass();\n * console.log(otherCollection.foo());\n * console.log(OtherCollectionClass.beep());\n *\n * // Extend the class, providing a custom constructor.\n * function AnotherCollectionClass () {\n *   Collection.call(this);\n *   this.created_at = new Date().getTime();\n * }\n * Collection.extend({\n *   constructor: AnotherCollectionClass,\n *   foo () { return 'bar'; }\n * }, {\n *   beep () { return 'boop'; }\n * });\n * const anotherCollection = new AnotherCollectionClass();\n * console.log(anotherCollection.created_at);\n * console.log(anotherCollection.foo());\n * console.log(AnotherCollectionClass.beep());\n *\n * @method Collection.extend\n * @param {object} [props={}] Properties to add to the prototype of the\n * subclass.\n * @param {object} [props.constructor] Provide a custom constructor function\n * to be used as the subclass itself.\n * @param {object} [classProps={}] Static properties to add to the subclass.\n * @returns {Constructor} Subclass of this Collection class.\n * @since 3.0.0\n */\n","export class TsDataError extends Error {\n  errors: any;\n}\n","import utils from './utils'\nimport Component from './Component'\nimport { TsDataError } from './TsDataError'\n\nconst DOMAIN = 'Schema'\n\n/**\n * A function map for each of the seven primitive JSON types defined by the core specification.\n * Each function will check a given value and return true or false if the value is an instance of that type.\n * ```\n *   types.integer(1) // returns true\n *   types.string({}) // returns false\n * ```\n * http://json-schema.org/latest/json-schema-core.html#anchor8\n * @name Schema.types\n * @type {object}\n */\nconst types = {\n  array: utils.isArray,\n  boolean: utils.isBoolean,\n  integer: utils.isInteger,\n  null: utils.isNull,\n  number: utils.isNumber,\n  object: utils.isObject,\n  string: utils.isString\n}\n\n/**\n * @ignore\n */\nfunction segmentToString (segment, prev) {\n  let str = ''\n  if (segment) {\n    if (utils.isNumber(segment)) {\n      str += `[${segment}]`\n    } else if (prev) {\n      str += `.${segment}`\n    } else {\n      str += `${segment}`\n    }\n  }\n  return str\n}\n\n/**\n * @ignore\n */\nfunction makePath (opts: any = {}) {\n  let path = ''\n  const segments = opts.path || []\n  segments.forEach(segment => {\n    path += segmentToString(segment, path)\n  })\n  path += segmentToString(opts.prop, path)\n  return path\n}\n\n/**\n * @ignore\n */\nfunction makeError (actual, expected, opts) {\n  return {\n    expected,\n    actual: '' + actual,\n    path: makePath(opts)\n  }\n}\n\n/**\n * @ignore\n */\nfunction addError (actual, expected, opts, errors) {\n  errors.push(makeError(actual, expected, opts))\n}\n\n/**\n * @ignore\n */\nfunction maxLengthCommon (keyword, value, schema, opts) {\n  const max = schema[keyword]\n  if (value.length > max) {\n    return makeError(value.length, `length no more than ${max}`, opts)\n  }\n}\n\n/**\n * @ignore\n */\nfunction minLengthCommon (keyword, value, schema, opts) {\n  const min = schema[keyword]\n  if (value.length < min) {\n    return makeError(value.length, `length no less than ${min}`, opts)\n  }\n}\n\n/**\n * A map of all object member validation functions for each keyword defined in the JSON Schema.\n * @name Schema.validationKeywords\n * @type {object}\n */\nconst validationKeywords = {\n  /**\n   * Validates the provided value against all schemas defined in the Schemas `allOf` keyword.\n   * The instance is valid against if and only if it is valid against all the schemas declared in the Schema's value.\n   *\n   * The value of this keyword MUST be an array. This array MUST have at least one element.\n   * Each element of this array MUST be a valid JSON Schema.\n   *\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor82\n   *\n   * @name Schema.validationKeywords.allOf\n   * @method\n   * @param {*} value Value to be validated.\n   * @param {object} schema Schema containing the `allOf` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  allOf (value, schema, opts) {\n    let allErrors = []\n    schema.allOf.forEach(_schema => {\n      allErrors = allErrors.concat(validate(value, _schema, opts) || [])\n    })\n    return allErrors.length ? allErrors : undefined\n  },\n\n  /**\n   * Validates the provided value against all schemas defined in the Schemas `anyOf` keyword.\n   * The instance is valid against this keyword if and only if it is valid against\n   * at least one of the schemas in this keyword's value.\n   *\n   * The value of this keyword MUST be an array. This array MUST have at least one element.\n   * Each element of this array MUST be an object, and each object MUST be a valid JSON Schema.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor85\n   *\n   * @name Schema.validationKeywords.anyOf\n   * @method\n   * @param {*} value Value to be validated.\n   * @param {object} schema Schema containing the `anyOf` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  anyOf (value, schema, opts) {\n    let validated = false\n    let allErrors = []\n    schema.anyOf.forEach(_schema => {\n      const errors = validate(value, _schema, opts)\n      if (errors) {\n        allErrors = allErrors.concat(errors)\n      } else {\n        validated = true\n      }\n    })\n    return validated ? undefined : allErrors\n  },\n\n  /**\n   * http://json-schema.org/latest/json-schema-validation.html#anchor70\n   *\n   * @name Schema.validationKeywords.dependencies\n   * @method\n   * @param {*} value TODO\n   * @param {object} schema TODO\n   * @param {object} opts TODO\n   */\n  dependencies (value, schema, opts) {\n    // TODO\n  },\n\n  /**\n   * Validates the provided value against an array of possible values defined by the Schema's `enum` keyword\n   * Validation succeeds if the value is deeply equal to one of the values in the array.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor76\n   *\n   * @name Schema.validationKeywords.enum\n   * @method\n   * @param {*} value Value to validate\n   * @param {object} schema Schema containing the `enum` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  enum (value, schema, opts) {\n    const possibleValues = schema.enum\n    if (utils.findIndex(possibleValues, item => utils.deepEqual(item, value)) === -1) {\n      return makeError(value, `one of (${possibleValues.join(', ')})`, opts)\n    }\n  },\n\n  /**\n   * Validates each of the provided array values against a schema or an array of schemas defined by the Schema's\n   * `items` keyword\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor37 for validation rules.\n   *\n   * @name Schema.validationKeywords.items\n   * @method\n   * @param {*} value Array to be validated.\n   * @param {object} schema Schema containing the items keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  items (value, schema, opts: any = {}) {\n    // TODO: additionalItems\n    let items = schema.items\n    let errors = []\n    const checkingTuple = utils.isArray(items)\n    const length = value.length\n    for (let prop = 0; prop < length; prop++) {\n      if (checkingTuple) {\n        // Validating a tuple, instead of just checking each item against the\n        // same schema\n        items = schema.items[prop]\n      }\n      opts.prop = prop\n      errors = errors.concat(validate(value[prop], items, opts) || [])\n    }\n    return errors.length ? errors : undefined\n  },\n\n  /**\n   * Validates the provided number against a maximum value defined by the Schema's `maximum` keyword\n   * Validation succeeds if the value is a number, and is less than, or equal to, the value of this keyword.\n   * http://json-schema.org/latest/json-schema-validation.html#anchor17\n   *\n   * @name Schema.validationKeywords.maximum\n   * @method\n   * @param {*} value Number to validate against the keyword.\n   * @param {object} schema Schema containing the `maximum` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  maximum (value, schema, opts) {\n    // Must be a number\n    const maximum = schema.maximum\n    // Must be a boolean\n    // Depends on maximum\n    // default: false\n    const exclusiveMaximum = schema.exclusiveMaximum\n    if (typeof value === typeof maximum && !(exclusiveMaximum ? maximum > value : maximum >= value)) {\n      return exclusiveMaximum\n        ? makeError(value, `no more than nor equal to ${maximum}`, opts)\n        : makeError(value, `no more than ${maximum}`, opts)\n    }\n  },\n\n  /**\n   * Validates the length of the provided array against a maximum value defined by the Schema's `maxItems` keyword.\n   * Validation succeeds if the length of the array is less than, or equal to the value of this keyword.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor42\n   *\n   * @name Schema.validationKeywords.maxItems\n   * @method\n   * @param {*} value Array to be validated.\n   * @param {object} schema Schema containing the `maxItems` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  maxItems (value, schema, opts) {\n    if (utils.isArray(value)) {\n      return maxLengthCommon('maxItems', value, schema, opts)\n    }\n  },\n\n  /**\n   * Validates the length of the provided string against a maximum value defined in the Schema's `maxLength` keyword.\n   * Validation succeeds if the length of the string is less than, or equal to the value of this keyword.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor26\n   *\n   * @name Schema.validationKeywords.maxLength\n   * @method\n   * @param {*} value String to be validated.\n   * @param {object} schema Schema containing the `maxLength` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  maxLength (value, schema, opts) {\n    return maxLengthCommon('maxLength', value, schema, opts)\n  },\n\n  /**\n   * Validates the count of the provided object's properties against a maximum value defined in the Schema's\n   * `maxProperties` keyword.\n   * Validation succeeds if the object's property count is less than, or equal to the value of this keyword.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor54\n   *\n   * @name Schema.validationKeywords.maxProperties\n   * @method\n   * @param {*} value Object to be validated.\n   * @param {object} schema Schema containing the `maxProperties` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  maxProperties (value, schema, opts) {\n    // validate only objects\n    if (!utils.isObject(value)) return\n    const maxProperties = schema.maxProperties\n    const length = Object.keys(value).length\n    if (length > maxProperties) {\n      return makeError(length, `no more than ${maxProperties} properties`, opts)\n    }\n  },\n\n  /**\n   * Validates the provided value against a minimum value defined by the Schema's `minimum` keyword\n   * Validation succeeds if the value is a number and is greater than, or equal to, the value of this keyword.\n   * http://json-schema.org/latest/json-schema-validation.html#anchor21\n   *\n   * @name Schema.validationKeywords.minimum\n   * @method\n   * @param {*} value Number to validate against the keyword.\n   * @param {object} schema Schema containing the `minimum` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  minimum (value, schema, opts) {\n    // Must be a number\n    const minimum = schema.minimum\n    // Must be a boolean\n    // Depends on minimum\n    // default: false\n    const exclusiveMinimum = schema.exclusiveMinimum\n    if (typeof value === typeof minimum && !(exclusiveMinimum ? value > minimum : value >= minimum)) {\n      return exclusiveMinimum\n        ? makeError(value, `no less than nor equal to ${minimum}`, opts)\n        : makeError(value, `no less than ${minimum}`, opts)\n    }\n  },\n\n  /**\n   * Validates the length of the provided array against a minimum value defined by the Schema's `minItems` keyword.\n   * Validation succeeds if the length of the array is greater than, or equal to the value of this keyword.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor45\n   *\n   * @name Schema.validationKeywords.minItems\n   * @method\n   * @param {*} value Array to be validated.\n   * @param {object} schema Schema containing the `minItems` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  minItems (value, schema, opts) {\n    if (utils.isArray(value)) {\n      return minLengthCommon('minItems', value, schema, opts)\n    }\n  },\n\n  /**\n   * Validates the length of the provided string against a minimum value defined in the Schema's `minLength` keyword.\n   * Validation succeeds if the length of the string is greater than, or equal to the value of this keyword.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor29\n   *\n   * @name Schema.validationKeywords.minLength\n   * @method\n   * @param {*} value String to be validated.\n   * @param {object} schema Schema containing the `minLength` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  minLength (value, schema, opts) {\n    return minLengthCommon('minLength', value, schema, opts)\n  },\n\n  /**\n   * Validates the count of the provided object's properties against a minimum value defined in the Schema's\n   * `minProperties` keyword.\n   * Validation succeeds if the object's property count is greater than, or equal to the value of this keyword.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor57\n   *\n   * @name Schema.validationKeywords.minProperties\n   * @method\n   * @param {*} value Object to be validated.\n   * @param {object} schema Schema containing the `minProperties` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  minProperties (value, schema, opts) {\n    // validate only objects\n    if (!utils.isObject(value)) return\n    const minProperties = schema.minProperties\n    const length = Object.keys(value).length\n    if (length < minProperties) {\n      return makeError(length, `no more than ${minProperties} properties`, opts)\n    }\n  },\n\n  /**\n   * Validates the provided number is a multiple of the number defined in the Schema's `multipleOf` keyword.\n   * Validation succeeds if the number can be divided equally into the value of this keyword.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor14\n   *\n   * @name Schema.validationKeywords.multipleOf\n   * @method\n   * @param {*} value Number to be validated.\n   * @param {object} schema Schema containing the `multipleOf` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  multipleOf (value, schema, opts) {\n    const multipleOf = schema.multipleOf\n    if (utils.isNumber(value)) {\n      if ((value / multipleOf) % 1 !== 0) {\n        return makeError(value, `multipleOf ${multipleOf}`, opts)\n      }\n    }\n  },\n\n  /**\n   * Validates the provided value is not valid with any of the schemas defined in the Schema's `not` keyword.\n   * An instance is valid against this keyword if and only if it is NOT valid against the schemas in this keyword's\n   * value.\n   *\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor91\n   * @name Schema.validationKeywords.not\n   * @method\n   * @param {*} value to be checked.\n   * @param {object} schema Schema containing the not keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  not (value, schema, opts) {\n    if (!validate(value, schema.not, opts)) {\n      // TODO: better messaging\n      return makeError('succeeded', 'should have failed', opts)\n    }\n  },\n\n  /**\n   * Validates the provided value is valid with one and only one of the schemas defined in the Schema's `oneOf` keyword.\n   * An instance is valid against this keyword if and only if it is valid against a single schemas in this keyword's\n   * value.\n   *\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor88\n   * @name Schema.validationKeywords.oneOf\n   * @method\n   * @param {*} value to be checked.\n   * @param {object} schema Schema containing the `oneOf` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  oneOf (value, schema, opts) {\n    let validated = false\n    let allErrors = []\n    schema.oneOf.forEach(_schema => {\n      const errors = validate(value, _schema, opts)\n      if (errors) {\n        allErrors = allErrors.concat(errors)\n      } else if (validated) {\n        allErrors = [makeError('valid against more than one', 'valid against only one', opts)]\n        validated = false\n        return false\n      } else {\n        validated = true\n      }\n    })\n    return validated ? undefined : allErrors\n  },\n\n  /**\n   * Validates the provided string matches a pattern defined in the Schema's `pattern` keyword.\n   * Validation succeeds if the string is a match of the regex value of this keyword.\n   *\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor33\n   * @name Schema.validationKeywords.pattern\n   * @method\n   * @param {*} value String to be validated.\n   * @param {object} schema Schema containing the `pattern` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  pattern (value, schema, opts) {\n    const pattern = schema.pattern\n    if (utils.isString(value) && !value.match(pattern)) {\n      return makeError(value, pattern, opts)\n    }\n  },\n\n  /**\n   * Validates the provided object's properties against a map of values defined in the Schema's `properties` keyword.\n   * Validation succeeds if the object's property are valid with each of the schema's in the provided map.\n   * Validation also depends on the additionalProperties and or patternProperties.\n   *\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor64 for more info.\n   *\n   * @name Schema.validationKeywords.properties\n   * @method\n   * @param {*} value Object to be validated.\n   * @param {object} schema Schema containing the `properties` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  properties (value, schema, opts: any = {}) {\n    if (utils.isArray(value)) {\n      return\n    }\n\n    // Can be a boolean or an object\n    // Technically the default is an \"empty schema\", but here \"true\" is\n    // functionally the same\n    const additionalProperties = schema.additionalProperties === undefined ? true : schema.additionalProperties\n    const validated = []\n    // \"p\": The property set from \"properties\".\n    // Default is an object\n    const properties = schema.properties || {}\n    // \"pp\": The property set from \"patternProperties\".\n    // Default is an object\n    const patternProperties = schema.patternProperties || {}\n    let errors = []\n\n    utils.forOwn(properties, (_schema, prop) => {\n      opts.prop = prop\n      errors = errors.concat(validate(value[prop], _schema, opts) || [])\n      validated.push(prop)\n    })\n\n    const toValidate = utils.omit(value, validated)\n    utils.forOwn(patternProperties, (_schema, pattern) => {\n      utils.forOwn(toValidate, (undef, prop) => {\n        if (prop.match(pattern)) {\n          opts.prop = prop\n          errors = errors.concat(validate(value[prop], _schema, opts) || [])\n          validated.push(prop)\n        }\n      })\n    })\n    const keys = Object.keys(utils.omit(value, validated))\n    // If \"s\" is not empty, validation fails\n    if (additionalProperties === false) {\n      if (keys.length) {\n        const origProp = opts.prop\n        opts.prop = ''\n        addError(`extra fields: ${keys.join(', ')}`, 'no extra fields', opts, errors)\n        opts.prop = origProp\n      }\n    } else if (utils.isObject(additionalProperties)) {\n      // Otherwise, validate according to provided schema\n      keys.forEach(prop => {\n        opts.prop = prop\n        errors = errors.concat(validate(value[prop], additionalProperties, opts) || [])\n      })\n    }\n    return errors.length ? errors : undefined\n  },\n\n  /**\n   * Validates the provided object's has all properties listed in the Schema's `properties` keyword array.\n   * Validation succeeds if the object contains all properties provided in the array value of this keyword.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor61\n   *\n   * @name Schema.validationKeywords.required\n   * @method\n   * @param {*} value Object to be validated.\n   * @param {object} schema Schema containing the `required` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  required (value, schema, opts: any = {}) {\n    const required = schema.required\n    const errors = []\n    if (!opts.existingOnly) {\n      required.forEach(prop => {\n        if (utils.get(value, prop) === undefined) {\n          const prevProp = opts.prop\n          opts.prop = prop\n          addError(undefined, 'a value', opts, errors)\n          opts.prop = prevProp\n        }\n      })\n    }\n    return errors.length ? errors : undefined\n  },\n\n  /**\n   * Validates the provided value's type is equal to the type, or array of types, defined in the Schema's `type`\n   * keyword.\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor79\n   *\n   * @name Schema.validationKeywords.type\n   * @method\n   * @param {*} value Value to be validated.\n   * @param {object} schema Schema containing the `type` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  type (value, schema, opts) {\n    let type = schema.type\n    let validType\n    // Can be one of several types\n    if (utils.isString(type)) {\n      type = [type]\n    }\n    // Try to match the value against an expected type\n    type.forEach(_type => {\n      // TODO: throw an error if type is not defined\n      if (types[_type](value, schema, opts)) {\n        // Matched a type\n        validType = _type\n        return false\n      }\n    })\n    // Value did not match any expected type\n    if (!validType) {\n      return makeError(\n        value !== undefined && value !== null ? typeof value : '' + value,\n        `one of (${type.join(', ')})`,\n        opts\n      )\n    }\n    // Run keyword validators for matched type\n    // http://json-schema.org/latest/json-schema-validation.html#anchor12\n    const validator = typeGroupValidators[validType]\n    if (validator) {\n      return validator(value, schema, opts)\n    }\n  },\n\n  /**\n   * Validates the provided array values are unique.\n   * Validation succeeds if the items in the array are unique, but only if the value of this keyword is true\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor49\n   *\n   * @name Schema.validationKeywords.uniqueItems\n   * @method\n   * @param {*} value Array to be validated.\n   * @param {object} schema Schema containing the `uniqueItems` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  uniqueItems (value, schema, opts) {\n    if (value?.length && schema.uniqueItems) {\n      const length = value.length\n      let item, i, j\n      // Check n - 1 items\n      for (i = length - 1; i > 0; i--) {\n        item = value[i]\n        // Only compare against unchecked items\n        for (j = i - 1; j >= 0; j--) {\n          // Found a duplicate\n          if (utils.deepEqual(item, value[j])) {\n            return makeError(item, 'no duplicates', opts)\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * @ignore\n */\nfunction runOps (ops, value, schema, opts) {\n  let errors = []\n  ops.forEach(op => {\n    if (schema[op] !== undefined) {\n      errors = errors.concat(validationKeywords[op](value, schema, opts) || [])\n    }\n  })\n  return errors.length ? errors : undefined\n}\n\n/**\n * Validation keywords validated for any type:\n *\n * - `enum`\n * - `type`\n * - `allOf`\n * - `anyOf`\n * - `oneOf`\n * - `not`\n *\n * @name Schema.ANY_OPS\n * @type {string[]}\n */\nconst ANY_OPS = ['enum', 'type', 'allOf', 'anyOf', 'oneOf', 'not']\n\n/**\n * Validation keywords validated for array types:\n *\n * - `items`\n * - `maxItems`\n * - `minItems`\n * - `uniqueItems`\n *\n * @name Schema.ARRAY_OPS\n * @type {string[]}\n */\nconst ARRAY_OPS = ['items', 'maxItems', 'minItems', 'uniqueItems']\n\n/**\n * Validation keywords validated for numeric (number and integer) types:\n *\n * - `multipleOf`\n * - `maximum`\n * - `minimum`\n *\n * @name Schema.NUMERIC_OPS\n * @type {string[]}\n */\nconst NUMERIC_OPS = ['multipleOf', 'maximum', 'minimum']\n\n/**\n * Validation keywords validated for object types:\n *\n * - `maxProperties`\n * - `minProperties`\n * - `required`\n * - `properties`\n * - `dependencies`\n *\n * @name Schema.OBJECT_OPS\n * @type {string[]}\n */\nconst OBJECT_OPS = ['maxProperties', 'minProperties', 'required', 'properties', 'dependencies']\n\n/**\n * Validation keywords validated for string types:\n *\n * - `maxLength`\n * - `minLength`\n * - `pattern`\n *\n * @name Schema.STRING_OPS\n * @type {string[]}\n */\nconst STRING_OPS = ['maxLength', 'minLength', 'pattern']\n\n/**\n * http://json-schema.org/latest/json-schema-validation.html#anchor75\n * @ignore\n */\nconst validateAny = (value, schema, opts) => runOps(ANY_OPS, value, schema, opts)\n\n/**\n * Validates the provided value against a given Schema according to the http://json-schema.org/ v4 specification.\n *\n * @name Schema.validate\n * @method\n * @param {*} value Value to be validated.\n * @param {object} schema Valid Schema according to the http://json-schema.org/ v4 specification.\n * @param {object} [opts] Configuration options.\n * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n */\nconst validate = (value, schema, opts: any = {}) => {\n  let errors = []\n  opts.ctx = opts.ctx || { value, schema }\n  let shouldPop\n  const prevProp = opts.prop\n  if (schema === undefined) {\n    return\n  }\n  if (!utils.isObject(schema)) {\n    throw utils.err(`${DOMAIN}#validate`)(500, `Invalid schema at path: \"${opts.path}\"`)\n  }\n  if (opts.path === undefined) {\n    opts.path = []\n  }\n  // Track our location as we recurse\n  if (opts.prop !== undefined) {\n    shouldPop = true\n    opts.path.push(opts.prop)\n    opts.prop = undefined\n  }\n  // Validate against parent schema\n  if (schema.extends) {\n    // opts.path = path\n    // opts.prop = prop\n    if (utils.isFunction(schema.extends.validate)) {\n      errors = errors.concat(schema.extends.validate(value, opts) || [])\n    } else {\n      errors = errors.concat(validate(value, schema.extends, opts) || [])\n    }\n  }\n  if (value === undefined) {\n    // Check if property is required\n    if (schema.required === true && !opts.existingOnly) {\n      addError(value, 'a value', opts, errors)\n    }\n    if (shouldPop) {\n      opts.path.pop()\n      opts.prop = prevProp\n    }\n    return errors.length ? errors : undefined\n  }\n\n  errors = errors.concat(validateAny(value, schema, opts) || [])\n  if (shouldPop) {\n    opts.path.pop()\n    opts.prop = prevProp\n  }\n  return errors.length ? errors : undefined\n}\n\n// These strings are cached for optimal performance of the change detection\n// boolean - Whether a Record is changing in the current execution frame\nconst changingPath = 'changing'\n// string[] - Properties that have changed in the current execution frame\nconst changedPath = 'changed'\n// Object[] - History of change records\nconst changeHistoryPath = 'history'\n// boolean - Whether a Record is currently being instantiated\nconst creatingPath = 'creating'\n// number - The setTimeout change event id of a Record, if any\nconst eventIdPath = 'eventId'\n// boolean - Whether to skip validation for a Record's currently changing property\nconst noValidatePath = 'noValidate'\n// boolean - Whether to preserve Change History for a Record\nconst keepChangeHistoryPath = 'keepChangeHistory'\n// boolean - Whether to skip change notification for a Record's currently\n// changing property\nconst silentPath = 'silent'\nconst validationFailureMsg = 'validation failed'\n\n/**\n * A map of validation functions grouped by type.\n *\n * @name Schema.typeGroupValidators\n * @type {object}\n */\nconst typeGroupValidators = {\n  /**\n   * Validates the provided value against the schema using all of the validation keywords specific to instances of an\n   * array.\n   * The validation keywords for the type `array` are:\n   * ```\n   * ['items', 'maxItems', 'minItems', 'uniqueItems']\n   * ```\n   * see http://json-schema.org/latest/json-schema-validation.html#anchor25\n   *\n   * @name Schema.typeGroupValidators.array\n   * @method\n   * @param {*} value Array to be validated.\n   * @param {object} schema Schema containing at least one array keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  array: (value, schema, opts?) => runOps(ARRAY_OPS, value, schema, opts),\n\n  /**\n   * Validates the provided value against the schema using all of the validation keywords specific to instances of an\n   * integer.\n   * The validation keywords for the type `integer` are:\n   * ```\n   * ['multipleOf', 'maximum', 'minimum']\n   * ```\n   * @name Schema.typeGroupValidators.integer\n   * @method\n   * @param {*} value Number to be validated.\n   * @param {object} schema Schema containing at least one `integer` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  integer: (value, schema, opts) =>\n    // Additional validations for numerics are the same\n    typeGroupValidators.numeric(value, schema, opts),\n\n  /**\n   * Validates the provided value against the schema using all of the validation keywords specific to instances of an\n   * number.\n   * The validation keywords for the type `number` are:\n   * ```\n   * ['multipleOf', 'maximum', 'minimum']\n   * ```\n   * @name Schema.typeGroupValidators.number\n   * @method\n   * @param {*} value Number to be validated.\n   * @param {object} schema Schema containing at least one `number` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  number: (value, schema, opts) =>\n    // Additional validations for numerics are the same\n    typeGroupValidators.numeric(value, schema, opts),\n\n  /**\n   * Validates the provided value against the schema using all of the validation keywords specific to instances of a\n   * number or integer.\n   * The validation keywords for the type `numeric` are:\n   * ```\n   * ['multipleOf', 'maximum', 'minimum']\n   * ```\n   * See http://json-schema.org/latest/json-schema-validation.html#anchor13.\n   *\n   * @name Schema.typeGroupValidators.numeric\n   * @method\n   * @param {*} value Number to be validated.\n   * @param {object} schema Schema containing at least one `numeric` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  numeric: (value, schema, opts) => runOps(NUMERIC_OPS, value, schema, opts),\n\n  /**\n   * Validates the provided value against the schema using all of the validation keywords specific to instances of an\n   * object.\n   * The validation keywords for the type `object` are:\n   * ```\n   * ['maxProperties', 'minProperties', 'required', 'properties', 'dependencies']\n   * ```\n   * See http://json-schema.org/latest/json-schema-validation.html#anchor53.\n   *\n   * @name Schema.typeGroupValidators.object\n   * @method\n   * @param {*} value Object to be validated.\n   * @param {object} schema Schema containing at least one `object` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  object: (value, schema, opts) => runOps(OBJECT_OPS, value, schema, opts),\n\n  /**\n   * Validates the provided value against the schema using all of the validation keywords specific to instances of an\n   * string.\n   * The validation keywords for the type `string` are:\n   * ```\n   * ['maxLength', 'minLength', 'pattern']\n   * ```\n   * See http://json-schema.org/latest/json-schema-validation.html#anchor25.\n   *\n   * @name Schema.typeGroupValidators.string\n   * @method\n   * @param {*} value String to be validated.\n   * @param {object} schema Schema containing at least one `string` keyword.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  string: (value, schema, opts?) => runOps(STRING_OPS, value, schema, opts)\n}\n\nexport interface PropertyDefinition {\n  type: string | string[]\n  track?: boolean\n  description?: string\n  indexed?: boolean\n  items?: PropertyDefinition\n  minItems?: number\n  uniqueItems?: boolean\n  extends?: Schema\n  get?: Function\n  properties?: { [name: string]: PropertyDefinition }\n  required?: string[] | boolean\n  maximum?: number\n  exclusiveMaximum?: boolean\n  minimum?: number\n  exclusiveMinimum?: boolean\n  additionalProperties?: boolean\n}\n\nexport interface SchemaDefinition {\n  type?: string\n  description?: string\n  $schema?: string\n  title?: string\n  properties?: { [name: string]: PropertyDefinition | any }\n  extends?: SchemaDefinition | Schema\n  items?: SchemaDefinition | Schema\n  track?: boolean\n  additionalProperties?\n  required?: string[]\n}\n\n/**\n * js-data's Schema class.\n *\n * @example <caption>Schema#constructor</caption>\n * const JSData = require('js-data');\n * const { Schema } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * const PostSchema = new Schema({\n *   type: 'object',\n *   properties: {\n *     title: { type: 'string' }\n *   }\n * });\n * PostSchema.validate({ title: 1234 });\n *\n * @example\n * const JSData = require('js-data');\n * const { Schema } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * class CustomSchemaClass extends Schema {\n *   foo () { return 'bar'; }\n *   static beep () { return 'boop'; }\n * }\n * const customSchema = new CustomSchemaClass();\n * console.log(customSchema.foo());\n * console.log(CustomSchemaClass.beep());\n *\n * @class Schema\n * @extends Component\n * @param {object} definition Schema definition according to json-schema.org\n */\nexport default class Schema extends Component {\n  type: string;\n  properties: any;\n  private readonly extends: Schema;\n  private readonly items: Schema;\n  private readonly track: any;\n  private readonly additionalProperties: any;\n\n  constructor (definition: SchemaDefinition = {}) {\n    super()\n    // TODO: schema validation\n    utils.fillIn(this, definition)\n\n    if (this.type === 'object') {\n      this.properties = this.properties || {}\n      utils.forOwn(this.properties, (_definition, prop) => {\n        if (!(_definition instanceof Schema)) {\n          this.properties[prop] = new Schema(_definition)\n        }\n      })\n    } else if (this.type === 'array' && this.items && !(this.items instanceof Schema)) {\n      this.items = new Schema(this.items)\n    }\n    if (this.extends && !(this.extends instanceof Schema)) {\n      this.extends = new Schema(this.extends)\n    }\n    ['allOf', 'anyOf', 'oneOf'].forEach(validationKeyword => {\n      if (this[validationKeyword]) {\n        this[validationKeyword].forEach((_definition, i) => {\n          if (!(_definition instanceof Schema)) {\n            this[validationKeyword][i] = new Schema(_definition)\n          }\n        })\n      }\n    })\n  }\n\n  /**\n   * This adds ES5 getters/setters to the target based on the \"properties\" in\n   * this Schema, which makes possible change tracking and validation on\n   * property assignment.\n   *\n   * @name Schema#apply\n   * @method\n   * @param {object} target The prototype to which to apply this schema.\n   * @param opts\n   */\n  apply (target, opts: any = {}) {\n    opts.getter = opts.getter || '_get'\n    opts.setter = opts.setter || '_set'\n    opts.unsetter = opts.unsetter || '_unset'\n    opts.track = opts.track || this.track\n    const properties = this.properties || {}\n    utils.forOwn(properties, (schema, prop) => {\n      Object.defineProperty(target, prop, this.makeDescriptor(prop, schema, opts))\n    })\n  }\n\n  /**\n   * Apply default values to the target object for missing values.\n   *\n   * @name Schema#applyDefaults\n   * @method\n   * @param {object} target The target to which to apply values for missing values.\n   */\n  applyDefaults (target) {\n    if (!target) {\n      return\n    }\n    const properties = this.properties || {}\n    const hasSet = utils.isFunction(target.set) || utils.isFunction(target._set)\n    utils.forOwn(properties, (schema, prop) => {\n      if (schema.hasOwnProperty('default') && utils.get(target, prop) === undefined) {\n        if (hasSet) {\n          target.set(prop, utils.plainCopy(schema.default), { silent: true })\n        } else {\n          utils.set(target, prop, utils.plainCopy(schema.default))\n        }\n      }\n      if (schema.type === 'object' && schema.properties) {\n        if (hasSet) {\n          const orig = target._get('noValidate')\n          target._set('noValidate', true)\n          utils.set(target, prop, utils.get(target, prop) || {}, { silent: true })\n          target._set('noValidate', orig)\n        } else {\n          utils.set(target, prop, utils.get(target, prop) || {})\n        }\n        schema.applyDefaults(utils.get(target, prop))\n      }\n    })\n  }\n\n  /**\n   * Assemble a property descriptor for tracking and validating changes to\n   * a property according to the given schema. This method is called when\n   * {@link Mapper#applySchema} is set to `true`.\n   *\n   * @name Schema#makeDescriptor\n   * @method\n   * @param {string} prop The property name.\n   * @param {(Schema|object)} schema The schema for the property.\n   * @param {object} [opts] Optional configuration.\n   * @param {function} [opts.getter] Custom getter function.\n   * @param {function} [opts.setter] Custom setter function.\n   * @param {function} [opts.track] Whether to track changes.\n   * @returns {object} A property descriptor for the given schema.\n   */\n  makeDescriptor (prop, schema, opts) {\n    const descriptor: any = {\n      // Better to allow configurability, but at the user's own risk\n      configurable: true,\n      // These properties are enumerable by default, but regardless of their\n      // enumerability, they won't be \"own\" properties of individual records\n      enumerable: schema.enumerable === undefined ? true : !!schema.enumerable,\n      get () {\n        return this._get(keyPath)\n      },\n      set (value) {\n        // These are accessed a lot\n        const _get = this[getter]\n        const _set = this[setter]\n        const _unset = this[unsetter]\n        // Optionally check that the new value passes validation\n        if (!_get(noValidatePath)) {\n          const errors = schema.validate(value, { path: [prop] })\n          if (errors) {\n            // Immediately throw an error, preventing the record from getting into\n            // an invalid state\n            const error = new TsDataError(validationFailureMsg)\n            error.errors = errors\n            throw error\n          }\n        }\n        // TODO: Make it so tracking can be turned on for all properties instead of\n        // only per-property\n        if (track && !_get(creatingPath)) {\n          // previous is versioned on database commit\n          // props are versioned on set()\n          const previous = _get(previousPath)\n          const current = _get(keyPath)\n          let changing = _get(changingPath)\n          let changed = _get(changedPath)\n\n          if (!changing) {\n            // Track properties that are changing in the current event loop\n            changed = []\n          }\n\n          // Add changing properties to this array once at most\n          const index = changed.indexOf(prop)\n          if (current !== value && index === -1) {\n            changed.push(prop)\n          }\n          if (previous === value) {\n            if (index >= 0) {\n              changed.splice(index, 1)\n            }\n          }\n          // No changes in current event loop\n          if (!changed.length) {\n            changing = false\n            _unset(changingPath)\n            _unset(changedPath)\n            // Cancel pending change event\n            if (_get(eventIdPath)) {\n              clearTimeout(_get(eventIdPath))\n              _unset(eventIdPath)\n            }\n          }\n          // Changes detected in current event loop\n          if (!changing && changed.length) {\n            _set(changedPath, changed)\n            _set(changingPath, true)\n            // Saving the timeout id allows us to batch all changes in the same\n            // event loop into a single \"change\"\n            // TODO: Optimize\n            _set(\n              eventIdPath,\n              setTimeout(() => {\n                // Previous event loop where changes were gathered has ended, so\n                // notify any listeners of those changes and prepare for any new\n                // changes\n                _unset(changedPath)\n                _unset(eventIdPath)\n                _unset(changingPath)\n                // TODO: Optimize\n                if (!_get(silentPath)) {\n                  let i\n                  for (i = 0; i < changed.length; i++) {\n                    this.emit('change:' + changed[i], this, utils.get(this, changed[i]))\n                  }\n\n                  const changes = utils.diffObjects({ [prop]: value }, { [prop]: current })\n\n                  if (_get(keepChangeHistoryPath)) {\n                    const changeRecord = utils.plainCopy(changes)\n                    changeRecord.timestamp = new Date().getTime()\n                    let changeHistory = _get(changeHistoryPath)\n                    if (!changeHistory) _set(changeHistoryPath, (changeHistory = []))\n                    changeHistory.push(changeRecord)\n                  }\n                  this.emit('change', this, changes)\n                }\n                _unset(silentPath)\n              }, 0)\n            )\n          }\n        }\n        _set(keyPath, value)\n        return value\n      }\n    }\n    // Cache a few strings for optimal performance\n    const keyPath = `props.${prop}`\n    const previousPath = `previous.${prop}`\n    const getter = opts.getter\n    const setter = opts.setter\n    const unsetter = opts.unsetter\n    const track = utils.isBoolean(opts.track) ? opts.track : schema.track\n\n    if (utils.isFunction(schema.get)) {\n      const originalGet = descriptor.get\n      descriptor.get = function () {\n        return schema.get.call(this, originalGet)\n      }\n    }\n\n    if (utils.isFunction(schema.set)) {\n      const originalSet = descriptor.set\n      descriptor.set = function (value) {\n        return schema.set.call(this, value, originalSet)\n      }\n    }\n\n    return descriptor\n  }\n\n  /**\n   * Create a copy of the given value that contains only the properties defined\n   * in this schema.\n   *\n   * @name Schema#pick\n   * @method\n   * @param {*} value The value to copy.\n   * @returns {*} The copy.\n   */\n  pick (value, opts?) {\n    if (value === undefined) {\n      return\n    }\n    if (this.type === 'object') {\n      const copy = {}\n      const properties = this.properties\n      if (properties) {\n        utils.forOwn(properties, (_definition, prop) => {\n          copy[prop] = _definition.pick(value[prop])\n        })\n      }\n      if (this.extends) {\n        utils.fillIn(copy, this.extends.pick(value))\n      }\n      // Conditionally copy properties not defined in \"properties\"\n      if (this.additionalProperties) {\n        for (const key in value) {\n          if (!properties[key]) {\n            copy[key] = utils.plainCopy(value[key])\n          }\n        }\n      }\n      return copy\n    } else if (this.type === 'array') {\n      return value.map(item => {\n        const _copy = this.items ? this.items.pick(item) : {}\n        if (this.extends) {\n          utils.fillIn(_copy, this.extends.pick(item))\n        }\n        return _copy\n      })\n    }\n    return utils.plainCopy(value)\n  }\n\n  /**\n   * Validate the provided value against this schema.\n   *\n   * @name Schema#validate\n   * @method\n   * @param {*} value Value to validate.\n   * @param {object} [opts] Configuration options.\n   * @returns {(array|undefined)} Array of errors or `undefined` if valid.\n   */\n  validate (value, opts?) {\n    return validate(value, this, opts)\n  }\n\n  static ANY_OPS = ANY_OPS;\n  static ARRAY_OPS = ARRAY_OPS;\n  static NUMERIC_OPS = NUMERIC_OPS;\n  static OBJECT_OPS = OBJECT_OPS;\n  static STRING_OPS = STRING_OPS;\n  static typeGroupValidators = typeGroupValidators;\n  static types = types;\n  static validate = validate;\n  static validationKeywords: any = validationKeywords;\n}\n","import utils from '../utils'\nimport { Relation } from '../Relation'\n\nexport class BelongsToRelation extends Relation {\n  getForeignKey (record) {\n    return utils.get(record, this.foreignKey)\n  }\n\n  _setForeignKey (record, relatedRecord) {\n    utils.set(record, this.foreignKey, utils.get(relatedRecord, this.getRelation().idAttribute))\n  }\n\n  findExistingLinksFor (record) {\n    // console.log('\\tBelongsTo#findExistingLinksFor', record)\n    if (!record) {\n      return\n    }\n    const relatedId = utils.get(record, this.foreignKey)\n    if (relatedId !== undefined && relatedId !== null) {\n      return this.relatedCollection.get(relatedId)\n    }\n  }\n\n  isRequiresParentId () {\n    return true\n  }\n\n  createParentRecord (props, opts) {\n    const relationData = this.getLocalField(props)\n\n    return this.createLinked(relationData, opts).then(record => {\n      this.setForeignKey(props, record)\n    })\n  }\n\n  createChildRecord () {\n    throw new Error('\"BelongsTo\" relation does not support child creation as it cannot have children.')\n  }\n\n  static TYPE_NAME = 'belongsTo';\n}\n","import utils from '../utils'\nimport { Relation } from '../Relation'\n\nexport class HasManyRelation extends Relation {\n  foreignKeys: any;\n  localKeys: any;\n  validateOptions (related, opts) {\n    super.validateOptions(related, opts)\n\n    const { localKeys, foreignKeys, foreignKey } = opts\n\n    if (!foreignKey && !localKeys && !foreignKeys) {\n      throw utils.err('new Relation', 'opts.<foreignKey|localKeys|foreignKeys>')(400, 'string', foreignKey)\n    }\n  }\n\n  canFindLinkFor (record) {\n    const hasForeignKeys = this.foreignKey || this.foreignKeys\n    return !!(hasForeignKeys || (this.localKeys && utils.get(record, this.localKeys)))\n  }\n\n  linkRecord (record, relatedRecords) {\n    const relatedCollection = this.relatedCollection\n    const canAutoAddLinks = this.canAutoAddLinks\n    const foreignKey = this.foreignKey\n    const unsaved = this.relatedCollection.unsaved()\n\n    return relatedRecords.map(relatedRecord => {\n      const relatedId = relatedCollection.recordId(relatedRecord)\n\n      if (\n        (relatedId === undefined && unsaved.indexOf(relatedRecord) === -1) ||\n        relatedRecord !== relatedCollection.get(relatedId)\n      ) {\n        if (foreignKey) {\n          // TODO: slow, could be optimized? But user loses hook\n          this.setForeignKey(record, relatedRecord)\n        }\n        if (canAutoAddLinks) {\n          relatedRecord = relatedCollection.add(relatedRecord)\n        }\n      }\n\n      return relatedRecord\n    })\n  }\n\n  findExistingLinksFor (record) {\n    const id = utils.get(record, this.mapper.idAttribute)\n    const ids = this.localKeys ? utils.get(record, this.localKeys) : null\n    let records\n\n    if (id !== undefined && this.foreignKey) {\n      records = this.findExistingLinksByForeignKey(id)\n    } else if (this.localKeys && ids) {\n      records = this.findExistingLinksByLocalKeys(ids)\n    } else if (id !== undefined && this.foreignKeys) {\n      records = this.findExistingLinksByForeignKeys(id)\n    }\n\n    if (records?.length) {\n      return records\n    }\n  }\n\n  // e.g. user hasMany group via \"foreignKeys\", so find all users of a group\n  findExistingLinksByLocalKeys (ids) {\n    return this.relatedCollection.filter({\n      where: {\n        [this.relatedCollection.mapper.idAttribute]: {\n          in: ids\n        }\n      }\n    })\n  }\n\n  // e.g. group hasMany user via \"localKeys\", so find all groups that own a user\n  findExistingLinksByForeignKeys (id) {\n    return this.relatedCollection.filter({\n      where: {\n        [this.foreignKeys]: {\n          contains: id\n        }\n      }\n    })\n  }\n\n  isRequiresParentId () {\n    return !!this.localKeys && this.localKeys.length > 0\n  }\n\n  isRequiresChildId () {\n    return !!this.foreignKey\n  }\n\n  createParentRecord (props, opts) {\n    const relationData = this.getLocalField(props)\n    const foreignIdField = this.getRelation().idAttribute\n\n    return this.createLinked(relationData, opts).then(records => {\n      utils.set(\n        props,\n        this.localKeys,\n        records.map(record => utils.get(record, foreignIdField))\n      )\n    })\n  }\n\n  createLinked (props, opts) {\n    return this.getRelation().createMany(props, opts)\n  }\n\n  static TYPE_NAME = 'hasMany';\n}\n","import utils from '../utils'\nimport { Relation } from '../Relation'\n\nexport class HasOneRelation extends Relation {\n  findExistingLinksFor (relatedMapper, record) {\n    const recordId = utils.get(record, relatedMapper.idAttribute)\n    const records = this.findExistingLinksByForeignKey(recordId)\n\n    if (records?.length) {\n      return records[0]\n    }\n  }\n\n  isRequiresChildId () {\n    return true\n  }\n\n  static TYPE_NAME = 'hasOne';\n}\n","import { Relation } from './Relation'\nimport { BelongsToRelation } from './Relation/BelongsTo'\nimport { HasManyRelation } from './Relation/HasMany'\nimport { HasOneRelation } from './Relation/HasOne';\n\n[BelongsToRelation, HasManyRelation, HasOneRelation].forEach(RelationType => {\n  Relation[RelationType.TYPE_NAME] = (related, options) => new RelationType(related, options)\n})\n\nexport { belongsToType, hasManyType, hasOneType, Relation } from './Relation'\n","import { Relation } from './relations'\n\nexport { belongsToType, hasManyType, hasOneType } from './relations'\n\n/**\n * BelongsTo relation decorator. You probably won't use this directly.\n *\n * @method\n * @param {Mapper} related The relation the target belongs to.\n * @param {object} opts Configuration options.\n * @param {string} opts.foreignKey The field that holds the primary key of the\n * related record.\n * @param {string} opts.localField The field that holds a reference to the\n * related record object.\n * @returns {Function} Invocation function, which accepts the target as the only\n * parameter.\n */\nexport function belongsTo (related, opts) {\n  return mapper => {\n    Relation.belongsTo(related, opts).assignTo(mapper)\n  }\n}\n\n/**\n * HasMany relation decorator. You probably won't use this directly.\n *\n * @method\n * @param {Mapper} related The relation of which the target has many.\n * @param {object} opts Configuration options.\n * @param {string} [opts.foreignKey] The field that holds the primary key of the\n * related record.\n * @param {string} opts.localField The field that holds a reference to the\n * related record object.\n * @returns {Function} Invocation function, which accepts the target as the only\n * parameter.\n */\nexport function hasMany (related, opts) {\n  return mapper => {\n    Relation.hasMany(related, opts).assignTo(mapper)\n  }\n}\n\n/**\n * HasOne relation decorator. You probably won't use this directly.\n *\n * @method\n * @param {Mapper} related The relation of which the target has one.\n * @param {object} opts Configuration options.\n * @param {string} [opts.foreignKey] The field that holds the primary key of the\n * related record.\n * @param {string} opts.localField The field that holds a reference to the\n * related record object.\n * @returns {Function} Invocation function, which accepts the target as the only\n * parameter.\n */\nexport function hasOne (related, opts) {\n  return mapper => {\n    Relation.hasOne(related, opts).assignTo(mapper)\n  }\n}\n","import utils from './utils'\nimport Component from './Component'\nimport Record from './Record'\nimport Schema, { PropertyDefinition, SchemaDefinition } from './Schema'\nimport { Relation } from './Relation'\nimport { belongsTo, belongsToType, hasMany, hasManyType, hasOne, hasOneType } from './decorators'\nimport { TsDataError } from './TsDataError'\nimport { QueryDefinition } from './Query'\n\nconst DOMAIN = 'Mapper'\nconst applyDefaultsHooks = ['beforeCreate', 'beforeCreateMany']\nconst validatingHooks = ['beforeCreate', 'beforeCreateMany', 'beforeUpdate', 'beforeUpdateAll', 'beforeUpdateMany']\n\nfunction makeNotify (num) {\n  return function (...args) {\n    const opts = args[args.length - num]\n    const op = opts.op\n    this.dbg(op, ...args)\n\n    if (applyDefaultsHooks.indexOf(op) !== -1 && opts.applyDefaults !== false) {\n      const schema = this.getSchema()\n      if (schema?.applyDefaults) {\n        let toProcess = args[0]\n        if (!utils.isArray(toProcess)) {\n          toProcess = [toProcess]\n        }\n        toProcess.forEach(record => {\n          schema.applyDefaults(record)\n        })\n      }\n    }\n\n    // Automatic validation\n    if (validatingHooks.indexOf(op) !== -1 && !opts.noValidate) {\n      // Save current value of option\n      const originalExistingOnly = opts.existingOnly\n\n      // For updates, ignore required fields if they aren't present\n      if (op.indexOf('beforeUpdate') === 0 && opts.existingOnly === undefined) {\n        opts.existingOnly = true\n      }\n      const errors = this.validate(args[op === 'beforeUpdate' ? 1 : 0], utils.pick(opts, ['existingOnly']))\n\n      // Restore option\n      opts.existingOnly = originalExistingOnly\n\n      // Abort lifecycle due to validation errors\n      if (errors) {\n        const err = new TsDataError('validation failed')\n        err.errors = errors\n        return utils.reject(err)\n      }\n    }\n\n    // Emit lifecycle event\n    if (opts.notify || (opts.notify === undefined && this.notify)) {\n      setTimeout(() => {\n        this.emit(op, ...args)\n      })\n    }\n  }\n}\n\n// These are the default implementations of all of the lifecycle hooks\nconst notify = makeNotify(1)\nconst notify2 = makeNotify(2)\n\n// This object provides meta information used by Mapper#crud to actually\n// execute each lifecycle method\nconst LIFECYCLE_METHODS = {\n  count: {\n    defaults: [{}, {}],\n    skip: true,\n    types: []\n  },\n  destroy: {\n    defaults: [{}, {}],\n    skip: true,\n    types: []\n  },\n  destroyAll: {\n    defaults: [{}, {}],\n    skip: true,\n    types: []\n  },\n  find: {\n    defaults: [undefined, {}],\n    types: []\n  },\n  findAll: {\n    defaults: [{}, {}],\n    types: []\n  },\n  sum: {\n    defaults: [undefined, {}, {}],\n    skip: true,\n    types: []\n  },\n  update: {\n    adapterArgs (mapper, id, props, opts) {\n      return [id, mapper.toJSON(props, opts), opts]\n    },\n    beforeAssign: 1,\n    defaults: [undefined, {}, {}],\n    types: []\n  },\n  updateAll: {\n    adapterArgs (mapper, props, query, opts) {\n      return [mapper.toJSON(props, opts), query, opts]\n    },\n    beforeAssign: 0,\n    defaults: [{}, {}, {}],\n    types: []\n  },\n  updateMany: {\n    adapterArgs (mapper, records, opts) {\n      return [records.map(record => mapper.toJSON(record, opts)), opts]\n    },\n    beforeAssign: 0,\n    defaults: [[], {}],\n    types: []\n  }\n}\n\nexport interface MapperOpts {\n  name?: string\n\n  [customAttr: string]: any\n\n  endpoint?: string\n\n  onConflict?: 'skip'\n\n  relations?: any\n\n  type?: string\n\n  schema?: SchemaDefinition | Schema\n\n  recordClass?: typeof Record | boolean\n\n  wrap?: boolean\n\n  methods?: { [name: string]: Function }\n\n  scopes?: any\n\n  mapperClass?: typeof Mapper\n\n  /**\n   * Hash of registered adapters. Don't modify directly. Use\n   * {@link Mapper#registerAdapter} instead.\n   *\n   * @default {}\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/connecting-to-a-data-source\",\"Connecting to a data source\"]\n   */\n  _adapters?: {}\n\n  /**\n   * Whether {@link Mapper#beforeCreate} and {@link Mapper#beforeCreateMany}\n   * should automatically receive default values according to the Mapper's schema.\n   *\n   * @default true\n   * @since 3.0.0\n   */\n  applyDefaults?: boolean\n\n  /**\n   * Whether to augment {@link Mapper#recordClass} with ES5 getters and setters\n   * according to the properties defined in {@link Mapper#schema}. This makes\n   * possible validation and change tracking on individual properties\n   * when using the dot (e.g. `user.name = \"Bob\"`) operator to modify a\n   * property, and is `true` by default.\n   *\n   * @default true\n   * @since 3.0.0\n   */\n  applySchema?: boolean\n\n  /**\n   * The name of the registered adapter that this Mapper should used by default.\n   *\n   * @default \"http\"\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/connecting-to-a-data-source\",\"Connecting to a data source\"]\n   */\n  defaultAdapter?: string\n\n  /**\n   * The field used as the unique identifier on records handled by this Mapper.\n   *\n   * @default id\n   * @since 3.0.0\n   */\n  idAttribute?: string\n\n  properties?: { [name: string]: PropertyDefinition }\n\n  /**\n   * Whether records created from this mapper keep changeHistory on property changes.\n   *\n   * @default true\n   * @since 3.0.0\n   */\n  keepChangeHistory?: boolean\n\n  /**\n   * Whether this Mapper should emit operational events.\n   *\n   * @default true\n   * @since 3.0.0\n   */\n  notify?: boolean\n\n  /**\n   * Whether to skip validation when the Record instances are created.\n   *\n   * @default false\n   * @since 3.0.0\n   */\n  noValidate?: boolean\n\n  /**\n   * Whether {@link Mapper#create}, {@link Mapper#createMany},\n   * {@link Mapper#update}, {@link Mapper#updateAll}, {@link Mapper#updateMany},\n   * {@link Mapper#find}, {@link Mapper#findAll}, {@link Mapper#destroy},\n   * {@link Mapper#destroyAll}, {@link Mapper#count}, and {@link Mapper#sum}\n   * should return a raw result object that contains both the instance data\n   * returned by the adapter _and_ metadata about the operation.\n   *\n   * The default is to NOT return the result object, and instead return just the\n   * instance data.\n   *\n   * @default false\n   * @since 3.0.0\n   */\n  raw?: boolean\n\n  /**\n   * Whether records created from this mapper automatically validate their properties\n   * when their properties are modified.\n   *\n   * @default true\n   * @since 3.0.0\n   */\n  validateOnSet?: boolean\n}\n\nconst MAPPER_DEFAULTS: MapperOpts = {\n  _adapters: {},\n  applyDefaults: true,\n  applySchema: true,\n  defaultAdapter: 'http',\n  idAttribute: 'id',\n  keepChangeHistory: true,\n  notify: true,\n  noValidate: false,\n  raw: false,\n  validateOnSet: true\n}\n\n/**\n * The core of JSData's [ORM/ODM][orm] implementation. Given a minimum amount of\n * meta information about a resource, a Mapper can perform generic CRUD\n * operations against that resource. Apart from its configuration, a Mapper is\n * stateless. The particulars of various persistence layers have been abstracted\n * into adapters, which a Mapper uses to perform its operations.\n *\n * The term \"Mapper\" comes from the [Data Mapper Pattern][pattern] described in\n * Martin Fowler's [Patterns of Enterprise Application Architecture][book]. A\n * Data Mapper moves data between [in-memory object instances][record] and a\n * relational or document-based database. JSData's Mapper can work with any\n * persistence layer you can write an adapter for.\n *\n * _(\"Model\" is a heavily overloaded term and is avoided in this documentation\n * to prevent confusion.)_\n *\n * [orm]: https://en.wikipedia.org/wiki/Object-relational_mapping\n *\n * @example\n * [pattern]: https://en.wikipedia.org/wiki/Data_mapper_pattern\n * [book]: http://martinfowler.com/books/eaa.html\n * [record]: Record.html\n * // Import and instantiate\n * import { Mapper } from 'js-data';\n * const UserMapper = new Mapper({ name: 'user' });\n *\n * @example\n * // Define a Mapper using the Container component\n * import { Container } from 'js-data';\n * const store = new Container();\n * store.defineMapper('user');\n *\n * @class Mapper\n * @extends Component\n * @param {object} opts Configuration options.\n * @param {boolean} [opts.applySchema=true] See {@link Mapper#applySchema}.\n * @param {boolean} [opts.debug=false] See {@link Component#debug}.\n * @param {string} [opts.defaultAdapter=http] See {@link Mapper#defaultAdapter}.\n * @param {string} [opts.idAttribute=id] See {@link Mapper#idAttribute}.\n * @param {object} [opts.methods] See {@link Mapper#methods}.\n * @param {string} opts.name See {@link Mapper#name}.\n * @param {boolean} [opts.notify] See {@link Mapper#notify}.\n * @param {boolean} [opts.raw=false] See {@link Mapper#raw}.\n * @param {Function|boolean} [opts.recordClass] See {@link Mapper#recordClass}.\n * @param {Object|Schema} [opts.schema] See {@link Mapper#schema}.\n * @returns {Mapper} A new {@link Mapper} instance.\n * @see http://www.js-data.io/v3.0/docs/components-of-jsdata#mapper\n * @since 3.0.0\n * @tutorial [\"http://www.js-data.io/v3.0/docs/components-of-jsdata#mapper\",\"Components of JSData: Mapper\"]\n * @tutorial [\"http://www.js-data.io/v3.0/docs/modeling-your-data\",\"Modeling your data\"]\n */\nexport default class Mapper extends Component {\n  idAttribute: string;\n\n  name: string;\n  /**\n   * This Mapper's {@link Schema}.\n   *\n   * @example <caption>Mapper#schema</caption>\n   * const JSData = require('js-data');\n   * const { Mapper } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const UserMapper = new Mapper({\n   *   name: 'user',\n   *   schema: {\n   *     properties: {\n   *       id: { type: 'number' },\n   *       first: { type: 'string', track: true },\n   *       last: { type: 'string', track: true },\n   *       role: { type: 'string', track: true, required: true },\n   *       age: { type: 'integer', track: true },\n   *       is_active: { type: 'number' }\n   *     }\n   *   }\n   * });\n   * const user = UserMapper.createRecord({\n   *   id: 1,\n   *   name: 'John',\n   *   role: 'admin'\n   * });\n   * user.on('change', function (user, changes) {\n   *   console.log(changes);\n   * });\n   * user.on('change:role', function (user, value) {\n   *   console.log('change:role - ' + value);\n   * });\n   * user.role = 'owner';\n   *\n   * @name Mapper#schema\n   * @see Schema\n   * @since 3.0.0\n   * @type {Schema}\n   */\n  schema: Schema;\n  /**\n   * Set to `false` to force the Mapper to work with POJO objects only.\n   *\n   * @example\n   * // Use POJOs only.\n   * import { Mapper, Record } from 'js-data';\n   * const UserMapper = new Mapper({ recordClass: false });\n   * UserMapper.recordClass // false;\n   * const user = UserMapper.createRecord();\n   * user instanceof Record; // false\n   *\n   * @example\n   * // Set to a custom class to have records wrapped in your custom class.\n   * import { Mapper, Record } from 'js-data';\n   *  // Custom class\n   * class User {\n   *   constructor (props = {}) {\n   *     for (var key in props) {\n   *       if (props.hasOwnProperty(key)) {\n   *         this[key] = props[key];\n   *       }\n   *     }\n   *   }\n   * }\n   * const UserMapper = new Mapper({ recordClass: User });\n   * UserMapper.recordClass; // function User() {}\n   * const user = UserMapper.createRecord();\n   * user instanceof Record; // false\n   * user instanceof User; // true\n   *\n   *\n   * @example\n   * // Extend the {@link Record} class.\n   * import { Mapper, Record } from 'js-data';\n   *  // Custom class\n   * class User extends Record {\n   *   constructor () {\n   *     super(props);\n   *   }\n   * }\n   * const UserMapper = new Mapper({ recordClass: User });\n   * UserMapper.recordClass; // function User() {}\n   * const user = UserMapper.createRecord();\n   * user instanceof Record; // true\n   * user instanceof User; // true\n   *\n   * @name Mapper#recordClass\n   * @default {@link Record}\n   * @see Record\n   * @since 3.0.0\n   */\n  recordClass: typeof Record | Function | false | any;\n  methods: any;\n  applySchema: any;\n  relationList: any;\n  defaultAdapter: any;\n  relationFields: any;\n  _adapters: any;\n  relations: any;\n  /**\n   * The meta information describing this Mapper's available lifecycle\n   * methods. __Do not modify.__\n   *\n   * @name Mapper#lifecycleMethods\n   * @since 3.0.0\n   * @type {Object}\n   */\n  lifecycleMethods = LIFECYCLE_METHODS;\n\n  /**\n   * The {@link Container} that holds this Mapper. __Do not modify.__\n   *\n   * @name Mapper#lifecycleMethods\n   * @since 3.0.0\n   * @type {Object}\n   */\n  datastore: any;\n  validateOnSet: any;\n  keepChangeHistory: any;\n\n  constructor (opts: MapperOpts = {}) {\n    super()\n\n    // Apply user-provided configuration\n    utils.fillIn(this, opts)\n    // Fill in any missing options with the defaults\n    utils.fillIn(this, utils.copy(MAPPER_DEFAULTS))\n\n    /**\n     * The name for this Mapper. This is the minimum amount of meta information\n     * required for a Mapper to be able to execute CRUD operations for a\n     * Resource.\n     *\n     * @name Mapper#name\n     * @since 3.0.0\n     * @type {string}\n     */\n    if (!this.name) {\n      throw utils.err(`new ${DOMAIN}`, 'opts.name')(400, 'string', this.name)\n    }\n\n    // Setup schema, with an empty default schema if necessary\n    if (this.schema) {\n      this.schema.type = this.schema.type || 'object'\n      if (!(this.schema instanceof Schema)) {\n        this.schema = new Schema(this.schema || { type: 'object' })\n      }\n    }\n\n    // Create a subclass of Record that's tied to this Mapper\n    if (this.recordClass === undefined) {\n      // tslint:disable-next-line:max-classes-per-file\n      this.recordClass = class TiedRecord extends Record {}\n    }\n\n    if (this.recordClass) {\n      this.recordClass.mapper = this\n\n      /**\n       * Functions that should be added to the prototype of {@link Mapper#recordClass}.\n       *\n       * @name Mapper#methods\n       * @since 3.0.0\n       * @type {Object}\n       */\n      if (utils.isObject(this.methods)) {\n        utils.addHiddenPropsToTarget(this.recordClass.prototype, this.methods)\n      }\n\n      // We can only apply the schema to the prototype of this.recordClass if the\n      // class extends Record\n      if (\n        Record.prototype.isPrototypeOf(Object.create(this.recordClass.prototype)) &&\n        this.schema &&\n        this.schema.apply &&\n        this.applySchema\n      ) {\n        this.schema.apply(this.recordClass.prototype)\n      }\n    }\n  }\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#count}. If this method\n   * returns a promise then {@link Mapper#count} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterCount\n   * @param {object} query The `query` argument passed to {@link Mapper#count}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#count}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterCount = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#create}. If this method\n   * returns a promise then {@link Mapper#create} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterCreate\n   * @param {object} props The `props` argument passed to {@link Mapper#create}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#create}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterCreate = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#createMany}. If this method\n   * returns a promise then {@link Mapper#createMany} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterCreateMany\n   * @param {array} records The `records` argument passed to {@link Mapper#createMany}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#createMany}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterCreateMany = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#destroy}. If this method\n   * returns a promise then {@link Mapper#destroy} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterDestroy\n   * @param {(string|number)} id The `id` argument passed to {@link Mapper#destroy}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#destroy}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterDestroy = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#destroyAll}. If this method\n   * returns a promise then {@link Mapper#destroyAll} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterDestroyAll\n   * @param {*} data The `data` returned by the adapter.\n   * @param {query} query The `query` argument passed to {@link Mapper#destroyAll}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#destroyAll}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterDestroyAll = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#find}. If this method\n   * returns a promise then {@link Mapper#find} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterFind\n   * @param {(string|number)} id The `id` argument passed to {@link Mapper#find}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#find}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterFind = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#findAll}. If this method\n   * returns a promise then {@link Mapper#findAll} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterFindAll\n   * @param {object} query The `query` argument passed to {@link Mapper#findAll}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#findAll}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterFindAll = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#sum}. If this method\n   * returns a promise then {@link Mapper#sum} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterSum\n   * @param {object} query The `query` argument passed to {@link Mapper#sum}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#sum}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterSum = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#update}. If this method\n   * returns a promise then {@link Mapper#update} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterUpdate\n   * @param {(string|number)} id The `id` argument passed to {@link Mapper#update}.\n   * @param {props} props The `props` argument passed to {@link Mapper#update}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#update}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterUpdate = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#updateAll}. If this method\n   * returns a promise then {@link Mapper#updateAll} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterUpdateAll\n   * @param {object} props The `props` argument passed to {@link Mapper#updateAll}.\n   * @param {object} query The `query` argument passed to {@link Mapper#updateAll}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#updateAll}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterUpdateAll = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#updateMany}. If this method\n   * returns a promise then {@link Mapper#updateMany} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#afterUpdateMany\n   * @param {array} records The `records` argument passed to {@link Mapper#updateMany}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#updateMany}.\n   * @param {*} result The result, if any.\n   * @since 3.0.0\n   */\n  afterUpdateMany = notify2;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#create}. If this method\n   * returns a promise then {@link Mapper#create} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeCreate\n   * @param {object} props The `props` argument passed to {@link Mapper#create}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#create}.\n   * @since 3.0.0\n   */\n  beforeCreate = notify;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#createMany}. If this method\n   * returns a promise then {@link Mapper#createMany} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeCreateMany\n   * @param {array} records The `records` argument passed to {@link Mapper#createMany}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#createMany}.\n   * @since 3.0.0\n   */\n  beforeCreateMany = notify;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#count}. If this method\n   * returns a promise then {@link Mapper#count} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeCount\n   * @param {object} query The `query` argument passed to {@link Mapper#count}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#count}.\n   * @since 3.0.0\n   */\n  beforeCount = notify;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#destroy}. If this method\n   * returns a promise then {@link Mapper#destroy} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeDestroy\n   * @param {(string|number)} id The `id` argument passed to {@link Mapper#destroy}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#destroy}.\n   * @since 3.0.0\n   */\n  beforeDestroy = notify;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#destroyAll}. If this method\n   * returns a promise then {@link Mapper#destroyAll} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeDestroyAll\n   * @param {query} query The `query` argument passed to {@link Mapper#destroyAll}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#destroyAll}.\n   * @since 3.0.0\n   */\n  beforeDestroyAll = notify;\n\n  /**\n   * Mappers lifecycle hook called by {@link Mapper#find}. If this method\n   * returns a promise then {@link Mapper#find} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeFind\n   * @param {(string|number)} id The `id` argument passed to {@link Mapper#find}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#find}.\n   * @since 3.0.0\n   */\n  beforeFind = notify;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#findAll}. If this method\n   * returns a promise then {@link Mapper#findAll} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeFindAll\n   * @param {object} query The `query` argument passed to {@link Mapper#findAll}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#findAll}.\n   * @since 3.0.0\n   */\n  beforeFindAll = notify;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#sum}. If this method\n   * returns a promise then {@link Mapper#sum} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeSum\n   * @param {string} field The `field` argument passed to {@link Mapper#sum}.\n   * @param {object} query The `query` argument passed to {@link Mapper#sum}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#sum}.\n   * @since 3.0.0\n   */\n  beforeSum = notify;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#update}. If this method\n   * returns a promise then {@link Mapper#update} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeUpdate\n   * @param {(string|number)} id The `id` argument passed to {@link Mapper#update}.\n   * @param {props} props The `props` argument passed to {@link Mapper#update}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#update}.\n   * @since 3.0.0\n   */\n  beforeUpdate = notify;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#updateAll}. If this method\n   * returns a promise then {@link Mapper#updateAll} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeUpdateAll\n   * @param {object} props The `props` argument passed to {@link Mapper#updateAll}.\n   * @param {object} query The `query` argument passed to {@link Mapper#updateAll}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#updateAll}.\n   * @since 3.0.0\n   */\n  beforeUpdateAll = notify;\n\n  /**\n   * Mapper lifecycle hook called by {@link Mapper#updateMany}. If this method\n   * returns a promise then {@link Mapper#updateMany} will wait for the promise\n   * to resolve before continuing.\n   *\n   * @method Mapper#beforeUpdateMany\n   * @param {array} records The `records` argument passed to {@link Mapper#updateMany}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#updateMany}.\n   * @since 3.0.0\n   */\n  beforeUpdateMany = notify;\n\n  /**\n   * This method is called at the end of most lifecycle methods. It does the\n   * following:\n   *\n   * 1. If `opts.raw` is `true`, add this Mapper's configuration to the `opts`\n   * argument as metadata for the operation.\n   * 2. Wrap the result data appropriately using {@link Mapper#wrap}, which\n   * calls {@link Mapper#createRecord}.\n   *\n   * @method Mapper#_end\n   * @private\n   * @since 3.0.0\n   */\n  _end (result, opts, skip = false) {\n    if (opts.raw) {\n      utils._(result, opts)\n    }\n    if (skip) {\n      return result\n    }\n    let _data = opts.raw ? result.data : result\n    if (_data && utils.isFunction(this.wrap)) {\n      _data = this.wrap(_data, opts)\n      if (opts.raw) {\n        result.data = _data\n      } else {\n        result = _data\n      }\n    }\n    return result\n  }\n\n  /**\n   * Define a belongsTo relationship. Only useful if you're managing your\n   * Mappers manually and not using a Container or DataStore component.\n   *\n   * @example\n   * PostMapper.belongsTo(UserMapper, {\n   *   // post.user_id points to user.id\n   *   foreignKey: 'user_id'\n   *   // user records will be attached to post records at \"post.user\"\n   *   localField: 'user'\n   * });\n   *\n   * CommentMapper.belongsTo(UserMapper, {\n   *   // comment.user_id points to user.id\n   *   foreignKey: 'user_id'\n   *   // user records will be attached to comment records at \"comment.user\"\n   *   localField: 'user'\n   * });\n   * CommentMapper.belongsTo(PostMapper, {\n   *   // comment.post_id points to post.id\n   *   foreignKey: 'post_id'\n   *   // post records will be attached to comment records at \"comment.post\"\n   *   localField: 'post'\n   * });\n   *\n   * @method Mapper#belongsTo\n   * @see http://www.js-data.io/v3.0/docs/relations\n   * @since 3.0.0\n   */\n  belongsTo (relatedMapper, opts) {\n    return belongsTo(relatedMapper, opts)(this)\n  }\n\n  /**\n   * Select records according to the `query` argument and return the count.\n   *\n   * {@link Mapper#beforeCount} will be called before calling the adapter.\n   * {@link Mapper#afterCount} will be called after calling the adapter.\n   *\n   * @example\n   * // Get the number of published blog posts\n   * PostMapper.count({ status: 'published' }).then((numPublished) => {\n   *   console.log(numPublished); // e.g. 45\n   * });\n   *\n   * @method Mapper#count\n   * @param {object} [query={}] Selection query. See {@link query}.\n   * @param {object} [query.where] See {@link query.where}.\n   * @param {number} [query.offset] See {@link query.offset}.\n   * @param {number} [query.limit] See {@link query.limit}.\n   * @param {string|Array[]} [query.orderBy] See {@link query.orderBy}.\n   * @param {object} [opts] Configuration options. Refer to the `count` method\n   * of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * @returns {Promise} Resolves with the count of the selected records.\n   * @since 3.0.0\n   */\n  count (query, opts?) {\n    return this.crud('count', query, opts)\n  }\n\n  /**\n   * Fired during {@link Mapper#create}. See\n   * {@link Mapper~beforeCreateListener} for how to listen for this event.\n   *\n   * @event Mapper#beforeCreate\n   * @see Mapper~beforeCreateListener\n   * @see Mapper#create\n   */\n  /**\n   * Callback signature for the {@link Mapper#event:beforeCreate} event.\n   *\n   * @example\n   * function onBeforeCreate (props, opts) {\n   *   // do something\n   * }\n   * store.on('beforeCreate', onBeforeCreate);\n   *\n   * @callback Mapper~beforeCreateListener\n   * @param {object} props The `props` argument passed to {@link Mapper#beforeCreate}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#beforeCreate}.\n   * @see Mapper#event:beforeCreate\n   * @see Mapper#create\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Mapper#create}. See\n   * {@link Mapper~afterCreateListener} for how to listen for this event.\n   *\n   * @event Mapper#afterCreate\n   * @see Mapper~afterCreateListener\n   * @see Mapper#create\n   */\n\n  /**\n   * Callback signature for the {@link Mapper#event:afterCreate} event.\n   *\n   * @example\n   * function onAfterCreate (props, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterCreate', onAfterCreate);\n   *\n   * @callback Mapper~afterCreateListener\n   * @param {object} props The `props` argument passed to {@link Mapper#afterCreate}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#afterCreate}.\n   * @param {object} result The `result` argument passed to {@link Mapper#afterCreate}.\n   * @see Mapper#event:afterCreate\n   * @see Mapper#create\n   * @since 3.0.0\n   */\n  /**\n   * Create and save a new the record using the provided `props`.\n   *\n   * {@link Mapper#beforeCreate} will be called before calling the adapter.\n   * {@link Mapper#afterCreate} will be called after calling the adapter.\n   *\n   * @example\n   * // Create and save a new blog post\n   * PostMapper.create({\n   *   title: 'Modeling your data',\n   *   status: 'draft'\n   * }).then((post) => {\n   *   console.log(post); // { id: 1234, status: 'draft', ... }\n   * });\n   *\n   * @fires Mapper#beforeCreate\n   * @fires Mapper#afterCreate\n   * @method Mapper#create\n   * @param {object} props The properties for the new record.\n   * @param {object} [opts] Configuration options. Refer to the `create` method\n   * of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.noValidate={@link Mapper#noValidate}] See {@link Mapper#noValidate}.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * @param {string[]} [opts.with=[]] Relations to create in a cascading\n   * create if `props` contains nested relations. NOT performed in a\n   * transaction. Each nested create will result in another {@link Mapper#create}\n   * or {@link Mapper#createMany} call.\n   * @param {string[]} [opts.pass=[]] Relations to send to the adapter as part\n   * of the payload. Normally relations are not sent.\n   * @returns {Promise} Resolves with the created record.\n   * @since 3.0.0\n   */\n  create (props: any = {}, opts: any = {}) {\n    const originalRecord = props\n    let parentRelationMap = {}\n    let adapterResponse: any = {}\n\n    // Fill in \"opts\" with the Mapper's configuration\n    utils._(opts, this)\n    opts.adapter = this.getAdapterName(opts)\n\n    opts.op = 'beforeCreate'\n    return this._runHook(opts.op, props, opts)\n      .then(props => {\n        opts.with = opts.with || []\n        return this._createParentRecordIfRequired(props, opts)\n      })\n      .then(relationMap => {\n        parentRelationMap = relationMap\n      })\n      .then(() => {\n        opts.op = 'create'\n        return this._invokeAdapterMethod(opts.op, props, opts)\n      })\n      .then(result => {\n        adapterResponse = result\n      })\n      .then(() => {\n        const createdProps = opts.raw ? adapterResponse.data : adapterResponse\n\n        return this._createOrAssignChildRecordIfRequired(createdProps, {\n          opts,\n          parentRelationMap,\n          originalProps: props\n        })\n      })\n      .then(createdProps => {\n        return this._commitChanges(originalRecord, createdProps)\n      })\n      .then(record => {\n        if (opts.raw) {\n          adapterResponse.data = record\n        } else {\n          adapterResponse = record\n        }\n        const result = this._end(adapterResponse, opts)\n        opts.op = 'afterCreate'\n        return this._runHook(opts.op, props, opts, result)\n      })\n  }\n\n  _commitChanges (recordOrRecords, newValues) {\n    if (utils.isArray(recordOrRecords)) {\n      return recordOrRecords.map((record, i) => this._commitChanges(record, newValues[i]))\n    }\n\n    utils.set(recordOrRecords, newValues, { silent: true })\n\n    if (utils.isFunction(recordOrRecords.commit)) {\n      recordOrRecords.commit()\n    }\n\n    return recordOrRecords\n  }\n\n  /**\n   * Use {@link Mapper#createRecord} instead.\n   * @deprecated\n   * @method Mapper#createInstance\n   * @param {Object|Array} props See {@link Mapper#createRecord}.\n   * @param {object} [opts] See {@link Mapper#createRecord}.\n   * @returns {Object|Array} See {@link Mapper#createRecord}.\n   * @see Mapper#createRecord\n   * @since 3.0.0\n   */\n  createInstance (props, opts?) {\n    return this.createRecord(props, opts)\n  }\n\n  /**\n   * Creates parent record for relation types like BelongsTo or HasMany with localKeys\n   * in order to satisfy foreignKey dependency (so called child records).\n   * @param {object} props See {@link Mapper#create}.\n   * @param {object} opts See {@link Mapper#create}.\n   * @returns {Object} cached parent records map\n   * @see Mapper#create\n   * @since 3.0.0\n   */\n  _createParentRecordIfRequired (props, opts) {\n    const tasks = []\n    const relations = []\n\n    utils.forEachRelation(this, opts, (def, optsCopy) => {\n      if (!def.isRequiresParentId() || !def.getLocalField(props)) {\n        return\n      }\n\n      optsCopy.raw = false\n      relations.push(def)\n      tasks.push(def.createParentRecord(props, optsCopy))\n    })\n\n    return Promise.all(tasks).then(records => {\n      return relations.reduce((map, relation, index) => {\n        relation.setLocalField(map, records[index])\n        return map\n      }, {})\n    })\n  }\n\n  /**\n   * Creates child record for relation types like HasOne or HasMany with foreignKey\n   * in order to satisfy foreignKey dependency (so called parent records).\n   * @param {object} props See {@link Mapper#create}.\n   * @param {object} context contains collected information.\n   * @param {object} context.opts See {@link Mapper#create}.\n   * @param {object} context.parentRelationMap contains parent records map\n   * @param {object} context.originalProps contains data passed into {@link Mapper#create} method\n   * @return {Promise} updated props\n   * @see Mapper#create\n   * @since 3.0.0\n   */\n  _createOrAssignChildRecordIfRequired (props, context) {\n    const tasks = []\n\n    utils.forEachRelation(this, context.opts, (def, optsCopy) => {\n      const relationData = def.getLocalField(context.originalProps)\n\n      if (!relationData) {\n        return\n      }\n\n      optsCopy.raw = false\n      // Create hasMany and hasOne after the main create because we needed\n      // a generated id to attach to these items\n      if (def.isRequiresChildId()) {\n        tasks.push(def.createChildRecord(props, relationData, optsCopy))\n      } else if (def.isRequiresParentId()) {\n        const parent = def.getLocalField(context.parentRelationMap)\n\n        if (parent) {\n          def.setLocalField(props, parent)\n        }\n      }\n    })\n\n    return Promise.all(tasks).then(() => props)\n  }\n\n  /**\n   * Fired during {@link Mapper#createMany}. See\n   * {@link Mapper~beforeCreateManyListener} for how to listen for this event.\n   *\n   * @event Mapper#beforeCreateMany\n   * @see Mapper~beforeCreateManyListener\n   * @see Mapper#createMany\n   */\n  /**\n   * Callback signature for the {@link Mapper#event:beforeCreateMany} event.\n   *\n   * @example\n   * function onBeforeCreateMany (records, opts) {\n   *   // do something\n   * }\n   * store.on('beforeCreateMany', onBeforeCreateMany);\n   *\n   * @callback Mapper~beforeCreateManyListener\n   * @param {object} records The `records` argument received by {@link Mapper#beforeCreateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeCreateMany}.\n   * @see Mapper#event:beforeCreateMany\n   * @see Mapper#createMany\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Mapper#createMany}. See\n   * {@link Mapper~afterCreateManyListener} for how to listen for this event.\n   *\n   * @event Mapper#afterCreateMany\n   * @see Mapper~afterCreateManyListener\n   * @see Mapper#createMany\n   */\n\n  /**\n   * Callback signature for the {@link Mapper#event:afterCreateMany} event.\n   *\n   * @example\n   * function onAfterCreateMany (records, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterCreateMany', onAfterCreateMany);\n   *\n   * @callback Mapper~afterCreateManyListener\n   * @param {object} records The `records` argument received by {@link Mapper#afterCreateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterCreateMany}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterCreateMany}.\n   * @see Mapper#event:afterCreateMany\n   * @see Mapper#createMany\n   * @since 3.0.0\n   */\n  /**\n   * Given an array of records, batch create them via an adapter.\n   *\n   * {@link Mapper#beforeCreateMany} will be called before calling the adapter.\n   * {@link Mapper#afterCreateMany} will be called after calling the adapter.\n   *\n   * @example\n   * // Create and save several new blog posts\n   * PostMapper.createMany([{\n   *   title: 'Modeling your data',\n   *   status: 'draft'\n   * }, {\n   *   title: 'Reading data',\n   *   status: 'draft'\n   * }]).then((posts) => {\n   *   console.log(posts[0]); // { id: 1234, status: 'draft', ... }\n   *   console.log(posts[1]); // { id: 1235, status: 'draft', ... }\n   * });\n   *\n   * @fires Mapper#beforeCreate\n   * @fires Mapper#afterCreate\n   * @method Mapper#createMany\n   * @param {Record[]} records Array of records to be created in one batch.\n   * @param {object} [opts] Configuration options. Refer to the `createMany`\n   * method of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.noValidate={@link Mapper#noValidate}] See {@link Mapper#noValidate}.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * @param {string[]} [opts.with=[]] Relations to create in a cascading\n   * create if `records` contains nested relations. NOT performed in a\n   * transaction. Each nested create will result in another {@link Mapper#createMany}\n   * call.\n   * @param {string[]} [opts.pass=[]] Relations to send to the adapter as part\n   * of the payload. Normally relations are not sent.\n   * @returns {Promise} Resolves with the created records.\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/saving-data\",\"Saving data\"]\n   */\n  createMany (records = [], opts: any = {}) {\n    // Default values for arguments\n    const originalRecords = records\n    let adapterResponse\n\n    // Fill in \"opts\" with the Mapper's configuration\n    utils._(opts, this)\n    opts.adapter = this.getAdapterName(opts)\n\n    // beforeCreateMany lifecycle hook\n    opts.op = 'beforeCreateMany'\n    return this._runHook(opts.op, records, opts)\n      .then(records => {\n        // Deep pre-create belongsTo relations\n        const belongsToRelationData = {}\n        opts.with = opts.with || []\n        let tasks = []\n        utils.forEachRelation(this, opts, (def, optsCopy) => {\n          const relationData = records.map(record => def.getLocalField(record)).filter(Boolean)\n          if (def.type === belongsToType && relationData.length === records.length) {\n            // Create belongsTo relation first because we need a generated id to\n            // attach to the child\n            optsCopy.raw = false\n            tasks.push(\n              def\n                .createLinked(relationData, optsCopy)\n                .then(relatedRecords => {\n                  records.forEach((record, i) => def.setForeignKey(record, relatedRecords[i]))\n                })\n                .then(relatedRecords => {\n                  def.setLocalField(belongsToRelationData, relatedRecords)\n                })\n            )\n          }\n        })\n        return Promise.all(tasks)\n          .then(() => {\n            opts.op = 'createMany'\n            return this._invokeAdapterMethod(opts.op, records, opts)\n          })\n          .then(result => {\n            adapterResponse = result\n          })\n          .then(() => {\n            const createdRecordsData = opts.raw ? adapterResponse.data : adapterResponse\n\n            // Deep post-create hasOne relations\n            tasks = []\n            utils.forEachRelation(this, opts, (def, optsCopy) => {\n              const relationData = records.map(record => def.getLocalField(record)).filter(Boolean)\n              if (relationData.length !== records.length) {\n                return\n              }\n\n              optsCopy.raw = false\n              const belongsToData = def.getLocalField(belongsToRelationData)\n              let task\n              // Create hasMany and hasOne after the main create because we needed\n              // a generated id to attach to these items\n              if (def.type === hasManyType) {\n                // Not supported\n                this.log('warn', 'deep createMany of hasMany type not supported!')\n              } else if (def.type === hasOneType) {\n                createdRecordsData.forEach((createdRecordData, i) => {\n                  def.setForeignKey(createdRecordData, relationData[i])\n                })\n                task = def\n                  .getRelation()\n                  .createMany(relationData, optsCopy)\n                  .then(relatedData => {\n                    createdRecordsData.forEach((createdRecordData, i) => {\n                      def.setLocalField(createdRecordData, relatedData[i])\n                    })\n                  })\n              } else if (\n                def.type === belongsToType &&\n                belongsToData &&\n                belongsToData.length === createdRecordsData.length\n              ) {\n                createdRecordsData.forEach((createdRecordData, i) => {\n                  def.setLocalField(createdRecordData, belongsToData[i])\n                })\n              }\n              if (task) {\n                tasks.push(task)\n              }\n            })\n            return Promise.all(tasks).then(() => {\n              return this._commitChanges(originalRecords, createdRecordsData)\n            })\n          })\n      })\n      .then(records => {\n        if (opts.raw) {\n          adapterResponse.data = records\n        } else {\n          adapterResponse = records\n        }\n        const result = this._end(adapterResponse, opts)\n        opts.op = 'afterCreateMany'\n        return this._runHook(opts.op, records, opts, result)\n      })\n  }\n\n  /**\n   * Create an unsaved, uncached instance of this Mapper's\n   * {@link Mapper#recordClass}.\n   *\n   * Returns `props` if `props` is already an instance of\n   * {@link Mapper#recordClass}.\n   *\n   * __Note:__ This method does __not__ interact with any adapter, and does\n   * __not__ save any data. It only creates new objects in memory.\n   *\n   * @example\n   * // Create empty unsaved record instance\n   * const post = PostMapper.createRecord();\n   *\n   * @example\n   * // Create an unsaved record instance with inital properties\n   * const post = PostMapper.createRecord({\n   *   title: 'Modeling your data',\n   *   status: 'draft'\n   * });\n   *\n   * @example\n   * // Create a record instance that corresponds to a saved record\n   * const post = PostMapper.createRecord({\n   *   // JSData thinks this record has been saved if it has a primary key\n   *   id: 1234,\n   *   title: 'Modeling your data',\n   *   status: 'draft'\n   * });\n   *\n   * @example\n   * // Create record instances from an array\n   * const posts = PostMapper.createRecord([{\n   *   title: 'Modeling your data',\n   *   status: 'draft'\n   * }, {\n   *   title: 'Reading data',\n   *   status: 'draft'\n   * }]);\n   *\n   * @example\n   * // Records are validated by default\n   * import { Mapper } from 'js-data';\n   * const PostMapper = new Mapper({\n   *   name: 'post',\n   *   schema: { properties: { title: { type: 'string' } } }\n   * });\n   * try {\n   *   const post = PostMapper.createRecord({\n   *     title: 1234,\n   *   });\n   * } catch (err) {\n   *   console.log(err.errors); // [{ expected: 'one of (string)', actual: 'number', path: 'title' }]\n   * }\n   *\n   * @example\n   * // Skip validation\n   * import { Mapper } from 'js-data';\n   * const PostMapper = new Mapper({\n   *   name: 'post',\n   *   schema: { properties: { title: { type: 'string' } } }\n   * });\n   * const post = PostMapper.createRecord({\n   *   title: 1234,\n   * }, { noValidate: true });\n   * console.log(post.isValid()); // false\n   *\n   * @method Mapper#createRecord\n   * @param {Object|Object[]} props The properties for the Record instance or an\n   * array of property objects for the Record instances.\n   * @param {object} [opts] Configuration options.\n   * @param {boolean} [opts.noValidate={@link Mapper#noValidate}] See {@link Mapper#noValidate}.\n   * @returns {Record|Record[]} The Record instance or Record instances.\n   * @since 3.0.0\n   */\n  createRecord (props: any = {}, opts?): Record | Record[] | any {\n    if (utils.isArray(props)) {\n      return props.map(_props => this.createRecord(_props, opts))\n    }\n    if (!utils.isObject(props)) {\n      throw utils.err(`${DOMAIN}#createRecord`, 'props')(400, 'array or object', props)\n    }\n\n    if (this.relationList) {\n      this.relationList.forEach(def => {\n        def.ensureLinkedDataHasProperType(props, opts)\n      })\n    }\n    const RecordCtor = this.recordClass\n\n    const result = !RecordCtor || props instanceof RecordCtor ? props : new RecordCtor(props, opts)\n    return result\n    // Record.mapper = this;\n    // return new Record(props);\n  }\n\n  /**\n   * Lifecycle invocation method. You probably won't call this method directly.\n   *\n   * @method Mapper#crud\n   * @param {string} method Name of the lifecycle method to invoke.\n   * @param {...*} args Arguments to pass to the lifecycle method.\n   * @returns {Promise}\n   * @since 3.0.0\n   */\n  crud (method, ...args) {\n    const config = this.lifecycleMethods[method]\n    if (!config) {\n      throw utils.err(`${DOMAIN}#crud`, method)(404, 'method')\n    }\n\n    const upper = `${method.charAt(0).toUpperCase()}${method.substr(1)}`\n    const before = `before${upper}`\n    const after = `after${upper}`\n\n    let op\n\n    // Default values for arguments\n    config.defaults.forEach((value, i) => {\n      if (args[i] === undefined) {\n        args[i] = utils.copy(value)\n      }\n    })\n\n    const opts = args[args.length - 1]\n\n    // Fill in \"opts\" with the Mapper's configuration\n    utils._(opts, this)\n    const adapter = opts.adapter = this.getAdapterName(opts)\n\n    // before lifecycle hook\n    op = opts.op = before\n    return utils\n      .resolve(this[op](...args))\n      .then(_value => {\n        if (args[config.beforeAssign] !== undefined) {\n          // Allow for re-assignment from lifecycle hook\n          args[config.beforeAssign] = _value === undefined ? args[config.beforeAssign] : _value\n        }\n        // Now delegate to the adapter\n        op = opts.op = method\n        args = config.adapterArgs ? config.adapterArgs(this, ...args) : args\n        this.dbg(op, ...args)\n        return utils.resolve(this.getAdapter(adapter)[op](this, ...args))\n      })\n      .then(result => {\n        // force noValidate on find/findAll\n        const noValidate = /find/.test(op) || opts.noValidate\n        const _opts = Object.assign({}, opts, { noValidate })\n\n        result = this._end(result, _opts, !!config.skip)\n        args.push(result)\n        // after lifecycle hook\n        op = opts.op = after\n        return utils.resolve(this[op](...args)).then(_result => {\n          // Allow for re-assignment from lifecycle hook\n          return _result === undefined ? result : _result\n        })\n      })\n  }\n\n  /**\n   * Fired during {@link Mapper#destroy}. See\n   * {@link Mapper~beforeDestroyListener} for how to listen for this event.\n   *\n   * @event Mapper#beforeDestroy\n   * @see Mapper~beforeDestroyListener\n   * @see Mapper#destroy\n   */\n  /**\n   * Callback signature for the {@link Mapper#event:beforeDestroy} event.\n   *\n   * @example\n   * function onBeforeDestroy (id, opts) {\n   *   // do something\n   * }\n   * store.on('beforeDestroy', onBeforeDestroy);\n   *\n   * @callback Mapper~beforeDestroyListener\n   * @param {string|number} id The `id` argument passed to {@link Mapper#beforeDestroy}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#beforeDestroy}.\n   * @see Mapper#event:beforeDestroy\n   * @see Mapper#destroy\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Mapper#destroy}. See\n   * {@link Mapper~afterDestroyListener} for how to listen for this event.\n   *\n   * @event Mapper#afterDestroy\n   * @see Mapper~afterDestroyListener\n   * @see Mapper#destroy\n   */\n\n  /**\n   * Callback signature for the {@link Mapper#event:afterDestroy} event.\n   *\n   * @example\n   * function onAfterDestroy (id, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterDestroy', onAfterDestroy);\n   *\n   * @callback Mapper~afterDestroyListener\n   * @param {string|number} id The `id` argument passed to {@link Mapper#afterDestroy}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#afterDestroy}.\n   * @param {object} result The `result` argument passed to {@link Mapper#afterDestroy}.\n   * @see Mapper#event:afterDestroy\n   * @see Mapper#destroy\n   * @since 3.0.0\n   */\n  /**\n   * Using an adapter, destroy the record with the given primary key.\n   *\n   * {@link Mapper#beforeDestroy} will be called before destroying the record.\n   * {@link Mapper#afterDestroy} will be called after destroying the record.\n   *\n   * @example\n   * // Destroy a specific blog post\n   * PostMapper.destroy(1234).then(() => {\n   *   // Blog post #1234 has been destroyed\n   * });\n   *\n   * @example\n   * // Get full response\n   * PostMapper.destroy(1234, { raw: true }).then((result) => {\n   *   console.log(result.deleted); e.g. 1\n   *   console.log(...); // etc., more metadata can be found on the result\n   * });\n   *\n   * @fires Mapper#beforeDestroy\n   * @fires Mapper#afterDestroy\n   * @method Mapper#destroy\n   * @param {(string|number)} id The primary key of the record to destroy.\n   * @param {object} [opts] Configuration options. Refer to the `destroy` method\n   * of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * @returns {Promise} Resolves when the record has been destroyed. Resolves\n   * even if no record was found to be destroyed.\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/saving-data\",\"Saving data\"]\n   */\n  destroy (id: string | number, opts?) {\n    return this.crud('destroy', id, opts)\n  }\n\n  /**\n   * Fired during {@link Mapper#destroyAll}. See\n   * {@link Mapper~beforeDestroyAllListener} for how to listen for this event.\n   *\n   * @event Mapper#beforeDestroyAll\n   * @see Mapper~beforeDestroyAllListener\n   * @see Mapper#destroyAll\n   */\n  /**\n   * Callback signature for the {@link Mapper#event:beforeDestroyAll} event.\n   *\n   * @example\n   * function onBeforeDestroyAll (query, opts) {\n   *   // do something\n   * }\n   * store.on('beforeDestroyAll', onBeforeDestroyAll);\n   *\n   * @callback Mapper~beforeDestroyAllListener\n   * @param {object} query The `query` argument passed to {@link Mapper#beforeDestroyAll}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#beforeDestroyAll}.\n   * @see Mapper#event:beforeDestroyAll\n   * @see Mapper#destroyAll\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Mapper#destroyAll}. See\n   * {@link Mapper~afterDestroyAllListener} for how to listen for this event.\n   *\n   * @event Mapper#afterDestroyAll\n   * @see Mapper~afterDestroyAllListener\n   * @see Mapper#destroyAll\n   */\n\n  /**\n   * Callback signature for the {@link Mapper#event:afterDestroyAll} event.\n   *\n   * @example\n   * function onAfterDestroyAll (query, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterDestroyAll', onAfterDestroyAll);\n   *\n   * @callback Mapper~afterDestroyAllListener\n   * @param {object} query The `query` argument passed to {@link Mapper#afterDestroyAll}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#afterDestroyAll}.\n   * @param {object} result The `result` argument passed to {@link Mapper#afterDestroyAll}.\n   * @see Mapper#event:afterDestroyAll\n   * @see Mapper#destroyAll\n   * @since 3.0.0\n   */\n  /**\n   * Destroy the records selected by `query` via an adapter. If no `query` is\n   * provided then all records will be destroyed.\n   *\n   * {@link Mapper#beforeDestroyAll} will be called before destroying the records.\n   * {@link Mapper#afterDestroyAll} will be called after destroying the records.\n   *\n   * @example\n   * // Destroy all blog posts\n   * PostMapper.destroyAll().then(() => {\n   *   // All blog posts have been destroyed\n   * });\n   *\n   * @example\n   * // Destroy all \"draft\" blog posts\n   * PostMapper.destroyAll({ status: 'draft' }).then(() => {\n   *   // All \"draft\" blog posts have been destroyed\n   * });\n   *\n   * @example\n   * // Get full response\n   * const query = null;\n   * const options = { raw: true };\n   * PostMapper.destroyAll(query, options).then((result) => {\n   *   console.log(result.deleted); e.g. 14\n   *   console.log(...); // etc., more metadata can be found on the result\n   * });\n   *\n   * @fires Mapper#beforeDestroyAll\n   * @fires Mapper#afterDestroyAll\n   * @method Mapper#destroyAll\n   * @param {object} [query={}] Selection query. See {@link query}.\n   * @param {object} [query.where] See {@link query.where}.\n   * @param {number} [query.offset] See {@link query.offset}.\n   * @param {number} [query.limit] See {@link query.limit}.\n   * @param {string|Array[]} [query.orderBy] See {@link query.orderBy}.\n   * @param {object} [opts] Configuration options. Refer to the `destroyAll`\n   * method of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * @returns {Promise} Resolves when the records have been destroyed. Resolves\n   * even if no records were found to be destroyed.\n   * @see query\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/saving-data\",\"Saving data\"]\n   */\n  destroyAll (query?, opts?) {\n    return this.crud('destroyAll', query, opts)\n  }\n\n  /**\n   * Fired during {@link Mapper#find}. See\n   * {@link Mapper~beforeFindListener} for how to listen for this event.\n   *\n   * @event Mapper#beforeFind\n   * @see Mapper~beforeFindListener\n   * @see Mapper#find\n   */\n  /**\n   * Callback signature for the {@link Mapper#event:beforeFind} event.\n   *\n   * @example\n   * function onBeforeFind (id, opts) {\n   *   // do something\n   * }\n   * store.on('beforeFind', onBeforeFind);\n   *\n   * @callback Mapper~beforeFindListener\n   * @param {string|number} id The `id` argument passed to {@link Mapper#beforeFind}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#beforeFind}.\n   * @see Mapper#event:beforeFind\n   * @see Mapper#find\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Mapper#find}. See\n   * {@link Mapper~afterFindListener} for how to listen for this event.\n   *\n   * @event Mapper#afterFind\n   * @see Mapper~afterFindListener\n   * @see Mapper#find\n   */\n\n  /**\n   * Callback signature for the {@link Mapper#event:afterFind} event.\n   *\n   * @example\n   * function onAfterFind (id, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterFind', onAfterFind);\n   *\n   * @callback Mapper~afterFindListener\n   * @param {string|number} id The `id` argument passed to {@link Mapper#afterFind}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#afterFind}.\n   * @param {object} result The `result` argument passed to {@link Mapper#afterFind}.\n   * @see Mapper#event:afterFind\n   * @see Mapper#find\n   * @since 3.0.0\n   */\n  /**\n   * Retrieve via an adapter the record with the given primary key.\n   *\n   * {@link Mapper#beforeFind} will be called before calling the adapter.\n   * {@link Mapper#afterFind} will be called after calling the adapter.\n   *\n   * @example\n   * PostMapper.find(1).then((post) => {\n   *   console.log(post); // { id: 1, ...}\n   * });\n   *\n   * @example\n   * // Get full response\n   * PostMapper.find(1, { raw: true }).then((result) => {\n   *   console.log(result.data); // { id: 1, ...}\n   *   console.log(result.found); // 1\n   *   console.log(...); // etc., more metadata can be found on the result\n   * });\n   *\n   * @fires Mapper#beforeFind\n   * @fires Mapper#afterFind\n   * @method Mapper#find\n   * @param {(string|number)} id The primary key of the record to retrieve.\n   * @param {object} [opts] Configuration options. Refer to the `find` method\n   * of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * @param {string[]} [opts.with=[]] Relations to eager load in the request.\n   * @returns {Promise} Resolves with the found record. Resolves with\n   * `undefined` if no record was found.\n   * @see http://www.js-data.io/v3.0/docs/reading-data\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/reading-data\",\"Reading data\"]\n   */\n  find (id: string | number, opts?) {\n    return this.crud('find', id, opts)\n  }\n\n  /**\n   * Fired during {@link Mapper#findAll}. See\n   * {@link Mapper~beforeFindAllListener} for how to listen for this event.\n   *\n   * @event Mapper#beforeFindAll\n   * @see Mapper~beforeFindAllListener\n   * @see Mapper#findAll\n   */\n  /**\n   * Callback signature for the {@link Mapper#event:beforeFindAll} event.\n   *\n   * @example\n   * function onBeforeFindAll (query, opts) {\n   *   // do something\n   * }\n   * store.on('beforeFindAll', onBeforeFindAll);\n   *\n   * @callback Mapper~beforeFindAllListener\n   * @param {object} query The `query` argument passed to {@link Mapper#beforeFindAll}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#beforeFindAll}.\n   * @see Mapper#event:beforeFindAll\n   * @see Mapper#findAll\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Mapper#findAll}. See\n   * {@link Mapper~afterFindAllListener} for how to listen for this event.\n   *\n   * @event Mapper#afterFindAll\n   * @see Mapper~afterFindAllListener\n   * @see Mapper#findAll\n   */\n\n  /**\n   * Callback signature for the {@link Mapper#event:afterFindAll} event.\n   *\n   * @example\n   * function onAfterFindAll (query, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterFindAll', onAfterFindAll);\n   *\n   * @callback Mapper~afterFindAllListener\n   * @param {object} query The `query` argument passed to {@link Mapper#afterFindAll}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#afterFindAll}.\n   * @param {object} result The `result` argument passed to {@link Mapper#afterFindAll}.\n   * @see Mapper#event:afterFindAll\n   * @see Mapper#findAll\n   * @since 3.0.0\n   */\n  /**\n   * Using the `query` argument, select records to retrieve via an adapter.\n   *\n   * {@link Mapper#beforeFindAll} will be called before calling the adapter.\n   * {@link Mapper#afterFindAll} will be called after calling the adapter.\n   *\n   * @example\n   * // Find all \"published\" blog posts\n   * PostMapper.findAll({ status: 'published' }).then((posts) => {\n   *   console.log(posts); // [{ id: 1, status: 'published', ...}, ...]\n   * });\n   *\n   * @example\n   * // Get full response\n   * PostMapper.findAll({ status: 'published' }, { raw: true }).then((result) => {\n   *   console.log(result.data); // [{ id: 1, status: 'published', ...}, ...]\n   *   console.log(result.found); // e.g. 13\n   *   console.log(...); // etc., more metadata can be found on the result\n   * });\n   *\n   * @fires Mapper#beforeFindAll\n   * @fires Mapper#afterFindAll\n   * @method Mapper#findAll\n   * @param {object} [query={}] Selection query. See {@link query}.\n   * @param {object} [query.where] See {@link query.where}.\n   * @param {number} [query.offset] See {@link query.offset}.\n   * @param {number} [query.limit] See {@link query.limit}.\n   * @param {string|Array[]} [query.orderBy] See {@link query.orderBy}.\n   * @param {object} [opts] Configuration options. Refer to the `findAll` method\n   * of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * @param {string[]} [opts.with=[]] Relations to eager load in the request.\n   * @returns {Promise} Resolves with the found records, if any.\n   * @see query\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/reading-data\",\"Reading data\"]\n   */\n  findAll (query, opts?) {\n    return this.crud('findAll', query, opts)\n  }\n\n  /**\n   * Return the registered adapter with the given name or the default adapter if\n   * no name is provided.\n   *\n   * @method Mapper#getAdapter\n   * @param {string} [name] The name of the adapter to retrieve.\n   * @returns {Adapter} The adapter.\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/connecting-to-a-data-source\",\"Connecting to a data source\"]\n   */\n  getAdapter (name?: string) {\n    this.dbg('getAdapter', 'name:', name)\n    const adapter = this.getAdapterName(name)\n    if (!adapter) {\n      throw utils.err(`${DOMAIN}#getAdapter`, 'name')(400, 'string', name)\n    }\n    return this.getAdapters()[adapter]\n  }\n\n  /**\n   * Return the name of a registered adapter based on the given name or options,\n   * or the name of the default adapter if no name provided.\n   *\n   * @method Mapper#getAdapterName\n   * @param {(Object|string)} [opts] The name of an adapter or options, if any.\n   * @returns {string} The name of the adapter.\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/connecting-to-a-data-source\",\"Connecting to a data source\"]\n   */\n  getAdapterName (opts: any = {}) {\n    if (utils.isString(opts)) {\n      opts = { adapter: opts }\n    }\n    return opts.adapter || opts.defaultAdapter\n  }\n\n  /**\n   * Get the object of registered adapters for this Mapper.\n   *\n   * @method Mapper#getAdapters\n   * @returns {Object} {@link Mapper#_adapters}\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/connecting-to-a-data-source\",\"Connecting to a data source\"]\n   */\n  getAdapters () {\n    return this._adapters\n  }\n\n  /**\n   * Returns this Mapper's {@link Schema}.\n   *\n   * @method Mapper#getSchema\n   * @returns {Schema} This Mapper's {@link Schema}.\n   * @see Mapper#schema\n   * @since 3.0.0\n   */\n  getSchema () {\n    return this.schema\n  }\n\n  /**\n   * Defines a hasMany relationship. Only useful if you're managing your\n   * Mappers manually and not using a Container or DataStore component.\n   *\n   * @example\n   * UserMapper.hasMany(PostMapper, {\n   *   // post.user_id points to user.id\n   *   foreignKey: 'user_id'\n   *   // post records will be attached to user records at \"user.posts\"\n   *   localField: 'posts'\n   * });\n   *\n   * @method Mapper#hasMany\n   * @see http://www.js-data.io/v3.0/docs/relations\n   * @since 3.0.0\n   */\n  hasMany (relatedMapper, opts) {\n    return hasMany(relatedMapper, opts)(this)\n  }\n\n  /**\n   * Defines a hasOne relationship. Only useful if you're managing your Mappers\n   * manually and not using a {@link Container} or {@link DataStore} component.\n   *\n   * @example\n   * UserMapper.hasOne(ProfileMapper, {\n   *   // profile.user_id points to user.id\n   *   foreignKey: 'user_id'\n   *   // profile records will be attached to user records at \"user.profile\"\n   *   localField: 'profile'\n   * });\n   *\n   * @method Mapper#hasOne\n   * @see http://www.js-data.io/v3.0/docs/relations\n   * @since 3.0.0\n   */\n  hasOne (relatedMapper, opts) {\n    return hasOne(relatedMapper, opts)(this)\n  }\n\n  /**\n   * Return whether `record` is an instance of this Mapper's recordClass.\n   *\n   * @example\n   * const post = PostMapper.createRecord();\n   *\n   * console.log(PostMapper.is(post)); // true\n   * // Equivalent to what's above\n   * console.log(post instanceof PostMapper.recordClass); // true\n   *\n   * @method Mapper#is\n   * @param {Object|Record} record The record to check.\n   * @returns {boolean} Whether `record` is an instance of this Mapper's\n   * {@link Mapper#recordClass}.\n   * @since 3.0.0\n   */\n  is (record) {\n    const recordClass = this.recordClass\n    return recordClass ? record instanceof recordClass : false\n  }\n\n  /**\n   * Register an adapter on this Mapper under the given name.\n   *\n   * @method Mapper#registerAdapter\n   * @param {string} name The name of the adapter to register.\n   * @param {Adapter} adapter The adapter to register.\n   * @param {object} [opts] Configuration options.\n   * @param {boolean} [opts.default=false] Whether to make the adapter the\n   * default adapter for this Mapper.\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/connecting-to-a-data-source\",\"Connecting to a data source\"]\n   */\n  registerAdapter (name, adapter, opts: any = {}) {\n    this.getAdapters()[name] = adapter\n    // Optionally make it the default adapter for the target.\n    if (opts === true || opts.default) {\n      this.defaultAdapter = name\n    }\n  }\n\n  _runHook (hookName, ...hookArgs) {\n    const defaultValueIndex = hookName.indexOf('after') === 0 ? hookArgs.length - 1 : 0\n\n    return utils\n      .resolve(this[hookName](...hookArgs))\n      .then(overridenResult => (overridenResult === undefined ? hookArgs[defaultValueIndex] : overridenResult))\n  }\n\n  _invokeAdapterMethod (method, propsOrRecords, opts) {\n    const conversionOptions = { with: opts.pass || [] }\n    let object\n\n    this.dbg(opts.op, propsOrRecords, opts)\n\n    if (utils.isArray(propsOrRecords)) {\n      object = propsOrRecords.map(record => this.toJSON(record, conversionOptions))\n    } else {\n      object = this.toJSON(propsOrRecords, conversionOptions)\n    }\n\n    return this.getAdapter(opts.adapter)[method](this, object, opts)\n  }\n\n  /**\n   * Select records according to the `query` argument, and aggregate the sum\n   * value of the property specified by `field`.\n   *\n   * {@link Mapper#beforeSum} will be called before calling the adapter.\n   * {@link Mapper#afterSum} will be called after calling the adapter.\n   *\n   * @example\n   * PurchaseOrderMapper.sum('amount', { status: 'paid' }).then((amountPaid) => {\n   *   console.log(amountPaid); // e.g. 451125.34\n   * });\n   *\n   * @method Mapper#sum\n   * @param {string} field The field to sum.\n   * @param {object} [query={}] Selection query. See {@link query}.\n   * @param {object} [query.where] See {@link query.where}.\n   * @param {number} [query.offset] See {@link query.offset}.\n   * @param {number} [query.limit] See {@link query.limit}.\n   * @param {string|Array[]} [query.orderBy] See {@link query.orderBy}.\n   * @param {object} [opts] Configuration options. Refer to the `sum` method\n   * of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * @returns {Promise} Resolves with the aggregated sum.\n   * @since 3.0.0\n   */\n  sum (field, query: QueryDefinition, opts?) {\n    return this.crud('sum', field, query, opts)\n  }\n\n  /**\n   * Return a plain object representation of the given record. Relations can\n   * be optionally be included. Non-schema properties can be excluded.\n   *\n   * @example\n   * import { Mapper, Schema } from 'js-data';\n   * const PersonMapper = new Mapper({\n   *   name: 'person',\n   *   schema: {\n   *     properties: {\n   *       name: { type: 'string' },\n   *       id: { type: 'string' }\n   *     }\n   *   }\n   * });\n   * const person = PersonMapper.createRecord({ id: 1, name: 'John', foo: 'bar' });\n   * // \"foo\" is stripped by toJSON()\n   * console.log(PersonMapper.toJSON(person)); // {\"id\":1,\"name\":\"John\"}\n   *\n   * const PersonRelaxedMapper = new Mapper({\n   *   name: 'personRelaxed',\n   *   schema: {\n   *     properties: {\n   *       name: { type: 'string' },\n   *       id: { type: 'string' }\n   *     },\n   *     additionalProperties: true\n   *   }\n   * });\n   * const person2 = PersonRelaxedMapper.createRecord({ id: 1, name: 'John', foo: 'bar' });\n   * // \"foo\" is not stripped by toJSON\n   * console.log(PersonRelaxedMapper.toJSON(person2)); // {\"id\":1,\"name\":\"John\",\"foo\":\"bar\"}\n   *\n   * @method Mapper#toJSON\n   * @param {Record|Record[]} records Record or records from which to create a\n   * POJO representation.\n   * @param {object} [opts] Configuration options.\n   * @param {string[]} [opts.with] Array of relation names or relation fields\n   * to include in the POJO representation.\n   * @param {boolean} [opts.withAll] Whether to simply include all relations in\n   * the representation. Overrides `opts.with`.\n   * @returns {Object|Object[]} POJO representation of the record or records.\n   * @since 3.0.0\n   */\n  toJSON (records, opts: any = {}) {\n    let record\n    if (utils.isArray(records)) {\n      return records.map(record => this.toJSON(record, opts))\n    } else {\n      record = records\n    }\n    const relationFields = (this ? this.relationFields : []) || []\n    let json = {}\n\n    // Copy properties defined in the schema\n    if (this && this.schema) {\n      json = this.schema.pick(record)\n    } else {\n      for (const key in record) {\n        if (relationFields.indexOf(key) === -1) {\n          json[key] = utils.plainCopy(record[key])\n        }\n      }\n    }\n\n    // The user wants to include relations in the resulting plain object representation\n    if (this && opts.withAll) {\n      opts.with = relationFields.slice()\n    }\n    if (this && opts.with) {\n      if (utils.isString(opts.with)) {\n        opts.with = [opts.with]\n      }\n      utils.forEachRelation(this, opts, (def, optsCopy) => {\n        const relationData = def.getLocalField(record)\n        if (relationData) {\n          // The actual recursion\n          if (utils.isArray(relationData)) {\n            def.setLocalField(\n              json,\n              relationData.map(item => {\n                return def.getRelation().toJSON(item, optsCopy)\n              })\n            )\n          } else {\n            def.setLocalField(json, def.getRelation().toJSON(relationData, optsCopy))\n          }\n        }\n      })\n    }\n    return json\n  }\n\n  /**\n   * Fired during {@link Mapper#update}. See\n   * {@link Mapper~beforeUpdateListener} for how to listen for this event.\n   *\n   * @event Mapper#beforeUpdate\n   * @see Mapper~beforeUpdateListener\n   * @see Mapper#update\n   */\n  /**\n   * Callback signature for the {@link Mapper#event:beforeUpdate} event.\n   *\n   * @example\n   * function onBeforeUpdate (id, props, opts) {\n   *   // do something\n   * }\n   * store.on('beforeUpdate', onBeforeUpdate);\n   *\n   * @callback Mapper~beforeUpdateListener\n   * @param {string|number} id The `id` argument passed to {@link Mapper#beforeUpdate}.\n   * @param {object} props The `props` argument passed to {@link Mapper#beforeUpdate}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#beforeUpdate}.\n   * @see Mapper#event:beforeUpdate\n   * @see Mapper#update\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Mapper#update}. See\n   * {@link Mapper~afterUpdateListener} for how to listen for this event.\n   *\n   * @event Mapper#afterUpdate\n   * @see Mapper~afterUpdateListener\n   * @see Mapper#update\n   */\n\n  /**\n   * Callback signature for the {@link Mapper#event:afterUpdate} event.\n   *\n   * @example\n   * function onAfterUpdate (id, props, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterUpdate', onAfterUpdate);\n   *\n   * @callback Mapper~afterUpdateListener\n   * @param {string|number} id The `id` argument passed to {@link Mapper#afterUpdate}.\n   * @param {object} props The `props` argument passed to {@link Mapper#afterUpdate}.\n   * @param {object} opts The `opts` argument passed to {@link Mapper#afterUpdate}.\n   * @param {object} result The `result` argument passed to {@link Mapper#afterUpdate}.\n   * @see Mapper#event:afterUpdate\n   * @see Mapper#update\n   * @since 3.0.0\n   */\n  /**\n   * Using an adapter, update the record with the primary key specified by the\n   * `id` argument.\n   *\n   * {@link Mapper#beforeUpdate} will be called before updating the record.\n   * {@link Mapper#afterUpdate} will be called after updating the record.\n   *\n   * @example\n   * // Update a specific post\n   * PostMapper.update(1234, {\n   *   status: 'published',\n   *   published_at: new Date()\n   * }).then((post) => {\n   *   console.log(post); // { id: 1234, status: 'published', ... }\n   * });\n   *\n   * @fires Mapper#beforeUpdate\n   * @fires Mapper#afterUpdate\n   * @method Mapper#update\n   * @param {(string|number)} id The primary key of the record to update.\n   * @param {object} props The update to apply to the record.\n   * @param {object} [opts] Configuration options. Refer to the `update` method\n   * of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.noValidate={@link Mapper#noValidate}] See {@link Mapper#noValidate}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * transaction.\n   * @returns {Promise} Resolves with the updated record. Rejects if the record\n   * could not be found.\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/saving-data\",\"Saving data\"]\n   */\n  update (id, props, opts?) {\n    return this.crud('update', id, props, opts)\n  }\n\n  /**\n   * Fired during {@link Mapper#updateAll}. See\n   * {@link Mapper~beforeUpdateAllListener} for how to listen for this event.\n   *\n   * @event Mapper#beforeUpdateAll\n   * @see Mapper~beforeUpdateAllListener\n   * @see Mapper#updateAll\n   */\n  /**\n   * Callback signature for the {@link Mapper#event:beforeUpdateAll} event.\n   *\n   * @example\n   * function onBeforeUpdateAll (props, query, opts) {\n   *   // do something\n   * }\n   * store.on('beforeUpdateAll', onBeforeUpdateAll);\n   *\n   * @callback Mapper~beforeUpdateAllListener\n   * @param {object} props The `props` argument received by {@link Mapper#beforeUpdateAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#beforeUpdateAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeUpdateAll}.\n   * @see Mapper#event:beforeUpdateAll\n   * @see Mapper#updateAll\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Mapper#updateAll}. See\n   * {@link Mapper~afterUpdateAllListener} for how to listen for this event.\n   *\n   * @event Mapper#afterUpdateAll\n   * @see Mapper~afterUpdateAllListener\n   * @see Mapper#updateAll\n   */\n\n  /**\n   * Callback signature for the {@link Mapper#event:afterUpdateAll} event.\n   *\n   * @example\n   * function onAfterUpdateAll (props, query, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterUpdateAll', onAfterUpdateAll);\n   *\n   * @callback Mapper~afterUpdateAllListener\n   * @param {object} props The `props` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterUpdateAll}.\n   * @see Mapper#event:afterUpdateAll\n   * @see Mapper#updateAll\n   * @since 3.0.0\n   */\n  /**\n   * Using the `query` argument, perform the a single updated to the selected\n   * records.\n   *\n   * {@link Mapper#beforeUpdateAll} will be called before making the update.\n   * {@link Mapper#afterUpdateAll} will be called after making the update.\n   *\n   * @example\n   * // Turn all of John's blog posts into drafts.\n   * const update = { status: draft: published_at: null };\n   * const query = { userId: 1234 };\n   * PostMapper.updateAll(update, query).then((posts) => {\n   *   console.log(posts); // [...]\n   * });\n   *\n   * @fires Mapper#beforeUpdateAll\n   * @fires Mapper#afterUpdateAll\n   * @method Mapper#updateAll\n   * @param {object} props Update to apply to selected records.\n   * @param {object} [query={}] Selection query. See {@link query}.\n   * @param {object} [query.where] See {@link query.where}.\n   * @param {number} [query.offset] See {@link query.offset}.\n   * @param {number} [query.limit] See {@link query.limit}.\n   * @param {string|Array[]} [query.orderBy] See {@link query.orderBy}.\n   * @param {object} [opts] Configuration options. Refer to the `updateAll`\n   * method of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.noValidate={@link Mapper#noValidate}] See {@link Mapper#noValidate}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * @returns {Promise} Resolves with the update records, if any.\n   * @see query\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/saving-data\",\"Saving data\"]\n   */\n  updateAll (props, query?: QueryDefinition, opts?) {\n    return this.crud('updateAll', props, query, opts)\n  }\n\n  /**\n   * Fired during {@link Mapper#updateMany}. See\n   * {@link Mapper~beforeUpdateManyListener} for how to listen for this event.\n   *\n   * @event Mapper#beforeUpdateMany\n   * @see Mapper~beforeUpdateManyListener\n   * @see Mapper#updateMany\n   */\n  /**\n   * Callback signature for the {@link Mapper#event:beforeUpdateMany} event.\n   *\n   * @example\n   * function onBeforeUpdateMany (records, opts) {\n   *   // do something\n   * }\n   * store.on('beforeUpdateMany', onBeforeUpdateMany);\n   *\n   * @callback Mapper~beforeUpdateManyListener\n   * @param {object} records The `records` argument received by {@link Mapper#beforeUpdateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeUpdateMany}.\n   * @see Mapper#event:beforeUpdateMany\n   * @see Mapper#updateMany\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Mapper#updateMany}. See\n   * {@link Mapper~afterUpdateManyListener} for how to listen for this event.\n   *\n   * @event Mapper#afterUpdateMany\n   * @see Mapper~afterUpdateManyListener\n   * @see Mapper#updateMany\n   */\n\n  /**\n   * Callback signature for the {@link Mapper#event:afterUpdateMany} event.\n   *\n   * @example\n   * function onAfterUpdateMany (records, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterUpdateMany', onAfterUpdateMany);\n   *\n   * @callback Mapper~afterUpdateManyListener\n   * @param {object} records The `records` argument received by {@link Mapper#afterUpdateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterUpdateMany}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterUpdateMany}.\n   * @see Mapper#event:afterUpdateMany\n   * @see Mapper#updateMany\n   * @since 3.0.0\n   */\n  /**\n   * Given an array of updates, perform each of the updates via an adapter. Each\n   * \"update\" is a hash of properties with which to update an record. Each\n   * update must contain the primary key of the record to be updated.\n   *\n   * {@link Mapper#beforeUpdateMany} will be called before making the update.\n   * {@link Mapper#afterUpdateMany} will be called after making the update.\n   *\n   * @example\n   * PostMapper.updateMany([\n   *   { id: 1234, status: 'draft' },\n   *   { id: 2468, status: 'published', published_at: new Date() }\n   * ]).then((posts) => {\n   *   console.log(posts); // [...]\n   * });\n   *\n   * @fires Mapper#beforeUpdateMany\n   * @fires Mapper#afterUpdateMany\n   * @method Mapper#updateMany\n   * @param {Record[]} records Array up record updates.\n   * @param {object} [opts] Configuration options. Refer to the `updateMany`\n   * method of whatever adapter you're using for more configuration options.\n   * @param {boolean} [opts.adapter={@link Mapper#defaultAdapter}] Name of the\n   * adapter to use.\n   * @param {boolean} [opts.notify={@link Mapper#notify}] See {@link Mapper#notify}.\n   * @param {boolean} [opts.noValidate={@link Mapper#noValidate}] See {@link Mapper#noValidate}.\n   * @param {boolean} [opts.raw={@link Mapper#raw}] See {@link Mapper#raw}.\n   * @returns {Promise} Resolves with the updated records. Rejects if any of the\n   * records could be found.\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/saving-data\",\"Saving data\"]\n   */\n  updateMany (records, opts?) {\n    return this.crud('updateMany', records, opts)\n  }\n\n  /**\n   * Validate the given record or records according to this Mapper's\n   * {@link Schema}. If there are no validation errors then the return value\n   * will be `undefined`.\n   *\n   * @example\n   * import {Mapper, Schema} from 'js-data'\n   * const PersonSchema = new Schema({\n   *   properties: {\n   *     name: { type: 'string' },\n   *     id: { type: 'string' }\n   *   }\n   * });\n   * const PersonMapper = new Mapper({\n   *   name: 'person',\n   *   schema: PersonSchema\n   * });\n   * let errors = PersonMapper.validate({ name: 'John' });\n   * console.log(errors); // undefined\n   * errors = PersonMapper.validate({ name: 123 });\n   * console.log(errors); // [{ expected: 'one of (string)', actual: 'number', path: 'name' }]\n   *\n   * @method Mapper#validate\n   * @param {Object|Object[]} record The record or records to validate.\n   * @param {object} [opts] Configuration options. Passed to\n   * {@link Schema#validate}.\n   * @returns {Object[]} Array of errors or `undefined` if no errors.\n   * @since 3.0.0\n   */\n  validate (record, opts: any = {}) {\n    const schema = this.getSchema()\n    if (!schema) {\n      return\n    }\n    const _opts = utils.pick(opts, ['existingOnly'])\n    if (utils.isArray(record)) {\n      const errors = record.map(_record => schema.validate(_record, utils.pick(_opts, ['existingOnly'])))\n\n      return errors.some(Boolean) ? errors : undefined\n    }\n    return schema.validate(record, _opts)\n  }\n\n  /**\n   * Method used to wrap data returned by an adapter with this Mapper's\n   * {@link Mapper#recordClass}. This method is used by all of a Mapper's CRUD\n   * methods. The provided implementation of this method assumes that the `data`\n   * passed to it is a record or records that need to be wrapped with\n   * {@link Mapper#createRecord}. Override with care.\n   *\n   * Provided implementation of {@link Mapper#wrap}:\n   *\n   * ```\n   * function (data, opts) {\n   *   return this.createRecord(data, opts);\n   * }\n   * ```\n   *\n   * @example\n   * const PostMapper = new Mapper({\n   *   name: 'post',\n   *   // Override to customize behavior\n   *   wrap (data, opts) {\n   *     const originalWrap = this.constructor.prototype.wrap;\n   *     // Let's say \"GET /post\" doesn't return JSON quite like JSData expects,\n   *     // but the actual post records are nested under a \"posts\" field. So,\n   *     // we override Mapper#wrap to handle this special case.\n   *     if (opts.op === 'findAll') {\n   *       return originalWrap.call(this, data.posts, opts);\n   *     }\n   *     // Otherwise perform original behavior\n   *     return originalWrap.call(this, data, opts);\n   *   }\n   * });\n   *\n   * @method Mapper#wrap\n   * @param {Object|Object[]} data The record or records to be wrapped.\n   * @param {object} [opts] Configuration options. Passed to {@link Mapper#createRecord}.\n   * @returns {Record|Record[]} The wrapped record or records.\n   * @since 3.0.0\n   */\n  wrap (data, opts) {\n    return this.createRecord(data, opts)\n  }\n\n  /**\n   * @ignore\n   */\n  defineRelations () {\n    // Setup the mapper's relations, including generating Mapper#relationList\n    // and Mapper#relationFields\n    utils.forOwn(this.relations, (group, type) => {\n      utils.forOwn(group, (relations, _name) => {\n        if (utils.isObject(relations)) {\n          relations = [relations]\n        }\n        relations.forEach(def => {\n          const relatedMapper = this.datastore.getMapperByName(_name) || _name\n          def.getRelation = () => this.datastore.getMapper(_name)\n\n          if (typeof Relation[type] !== 'function') {\n            throw utils.err(DOMAIN, 'defineRelations')(400, 'relation type (hasOne, hasMany, etc)', type, true)\n          }\n\n          this[type](relatedMapper, def)\n        })\n      })\n    })\n  }\n}\n\n/**\n * Create a subclass of this Mapper:\n *\n * @example <caption>Mapper.extend</caption>\n * const JSData = require('js-data');\n * const { Mapper } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * // Extend the class using ES2015 class syntax.\n * class CustomMapperClass extends Mapper {\n *   foo () { return 'bar'; }\n *   static beep () { return 'boop'; }\n * };\n * const customMapper = new CustomMapperClass();\n * console.log(customMapper.foo());\n * console.log(CustomMapperClass.beep());\n *\n * // Extend the class using alternate method.\n * const OtherMapperClass = Mapper.extend({\n *   foo () { return 'bar'; }\n * }, {\n *   beep () { return 'boop'; }\n * });\n * const otherMapper = new OtherMapperClass();\n * console.log(otherMapper.foo());\n * console.log(OtherMapperClass.beep());\n *\n * // Extend the class, providing a custom constructor.\n * function AnotherMapperClass () {\n *   Mapper.call(this);\n *   this.created_at = new Date().getTime();\n * }\n * Mapper.extend({\n *   constructor: AnotherMapperClass,\n *   foo () { return 'bar'; }\n * }, {\n *   beep () { return 'boop'; }\n * })\n * const anotherMapper = new AnotherMapperClass();\n * console.log(anotherMapper.created_at);\n * console.log(anotherMapper.foo());\n * console.log(AnotherMapperClass.beep());\n *\n * @method Mapper.extend\n * @param {object} [props={}] Properties to add to the prototype of the\n * subclass.\n * @param {object} [props.constructor] Provide a custom constructor function\n * to be used as the subclass itself.\n * @param {object} [classProps={}] Static properties to add to the subclass.\n * @returns {Constructor} Subclass of this Mapper class.\n * @since 3.0.0\n */\n","import utils from './utils'\nimport Component from './Component'\nimport Mapper, { MapperOpts } from './Mapper'\nimport Record from './Record'\n\nconst DOMAIN = 'Container'\n\nexport const proxiedMapperMethods = [\n  'count',\n  'create',\n  'createMany',\n  'createRecord',\n  'destroy',\n  'destroyAll',\n  'find',\n  'findAll',\n  'getSchema',\n  'is',\n  'sum',\n  'toJSON',\n  'update',\n  'updateAll',\n  'updateMany',\n  'validate'\n]\n\n/**\n * The `Container` class is a place to define and store {@link Mapper} instances.\n *\n * `Container` makes it easy to manage your Mappers. Without a container, you\n * need to manage Mappers yourself, including resolving circular dependencies\n * among relations. All Mappers in a container share the same adapters, so you\n * don't have to register adapters for every single Mapper.\n *\n * @example <caption>Container#constructor</caption>\n * // import { Container } from 'js-data';\n * const JSData = require('js-data');\n * const {Container} = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * const store = new Container();\n *\n * @class Container\n * @extends Component\n * @param {object} [opts] Configuration options.\n * @param {boolean} [opts.debug=false] See {@link Component#debug}.\n * @param {Constructor} [opts.mapperClass] See {@link Container#mapperClass}.\n * @param {object} [opts.mapperDefaults] See {@link Container#mapperDefaults}.\n * @since 3.0.0\n */\nexport class Container extends Component {\n  mapperDefaults: any;\n  mapperClass: typeof Mapper;\n  _adapters: any;\n  _mappers: { [name: string]: Mapper };\n\n  constructor (opts = {}) {\n    super()\n\n    Object.defineProperties(this, {\n      /**\n       * The adapters registered with this Container, which are also shared by all\n       * Mappers in this Container.\n       *\n       * @name Container#_adapters\n       * @see Container#registerAdapter\n       * @since 3.0.0\n       * @type {Object}\n       */\n      _adapters: {\n        value: {}\n      },\n\n      /**\n       * The the mappers in this container\n       *\n       * @name Container#_mappers\n       * @see Mapper\n       * @since 3.0.0\n       * @type {Object}\n       */\n      _mappers: {\n        value: {}\n      },\n\n      /**\n       * Constructor function to use in {@link Container#defineMapper} to create new\n       * {@link Mapper} instances. {@link Container#mapperClass} should extend\n       * {@link Mapper}. By default {@link Mapper} is used to instantiate Mappers.\n       *\n       * @example <caption>Container#mapperClass</caption>\n       * // import { Container, Mapper } from 'js-data';\n       * const JSData = require('js-data');\n       * const { Container, Mapper } = JSData;\n       * console.log('Using JSData v' + JSData.version.full);\n       *\n       * class MyMapperClass extends Mapper {\n       *   foo () { return 'bar' }\n       * }\n       * const store = new Container({\n       *   mapperClass: MyMapperClass\n       * });\n       * store.defineMapper('user');\n       * console.log(store.getMapper('user').foo());\n       *\n       * @name Container#mapperClass\n       * @see Mapper\n       * @since 3.0.0\n       * @type {Constructor}\n       */\n      mapperClass: {\n        value: undefined,\n        writable: true\n      }\n    })\n\n    // Apply options provided by the user\n    utils.fillIn(this, opts)\n\n    /**\n     * Defaults options to pass to {@link Container#mapperClass} when creating a\n     * new {@link Mapper}.\n     *\n     * @example <caption>Container#mapperDefaults</caption>\n     * // import { Container } from 'js-data';\n     * const JSData = require('js-data');\n     * const { Container } = JSData;\n     * console.log('Using JSData v' + JSData.version.full);\n     *\n     * const store = new Container({\n     *   mapperDefaults: {\n     *     idAttribute: '_id'\n     *   }\n     * });\n     * store.defineMapper('user');\n     * console.log(store.getMapper('user').idAttribute);\n     *\n     * @default {}\n     * @name Container#mapperDefaults\n     * @since 3.0.0\n     * @type {Object}\n     */\n    this.mapperDefaults = this.mapperDefaults || {}\n\n    // Use the Mapper class if the user didn't provide a mapperClass\n    this.mapperClass = this.mapperClass || Mapper\n  }\n\n  /**\n   * Register a new event listener on this Container.\n   *\n   * Proxy for {@link Component#on}. If an event was emitted by a {@link Mapper}\n   * in the Container, then the name of the {@link Mapper} will be prepended to\n   * the arugments passed to the listener.\n   *\n   * @example <caption>Container#on</caption>\n   * // import { Container } from 'js-data';\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new Container();\n   * store.on('foo', function (...args) { console.log(args.join(':')) });\n   * store.defineMapper('user');\n   * store.emit('foo', 'arg1', 'arg2');\n   * store.getMapper('user').emit('foo', 'arg1', 'arg2');\n   *\n   * @method Container#on\n   * @param {string} event Name of event to subsribe to.\n   * @param {Function} listener Listener function to handle the event.\n   * @param {*} [ctx] Optional content in which to invoke the listener.\n   * @since 3.0.0\n   */\n\n  /**\n   * Used to bind to events emitted by mappers in this container.\n   *\n   * @method Container#_onMapperEvent\n   * @param {string} name Name of the mapper that emitted the event.\n   * @param {...*} [args] Args See {@link Mapper#emit}.\n   * @private\n   * @since 3.0.0\n   */\n  _onMapperEvent (name, ...args) {\n    const type = args.shift()\n    this.emit(type, name, ...args)\n  }\n\n  /**\n   * Return a container scoped to a particular mapper.\n   *\n   * @example <caption>Container#as</caption>\n   * // import { Container } from 'js-data';\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new Container();\n   * const UserMapper = store.defineMapper('user');\n   * const UserStore = store.as('user');\n   *\n   * const user1 = store.createRecord('user', { name: 'John' });\n   * const user2 = UserStore.createRecord({ name: 'John' });\n   * const user3 = UserMapper.createRecord({ name: 'John' });\n   * console.log(user1 === user2);\n   * console.log(user2 === user3);\n   * console.log(user1 === user3);\n   *\n   * @method Container#as\n   * @param {string} name Name of the {@link Mapper}.\n   * @returns {Object} A container scoped to a particular mapper.\n   * @since 3.0.0\n   */\n  as (name) {\n    const props: any = {}\n    const original = this\n    proxiedMapperMethods.forEach(method => {\n      props[method] = {\n        writable: true,\n        value (...args) {\n          return original[method](name, ...args)\n        }\n      }\n    })\n    props.getMapper = {\n      writable: true,\n      value () {\n        return original.getMapper(name)\n      }\n    }\n    return Object.create(this, props)\n  }\n\n  /**\n   * Create a new mapper and register it in this container.\n   *\n   * @example <caption>Container#defineMapper</caption>\n   * // import { Container } from 'js-data';\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new Container({\n   *   mapperDefaults: { foo: 'bar' }\n   * });\n   * // Container#defineMapper returns a direct reference to the newly created\n   * // Mapper.\n   * const UserMapper = store.defineMapper('user');\n   * console.log(UserMapper === store.getMapper('user'));\n   * console.log(UserMapper === store.as('user').getMapper());\n   * console.log(UserMapper.foo);\n   *\n   * @method Container#defineMapper\n   * @param {string} name Name under which to register the new {@link Mapper}.\n   * {@link Mapper#name} will be set to this value.\n   * @param {object} [opts] Configuration options. Passed to\n   * {@link Container#mapperClass} when creating the new {@link Mapper}.\n   * @returns {Mapper} The newly created instance of {@link Mapper}.\n   * @see Container#as\n   * @since 3.0.0\n   */\n  defineMapper (name?: string | MapperOpts | any, opts?: MapperOpts) {\n    // For backwards compatibility with defineResource\n    if (utils.isObject(name)) {\n      opts = name\n      name = opts.name\n    }\n    if (!utils.isString(name)) {\n      throw utils.err(`${DOMAIN}#defineMapper`, 'name')(400, 'string', name)\n    }\n\n    // Default values for arguments\n    opts = opts || {}\n    // Set Mapper#name\n    opts.name = name\n    opts.relations = opts.relations || {}\n\n    // Check if the user is overriding the datastore's default mapperClass\n    const mapperClass = opts.mapperClass || this.mapperClass\n    delete opts.mapperClass\n\n    // Apply the datastore's defaults to the options going into the mapper\n    utils.fillIn(opts, this.mapperDefaults)\n\n    // Instantiate a mapper\n    const mapper = (this._mappers[name] = new mapperClass(opts)); // eslint-disable-line\n    mapper.relations = mapper.relations || {}\n    // Make sure the mapper's name is set\n    mapper.name = name\n    // All mappers in this datastore will share adapters\n    mapper._adapters = this.getAdapters()\n\n    mapper.datastore = this\n\n    mapper.on('all', (...args) => this._onMapperEvent(name, ...args))\n    mapper.defineRelations()\n\n    return mapper\n  }\n\n  defineResource (name, opts) {\n    console.warn('DEPRECATED: defineResource is deprecated, use defineMapper instead')\n    return this.defineMapper(name, opts)\n  }\n\n  /**\n   * Return the registered adapter with the given name or the default adapter if\n   * no name is provided.\n   *\n   * @method Container#getAdapter\n   * @param {string} [name] The name of the adapter to retrieve.\n   * @returns {Adapter} The adapter.\n   * @since 3.0.0\n   */\n  getAdapter (name?) {\n    const adapter = this.getAdapterName(name)\n    if (!adapter) {\n      throw utils.err(`${DOMAIN}#getAdapter`, 'name')(400, 'string', name)\n    }\n    return this.getAdapters()[adapter]\n  }\n\n  /**\n   * Return the name of a registered adapter based on the given name or options,\n   * or the name of the default adapter if no name provided.\n   *\n   * @method Container#getAdapterName\n   * @param {(Object|string)} [opts] The name of an adapter or options, if any.\n   * @returns {string} The name of the adapter.\n   * @since 3.0.0\n   */\n  getAdapterName (opts: any = {}) {\n    if (utils.isString(opts)) {\n      opts = { adapter: opts }\n    }\n    return opts.adapter || this.mapperDefaults.defaultAdapter\n  }\n\n  /**\n   * Return the registered adapters of this container.\n   *\n   * @method Container#getAdapters\n   * @returns {Adapter}\n   * @since 3.0.0\n   */\n  getAdapters () {\n    return this._adapters\n  }\n\n  /**\n   * Return the mapper registered under the specified name.\n   *\n   * @example <caption>Container#getMapper</caption>\n   * // import { Container } from 'js-data';\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new Container();\n   * // Container#defineMapper returns a direct reference to the newly created\n   * // Mapper.\n   * const UserMapper = store.defineMapper('user');\n   * console.log(UserMapper === store.getMapper('user'));\n   * console.log(UserMapper === store.as('user').getMapper());\n   * store.getMapper('profile'); // throws Error, there is no mapper with name \"profile\"\n   *\n   * @method Container#getMapper\n   * @param {string} name {@link Mapper#name}.\n   * @returns {Mapper}\n   * @since 3.0.0\n   */\n  getMapper (name: string): Mapper {\n    const mapper = this.getMapperByName(name)\n    if (!mapper) {\n      throw utils.err(`${DOMAIN}#getMapper`, name)(404, 'mapper')\n    }\n    return mapper\n  }\n\n  /**\n   * Return the mapper registered under the specified name.\n   * Doesn't throw error if mapper doesn't exist.\n   *\n   * @example <caption>Container#getMapperByName</caption>\n   * // import { Container } from 'js-data';\n   * const JSData = require('js-data');\n   * const { Container } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new Container();\n   * // Container#defineMapper returns a direct reference to the newly created\n   * // Mapper.\n   * const UserMapper = store.defineMapper('user');\n   * console.log(UserMapper === store.getMapper('user'));\n   * console.log(UserMapper === store.as('user').getMapper());\n   * console.log(store.getMapper('profile')); // Does NOT throw an error\n   *\n   * @method Container#getMapperByName\n   * @param {string} name {@link Mapper#name}.\n   * @returns {Mapper}\n   * @since 3.0.0\n   */\n  getMapperByName (name) {\n    return this._mappers[name]\n  }\n\n  /**\n   * Register an adapter on this container under the given name. Adapters\n   * registered on a container are shared by all mappers in the container.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * import { RethinkDBAdapter } from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   *\n   * @method Container#registerAdapter\n   * @param {string} name The name of the adapter to register.\n   * @param {Adapter} adapter The adapter to register.\n   * @param {object} [opts] Configuration options.\n   * @param {boolean} [opts.default=false] Whether to make the adapter the\n   * default adapter for all Mappers in this container.\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/connecting-to-a-data-source\",\"Connecting to a data source\"]\n   */\n  registerAdapter (name, adapter, opts: any = {}) {\n    this.getAdapters()[name] = adapter\n    // Optionally make it the default adapter for the target.\n    if (opts === true || opts.default) {\n      this.mapperDefaults.defaultAdapter = name\n      utils.forOwn(this._mappers, mapper => {\n        mapper.defaultAdapter = name\n      })\n    }\n  }\n\n  /**\n   * Wrapper for {@link Mapper#count}.\n   *\n   * @example\n   * // Get the number of published blog posts\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('post');\n   *\n   * store.count('post', { status: 'published' }).then((numPublished) => {\n   *   console.log(numPublished); // e.g. 45\n   * });\n   *\n   * @method Container#count\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {object} [query] See {@link Mapper#count}.\n   * @param {object} [opts] See {@link Mapper#count}.\n   * @returns {Promise} See {@link Mapper#count}.\n   * @see Mapper#count\n   * @since 3.0.0\n   */\n  count (name, query, opts?) {\n    return this.getMapper(name).count(query, opts)\n  }\n\n  /**\n   * Fired during {@link Container#create}. See\n   * {@link Container~beforeCreateListener} for how to listen for this event.\n   *\n   * @event Container#beforeCreate\n   * @see Container~beforeCreateListener\n   * @see Container#create\n   */\n  /**\n   * Callback signature for the {@link Container#event:beforeCreate} event.\n   *\n   * @example\n   * function onBeforeCreate (mapperName, props, opts) {\n   *   // do something\n   * }\n   * store.on('beforeCreate', onBeforeCreate);\n   *\n   * @callback Container~beforeCreateListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeCreate}.\n   * @param {object} props The `props` argument received by {@link Mapper#beforeCreate}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeCreate}.\n   * @see Container#event:beforeCreate\n   * @see Container#create\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Container#create}. See\n   * {@link Container~afterCreateListener} for how to listen for this event.\n   *\n   * @event Container#afterCreate\n   * @see Container~afterCreateListener\n   * @see Container#create\n   */\n\n  /**\n   * Callback signature for the {@link Container#event:afterCreate} event.\n   *\n   * @example\n   * function onAfterCreate (mapperName, props, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterCreate', onAfterCreate);\n   *\n   * @callback Container~afterCreateListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterCreate}.\n   * @param {object} props The `props` argument received by {@link Mapper#afterCreate}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterCreate}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterCreate}.\n   * @see Container#event:afterCreate\n   * @see Container#create\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#create}.\n   *\n   * @example\n   * // Create and save a new blog post\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('post');\n   *\n   * store.create('post', {\n   *   title: 'Modeling your data',\n   *   status: 'draft'\n   * }).then((post) => {\n   *   console.log(post); // { id: 1234, status: 'draft', ... }\n   * });\n   *\n   * @fires Container#beforeCreate\n   * @fires Container#afterCreate\n   * @method Container#create\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {object} props See {@link Mapper#create}.\n   * @param {object} [opts] See {@link Mapper#create}.\n   * @returns {Promise} See {@link Mapper#create}.\n   * @see Mapper#create\n   * @since 3.0.0\n   */\n  create (name, props, opts) {\n    return this.getMapper(name).create(props, opts)\n  }\n\n  /**\n   * Fired during {@link Container#createMany}. See\n   * {@link Container~beforeCreateManyListener} for how to listen for this event.\n   *\n   * @event Container#beforeCreateMany\n   * @see Container~beforeCreateManyListener\n   * @see Container#createMany\n   */\n  /**\n   * Callback signature for the {@link Container#event:beforeCreateMany} event.\n   *\n   * @example\n   * function onBeforeCreateMany (mapperName, records, opts) {\n   *   // do something\n   * }\n   * store.on('beforeCreateMany', onBeforeCreateMany);\n   *\n   * @callback Container~beforeCreateManyListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeCreateMany}.\n   * @param {object} records The `records` argument received by {@link Mapper#beforeCreateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeCreateMany}.\n   * @see Container#event:beforeCreateMany\n   * @see Container#createMany\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Container#createMany}. See\n   * {@link Container~afterCreateManyListener} for how to listen for this event.\n   *\n   * @event Container#afterCreateMany\n   * @see Container~afterCreateManyListener\n   * @see Container#createMany\n   */\n\n  /**\n   * Callback signature for the {@link Container#event:afterCreateMany} event.\n   *\n   * @example\n   * function onAfterCreateMany (mapperName, records, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterCreateMany', onAfterCreateMany);\n   *\n   * @callback Container~afterCreateManyListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterCreateMany}.\n   * @param {object} records The `records` argument received by {@link Mapper#afterCreateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterCreateMany}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterCreateMany}.\n   * @see Container#event:afterCreateMany\n   * @see Container#createMany\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#createMany}.\n   *\n   * @example\n   * // Create and save several new blog posts\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('post');\n   *\n   * store.createMany('post', [{\n   *   title: 'Modeling your data',\n   *   status: 'draft'\n   * }, {\n   *   title: 'Reading data',\n   *   status: 'draft'\n   * }]).then((posts) => {\n   *   console.log(posts[0]); // { id: 1234, status: 'draft', ... }\n   *   console.log(posts[1]); // { id: 1235, status: 'draft', ... }\n   * });\n   *\n   * @fires Container#beforeCreateMany\n   * @fires Container#afterCreateMany\n   * @method Container#createMany\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {Record[]} records See {@link Mapper#createMany}.\n   * @param {object} [opts] See {@link Mapper#createMany}.\n   * @returns {Promise} See {@link Mapper#createMany}.\n   * @see Mapper#createMany\n   * @since 3.0.0\n   */\n  createMany (name, records, opts) {\n    return this.getMapper(name).createMany(records, opts)\n  }\n\n  /**\n   * Wrapper for {@link Mapper#createRecord}.\n   *\n   * __Note:__ This method does __not__ interact with any adapter, and does\n   * __not__ save any data. It only creates new objects in memory.\n   *\n   * @example\n   * // Create empty unsaved record instance\n   * import { Container } from 'js-data';\n   * const store = new Container();\n   * store.defineMapper('post');\n   * const post = PostMapper.createRecord();\n   *\n   * @method Container#createRecord\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {Object|Object[]} props See {@link Mapper#createRecord}.\n   * @param {object} [opts] See {@link Mapper#createRecord}.\n   * @returns {Promise} See {@link Mapper#createRecord}.\n   * @see Mapper#createRecord\n   * @since 3.0.0\n   */\n  createRecord (name, props?, opts?) {\n    return this.getMapper(name).createRecord(props, opts)\n  }\n\n  /**\n   * Fired during {@link Container#destroy}. See\n   * {@link Container~beforeDestroyListener} for how to listen for this event.\n   *\n   * @event Container#beforeDestroy\n   * @see Container~beforeDestroyListener\n   * @see Container#destroy\n   */\n  /**\n   * Callback signature for the {@link Container#event:beforeDestroy} event.\n   *\n   * @example\n   * function onBeforeDestroy (mapperName, id, opts) {\n   *   // do something\n   * }\n   * store.on('beforeDestroy', onBeforeDestroy);\n   *\n   * @callback Container~beforeDestroyListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeDestroy}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#beforeDestroy}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeDestroy}.\n   * @see Container#event:beforeDestroy\n   * @see Container#destroy\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Container#destroy}. See\n   * {@link Container~afterDestroyListener} for how to listen for this event.\n   *\n   * @event Container#afterDestroy\n   * @see Container~afterDestroyListener\n   * @see Container#destroy\n   */\n\n  /**\n   * Callback signature for the {@link Container#event:afterDestroy} event.\n   *\n   * @example\n   * function onAfterDestroy (mapperName, id, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterDestroy', onAfterDestroy);\n   *\n   * @callback Container~afterDestroyListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterDestroy}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#afterDestroy}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterDestroy}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterDestroy}.\n   * @see Container#event:afterDestroy\n   * @see Container#destroy\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#destroy}.\n   *\n   * @example\n   * // Destroy a specific blog post\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('post');\n   *\n   * store.destroy('post', 1234).then(() => {\n   *   // Blog post #1234 has been destroyed\n   * });\n   *\n   * @fires Container#beforeDestroy\n   * @fires Container#afterDestroy\n   * @method Container#destroy\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {(string|number)} id See {@link Mapper#destroy}.\n   * @param {object} [opts] See {@link Mapper#destroy}.\n   * @returns {Promise} See {@link Mapper#destroy}.\n   * @see Mapper#destroy\n   * @since 3.0.0\n   */\n  destroy (name, id, opts) {\n    return this.getMapper(name).destroy(id, opts)\n  }\n\n  /**\n   * Fired during {@link Container#destroyAll}. See\n   * {@link Container~beforeDestroyAllListener} for how to listen for this event.\n   *\n   * @event Container#beforeDestroyAll\n   * @see Container~beforeDestroyAllListener\n   * @see Container#destroyAll\n   */\n  /**\n   * Callback signature for the {@link Container#event:beforeDestroyAll} event.\n   *\n   * @example\n   * function onBeforeDestroyAll (mapperName, query, opts) {\n   *   // do something\n   * }\n   * store.on('beforeDestroyAll', onBeforeDestroyAll);\n   *\n   * @callback Container~beforeDestroyAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeDestroyAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#beforeDestroyAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeDestroyAll}.\n   * @see Container#event:beforeDestroyAll\n   * @see Container#destroyAll\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Container#destroyAll}. See\n   * {@link Container~afterDestroyAllListener} for how to listen for this event.\n   *\n   * @event Container#afterDestroyAll\n   * @see Container~afterDestroyAllListener\n   * @see Container#destroyAll\n   */\n\n  /**\n   * Callback signature for the {@link Container#event:afterDestroyAll} event.\n   *\n   * @example\n   * function onAfterDestroyAll (mapperName, query, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterDestroyAll', onAfterDestroyAll);\n   *\n   * @callback Container~afterDestroyAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterDestroyAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#afterDestroyAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterDestroyAll}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterDestroyAll}.\n   * @see Container#event:afterDestroyAll\n   * @see Container#destroyAll\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#destroyAll}.\n   *\n   * @example\n   * // Destroy all \"draft\" blog posts\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('post');\n   *\n   * store.destroyAll('post', { status: 'draft' }).then(() => {\n   *   // All \"draft\" blog posts have been destroyed\n   * });\n   *\n   * @fires Container#beforeDestroyAll\n   * @fires Container#afterDestroyAll\n   * @method Container#destroyAll\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {object} [query] See {@link Mapper#destroyAll}.\n   * @param {object} [opts] See {@link Mapper#destroyAll}.\n   * @returns {Promise} See {@link Mapper#destroyAll}.\n   * @see Mapper#destroyAll\n   * @since 3.0.0\n   */\n  destroyAll (name, query, opts) {\n    return this.getMapper(name).destroyAll(query, opts)\n  }\n\n  /**\n   * Fired during {@link Container#find}. See\n   * {@link Container~beforeFindListener} for how to listen for this event.\n   *\n   * @event Container#beforeFind\n   * @see Container~beforeFindListener\n   * @see Container#find\n   */\n  /**\n   * Callback signature for the {@link Container#event:beforeFind} event.\n   *\n   * @example\n   * function onBeforeFind (mapperName, id, opts) {\n   *   // do something\n   * }\n   * store.on('beforeFind', onBeforeFind);\n   *\n   * @callback Container~beforeFindListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeFind}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#beforeFind}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeFind}.\n   * @see Container#event:beforeFind\n   * @see Container#find\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Container#find}. See\n   * {@link Container~afterFindListener} for how to listen for this event.\n   *\n   * @event Container#afterFind\n   * @see Container~afterFindListener\n   * @see Container#find\n   */\n\n  /**\n   * Callback signature for the {@link Container#event:afterFind} event.\n   *\n   * @example\n   * function onAfterFind (mapperName, id, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterFind', onAfterFind);\n   *\n   * @callback Container~afterFindListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterFind}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#afterFind}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterFind}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterFind}.\n   * @see Container#event:afterFind\n   * @see Container#find\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#find}.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('post');\n   *\n   * store.find('post', 1).then((post) => {\n   *   console.log(post) // { id: 1, ...}\n   * });\n   *\n   * @fires Container#beforeFind\n   * @fires Container#afterFind\n   * @method Container#find\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {(string|number)} id See {@link Mapper#find}.\n   * @param {object} [opts] See {@link Mapper#find}.\n   * @returns {Promise} See {@link Mapper#find}.\n   * @see Mapper#find\n   * @since 3.0.0\n   */\n  find (name, id, opts) {\n    return this.getMapper(name).find(id, opts)\n  }\n\n  /**\n   * Fired during {@link Container#findAll}. See\n   * {@link Container~beforeFindAllListener} for how to listen for this event.\n   *\n   * @event Container#beforeFindAll\n   * @see Container~beforeFindAllListener\n   * @see Container#findAll\n   */\n  /**\n   * Callback signature for the {@link Container#event:beforeFindAll} event.\n   *\n   * @example\n   * function onBeforeFindAll (mapperName, query, opts) {\n   *   // do something\n   * }\n   * store.on('beforeFindAll', onBeforeFindAll);\n   *\n   * @callback Container~beforeFindAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeFindAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#beforeFindAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeFindAll}.\n   * @see Container#event:beforeFindAll\n   * @see Container#findAll\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Container#findAll}. See\n   * {@link Container~afterFindAllListener} for how to listen for this event.\n   *\n   * @event Container#afterFindAll\n   * @see Container~afterFindAllListener\n   * @see Container#findAll\n   */\n\n  /**\n   * Callback signature for the {@link Container#event:afterFindAll} event.\n   *\n   * @example\n   * function onAfterFindAll (mapperName, query, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterFindAll', onAfterFindAll);\n   *\n   * @callback Container~afterFindAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterFindAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#afterFindAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterFindAll}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterFindAll}.\n   * @see Container#event:afterFindAll\n   * @see Container#findAll\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#createRecord}.\n   *\n   * @example\n   * // Find all \"published\" blog posts\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('post');\n   *\n   * store.findAll('post', { status: 'published' }).then((posts) => {\n   *   console.log(posts); // [{ id: 1, ...}, ...]\n   * });\n   *\n   * @fires Container#beforeFindAll\n   * @fires Container#afterFindAll\n   * @method Container#findAll\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {object} [query] See {@link Mapper#findAll}.\n   * @param {object} [opts] See {@link Mapper#findAll}.\n   * @returns {Promise} See {@link Mapper#findAll}.\n   * @see Mapper#findAll\n   * @since 3.0.0\n   */\n  findAll (name, query, opts) {\n    return this.getMapper(name).findAll(query, opts)\n  }\n\n  /**\n   * Wrapper for {@link Mapper#getSchema}.\n   *\n   * @method Container#getSchema\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @returns {Schema} See {@link Mapper#getSchema}.\n   * @see Mapper#getSchema\n   * @since 3.0.0\n   */\n  getSchema (name) {\n    return this.getMapper(name).getSchema()\n  }\n\n  /**\n   * Wrapper for {@link Mapper#is}.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * const store = new Container();\n   * store.defineMapper('post');\n   * const post = store.createRecord();\n   *\n   * console.log(store.is('post', post)); // true\n   * // Equivalent to what's above\n   * console.log(post instanceof store.getMapper('post').recordClass); // true\n   *\n   * @method Container#is\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {Object|Record} record See {@link Mapper#is}.\n   * @returns {boolean} See {@link Mapper#is}.\n   * @see Mapper#is\n   * @since 3.0.0\n   */\n  is (name, record) {\n    return this.getMapper(name).is(record)\n  }\n\n  /**\n   * Wrapper for {@link Mapper#sum}.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('purchase_order');\n   *\n   * store.sum('purchase_order', 'amount', { status: 'paid' }).then((amountPaid) => {\n   *   console.log(amountPaid); // e.g. 451125.34\n   * });\n   *\n   * @method Container#sum\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {string} field See {@link Mapper#sum}.\n   * @param {object} [query] See {@link Mapper#sum}.\n   * @param {object} [opts] See {@link Mapper#sum}.\n   * @returns {Promise} See {@link Mapper#sum}.\n   * @see Mapper#sum\n   * @since 3.0.0\n   */\n  sum (name, field, query, opts) {\n    return this.getMapper(name).sum(field, query, opts)\n  }\n\n  /**\n   * Wrapper for {@link Mapper#toJSON}.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('person', {\n   *   schema: {\n   *     properties: {\n   *       name: { type: 'string' },\n   *       id: { type: 'string' }\n   *     }\n   *   }\n   * });\n   * const person = store.createRecord('person', { id: 1, name: 'John', foo: 'bar' });\n   * // \"foo\" is stripped by toJSON()\n   * console.log(store.toJSON('person', person)); // {\"id\":1,\"name\":\"John\"}\n   *\n   * store.defineMapper('personRelaxed', {\n   *   schema: {\n   *     properties: {\n   *       name: { type: 'string' },\n   *       id: { type: 'string' }\n   *     },\n   *     additionalProperties: true\n   *   }\n   * });\n   * const person2 = store.createRecord('personRelaxed', { id: 1, name: 'John', foo: 'bar' });\n   * // \"foo\" is not stripped by toJSON\n   * console.log(store.toJSON('personRelaxed', person2)); // {\"id\":1,\"name\":\"John\",\"foo\":\"bar\"}\n   *\n   * @method Container#toJSON\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {Record|Record[]} records See {@link Mapper#toJSON}.\n   * @param {object} [opts] See {@link Mapper#toJSON}.\n   * @returns {Object|Object[]} See {@link Mapper#toJSON}.\n   * @see Mapper#toJSON\n   * @since 3.0.0\n   */\n  toJSON (name, records, opts?) {\n    return this.getMapper(name).toJSON(records, opts)\n  }\n\n  /**\n   * Fired during {@link Container#update}. See\n   * {@link Container~beforeUpdateListener} for how to listen for this event.\n   *\n   * @event Container#beforeUpdate\n   * @see Container~beforeUpdateListener\n   * @see Container#update\n   */\n  /**\n   * Callback signature for the {@link Container#event:beforeUpdate} event.\n   *\n   * @example\n   * function onBeforeUpdate (mapperName, id, props, opts) {\n   *   // do something\n   * }\n   * store.on('beforeUpdate', onBeforeUpdate);\n   *\n   * @callback Container~beforeUpdateListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeUpdate}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#beforeUpdate}.\n   * @param {object} props The `props` argument received by {@link Mapper#beforeUpdate}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeUpdate}.\n   * @see Container#event:beforeUpdate\n   * @see Container#update\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Container#update}. See\n   * {@link Container~afterUpdateListener} for how to listen for this event.\n   *\n   * @event Container#afterUpdate\n   * @see Container~afterUpdateListener\n   * @see Container#update\n   */\n\n  /**\n   * Callback signature for the {@link Container#event:afterUpdate} event.\n   *\n   * @example\n   * function onAfterUpdate (mapperName, id, props, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterUpdate', onAfterUpdate);\n   *\n   * @callback Container~afterUpdateListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterUpdate}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#afterUpdate}.\n   * @param {object} props The `props` argument received by {@link Mapper#afterUpdate}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterUpdate}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterUpdate}.\n   * @see Container#event:afterUpdate\n   * @see Container#update\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#update}.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('post');\n   *\n   * store.update('post', 1234, {\n   *   status: 'published',\n   *   published_at: new Date()\n   * }).then((post) => {\n   *   console.log(post); // { id: 1234, status: 'published', ... }\n   * });\n   *\n   * @fires Container#beforeUpdate\n   * @fires Container#afterUpdate\n   * @method Container#update\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {(string|number)} id See {@link Mapper#update}.\n   * @param {object} props See {@link Mapper#update}.\n   * @param {object} [opts] See {@link Mapper#update}.\n   * @returns {Promise} See {@link Mapper#update}.\n   * @see Mapper#update\n   * @since 3.0.0\n   * @tutorial [\"http://www.js-data.io/v3.0/docs/saving-data\",\"Saving data\"]\n   */\n  update (name, id, props, opts) {\n    return this.getMapper(name).update(id, props, opts)\n  }\n\n  /**\n   * Fired during {@link Container#updateAll}. See\n   * {@link Container~beforeUpdateAllListener} for how to listen for this event.\n   *\n   * @event Container#beforeUpdateAll\n   * @see Container~beforeUpdateAllListener\n   * @see Container#updateAll\n   */\n  /**\n   * Callback signature for the {@link Container#event:beforeUpdateAll} event.\n   *\n   * @example\n   * function onBeforeUpdateAll (mapperName, props, query, opts) {\n   *   // do something\n   * }\n   * store.on('beforeUpdateAll', onBeforeUpdateAll);\n   *\n   * @callback Container~beforeUpdateAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeUpdateAll}.\n   * @param {object} props The `props` argument received by {@link Mapper#beforeUpdateAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#beforeUpdateAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeUpdateAll}.\n   * @see Container#event:beforeUpdateAll\n   * @see Container#updateAll\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Container#updateAll}. See\n   * {@link Container~afterUpdateAllListener} for how to listen for this event.\n   *\n   * @event Container#afterUpdateAll\n   * @see Container~afterUpdateAllListener\n   * @see Container#updateAll\n   */\n\n  /**\n   * Callback signature for the {@link Container#event:afterUpdateAll} event.\n   *\n   * @example\n   * function onAfterUpdateAll (mapperName, props, query, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterUpdateAll', onAfterUpdateAll);\n   *\n   * @callback Container~afterUpdateAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} props The `props` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterUpdateAll}.\n   * @see Container#event:afterUpdateAll\n   * @see Container#updateAll\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#updateAll}.\n   *\n   * @example\n   * // Turn all of John's blog posts into drafts.\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('post');\n   *\n   * const update = { status: draft: published_at: null };\n   * const query = { userId: 1234 };\n   * store.updateAll('post', update, query).then((posts) => {\n   *   console.log(posts); // [...]\n   * });\n   *\n   * @fires Container#beforeUpdateAll\n   * @fires Container#afterUpdateAll\n   * @method Container#updateAll\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {object} props See {@link Mapper#updateAll}.\n   * @param {object} [query] See {@link Mapper#updateAll}.\n   * @param {object} [opts] See {@link Mapper#updateAll}.\n   * @returns {Promise} See {@link Mapper#updateAll}.\n   * @see Mapper#updateAll\n   * @since 3.0.0\n   */\n  updateAll (name, props, query, opts) {\n    return this.getMapper(name).updateAll(props, query, opts)\n  }\n\n  /**\n   * Fired during {@link Container#updateMany}. See\n   * {@link Container~beforeUpdateManyListener} for how to listen for this event.\n   *\n   * @event Container#beforeUpdateMany\n   * @see Container~beforeUpdateManyListener\n   * @see Container#updateMany\n   */\n  /**\n   * Callback signature for the {@link Container#event:beforeUpdateMany} event.\n   *\n   * @example\n   * function onBeforeUpdateMany (mapperName, records, opts) {\n   *   // do something\n   * }\n   * store.on('beforeUpdateMany', onBeforeUpdateMany);\n   *\n   * @callback Container~beforeUpdateManyListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeUpdateMany}.\n   * @param {object} records The `records` argument received by {@link Mapper#beforeUpdateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeUpdateMany}.\n   * @see Container#event:beforeUpdateMany\n   * @see Container#updateMany\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link Container#updateMany}. See\n   * {@link Container~afterUpdateManyListener} for how to listen for this event.\n   *\n   * @event Container#afterUpdateMany\n   * @see Container~afterUpdateManyListener\n   * @see Container#updateMany\n   */\n\n  /**\n   * Callback signature for the {@link Container#event:afterUpdateMany} event.\n   *\n   * @example\n   * function onAfterUpdateMany (mapperName, records, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterUpdateMany', onAfterUpdateMany);\n   *\n   * @callback Container~afterUpdateManyListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterUpdateMany}.\n   * @param {object} records The `records` argument received by {@link Mapper#afterUpdateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterUpdateMany}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterUpdateMany}.\n   * @see Container#event:afterUpdateMany\n   * @see Container#updateMany\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#updateMany}.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * import RethinkDBAdapter from 'js-data-rethinkdb';\n   * const store = new Container();\n   * store.registerAdapter('rethinkdb', new RethinkDBAdapter(), { default: true });\n   * store.defineMapper('post');\n   *\n   * store.updateMany('post', [\n   *   { id: 1234, status: 'draft' },\n   *   { id: 2468, status: 'published', published_at: new Date() }\n   * ]).then((posts) => {\n   *   console.log(posts); // [...]\n   * });\n   *\n   * @fires Container#beforeUpdateMany\n   * @fires Container#afterUpdateMany\n   * @method Container#updateMany\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {(Object[]|Record[])} records See {@link Mapper#updateMany}.\n   * @param {object} [opts] See {@link Mapper#updateMany}.\n   * @returns {Promise} See {@link Mapper#updateMany}.\n   * @see Mapper#updateMany\n   * @since 3.0.0\n   */\n  updateMany (name, record, opts) {\n    return this.getMapper(name).updateMany(record, opts)\n  }\n\n  /**\n   * Wrapper for {@link Mapper#validate}.\n   *\n   * @example\n   * import { Container } from 'js-data';\n   * const store = new Container();\n   * store.defineMapper('post', {\n   *   schema: {\n   *     properties: {\n   *       name: { type: 'string' },\n   *       id: { type: 'string' }\n   *     }\n   *   }\n   * });\n   * let errors = store.validate('post', { name: 'John' });\n   * console.log(errors); // undefined\n   * errors = store.validate('post', { name: 123 });\n   * console.log(errors); // [{ expected: 'one of (string)', actual: 'number', path: 'name' }]\n   *\n   * @method Container#validate\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {(Object[]|Record[])} records See {@link Mapper#validate}.\n   * @param {object} [opts] See {@link Mapper#validate}.\n   * @returns {Promise} See {@link Mapper#validate}.\n   * @see Mapper#validate\n   * @since 3.0.0\n   */\n  validate (name, record, opts) {\n    return this.getMapper(name).validate(record, opts)\n  }\n}\n","import utils from './utils'\n\nimport { belongsToType, hasManyType, hasOneType } from './decorators'\nimport { Container, proxiedMapperMethods } from './Container'\nimport Collection from './Collection'\nimport { MapperOpts } from './Mapper'\nimport Schema from './Schema'\n\nconst DOMAIN = 'SimpleStore'\nconst proxiedCollectionMethods = [\n  'add',\n  'between',\n  'createIndex',\n  'filter',\n  'get',\n  'getAll',\n  'prune',\n  'query',\n  'toJSON',\n  'unsaved'\n]\nconst ownMethodsForScoping = ['addToCache', 'cachedFind', 'cachedFindAll', 'cacheFind', 'cacheFindAll', 'hashQuery']\n\nconst cachedFn = function (name, hashOrId, opts) {\n  const cached = this._completedQueries[name][hashOrId]\n  if (utils.isFunction(cached)) {\n    return cached(name, hashOrId, opts)\n  }\n  return cached\n}\n\nexport interface SimpleStoreOpts {\n  /**\n   * Whether to use the pending query if a `find` request for the specified\n   * record is currently underway. Can be set to `true`, `false`, or to a\n   * function that returns `true` or `false`.\n   *\n   * @default true\n   * @name SimpleStore#usePendingFind\n   * @since 3.0.0\n   * @type {boolean|Function}\n   */\n  usePendingFind?: boolean | Function\n\n  /**\n   * Whether to use the pending query if a `findAll` request for the given query\n   * is currently underway. Can be set to `true`, `false`, or to a function that\n   * returns `true` or `false`.\n   *\n   * @default true\n   * @name SimpleStore#usePendingFindAll\n   * @since 3.0.0\n   * @type {boolean|Function}\n   */\n  usePendingFindAll?: boolean | Function\n}\n\nconst SIMPLESTORE_DEFAULTS = {\n  /**\n   * Whether to use the pending query if a `find` request for the specified\n   * record is currently underway. Can be set to `true`, `false`, or to a\n   * function that returns `true` or `false`.\n   *\n   * @default true\n   * @name SimpleStore#usePendingFind\n   * @since 3.0.0\n   * @type {boolean|Function}\n   */\n  usePendingFind: true,\n\n  /**\n   * Whether to use the pending query if a `findAll` request for the given query\n   * is currently underway. Can be set to `true`, `false`, or to a function that\n   * returns `true` or `false`.\n   *\n   * @default true\n   * @name SimpleStore#usePendingFindAll\n   * @since 3.0.0\n   * @type {boolean|Function}\n   */\n  usePendingFindAll: true\n}\n\n/**\n * The `SimpleStore` class is an extension of {@link Container}. Not only does\n * `SimpleStore` manage mappers, but also collections. `SimpleStore` implements the\n * asynchronous {@link Mapper} methods, such as {@link Mapper#find} and\n * {@link Mapper#create}. If you use the asynchronous `SimpleStore` methods\n * instead of calling them directly on the mappers, then the results of the\n * method calls will be inserted into the store's collections. You can think of\n * a `SimpleStore` as an [Identity Map](https://en.wikipedia.org/wiki/Identity_map_pattern)\n * for the [ORM](https://en.wikipedia.org/wiki/Object-relational_mapping)\n * (the Mappers).\n *\n * ```javascript\n * import { SimpleStore } from 'js-data';\n * ```\n *\n * @example\n * import { SimpleStore } from 'js-data';\n * import { HttpAdapter } from 'js-data-http';\n * const store = new SimpleStore();\n *\n * // SimpleStore#defineMapper returns a direct reference to the newly created\n * // Mapper.\n * const UserMapper = store.defineMapper('user');\n *\n * // SimpleStore#as returns the store scoped to a particular Mapper.\n * const UserStore = store.as('user');\n *\n * // Call \"find\" on \"UserMapper\" (Stateless ORM)\n * UserMapper.find(1).then((user) => {\n *   // retrieved a \"user\" record via the http adapter, but that's it\n *\n *   // Call \"find\" on \"store\" targeting \"user\" (Stateful SimpleStore)\n *   return store.find('user', 1); // same as \"UserStore.find(1)\"\n * }).then((user) => {\n *   // not only was a \"user\" record retrieved, but it was added to the\n *   // store's \"user\" collection\n *   const cachedUser = store.getCollection('user').get(1);\n *   console.log(user === cachedUser); // true\n * });\n *\n * @class SimpleStore\n * @extends Container\n * @param {object} [opts] Configuration options. See {@link Container}.\n * @param {boolean} [opts.collectionClass={@link Collection}] See {@link SimpleStore#collectionClass}.\n * @param {boolean} [opts.debug=false] See {@link Component#debug}.\n * @param {boolean|Function} [opts.usePendingFind=true] See {@link SimpleStore#usePendingFind}.\n * @param {boolean|Function} [opts.usePendingFindAll=true] See {@link SimpleStore#usePendingFindAll}.\n * @returns {SimpleStore}\n * @see Container\n * @since 3.0.0\n * @tutorial [\"http://www.js-data.io/v3.0/docs/components-of-jsdata#SimpleStore\",\"Components of JSData: SimpleStore\"]\n * @tutorial [\"http://www.js-data.io/v3.0/docs/working-with-the-SimpleStore\",\"Working with the SimpleStore\"]\n * @tutorial [\"http://www.js-data.io/v3.0/docs/jsdata-and-the-browser\",\"Notes on using JSData in the Browser\"]\n */\nexport default class SimpleStore extends Container {\n  collectionClass: typeof Collection;\n  _collections: { [name: string]: Collection } = {};\n  _completedQueries = {};\n  _pendingQueries = {};\n  usePendingFind: boolean;\n  usePendingFindAll: boolean;\n\n  constructor (opts: SimpleStoreOpts = {}) {\n    super({ ...SIMPLESTORE_DEFAULTS, ...opts })\n    this.collectionClass = this.collectionClass || Collection\n  }\n\n  /**\n   * Internal method used to handle Mapper responses.\n   *\n   * @method SimpleStore#_end\n   * @private\n   * @param {string} name Name of the {@link Collection} to which to\n   * add the data.\n   * @param {object} result The result from a Mapper.\n   * @param {object} [opts] Configuration options.\n   * @returns {(Object|Array)} Result.\n   */\n  _end (name, result, opts) {\n    let data = opts.raw ? result.data : result\n    if (data && utils.isFunction(this.addToCache)) {\n      data = this.addToCache(name, data, opts)\n      if (opts.raw) {\n        result.data = data\n      } else {\n        result = data\n      }\n    }\n    return result\n  }\n\n  /**\n   * Register a new event listener on this SimpleStore.\n   *\n   * Proxy for {@link Container#on}. If an event was emitted by a Mapper or\n   * Collection in the SimpleStore, then the name of the Mapper or Collection will\n   * be prepended to the arugments passed to the provided event handler.\n   *\n   * @example\n   * // Listen for all \"afterCreate\" events in a SimpleStore\n   * store.on('afterCreate', (mapperName, props, opts, result) => {\n   *   console.log(mapperName); // \"post\"\n   *   console.log(props.id); // undefined\n   *   console.log(result.id); // 1234\n   * });\n   * store.create('post', { title: 'Modeling your data' }).then((post) => {\n   *   console.log(post.id); // 1234\n   * });\n   *\n   * @example\n   * // Listen for the \"add\" event on a collection\n   * store.on('add', (mapperName, records) => {\n   *   console.log(records); // [...]\n   * });\n   *\n   * @example\n   * // Listen for \"change\" events on a record\n   * store.on('change', (mapperName, record, changes) => {\n   *   console.log(changes); // { changed: { title: 'Modeling your data' } }\n   * });\n   * post.title = 'Modeling your data';\n   *\n   * @method SimpleStore#on\n   * @param {string} event Name of event to subsribe to.\n   * @param {Function} listener Listener function to handle the event.\n   * @param {*} [ctx] Optional content in which to invoke the listener.\n   */\n\n  /**\n   * Used to bind to events emitted by collections in this store.\n   *\n   * @method SimpleStore#_onCollectionEvent\n   * @private\n   * @param {string} name Name of the collection that emitted the event.\n   * @param {...*} [args] Args passed to {@link Collection#emit}.\n   */\n  _onCollectionEvent (name, ...args) {\n    const type = args.shift()\n    this.emit(type, name, ...args)\n  }\n\n  /**\n   * This method takes the data received from {@link SimpleStore#find},\n   * {@link SimpleStore#findAll}, {@link SimpleStore#update}, etc., and adds the\n   * data to the store. _You don't need to call this method directly._\n   *\n   * If you're using the http adapter and your response data is in an unexpected\n   * format, you may need to override this method so the right data gets added\n   * to the store.\n   *\n   * @example\n   * const store = new SimpleStore({\n   *   addToCache (mapperName, data, opts) {\n   *     // Let's say for a particular Resource, response data is in a weird format\n   *     if (name === 'comment') {\n   *       // Re-assign the variable to add the correct records into the stores\n   *       data = data.items;\n   *     }\n   *     // Now perform default behavior\n   *     return SimpleStore.prototype.addToCache.call(this, mapperName, data, opts);\n   *   }\n   * });\n   *\n   * @example\n   * // Extend using ES2015 class syntax.\n   * class MyStore extends SimpleStore {\n   *   addToCache (mapperName, data, opts) {\n   *     // Let's say for a particular Resource, response data is in a weird format\n   *     if (name === 'comment') {\n   *       // Re-assign the variable to add the correct records into the stores\n   *       data = data.items;\n   *     }\n   *     // Now perform default behavior\n   *     return super.addToCache(mapperName, data, opts);\n   *   }\n   * }\n   * const store = new MyStore();\n   *\n   * @method SimpleStore#addToCache\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {*} data Data from which data should be selected for add.\n   * @param {object} [opts] Configuration options.\n   */\n  addToCache (name, data, opts) {\n    return this.getCollection(name).add(data, opts)\n  }\n\n  /**\n   * Return the store scoped to a particular mapper/collection pair.\n   *\n   * @example <caption>SimpleStore.as</caption>\n   * const JSData = require('js-data');\n   * const { SimpleStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new SimpleStore();\n   * const UserMapper = store.defineMapper('user');\n   * const UserStore = store.as('user');\n   *\n   * const user1 = store.createRecord('user', { name: 'John' });\n   * const user2 = UserStore.createRecord({ name: 'John' });\n   * const user3 = UserMapper.createRecord({ name: 'John' });\n   * console.log(user1 === user2);\n   * console.log(user2 === user3);\n   * console.log(user1 === user3);\n   *\n   * @method SimpleStore#as\n   * @param {string} name Name of the {@link Mapper}.\n   * @returns {Object} The store, scoped to a particular Mapper/Collection pair.\n   * @since 3.0.0\n   */\n  as (name) {\n    const props: any = {}\n    const original = this\n    const methods = ownMethodsForScoping.concat(proxiedMapperMethods).concat(proxiedCollectionMethods)\n\n    methods.forEach(method => {\n      props[method] = {\n        writable: true,\n        value (...args) {\n          return original[method](name, ...args)\n        }\n      }\n    })\n    props.getMapper = {\n      writable: true,\n      value () {\n        return original.getMapper(name)\n      }\n    }\n    props.getCollection = {\n      writable: true,\n      value () {\n        return original.getCollection(name)\n      }\n    }\n    return Object.create(this, props)\n  }\n\n  /**\n   * Retrieve a cached `find` result, if any. This method is called during\n   * {@link SimpleStore#find} to determine if {@link Mapper#find} needs to be\n   * called. If this method returns `undefined` then {@link Mapper#find} will\n   * be called. Otherwise {@link SimpleStore#find} will immediately resolve with\n   * the return value of this method.\n   *\n   * When using {@link SimpleStore} in the browser, you can override this method\n   * to implement your own cache-busting strategy.\n   *\n   * @example\n   * const store = new SimpleStore({\n   *   cachedFind (mapperName, id, opts) {\n   *     // Let's say for a particular Resource, we always want to pull fresh from the server\n   *     if (mapperName === 'schedule') {\n   *       // Return undefined to trigger a Mapper#find call\n   *       return;\n   *     }\n   *     // Otherwise perform default behavior\n   *     return SimpleStore.prototype.cachedFind.call(this, mapperName, id, opts);\n   *   }\n   * });\n   *\n   * @example\n   * // Extend using ES2015 class syntax.\n   * class MyStore extends SimpleStore {\n   *   cachedFind (mapperName, id, opts) {\n   *     // Let's say for a particular Resource, we always want to pull fresh from the server\n   *     if (mapperName === 'schedule') {\n   *       // Return undefined to trigger a Mapper#find call\n   *       return;\n   *     }\n   *     // Otherwise perform default behavior\n   *     return super.cachedFind(mapperName, id, opts);\n   *   }\n   * }\n   * const store = new MyStore();\n   *\n   * @method SimpleStore#cachedFind\n   * @param {string} name The `name` argument passed to {@link SimpleStore#find}.\n   * @param {(string|number)} id The `id` argument passed to {@link SimpleStore#find}.\n   * @param {object} opts The `opts` argument passed to {@link SimpleStore#find}.\n   * @since 3.0.0\n   */\n  cachedFind = cachedFn\n\n  /**\n   * Retrieve a cached `findAll` result, if any. This method is called during\n   * {@link SimpleStore#findAll} to determine if {@link Mapper#findAll} needs to be\n   * called. If this method returns `undefined` then {@link Mapper#findAll} will\n   * be called. Otherwise {@link SimpleStore#findAll} will immediately resolve with\n   * the return value of this method.\n   *\n   * When using {@link SimpleStore} in the browser, you can override this method\n   * to implement your own cache-busting strategy.\n   *\n   * @example\n   * const store = new SimpleStore({\n   *   cachedFindAll (mapperName, hash, opts) {\n   *     // Let's say for a particular Resource, we always want to pull fresh from the server\n   *     if (mapperName === 'schedule') {\n   *       // Return undefined to trigger a Mapper#findAll call\n   *       return undefined;\n   *     }\n   *     // Otherwise perform default behavior\n   *     return SimpleStore.prototype.cachedFindAll.call(this, mapperName, hash, opts);\n   *   }\n   * });\n   *\n   * @example\n   * // Extend using ES2015 class syntax.\n   * class MyStore extends SimpleStore {\n   *   cachedFindAll (mapperName, hash, opts) {\n   *     // Let's say for a particular Resource, we always want to pull fresh from the server\n   *     if (mapperName === 'schedule') {\n   *       // Return undefined to trigger a Mapper#findAll call\n   *       return undefined;\n   *     }\n   *     // Otherwise perform default behavior\n   *     return super.cachedFindAll(mapperName, hash, opts);\n   *   }\n   * }\n   * const store = new MyStore();\n   *\n   * @method SimpleStore#cachedFindAll\n   * @param {string} name The `name` argument passed to {@link SimpleStore#findAll}.\n   * @param {string} hash The result of calling {@link SimpleStore#hashQuery} on\n   * the `query` argument passed to {@link SimpleStore#findAll}.\n   * @param {object} opts The `opts` argument passed to {@link SimpleStore#findAll}.\n   * @since 3.0.0\n   */\n  cachedFindAll = cachedFn\n\n  /**\n   * Mark a {@link Mapper#find} result as cached by adding an entry to\n   * {@link SimpleStore#_completedQueries}. By default, once a `find` entry is\n   * added it means subsequent calls to the same Resource with the same `id`\n   * argument will immediately resolve with the result of calling\n   * {@link SimpleStore#get} instead of delegating to {@link Mapper#find}.\n   *\n   * As part of implementing your own caching strategy, you may choose to\n   * override this method.\n   *\n   * @example\n   * const store = new SimpleStore({\n   *   cacheFind (mapperName, data, id, opts) {\n   *     // Let's say for a particular Resource, we always want to pull fresh from the server\n   *     if (mapperName === 'schedule') {\n   *       // Return without saving an entry to SimpleStore#_completedQueries\n   *       return;\n   *     }\n   *     // Otherwise perform default behavior\n   *     return SimpleStore.prototype.cacheFind.call(this, mapperName, data, id, opts);\n   *   }\n   * });\n   *\n   * @example\n   * // Extend using ES2015 class syntax.\n   * class MyStore extends SimpleStore {\n   *   cacheFind (mapperName, data, id, opts) {\n   *     // Let's say for a particular Resource, we always want to pull fresh from the server\n   *     if (mapperName === 'schedule') {\n   *       // Return without saving an entry to SimpleStore#_completedQueries\n   *       return;\n   *     }\n   *     // Otherwise perform default behavior\n   *     return super.cacheFind(mapperName, data, id, opts);\n   *   }\n   * }\n   * const store = new MyStore();\n   *\n   * @method SimpleStore#cacheFind\n   * @param {string} name The `name` argument passed to {@link SimpleStore#find}.\n   * @param {*} data The result to cache.\n   * @param {(string|number)} id The `id` argument passed to {@link SimpleStore#find}.\n   * @param {object} opts The `opts` argument passed to {@link SimpleStore#find}.\n   * @since 3.0.0\n   */\n  cacheFind (name, data, id, opts) {\n    this._completedQueries[name][id] = (name, id, opts) => this.get(name, id)\n  }\n\n  /**\n   * Mark a {@link Mapper#findAll} result as cached by adding an entry to\n   * {@link SimpleStore#_completedQueries}. By default, once a `findAll` entry is\n   * added it means subsequent calls to the same Resource with the same `query`\n   * argument will immediately resolve with the result of calling\n   * {@link SimpleStore#filter} instead of delegating to {@link Mapper#findAll}.\n   *\n   * As part of implementing your own caching strategy, you may choose to\n   * override this method.\n   *\n   * @example\n   * const store = new SimpleStore({\n   *   cachedFindAll (mapperName, data, hash, opts) {\n   *     // Let's say for a particular Resource, we always want to pull fresh from the server\n   *     if (mapperName === 'schedule') {\n   *       // Return without saving an entry to SimpleStore#_completedQueries\n   *       return;\n   *     }\n   *     // Otherwise perform default behavior.\n   *     return SimpleStore.prototype.cachedFindAll.call(this, mapperName, data, hash, opts);\n   *   }\n   * });\n   *\n   * @example\n   * // Extend using ES2015 class syntax.\n   * class MyStore extends SimpleStore {\n   *   cachedFindAll (mapperName, data, hash, opts) {\n   *     // Let's say for a particular Resource, we always want to pull fresh from the server\n   *     if (mapperName === 'schedule') {\n   *       // Return without saving an entry to SimpleStore#_completedQueries\n   *       return;\n   *     }\n   *     // Otherwise perform default behavior.\n   *     return super.cachedFindAll(mapperName, data, hash, opts);\n   *   }\n   * }\n   * const store = new MyStore();\n   *\n   * @method SimpleStore#cacheFindAll\n   * @param {string} name The `name` argument passed to {@link SimpleStore#findAll}.\n   * @param {*} data The result to cache.\n   * @param {string} hash The result of calling {@link SimpleStore#hashQuery} on\n   * the `query` argument passed to {@link SimpleStore#findAll}.\n   * @param {object} opts The `opts` argument passed to {@link SimpleStore#findAll}.\n   * @since 3.0.0\n   */\n  cacheFindAll (name, data, hash, opts) {\n    this._completedQueries[name][hash] = (name, hash, opts) => this.filter(name, utils.fromJson(hash))\n  }\n\n  /**\n   * Remove __all__ records from the in-memory store and reset\n   * {@link SimpleStore#_completedQueries}.\n   *\n   * @method SimpleStore#clear\n   * @returns {Object} Object containing all records that were in the store.\n   * @see SimpleStore#remove\n   * @see SimpleStore#removeAll\n   * @since 3.0.0\n   */\n  clear () {\n    const removed = {}\n    utils.forOwn(this._collections, (collection, name) => {\n      removed[name] = collection.removeAll()\n      this._completedQueries[name] = {}\n    })\n    return removed\n  }\n\n  /**\n   * Fired during {@link SimpleStore#create}. See\n   * {@link SimpleStore~beforeCreateListener} for how to listen for this event.\n   *\n   * @event SimpleStore#beforeCreate\n   * @see SimpleStore~beforeCreateListener\n   * @see SimpleStore#create\n   */\n  /**\n   * Callback signature for the {@link SimpleStore#event:beforeCreate} event.\n   *\n   * @example\n   * function onBeforeCreate (mapperName, props, opts) {\n   *   // do something\n   * }\n   * store.on('beforeCreate', onBeforeCreate);\n   *\n   * @callback SimpleStore~beforeCreateListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeCreate}.\n   * @param {object} props The `props` argument received by {@link Mapper#beforeCreate}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeCreate}.\n   * @see SimpleStore#event:beforeCreate\n   * @see SimpleStore#create\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link SimpleStore#create}. See\n   * {@link SimpleStore~afterCreateListener} for how to listen for this event.\n   *\n   * @event SimpleStore#afterCreate\n   * @see SimpleStore~afterCreateListener\n   * @see SimpleStore#create\n   */\n\n  /**\n   * Callback signature for the {@link SimpleStore#event:afterCreate} event.\n   *\n   * @example\n   * function onAfterCreate (mapperName, props, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterCreate', onAfterCreate);\n   *\n   * @callback SimpleStore~afterCreateListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterCreate}.\n   * @param {object} props The `props` argument received by {@link Mapper#afterCreate}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterCreate}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterCreate}.\n   * @see SimpleStore#event:afterCreate\n   * @see SimpleStore#create\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#create}. Adds the created record to the store.\n   *\n   * @example\n   * import { SimpleStore } from 'js-data';\n   * import { HttpAdapter } from 'js-data-http';\n   *\n   * const store = new SimpleStore();\n   * store.registerAdapter('http', new HttpAdapter(), { default: true });\n   *\n   * store.defineMapper('book');\n   *\n   * // Since this example uses the http adapter, we'll get something like:\n   * //\n   * //   POST /book {\"author_id\":1234,...}\n   * store.create('book', {\n   *   author_id: 1234,\n   *   edition: 'First Edition',\n   *   title: 'Respect your Data'\n   * }).then((book) => {\n   *   console.log(book.id); // 120392\n   *   console.log(book.title); // \"Respect your Data\"\n   * });\n   *\n   * @fires SimpleStore#beforeCreate\n   * @fires SimpleStore#afterCreate\n   * @fires SimpleStore#add\n   * @method SimpleStore#create\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {object} record Passed to {@link Mapper#create}.\n   * @param {object} [opts] Passed to {@link Mapper#create}. See\n   * {@link Mapper#create} for more configuration options.\n   * @returns {Promise} Resolves with the result of the create.\n   * @since 3.0.0\n   */\n  create (name, record, opts: any = {}) {\n    return super.create(name, record, opts).then(result => this._end(name, result, opts))\n  }\n\n  /**\n   * Fired during {@link SimpleStore#createMany}. See\n   * {@link SimpleStore~beforeCreateManyListener} for how to listen for this event.\n   *\n   * @event SimpleStore#beforeCreateMany\n   * @see SimpleStore~beforeCreateManyListener\n   * @see SimpleStore#createMany\n   */\n  /**\n   * Callback signature for the {@link SimpleStore#event:beforeCreateMany} event.\n   *\n   * @example\n   * function onBeforeCreateMany (mapperName, records, opts) {\n   *   // do something\n   * }\n   * store.on('beforeCreateMany', onBeforeCreateMany);\n   *\n   * @callback SimpleStore~beforeCreateManyListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeCreateMany}.\n   * @param {object} records The `records` argument received by {@link Mapper#beforeCreateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeCreateMany}.\n   * @see SimpleStore#event:beforeCreateMany\n   * @see SimpleStore#createMany\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link SimpleStore#createMany}. See\n   * {@link SimpleStore~afterCreateManyListener} for how to listen for this event.\n   *\n   * @event SimpleStore#afterCreateMany\n   * @see SimpleStore~afterCreateManyListener\n   * @see SimpleStore#createMany\n   */\n\n  /**\n   * Callback signature for the {@link SimpleStore#event:afterCreateMany} event.\n   *\n   * @example\n   * function onAfterCreateMany (mapperName, records, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterCreateMany', onAfterCreateMany);\n   *\n   * @callback SimpleStore~afterCreateManyListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterCreateMany}.\n   * @param {object} records The `records` argument received by {@link Mapper#afterCreateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterCreateMany}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterCreateMany}.\n   * @see SimpleStore#event:afterCreateMany\n   * @see SimpleStore#createMany\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#createMany}. Adds the created records to the\n   * store.\n   *\n   * @example\n   * import { SimpleStore } from 'js-data';\n   * import { HttpAdapter } from 'js-data-http';\n   *\n   * const store = new SimpleStore();\n   * store.registerAdapter('http', new HttpAdapter(), { default: true });\n   *\n   * store.defineMapper('book');\n   *\n   * // Since this example uses the http adapter, we'll get something like:\n   * //\n   * //   POST /book [{\"author_id\":1234,...},{...}]\n   * store.createMany('book', [{\n   *   author_id: 1234,\n   *   edition: 'First Edition',\n   *   title: 'Respect your Data'\n   * }, {\n   *   author_id: 1234,\n   *   edition: 'Second Edition',\n   *   title: 'Respect your Data'\n   * }]).then((books) => {\n   *   console.log(books[0].id); // 142394\n   *   console.log(books[0].title); // \"Respect your Data\"\n   * });\n   *\n   * @fires SimpleStore#beforeCreateMany\n   * @fires SimpleStore#afterCreateMany\n   * @fires SimpleStore#add\n   * @method SimpleStore#createMany\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {array} records Passed to {@link Mapper#createMany}.\n   * @param {object} [opts] Passed to {@link Mapper#createMany}. See\n   * {@link Mapper#createMany} for more configuration options.\n   * @returns {Promise} Resolves with the result of the create.\n   * @since 3.0.0\n   */\n  createMany (name, records, opts: any = {}) {\n    return super.createMany(name, records, opts).then(result => this._end(name, result, opts))\n  }\n\n  defineMapper (name, opts: MapperOpts = {}) {\n    const self = this\n    const mapper = super.defineMapper(name, opts)\n    self._pendingQueries[name] = {}\n    self._completedQueries[name] = {}\n    if (!mapper.relationList) Object.defineProperty(mapper, 'relationList', { value: [] })\n\n    const collectionOpts: any = {\n      // Make sure the collection has somewhere to store \"added\" timestamps\n      _added: {},\n      // Give the collection a reference to this SimpleStore\n      datastore: this,\n      // The mapper tied to the collection\n      mapper\n    }\n\n    if (opts && 'onConflict' in opts) {\n      collectionOpts.onConflict = opts.onConflict\n    }\n\n    // The SimpleStore uses a subclass of Collection that is \"SimpleStore-aware\"\n    const collection = (self._collections[name] = new self.collectionClass(null, collectionOpts))\n\n    const schema = mapper.schema || ({} as Schema)\n    const properties = schema.properties || {}\n    // TODO: Make it possible index nested properties?\n    utils.forOwn(properties, (opts, prop) => {\n      if (opts.indexed) {\n        collection.createIndex(prop)\n      }\n    })\n\n    // Create a secondary index on the \"added\" timestamps of records in the\n    // collection\n    collection.createIndex('addedTimestamps', ['$'], {\n      fieldGetter (obj) {\n        return collection._added[collection.recordId(obj)]\n      }\n    })\n\n    collection.on('all', (...args) => {\n      self._onCollectionEvent(name, ...args)\n    })\n\n    return mapper\n  }\n\n  /**\n   * Fired during {@link SimpleStore#destroy}. See\n   * {@link SimpleStore~beforeDestroyListener} for how to listen for this event.\n   *\n   * @event SimpleStore#beforeDestroy\n   * @see SimpleStore~beforeDestroyListener\n   * @see SimpleStore#destroy\n   */\n  /**\n   * Callback signature for the {@link SimpleStore#event:beforeDestroy} event.\n   *\n   * @example\n   * function onBeforeDestroy (mapperName, id, opts) {\n   *   // do something\n   * }\n   * store.on('beforeDestroy', onBeforeDestroy);\n   *\n   * @callback SimpleStore~beforeDestroyListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeDestroy}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#beforeDestroy}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeDestroy}.\n   * @see SimpleStore#event:beforeDestroy\n   * @see SimpleStore#destroy\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link SimpleStore#destroy}. See\n   * {@link SimpleStore~afterDestroyListener} for how to listen for this event.\n   *\n   * @event SimpleStore#afterDestroy\n   * @see SimpleStore~afterDestroyListener\n   * @see SimpleStore#destroy\n   */\n\n  /**\n   * Callback signature for the {@link SimpleStore#event:afterDestroy} event.\n   *\n   * @example\n   * function onAfterDestroy (mapperName, id, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterDestroy', onAfterDestroy);\n   *\n   * @callback SimpleStore~afterDestroyListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterDestroy}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#afterDestroy}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterDestroy}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterDestroy}.\n   * @see SimpleStore#event:afterDestroy\n   * @see SimpleStore#destroy\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#destroy}. Removes any destroyed record from the\n   * in-memory store. Clears out any {@link SimpleStore#_completedQueries} entries\n   * associated with the provided `id`.\n   *\n   * @example\n   * import { SimpleStore } from 'js-data';\n   * import { HttpAdapter } from 'js-data-http';\n   *\n   * const store = new SimpleStore();\n   * store.registerAdapter('http', new HttpAdapter(), { default: true });\n   *\n   * store.defineMapper('book');\n   *\n   * store.add('book', { id: 1234, title: 'Data Management is Hard' });\n   *\n   * // Since this example uses the http adapter, we'll get something like:\n   * //\n   * //   DELETE /book/1234\n   * store.destroy('book', 1234).then(() => {\n   *   // The book record is no longer in the in-memory store\n   *   console.log(store.get('book', 1234)); // undefined\n   *\n   *   return store.find('book', 1234);\n   * }).then((book) {\n   *   // The book was deleted from the database too\n   *   console.log(book); // undefined\n   * });\n   *\n   * @fires SimpleStore#beforeDestroy\n   * @fires SimpleStore#afterDestroy\n   * @fires SimpleStore#remove\n   * @method SimpleStore#destroy\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {(string|number)} id Passed to {@link Mapper#destroy}.\n   * @param {object} [opts] Passed to {@link Mapper#destroy}. See\n   * {@link Mapper#destroy} for more configuration options.\n   * @returns {Promise} Resolves when the destroy operation completes.\n   * @since 3.0.0\n   */\n  destroy (name, id, opts: any = {}) {\n    return super.destroy(name, id, opts).then(result => {\n      const record = this.getCollection(name).remove(id, opts)\n\n      if (opts.raw) {\n        result.data = record\n      } else {\n        result = record\n      }\n      delete this._pendingQueries[name][id]\n      delete this._completedQueries[name][id]\n      return result\n    })\n  }\n\n  /**\n   * Fired during {@link SimpleStore#destroyAll}. See\n   * {@link SimpleStore~beforeDestroyAllListener} for how to listen for this event.\n   *\n   * @event SimpleStore#beforeDestroyAll\n   * @see SimpleStore~beforeDestroyAllListener\n   * @see SimpleStore#destroyAll\n   */\n  /**\n   * Callback signature for the {@link SimpleStore#event:beforeDestroyAll} event.\n   *\n   * @example\n   * function onBeforeDestroyAll (mapperName, query, opts) {\n   *   // do something\n   * }\n   * store.on('beforeDestroyAll', onBeforeDestroyAll);\n   *\n   * @callback SimpleStore~beforeDestroyAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeDestroyAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#beforeDestroyAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeDestroyAll}.\n   * @see SimpleStore#event:beforeDestroyAll\n   * @see SimpleStore#destroyAll\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link SimpleStore#destroyAll}. See\n   * {@link SimpleStore~afterDestroyAllListener} for how to listen for this event.\n   *\n   * @event SimpleStore#afterDestroyAll\n   * @see SimpleStore~afterDestroyAllListener\n   * @see SimpleStore#destroyAll\n   */\n\n  /**\n   * Callback signature for the {@link SimpleStore#event:afterDestroyAll} event.\n   *\n   * @example\n   * function onAfterDestroyAll (mapperName, query, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterDestroyAll', onAfterDestroyAll);\n   *\n   * @callback SimpleStore~afterDestroyAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterDestroyAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#afterDestroyAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterDestroyAll}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterDestroyAll}.\n   * @see SimpleStore#event:afterDestroyAll\n   * @see SimpleStore#destroyAll\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#destroyAll}. Removes any destroyed records from\n   * the in-memory store.\n   *\n   * @example\n   * import { SimpleStore } from 'js-data';\n   * import { HttpAdapter } from 'js-data-http';\n   *\n   * const store = new SimpleStore();\n   * store.registerAdapter('http', new HttpAdapter(), { default: true });\n   *\n   * store.defineMapper('book');\n   *\n   * store.add('book', { id: 1234, title: 'Data Management is Hard' });\n   *\n   * // Since this example uses the http adapter, we'll get something like:\n   * //\n   * //   DELETE /book/1234\n   * store.destroy('book', 1234).then(() => {\n   *   // The book record is gone from the in-memory store\n   *   console.log(store.get('book', 1234)); // undefined\n   *   return store.find('book', 1234);\n   * }).then((book) {\n   *   // The book was deleted from the database too\n   *   console.log(book); // undefined\n   * });\n   *\n   * @fires SimpleStore#beforeDestroyAll\n   * @fires SimpleStore#afterDestroyAll\n   * @fires SimpleStore#remove\n   * @method SimpleStore#destroyAll\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {object} [query] Passed to {@link Mapper#destroyAll}.\n   * @param {object} [opts] Passed to {@link Mapper#destroyAll}. See\n   * {@link Mapper#destroyAll} for more configuration options.\n   * @returns {Promise} Resolves when the delete completes.\n   * @since 3.0.0\n   */\n  destroyAll (name, query, opts: any = {}) {\n    return super.destroyAll(name, query, opts).then(result => {\n      const records = this.getCollection(name).removeAll(query, opts)\n\n      if (opts.raw) {\n        result.data = records\n      } else {\n        result = records\n      }\n      const hash = this.hashQuery(name, query, opts)\n      delete this._pendingQueries[name][hash]\n      delete this._completedQueries[name][hash]\n      return result\n    })\n  }\n\n  eject (name, id, opts) {\n    console.warn('DEPRECATED: \"eject\" is deprecated, use \"remove\" instead')\n    return this.remove(name, id, opts)\n  }\n\n  ejectAll (name, query, opts) {\n    console.warn('DEPRECATED: \"ejectAll\" is deprecated, use \"removeAll\" instead')\n    return this.removeAll(name, query, opts)\n  }\n\n  /**\n   * Fired during {@link SimpleStore#find}. See\n   * {@link SimpleStore~beforeFindListener} for how to listen for this event.\n   *\n   * @event SimpleStore#beforeFind\n   * @see SimpleStore~beforeFindListener\n   * @see SimpleStore#find\n   */\n  /**\n   * Callback signature for the {@link SimpleStore#event:beforeFind} event.\n   *\n   * @example\n   * function onBeforeFind (mapperName, id, opts) {\n   *   // do something\n   * }\n   * store.on('beforeFind', onBeforeFind);\n   *\n   * @callback SimpleStore~beforeFindListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeFind}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#beforeFind}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeFind}.\n   * @see SimpleStore#event:beforeFind\n   * @see SimpleStore#find\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link SimpleStore#find}. See\n   * {@link SimpleStore~afterFindListener} for how to listen for this event.\n   *\n   * @event SimpleStore#afterFind\n   * @see SimpleStore~afterFindListener\n   * @see SimpleStore#find\n   */\n\n  /**\n   * Callback signature for the {@link SimpleStore#event:afterFind} event.\n   *\n   * @example\n   * function onAfterFind (mapperName, id, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterFind', onAfterFind);\n   *\n   * @callback SimpleStore~afterFindListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterFind}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#afterFind}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterFind}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterFind}.\n   * @see SimpleStore#event:afterFind\n   * @see SimpleStore#find\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#find}. Adds any found record to the store.\n   *\n   * @example\n   * import { SimpleStore } from 'js-data';\n   * import { HttpAdapter } from 'js-data-http';\n   *\n   * const store = new SimpleStore();\n   * store.registerAdapter('http', new HttpAdapter(), { default: true });\n   *\n   * store.defineMapper('book');\n   *\n   * // Since this example uses the http adapter, we'll get something like:\n   * //\n   * //   GET /book/1234\n   * store.find('book', 1234).then((book) => {\n   *   // The book record is now in the in-memory store\n   *   console.log(store.get('book', 1234) === book); // true\n   * });\n   *\n   * @fires SimpleStore#beforeFind\n   * @fires SimpleStore#afterFind\n   * @fires SimpleStore#add\n   * @method SimpleStore#find\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {(string|number)} id Passed to {@link Mapper#find}.\n   * @param {object} [opts] Passed to {@link Mapper#find}.\n   * @param {boolean} [opts.force] Bypass cacheFind\n   * @param {boolean|Function} [opts.usePendingFind] See {@link SimpleStore#usePendingFind}\n   * @returns {Promise} Resolves with the result, if any.\n   * @since 3.0.0\n   */\n  find (name, id, opts: any = {}) {\n    const mapper = this.getMapper(name)\n    const pendingQuery = this._pendingQueries[name][id]\n    const usePendingFind = opts.usePendingFind === undefined ? this.usePendingFind : opts.usePendingFind\n    utils._(opts, mapper)\n\n    if (\n      pendingQuery &&\n      (utils.isFunction(usePendingFind) ? usePendingFind.call(this, name, id, opts) : usePendingFind)\n    ) {\n      return pendingQuery\n    }\n    const item = this.cachedFind(name, id, opts)\n\n    if (opts.force || !item) {\n      const promise = (this._pendingQueries[name][id] = super.find(name, id, opts))\n      return promise.then(\n        result => {\n          delete this._pendingQueries[name][id]\n          result = this._end(name, result, opts)\n          this.cacheFind(name, result, id, opts)\n          return result\n        },\n        err => {\n          delete this._pendingQueries[name][id]\n          return utils.reject(err)\n        }\n      )\n    }\n\n    return utils.resolve(item)\n  }\n\n  /**\n   * Fired during {@link SimpleStore#findAll}. See\n   * {@link SimpleStore~beforeFindAllListener} for how to listen for this event.\n   *\n   * @event SimpleStore#beforeFindAll\n   * @see SimpleStore~beforeFindAllListener\n   * @see SimpleStore#findAll\n   */\n  /**\n   * Callback signature for the {@link SimpleStore#event:beforeFindAll} event.\n   *\n   * @example\n   * function onBeforeFindAll (mapperName, query, opts) {\n   *   // do something\n   * }\n   * store.on('beforeFindAll', onBeforeFindAll);\n   *\n   * @callback SimpleStore~beforeFindAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeFindAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#beforeFindAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeFindAll}.\n   * @see SimpleStore#event:beforeFindAll\n   * @see SimpleStore#findAll\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link SimpleStore#findAll}. See\n   * {@link SimpleStore~afterFindAllListener} for how to listen for this event.\n   *\n   * @event SimpleStore#afterFindAll\n   * @see SimpleStore~afterFindAllListener\n   * @see SimpleStore#findAll\n   */\n\n  /**\n   * Callback signature for the {@link SimpleStore#event:afterFindAll} event.\n   *\n   * @example\n   * function onAfterFindAll (mapperName, query, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterFindAll', onAfterFindAll);\n   *\n   * @callback SimpleStore~afterFindAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterFindAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#afterFindAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterFindAll}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterFindAll}.\n   * @see SimpleStore#event:afterFindAll\n   * @see SimpleStore#findAll\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#findAll}. Adds any found records to the store.\n   *\n   * @example\n   * import { SimpleStore } from 'js-data';\n   * import { HttpAdapter } from 'js-data-http';\n   *\n   * const store = new SimpleStore();\n   * store.registerAdapter('http', new HttpAdapter(), { default: true });\n   *\n   * store.defineMapper('movie');\n   *\n   * // Since this example uses the http adapter, we'll get something like:\n   * //\n   * //   GET /movie?rating=PG\n   * store.find('movie', { rating: 'PG' }).then((movies) => {\n   *   // The movie records are now in the in-memory store\n   *   console.log(store.filter('movie'));\n   * });\n   *\n   * @fires SimpleStore#beforeFindAll\n   * @fires SimpleStore#afterFindAll\n   * @fires SimpleStore#add\n   * @method SimpleStore#findAll\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {object} [query] Passed to {@link Mapper.findAll}.\n   * @param {object} [opts] Passed to {@link Mapper.findAll}.\n   * @param {boolean} [opts.force] Bypass cacheFindAll\n   * @param {boolean|Function} [opts.usePendingFindAll] See {@link SimpleStore#usePendingFindAll}\n   * @returns {Promise} Resolves with the result, if any.\n   * @since 3.0.0\n   */\n  findAll (name, query, opts: any = {}) {\n    const mapper = this.getMapper(name)\n    const hash = this.hashQuery(name, query, opts)\n    const pendingQuery = this._pendingQueries[name][hash]\n    const usePendingFindAll = opts.usePendingFindAll === undefined ? this.usePendingFindAll : opts.usePendingFindAll\n    utils._(opts, mapper)\n\n    if (\n      pendingQuery &&\n      (utils.isFunction(usePendingFindAll) ? usePendingFindAll.call(this, name, query, opts) : usePendingFindAll)\n    ) {\n      return pendingQuery\n    }\n\n    const items = this.cachedFindAll(name, hash, opts)\n\n    if (opts.force || !items) {\n      const promise = (this._pendingQueries[name][hash] = super.findAll(name, query, opts))\n      return promise.then(\n        result => {\n          delete this._pendingQueries[name][hash]\n          result = this._end(name, result, opts)\n          this.cacheFindAll(name, result, hash, opts)\n          return result\n        },\n        err => {\n          delete this._pendingQueries[name][hash]\n          return utils.reject(err)\n        }\n      )\n    }\n\n    return utils.resolve(items)\n  }\n\n  /**\n   * Return the {@link Collection} with the given name, if for some\n   * reason you need a direct reference to the collection.\n   *\n   * @param {string} name Name of the {@link Collection} to retrieve.\n   * @since 3.0.0\n   * @throws {Error} Thrown if the specified {@link Collection} does not\n   * exist.\n   */\n  getCollection (name): Collection {\n    const collection = this._collections[name]\n    if (!collection) {\n      throw utils.err(`${DOMAIN}#getCollection`, name)(404, 'collection')\n    }\n    return collection\n  }\n\n  /**\n   * Hashing function used to cache {@link SimpleStore#find} and\n   * {@link SimpleStore#findAll} requests. This method simply JSONifies the\n   * `query` argument passed to {@link SimpleStore#find} or\n   * {@link SimpleStore#findAll}.\n   *\n   * Override this method for custom hashing behavior.\n   * @method SimpleStore#hashQuery\n   * @param {string} name The `name` argument passed to {@link SimpleStore#find}\n   * or {@link SimpleStore#findAll}.\n   * @param {object} query The `query` argument passed to {@link SimpleStore#find}\n   * or {@link SimpleStore#findAll}.\n   * @returns {string} The JSONified `query`.\n   * @since 3.0.0\n   */\n  hashQuery (name, query, opts) {\n    return utils.toJson(query || {})\n  }\n\n  inject (name, records, opts) {\n    console.warn('DEPRECATED: \"inject\" is deprecated, use \"add\" instead')\n    return this.add(name, records, opts)\n  }\n\n  /**\n   * Wrapper for {@link Collection#remove}. Removes the specified\n   * {@link Record} from the store.\n   *\n   * @example <caption>SimpleStore#remove</caption>\n   * const JSData = require('js-data');\n   * const { SimpleStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new SimpleStore();\n   * store.defineMapper('book');\n   * console.log(store.getAll('book').length);\n   * store.add('book', { id: 1234 });\n   * console.log(store.getAll('book').length);\n   * store.remove('book', 1234);\n   * console.log(store.getAll('book').length);\n   *\n   * @fires SimpleStore#remove\n   * @method SimpleStore#remove\n   * @param {string} name The name of the {@link Collection} to target.\n   * @param {string|number} id The primary key of the {@link Record} to remove.\n   * @param {object} [opts] Configuration options.\n   * @param {string[]} [opts.with] Relations of the {@link Record} to also\n   * remove from the store.\n   * @returns {Record} The removed {@link Record}, if any.\n   * @see Collection#add\n   * @see Collection#add\n   * @since 3.0.0\n   */\n  remove (name, id, opts?) {\n    const record = this.getCollection(name).remove(id, opts)\n    if (record) {\n      this.removeRelated(name, [record], opts)\n    }\n    return record\n  }\n\n  /**\n   * Wrapper for {@link Collection#removeAll}. Removes the selected\n   * {@link Record}s from the store.\n   *\n   * @example <caption>SimpleStore#removeAll</caption>\n   * const JSData = require('js-data');\n   * const { SimpleStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new SimpleStore();\n   * store.defineMapper('movie');\n   * console.log(store.getAll('movie').length);\n   * store.add('movie', [{ id: 3, rating: 'R' }, { id: 4, rating: 'PG-13' });\n   * console.log(store.getAll('movie').length);\n   * store.removeAll('movie', { rating: 'R' });\n   * console.log(store.getAll('movie').length);\n   *\n   * @fires SimpleStore#remove\n   * @method SimpleStore#removeAll\n   * @param {string} name The name of the {@link Collection} to target.\n   * @param {object} [query={}] Selection query. See {@link query}.\n   * @param {object} [query.where] See {@link query.where}.\n   * @param {number} [query.offset] See {@link query.offset}.\n   * @param {number} [query.limit] See {@link query.limit}.\n   * @param {string|Array[]} [query.orderBy] See {@link query.orderBy}.\n   * @param {object} [opts] Configuration options.\n   * @param {string[]} [opts.with] Relations of the {@link Record} to also\n   * remove from the store.\n   * @returns {Record} The removed {@link Record}s, if any.\n   * @see Collection#add\n   * @see Collection#add\n   * @since 3.0.0\n   */\n  removeAll (name, query, opts) {\n    if (!query || !Object.keys(query).length) {\n      this._completedQueries[name] = {}\n    } else {\n      this._completedQueries[name][this.hashQuery(name, query, opts)] = undefined\n    }\n    const records = this.getCollection(name).removeAll(query, opts)\n    if (records.length) {\n      this.removeRelated(name, records, opts)\n    }\n    return records\n  }\n\n  /**\n   * Remove from the store {@link Record}s that are related to the provided\n   * {@link Record}(s).\n   *\n   * @fires SimpleStore#remove\n   * @method SimpleStore#removeRelated\n   * @param {string} name The name of the {@link Collection} to target.\n   * @param {Record|Record[]} records {@link Record}s whose relations are to be\n   * removed.\n   * @param {object} [opts] Configuration options.\n   * @param {string[]} [opts.with] Relations of the {@link Record}(s) to remove\n   * from the store.\n   * @since 3.0.0\n   */\n  removeRelated (name, records, opts) {\n    if (!utils.isArray(records)) {\n      records = [records]\n    }\n    utils.forEachRelation(this.getMapper(name), opts, (def, optsCopy) => {\n      records.forEach(record => {\n        let relatedData\n        let query\n        if (def.foreignKey && (def.type === hasOneType || def.type === hasManyType)) {\n          query = { [def.foreignKey]: def.getForeignKey(record) }\n        } else if (def.type === hasManyType && def.localKeys) {\n          query = {\n            where: {\n              [def.getRelation().idAttribute]: {\n                in: utils.get(record, def.localKeys)\n              }\n            }\n          }\n        } else if (def.type === hasManyType && def.foreignKeys) {\n          query = {\n            where: {\n              [def.foreignKeys]: {\n                contains: def.getForeignKey(record)\n              }\n            }\n          }\n        } else if (def.type === belongsToType) {\n          relatedData = this.remove(def.relation, def.getForeignKey(record), optsCopy)\n        }\n        if (query) {\n          relatedData = this.removeAll(def.relation, query, optsCopy)\n        }\n        if (relatedData) {\n          if (utils.isArray(relatedData) && !relatedData.length) {\n            return\n          }\n          if (def.type === hasOneType) {\n            relatedData = relatedData[0]\n          }\n          def.setLocalField(record, relatedData)\n        }\n      })\n    })\n  }\n\n  /**\n   * Fired during {@link SimpleStore#update}. See\n   * {@link SimpleStore~beforeUpdateListener} for how to listen for this event.\n   *\n   * @event SimpleStore#beforeUpdate\n   * @see SimpleStore~beforeUpdateListener\n   * @see SimpleStore#update\n   */\n  /**\n   * Callback signature for the {@link SimpleStore#event:beforeUpdate} event.\n   *\n   * @example\n   * function onBeforeUpdate (mapperName, id, props, opts) {\n   *   // do something\n   * }\n   * store.on('beforeUpdate', onBeforeUpdate);\n   *\n   * @callback SimpleStore~beforeUpdateListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeUpdate}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#beforeUpdate}.\n   * @param {object} props The `props` argument received by {@link Mapper#beforeUpdate}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeUpdate}.\n   * @see SimpleStore#event:beforeUpdate\n   * @see SimpleStore#update\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link SimpleStore#update}. See\n   * {@link SimpleStore~afterUpdateListener} for how to listen for this event.\n   *\n   * @event SimpleStore#afterUpdate\n   * @see SimpleStore~afterUpdateListener\n   * @see SimpleStore#update\n   */\n\n  /**\n   * Callback signature for the {@link SimpleStore#event:afterUpdate} event.\n   *\n   * @example\n   * function onAfterUpdate (mapperName, id, props, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterUpdate', onAfterUpdate);\n   *\n   * @callback SimpleStore~afterUpdateListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterUpdate}.\n   * @param {string|number} id The `id` argument received by {@link Mapper#afterUpdate}.\n   * @param {object} props The `props` argument received by {@link Mapper#afterUpdate}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterUpdate}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterUpdate}.\n   * @see SimpleStore#event:afterUpdate\n   * @see SimpleStore#update\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#update}. Adds the updated {@link Record} to the\n   * store.\n   *\n   * @example\n   * import { SimpleStore } from 'js-data';\n   * import { HttpAdapter } from 'js-data-http';\n   *\n   * const store = new SimpleStore();\n   * store.registerAdapter('http', new HttpAdapter(), { default: true });\n   *\n   * store.defineMapper('post');\n   *\n   * // Since this example uses the http adapter, we'll get something like:\n   * //\n   * //   PUT /post/1234 {\"status\":\"published\"}\n   * store.update('post', 1, { status: 'published' }).then((post) => {\n   *   // The post record has also been updated in the in-memory store\n   *   console.log(store.get('post', 1234));\n   * });\n   *\n   * @fires SimpleStore#beforeUpdate\n   * @fires SimpleStore#afterUpdate\n   * @fires SimpleStore#add\n   * @method SimpleStore#update\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {(string|number)} id Passed to {@link Mapper#update}.\n   * @param {object} record Passed to {@link Mapper#update}.\n   * @param {object} [opts] Passed to {@link Mapper#update}. See\n   * {@link Mapper#update} for more configuration options.\n   * @returns {Promise} Resolves with the result of the update.\n   * @since 3.0.0\n   */\n  update (name, id, record, opts: any = {}) {\n    return super.update(name, id, record, opts).then(result => this._end(name, result, opts))\n  }\n\n  /**\n   * Fired during {@link SimpleStore#updateAll}. See\n   * {@link SimpleStore~beforeUpdateAllListener} for how to listen for this event.\n   *\n   * @event SimpleStore#beforeUpdateAll\n   * @see SimpleStore~beforeUpdateAllListener\n   * @see SimpleStore#updateAll\n   */\n  /**\n   * Callback signature for the {@link SimpleStore#event:beforeUpdateAll} event.\n   *\n   * @example\n   * function onBeforeUpdateAll (mapperName, props, query, opts) {\n   *   // do something\n   * }\n   * store.on('beforeUpdateAll', onBeforeUpdateAll);\n   *\n   * @callback SimpleStore~beforeUpdateAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeUpdateAll}.\n   * @param {object} props The `props` argument received by {@link Mapper#beforeUpdateAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#beforeUpdateAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeUpdateAll}.\n   * @see SimpleStore#event:beforeUpdateAll\n   * @see SimpleStore#updateAll\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link SimpleStore#updateAll}. See\n   * {@link SimpleStore~afterUpdateAllListener} for how to listen for this event.\n   *\n   * @event SimpleStore#afterUpdateAll\n   * @see SimpleStore~afterUpdateAllListener\n   * @see SimpleStore#updateAll\n   */\n\n  /**\n   * Callback signature for the {@link SimpleStore#event:afterUpdateAll} event.\n   *\n   * @example\n   * function onAfterUpdateAll (mapperName, props, query, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterUpdateAll', onAfterUpdateAll);\n   *\n   * @callback SimpleStore~afterUpdateAllListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} props The `props` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} query The `query` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterUpdateAll}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterUpdateAll}.\n   * @see SimpleStore#event:afterUpdateAll\n   * @see SimpleStore#updateAll\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#updateAll}. Adds the updated {@link Record}s to\n   * the store.\n   *\n   * @example\n   * import { SimpleStore } from 'js-data';\n   * import { HttpAdapter } from 'js-data-http';\n   *\n   * const store = new SimpleStore();\n   * store.registerAdapter('http', new HttpAdapter(), { default: true });\n   *\n   * store.defineMapper('post');\n   *\n   * // Since this example uses the http adapter, we'll get something like:\n   * //\n   * //   PUT /post?author_id=1234 {\"status\":\"published\"}\n   * store.updateAll('post', { author_id: 1234 }, { status: 'published' }).then((posts) => {\n   *   // The post records have also been updated in the in-memory store\n   *   console.log(store.filter('posts', { author_id: 1234 }));\n   * });\n   *\n   * @fires SimpleStore#beforeUpdateAll\n   * @fires SimpleStore#afterUpdateAll\n   * @fires SimpleStore#add\n   * @method SimpleStore#updateAll\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {object} props Passed to {@link Mapper#updateAll}.\n   * @param {object} [query] Passed to {@link Mapper#updateAll}.\n   * @param {object} [opts] Passed to {@link Mapper#updateAll}. See\n   * {@link Mapper#updateAll} for more configuration options.\n   * @returns {Promise} Resolves with the result of the update.\n   * @since 3.0.0\n   */\n  updateAll (name, props, query, opts: any = {}) {\n    return super.updateAll(name, props, query, opts).then(result => this._end(name, result, opts))\n  }\n\n  /**\n   * Fired during {@link SimpleStore#updateMany}. See\n   * {@link SimpleStore~beforeUpdateManyListener} for how to listen for this event.\n   *\n   * @event SimpleStore#beforeUpdateMany\n   * @see SimpleStore~beforeUpdateManyListener\n   * @see SimpleStore#updateMany\n   */\n  /**\n   * Callback signature for the {@link SimpleStore#event:beforeUpdateMany} event.\n   *\n   * @example\n   * function onBeforeUpdateMany (mapperName, records, opts) {\n   *   // do something\n   * }\n   * store.on('beforeUpdateMany', onBeforeUpdateMany);\n   *\n   * @callback SimpleStore~beforeUpdateManyListener\n   * @param {string} name The `name` argument received by {@link Mapper#beforeUpdateMany}.\n   * @param {object} records The `records` argument received by {@link Mapper#beforeUpdateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#beforeUpdateMany}.\n   * @see SimpleStore#event:beforeUpdateMany\n   * @see SimpleStore#updateMany\n   * @since 3.0.0\n   */\n  /**\n   * Fired during {@link SimpleStore#updateMany}. See\n   * {@link SimpleStore~afterUpdateManyListener} for how to listen for this event.\n   *\n   * @event SimpleStore#afterUpdateMany\n   * @see SimpleStore~afterUpdateManyListener\n   * @see SimpleStore#updateMany\n   */\n\n  /**\n   * Callback signature for the {@link SimpleStore#event:afterUpdateMany} event.\n   *\n   * @example\n   * function onAfterUpdateMany (mapperName, records, opts, result) {\n   *   // do something\n   * }\n   * store.on('afterUpdateMany', onAfterUpdateMany);\n   *\n   * @callback SimpleStore~afterUpdateManyListener\n   * @param {string} name The `name` argument received by {@link Mapper#afterUpdateMany}.\n   * @param {object} records The `records` argument received by {@link Mapper#afterUpdateMany}.\n   * @param {object} opts The `opts` argument received by {@link Mapper#afterUpdateMany}.\n   * @param {object} result The `result` argument received by {@link Mapper#afterUpdateMany}.\n   * @see SimpleStore#event:afterUpdateMany\n   * @see SimpleStore#updateMany\n   * @since 3.0.0\n   */\n  /**\n   * Wrapper for {@link Mapper#updateMany}. Adds the updated {@link Record}s to\n   * the store.\n   *\n   * @example\n   * import { SimpleStore } from 'js-data';\n   * import { HttpAdapter } from 'js-data-http';\n   *\n   * const store = new SimpleStore();\n   * store.registerAdapter('http', new HttpAdapter(), { default: true });\n   *\n   * store.defineMapper('post');\n   *\n   * // Since this example uses the http adapter, we'll get something like:\n   * //\n   * //   PUT /post [{\"id\":3,status\":\"published\"},{\"id\":4,status\":\"published\"}]\n   * store.updateMany('post', [\n   *   { id: 3, status: 'published' },\n   *   { id: 4, status: 'published' }\n   * ]).then((posts) => {\n   *   // The post records have also been updated in the in-memory store\n   *   console.log(store.getAll('post', 3, 4));\n   * });\n   *\n   * @fires SimpleStore#beforeUpdateMany\n   * @fires SimpleStore#afterUpdateMany\n   * @fires SimpleStore#add\n   * @method SimpleStore#updateMany\n   * @param {string} name Name of the {@link Mapper} to target.\n   * @param {(Object[]|Record[])} records Passed to {@link Mapper#updateMany}.\n   * @param {object} [opts] Passed to {@link Mapper#updateMany}. See\n   * {@link Mapper#updateMany} for more configuration options.\n   * @returns {Promise} Resolves with the result of the update.\n   * @since 3.0.0\n   */\n  updateMany (name, records, opts: any = {}) {\n    return super.updateMany(name, records, opts).then(result => this._end(name, result, opts))\n  }\n\n  /**\n   * Wrapper for {@link Collection#add}.\n   *\n   * @example <caption>SimpleStore#add</caption>\n   * const JSData = require('js-data');\n   * const { SimpleStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new SimpleStore();\n   * store.defineMapper('book');\n   *\n   * // Add one book to the in-memory store:\n   * store.add('book', { id: 1, title: 'Respect your Data' });\n   * // Add multiple books to the in-memory store:\n   * store.add('book', [\n   *   { id: 2, title: 'Easy data recipes' },\n   *   { id: 3, title: 'Active Record 101' }\n   * ]);\n   *\n   * @fires SimpleStore#add\n   * @method SimpleStore#add\n   * @param {(string|number)} name Name of the {@link Mapper} to target.\n   * @param {(Object|Object[]|Record|Record[])} records See {@link Collection#add}.\n   * @param {object} [opts] Configuration options. See {@link Collection#add}.\n   * @returns {(Object|Object[]|Record|Record[])} See {@link Collection#add}.\n   * @see Collection#add\n   * @see Collection#add\n   * @since 3.0.0\n   */\n  add (name, records, opts?) {\n    return this.getCollection(name).add(records, opts)\n  }\n\n  /**\n   * Wrapper for {@link Collection#between}.\n   *\n   * @example\n   * // Get all users ages 18 to 30\n   * const users = store.between('user', 18, 30, { index: 'age' });\n   *\n   * @example\n   * // Same as above\n   * const users = store.between('user', [18], [30], { index: 'age' });\n   *\n   * @method SimpleStore#between\n   * @param {(string|number)} name Name of the {@link Mapper} to target.\n   * @param {array} leftKeys See {@link Collection#between}.\n   * @param {array} rightKeys See {@link Collection#between}.\n   * @param {object} [opts] Configuration options. See {@link Collection#between}.\n   * @returns {Object[]|Record[]} See {@link Collection#between}.\n   * @see Collection#between\n   * @see Collection#between\n   * @since 3.0.0\n   */\n  between (name, leftKeys, rightKeys, opts) {\n    return this.getCollection(name).between(leftKeys, rightKeys, opts)\n  }\n\n  /**\n   * Wrapper for {@link Collection#createIndex}.\n   *\n   * @example\n   * // Index users by age\n   * store.createIndex('user', 'age');\n   *\n   * @example\n   * // Index users by status and role\n   * store.createIndex('user', 'statusAndRole', ['status', 'role']);\n   *\n   * @method SimpleStore#createIndex\n   * @param {(string|number)} name Name of the {@link Mapper} to target.\n   * @param {string} indexName See {@link Collection#createIndex}.\n   * @param {string[]} [fieldList] See {@link Collection#createIndex}.\n   * @param {object} [opts] Configuration options. See {@link Collection#between}.\n   * @see Collection#createIndex\n   * @see Collection#createIndex\n   * @since 3.0.0\n   */\n  createIndex (name: string | number, indexName: string, fieldList?: string[], opts?) {\n    return this.getCollection(name).createIndex(indexName, fieldList, opts)\n  }\n\n  /**\n   * Wrapper for {@link Collection#filter}.\n   *\n   * @example <caption>SimpleStore#filter</caption>\n   * const JSData = require('js-data');\n   * const { SimpleStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new SimpleStore();\n   * store.defineMapper('post');\n   * store.add('post', [\n   *   { id: 1, status: 'draft', created_at_timestamp: new Date().getTime() }\n   * ]);\n   *\n   * // Get the draft posts created less than three months ago\n   * let posts = store.filter('post', {\n   *   where: {\n   *     status: {\n   *       '==': 'draft'\n   *     },\n   *     created_at_timestamp: {\n   *       '>=': (new Date().getTime() - (1000 \\* 60 \\* 60 \\* 24 \\* 30 \\* 3)) // 3 months ago\n   *     }\n   *   }\n   * });\n   * console.log(posts);\n   *\n   * // Use a custom filter function\n   * posts = store.filter('post', function (post) { return post.id % 2 === 0 });\n   *\n   * @method SimpleStore#filter\n   * @param {(string|number)} name Name of the {@link Mapper} to target.\n   * @param {(Object|Function)} [queryOrFn={}] See {@link Collection#filter}.\n   * @param {object} [thisArg] See {@link Collection#filter}.\n   * @returns {Array} See {@link Collection#filter}.\n   * @see Collection#filter\n   * @see Collection#filter\n   * @since 3.0.0\n   */\n  filter (name, queryOrFn?, thisArg?) {\n    return this.getCollection(name).filter(queryOrFn, thisArg)\n  }\n\n  /**\n   * Wrapper for {@link Collection#get}.\n   *\n   * @example <caption>SimpleStore#get</caption>\n   * const JSData = require('js-data');\n   * const { SimpleStore } = JSData;\n   * console.log('Using JSData v' + JSData.version.full);\n   *\n   * const store = new SimpleStore();\n   * store.defineMapper('post');\n   * store.add('post', [\n   *   { id: 1, status: 'draft', created_at_timestamp: new Date().getTime() }\n   * ]);\n   *\n   * console.log(store.get('post', 1)); // {...}\n   * console.log(store.get('post', 2)); // undefined\n   *\n   * @method SimpleStore#get\n   * @param {(string|number)} name Name of the {@link Mapper} to target.\n   * @param {(string|number)} id See {@link Collection#get}.\n   * @returns {(Object|Record)} See {@link Collection#get}.\n   * @see Collection#get\n   * @see Collection#get\n   * @since 3.0.0\n   */\n  get (name, id) {\n    return this.getCollection(name).get(id)\n  }\n\n  /**\n   * Wrapper for {@link Collection#getAll}.\n   *\n   * @example\n   * // Get the posts where \"status\" is \"draft\" or \"inReview\"\n   * const posts = store.getAll('post', 'draft', 'inReview', { index: 'status' });\n   *\n   * @example\n   * // Same as above\n   * const posts = store.getAll('post', ['draft'], ['inReview'], { index: 'status' });\n   *\n   * @method SimpleStore#getAll\n   * @param {(string|number)} name Name of the {@link Mapper} to target.\n   * @param {...Array} [keyList] See {@link Collection#getAll}.\n   * @param {object} [opts] See {@link Collection#getAll}.\n   * @returns {Array} See {@link Collection#getAll}.\n   * @see Collection#getAll\n   * @see Collection#getAll\n   * @since 3.0.0\n   */\n  getAll (name, ...args) {\n    return this.getCollection(name).getAll(...args)\n  }\n\n  /**\n   * Wrapper for {@link Collection#prune}.\n   *\n   * @method SimpleStore#prune\n   * @param name\n   * @param {object} [opts] See {@link Collection#prune}.\n   * @returns {Array} See {@link Collection#prune}.\n   * @see Collection#prune\n   * @see Collection#prune\n   * @since 3.0.0\n   */\n  prune (name: string, opts?) {\n    return this.getCollection(name).prune(opts)\n  }\n\n  /**\n   * Wrapper for {@link Collection#query}.\n   *\n   * @example\n   * // Grab page 2 of users between ages 18 and 30\n   * store.query('user')\n   *   .between(18, 30, { index: 'age' }) // between ages 18 and 30\n   *   .skip(10) // second page\n   *   .limit(10) // page size\n   *   .run();\n   *\n   * @method SimpleStore#query\n   * @param {(string|number)} name Name of the {@link Mapper} to target.\n   * @returns {Query} See {@link Collection#query}.\n   * @see Collection#query\n   * @see Collection#query\n   * @since 3.0.0\n   */\n  query (name) {\n    return this.getCollection(name).query()\n  }\n\n  /**\n   * Wrapper for {@link Collection#toJSON}.\n   *\n   * @example\n   * store.defineMapper('post', {\n   *   schema: {\n   *     properties: {\n   *       id: { type: 'number' },\n   *       title: { type: 'string' }\n   *     }\n   *   }\n   * });\n   * store.add('post', [\n   *   { id: 1, status: 'published', title: 'Respect your Data' },\n   *   { id: 2, status: 'draft', title: 'Connecting to a data source' }\n   * ]);\n   * console.log(store.toJSON('post'));\n   * const draftsJSON = store.query('post')\n   *   .filter({ status: 'draft' })\n   *   .mapCall('toJSON')\n   *   .run();\n   *\n   * @method SimpleStore#toJSON\n   * @param {(string|number)} name Name of the {@link Mapper} to target.\n   * @param {object} [opts] See {@link Collection#toJSON}.\n   * @returns {Array} See {@link Collection#toJSON}.\n   * @see Collection#toJSON\n   * @see Collection#toJSON\n   * @since 3.0.0\n   */\n  toJSON (name, opts) {\n    return this.getCollection(name).toJSON(opts)\n  }\n\n  /**\n   * Wrapper for {@link Collection#unsaved}.\n   *\n   * @method SimpleStore#unsaved\n   * @returns {Array} See {@link Collection#unsaved}.\n   * @see Collection#unsaved\n   * @see Collection#unsaved\n   * @since 3.0.0\n   */\n  unsaved (name, opts?) {\n    return this.getCollection(name).unsaved(opts)\n  }\n}\n\n/**\n * Fired when a record changes. Only works for records that have tracked fields.\n * See {@link SimpleStore~changeListener} on how to listen for this event.\n *\n * @event SimpleStore#change\n * @see SimpleStore~changeListener\n */\n\n/**\n * Callback signature for the {@link SimpleStore#event:change} event.\n *\n * @example\n * function onChange (mapperName, record, changes) {\n *   // do something\n * }\n * store.on('change', onChange);\n *\n * @callback SimpleStore~changeListener\n * @param {string} name The name of the associated {@link Mapper}.\n * @param {Record} record The Record that changed.\n * @param {object} changes The changes.\n * @see SimpleStore#event:change\n * @since 3.0.0\n */\n\n/**\n * Fired when one or more records are added to the in-memory store. See\n * {@link SimpleStore~addListener} on how to listen for this event.\n *\n * @event SimpleStore#add\n * @see SimpleStore~addListener\n * @see SimpleStore#event:add\n * @see SimpleStore#add\n * @see SimpleStore#create\n * @see SimpleStore#createMany\n * @see SimpleStore#find\n * @see SimpleStore#findAll\n * @see SimpleStore#update\n * @see SimpleStore#updateAll\n * @see SimpleStore#updateMany\n */\n\n/**\n * Callback signature for the {@link SimpleStore#event:add} event.\n *\n * @example\n * function onAdd (mapperName, recordOrRecords) {\n *   // do something\n * }\n * store.on('add', onAdd);\n *\n * @callback SimpleStore~addListener\n * @param {string} name The name of the associated {@link Mapper}.\n * @param {Record|Record[]} The Record or Records that were added.\n * @see SimpleStore#event:add\n * @see SimpleStore#add\n * @see SimpleStore#create\n * @see SimpleStore#createMany\n * @see SimpleStore#find\n * @see SimpleStore#findAll\n * @see SimpleStore#update\n * @see SimpleStore#updateAll\n * @see SimpleStore#updateMany\n * @since 3.0.0\n */\n\n/**\n * Fired when one or more records are removed from the in-memory store. See\n * {@link SimpleStore~removeListener} for how to listen for this event.\n *\n * @event SimpleStore#remove\n * @see SimpleStore~removeListener\n * @see SimpleStore#event:remove\n * @see SimpleStore#clear\n * @see SimpleStore#destroy\n * @see SimpleStore#destroyAll\n * @see SimpleStore#remove\n * @see SimpleStore#removeAll\n */\n\n/**\n * Callback signature for the {@link SimpleStore#event:remove} event.\n *\n * @example\n * function onRemove (mapperName, recordsOrRecords) {\n *   // do something\n * }\n * store.on('remove', onRemove);\n *\n * @callback SimpleStore~removeListener\n * @param {string} name The name of the associated {@link Mapper}.\n * @param {Record|Record[]} Record or Records that were removed.\n * @see SimpleStore#event:remove\n * @see SimpleStore#clear\n * @see SimpleStore#destroy\n * @see SimpleStore#destroyAll\n * @see SimpleStore#remove\n * @see SimpleStore#removeAll\n * @since 3.0.0\n */\n\n/**\n * Create a subclass of this SimpleStore:\n * @example <caption>SimpleStore.extend</caption>\n * const JSData = require('js-data');\n * const { SimpleStore } = JSData;\n * console.log('Using JSData v' + JSData.version.full);\n *\n * // Extend the class using ES2015 class syntax.\n * class CustomSimpleStoreClass extends SimpleStore {\n *   foo () { return 'bar'; }\n *   static beep () { return 'boop'; }\n * }\n * const customSimpleStore = new CustomSimpleStoreClass();\n * console.log(customSimpleStore.foo());\n * console.log(CustomSimpleStoreClass.beep());\n *\n * // Extend the class using alternate method.\n * const OtherSimpleStoreClass = SimpleStore.extend({\n *   foo () { return 'bar'; }\n * }, {\n *   beep () { return 'boop'; }\n * })\n * const otherSimpleStore = new OtherSimpleStoreClass();\n * console.log(otherSimpleStore.foo());\n * console.log(OtherSimpleStoreClass.beep());\n *\n * // Extend the class, providing a custom constructor.\n * function AnotherSimpleStoreClass () {\n *   SimpleStore.call(this)\n *   this.created_at = new Date().getTime()\n * }\n * SimpleStore.extend({\n *   constructor: AnotherSimpleStoreClass,\n *   foo () { return 'bar'; }\n * }, {\n *   beep () { return 'boop'; }\n * })\n * const anotherSimpleStore = new AnotherSimpleStoreClass();\n * console.log(anotherSimpleStore.created_at);\n * console.log(anotherSimpleStore.foo());\n * console.log(AnotherSimpleStoreClass.beep());\n *\n * @method SimpleStore.extend\n * @param {object} [props={}] Properties to add to the prototype of the\n * subclass.\n * @param {object} [props.constructor] Provide a custom constructor function\n * to be used as the subclass itself.\n * @param {object} [classProps={}] Static properties to add to the subclass.\n * @returns {Constructor} Subclass of this SimpleStore class.\n * @since 3.0.0\n */\n","import utils from './utils'\nimport './decorators'\nimport Collection from './Collection'\n\nconst DOMAIN = 'LinkedCollection'\n\n/**\n * Extends {@link Collection}. Used by a {@link DataStore} to implement an\n * Identity Map.\n *\n * @example\n * import {LinkedCollection} from 'js-data';\n *\n * // Extend the class using ES2015 class syntax.\n * class CustomLinkedCollectionClass extends LinkedCollection {\n *   foo () { return 'bar'; }\n *   static beep () { return 'boop'; }\n * }\n * const customLinkedCollection = new CustomLinkedCollectionClass();\n * console.log(customLinkedCollection.foo());\n * console.log(CustomLinkedCollectionClass.beep());\n *\n * @class LinkedCollection\n * @extends Collection\n * @param {array} [records] Initial set of records to insert into the\n * collection. See {@link Collection}.\n * @param {object} [opts] Configuration options. See {@link Collection}.\n * @returns {Mapper}\n */\nexport default class LinkedCollection extends Collection {\n  datastore: any;\n\n  constructor (records, opts) {\n    super(records, opts)\n\n    // Make sure this collection has a reference to a datastore\n    if (!this.datastore) {\n      throw utils.err(`new ${DOMAIN}`, 'opts.datastore')(400, 'DataStore', this.datastore)\n    }\n  }\n\n  _addMeta (record, timestamp) {\n    // Track when this record was added\n    this._added[this.recordId(record)] = timestamp\n\n    if (utils.isFunction(record._set)) {\n      record._set('$', timestamp)\n    }\n  }\n\n  _clearMeta (record) {\n    delete this._added[this.recordId(record)]\n    if (utils.isFunction(record._set)) {\n      record._set('$') // unset\n    }\n  }\n\n  _onRecordEvent (...args) {\n    Collection.prototype._onRecordEvent.apply(this, args)\n    const event = args[0]\n    // This is a very brute force method\n    // Lots of room for optimization\n    if (utils.isString(event) && event.indexOf('change') === 0) {\n      this.updateIndexes(args[1])\n    }\n  }\n\n  add (records, opts) {\n    const mapper = this.mapper\n    const timestamp = new Date().getTime()\n    const singular = utils.isObject(records) && !utils.isArray(records)\n\n    if (singular) {\n      records = [records]\n    }\n    records = super.add(records, opts)\n\n    if (mapper.relationList.length && records.length) {\n      // Check the currently visited record for relations that need to be\n      // inserted into their respective collections.\n      mapper.relationList.forEach(def => {\n        def.addLinkedRecords(records)\n      })\n    }\n\n    records.forEach(record => this._addMeta(record, timestamp))\n\n    return singular ? records[0] : records\n  }\n\n  remove (idOrRecord, opts) {\n    const mapper = this.mapper\n    const record = super.remove(idOrRecord, opts)\n    if (record) {\n      this._clearMeta(record)\n    }\n\n    if (mapper.relationList.length && record) {\n      mapper.relationList.forEach(def => {\n        def.removeLinkedRecords(mapper, [record])\n      })\n    }\n\n    return record\n  }\n\n  removeAll (query, opts) {\n    const mapper = this.mapper\n    const records = super.removeAll(query, opts)\n    records.forEach(this._clearMeta, this)\n\n    if (mapper.relationList.length && records.length) {\n      mapper.relationList.forEach(def => {\n        def.removeLinkedRecords(mapper, records)\n      })\n    }\n\n    return records\n  }\n}\n\n/**\n * Create a subclass of this LinkedCollection:\n *\n * // Extend the class using alternate method.\n * const OtherLinkedCollectionClass = LinkedCollection.extend({\n *   foo () { return 'bar'; }\n * }, {\n *   beep () { return 'boop'; }\n * });\n * const otherLinkedCollection = new OtherLinkedCollectionClass();\n * console.log(otherLinkedCollection.foo());\n * console.log(OtherLinkedCollectionClass.beep());\n *\n * // Extend the class, providing a custom constructor.\n * function AnotherLinkedCollectionClass () {\n *   LinkedCollection.call(this);\n *   this.created_at = new Date().getTime();\n * }\n * LinkedCollection.extend({\n *   constructor: AnotherLinkedCollectionClass,\n *   foo () { return 'bar'; }\n * }, {\n *   beep () { return 'boop'; }\n * });\n * const anotherLinkedCollection = new AnotherLinkedCollectionClass();\n * console.log(anotherLinkedCollection.created_at);\n * console.log(anotherLinkedCollection.foo());\n * console.log(AnotherLinkedCollectionClass.beep());\n *\n * @method LinkedCollection.extend\n * @param {object} [props={}] Properties to add to the prototype of the\n * subclass.\n * @param {object} [props.constructor] Provide a custom constructor function\n * to be used as the subclass itself.\n * @param {object} [classProps={}] Static properties to add to the subclass.\n * @returns {Constructor} Subclass of this LinkedCollection class.\n * @since 3.0.0\n */\n","import utils, { safeSetLink, safeSetProp } from './utils'\n\nimport { belongsToType, hasManyType, hasOneType } from './decorators'\nimport SimpleStore, { SimpleStoreOpts } from './SimpleStore'\nimport LinkedCollection from './LinkedCollection'\nimport { MapperOpts } from './Mapper'\n\nexport interface DataStoreOpts extends SimpleStoreOpts {\n  [customAttr: string]: any\n\n  linkRelations?: boolean\n  unlinkOnDestroy?: boolean\n  collectionClass /*: typeof Collection */?\n  mapperClass?\n  scopes?: any\n}\n\nconst DATASTORE_DEFAULTS: DataStoreOpts = {\n  /**\n   * Whether in-memory relations should be unlinked from records after they are\n   * destroyed.\n   *\n   * @default true\n   * @name DataStore#unlinkOnDestroy\n   * @since 3.0.0\n   * @type {boolean}\n   */\n  unlinkOnDestroy: true,\n\n  collectionClass: LinkedCollection\n}\n\n/**\n * The `DataStore` class is an extension of {@link SimpleStore}. Not only does\n * `DataStore` manage mappers and store data in collections, it uses the\n * {@link LinkedCollection} class to link related records together in memory.\n *\n * ```javascript\n * import { DataStore } from 'js-data';\n * ```\n *\n * @example\n * import { DataStore } from 'js-data';\n * import HttpAdapter from 'js-data-http';\n * const store = new DataStore();\n *\n * // DataStore#defineMapper returns a direct reference to the newly created\n * // Mapper.\n * const UserMapper = store.defineMapper('user');\n *\n * // DataStore#as returns the store scoped to a particular Mapper.\n * const UserStore = store.as('user');\n *\n * // Call \"find\" on \"UserMapper\" (Stateless ORM)\n * UserMapper.find(1).then((user) => {\n *   // retrieved a \"user\" record via the http adapter, but that's it\n *\n *   // Call \"find\" on \"store\" targeting \"user\" (Stateful DataStore)\n *   return store.find('user', 1); // same as \"UserStore.find(1)\"\n * }).then((user) => {\n *   // not only was a \"user\" record retrieved, but it was added to the\n *   // store's \"user\" collection\n *   const cachedUser = store.getCollection('user').get(1);\n *   console.log(user === cachedUser); // true\n * });\n *\n * @class DataStore\n * @extends SimpleStore\n * @param {object} [opts] Configuration options. See {@link SimpleStore}.\n * @param {boolean} [opts.collectionClass={@link LinkedCollection}] See {@link DataStore#collectionClass}.\n * @param {boolean} [opts.debug=false] See {@link Component#debug}.\n * @param {boolean} [opts.unlinkOnDestroy=true] See {@link DataStore#unlinkOnDestroy}.\n * @param {boolean|Function} [opts.usePendingFind=true] See {@link DataStore#usePendingFind}.\n * @param {boolean|Function} [opts.usePendingFindAll=true] See {@link DataStore#usePendingFindAll}.\n * @returns {DataStore}\n * @see SimpleStore\n * @since 3.0.0\n * @tutorial [\"http://www.js-data.io/v3.0/docs/components-of-jsdata#datastore\",\"Components of JSData: DataStore\"]\n * @tutorial [\"http://www.js-data.io/v3.0/docs/working-with-the-datastore\",\"Working with the DataStore\"]\n * @tutorial [\"http://www.js-data.io/v3.0/docs/jsdata-and-the-browser\",\"Notes on using JSData in the Browser\"]\n */\nexport default class DataStore extends SimpleStore {\n  unlinkOnDestroy: any;\n\n  constructor (opts: DataStoreOpts = {}) {\n    // Fill in any missing options with the defaults\n    super({ ...DATASTORE_DEFAULTS, ...opts })\n  }\n\n  /**\n   * Creates a new [Mapper] with [name] from the [opts]\n   * @param {string} name\n   * @param {object} opts\n   * @returns {*}\n   */\n  defineMapper (name, opts?: MapperOpts) {\n    // Complexity of this method is beyond simply using => functions to bind context\n    const self = this\n    const mapper = super.defineMapper(name, opts)\n    const idAttribute = mapper.idAttribute\n    const collection = this.getCollection(name)\n\n    mapper.relationList.forEach(def => {\n      const relation = def.relation\n      const localField = def.localField\n      const path = `links.${localField}`\n      const foreignKey = def.foreignKey\n      const type = def.type\n      const updateOpts = { index: foreignKey }\n      let descriptor\n\n      const getter = function () {\n        return this._get(path)\n      }\n\n      if (type === belongsToType) {\n        if (!collection.indexes[foreignKey]) {\n          collection.createIndex(foreignKey)\n        }\n\n        descriptor = {\n          get: getter,\n          // e.g. profile.user = someUser\n          // or comment.post = somePost\n          set (record) {\n            // e.g. const otherUser = profile.user\n            const currentParent = this._get(path)\n            // e.g. profile.user === someUser\n            if (record === currentParent) {\n              return currentParent\n            }\n            const id = utils.get(this, idAttribute)\n            const inverseDef = def.getInverse(mapper)\n\n            // e.g. profile.user !== someUser\n            // or comment.post !== somePost\n            if (currentParent && inverseDef) {\n              this.removeInverseRelation(currentParent, id, inverseDef, idAttribute)\n            }\n            if (record) {\n              // e.g. profile.user = someUser\n              const relatedIdAttribute = def.getRelation().idAttribute\n              const relatedId = utils.get(record, relatedIdAttribute)\n\n              // Prefer store record\n              if (relatedId !== undefined && this._get('$')) {\n                record = self.get(relation, relatedId) || record\n              }\n\n              // Set locals\n              // e.g. profile.user = someUser\n              // or comment.post = somePost\n              safeSetLink(this, localField, record)\n              safeSetProp(this, foreignKey, relatedId)\n              collection.updateIndex(this, updateOpts)\n\n              if (inverseDef) {\n                this.setupInverseRelation(record, id, inverseDef, idAttribute)\n              }\n            } else {\n              // Unset in-memory link only\n              // e.g. profile.user = undefined\n              // or comment.post = undefined\n              safeSetLink(this, localField, undefined)\n            }\n            return record\n          }\n        }\n\n        let foreignKeyDescriptor = Object.getOwnPropertyDescriptor(mapper.recordClass.prototype, foreignKey)\n        if (!foreignKeyDescriptor) {\n          foreignKeyDescriptor = {\n            enumerable: true\n          }\n        }\n        const originalGet = foreignKeyDescriptor.get\n        foreignKeyDescriptor.get = function () {\n          if (originalGet) {\n            return originalGet.call(this)\n          }\n          return this._get(`props.${foreignKey}`)\n        }\n        const originalSet = foreignKeyDescriptor.set\n        foreignKeyDescriptor.set = function (value) {\n          if (originalSet) {\n            originalSet.call(this, value)\n          }\n          const currentParent = utils.get(this, localField)\n          const id = utils.get(this, idAttribute)\n          const inverseDef = def.getInverse(mapper)\n          const currentParentId = currentParent ? utils.get(currentParent, def.getRelation().idAttribute) : undefined\n\n          if (inverseDef && currentParent && currentParentId !== undefined && currentParentId !== value) {\n            if (inverseDef.type === hasOneType) {\n              safeSetLink(currentParent, inverseDef.localField, undefined)\n            } else if (inverseDef.type === hasManyType) {\n              const children = utils.get(currentParent, inverseDef.localField)\n              if (id === undefined) {\n                utils.remove(children, child => child === this)\n              } else {\n                utils.remove(children, child => child === this || id === utils.get(child, idAttribute))\n              }\n            }\n          }\n\n          safeSetProp(this, foreignKey, value)\n          collection.updateIndex(this, updateOpts)\n\n          if (value === undefined || value === null) {\n            if (currentParentId !== undefined) {\n              // Unset locals\n              utils.set(this, localField, undefined)\n            }\n          } else if (this._get('$')) {\n            const storeRecord = self.get(relation, value)\n            if (storeRecord) {\n              utils.set(this, localField, storeRecord)\n            }\n          }\n        }\n        Object.defineProperty(mapper.recordClass.prototype, foreignKey, foreignKeyDescriptor)\n      } else if (type === hasManyType) {\n        const localKeys = def.localKeys\n        const foreignKeys = def.foreignKeys\n\n        // TODO: Handle case when belongsTo relation isn't ever defined\n        if (self._collections[relation] && foreignKey && !self.getCollection(relation).indexes[foreignKey]) {\n          self.getCollection(relation).createIndex(foreignKey)\n        }\n\n        descriptor = {\n          get () {\n            const current = getter.call(this)\n            if (!current) {\n              this._set(path, [])\n            }\n            return getter.call(this)\n          },\n          // e.g. post.comments = someComments\n          // or user.groups = someGroups\n          // or group.users = someUsers\n          set (records) {\n            if (records && !utils.isArray(records)) {\n              records = [records]\n            }\n            const id = utils.get(this, idAttribute)\n            const relatedIdAttribute = def.getRelation().idAttribute\n            const inverseDef = def.getInverse(mapper)\n            const inverseLocalField = inverseDef.localField\n            const current = this._get(path) || []\n            const toLink = []\n            const toLinkIds = {}\n\n            if (records) {\n              records.forEach(record => {\n                // e.g. comment.id\n                const relatedId = utils.get(record, relatedIdAttribute)\n                const currentParent = utils.get(record, inverseLocalField)\n                if (currentParent && currentParent !== this) {\n                  const currentChildrenOfParent = utils.get(currentParent, localField)\n                  // e.g. somePost.comments.remove(comment)\n                  if (relatedId === undefined) {\n                    utils.remove(currentChildrenOfParent, child => child === record)\n                  } else {\n                    utils.remove(\n                      currentChildrenOfParent,\n                      child => child === record || relatedId === utils.get(child, relatedIdAttribute)\n                    )\n                  }\n                }\n                if (relatedId !== undefined) {\n                  if (this._get('$')) {\n                    // Prefer store record\n                    record = self.get(relation, relatedId) || record\n                  }\n                  // e.g. toLinkIds[comment.id] = comment\n                  toLinkIds[relatedId] = record\n                }\n                toLink.push(record)\n              })\n            }\n\n            // e.g. post.comments = someComments\n            if (foreignKey) {\n              current.forEach(record => {\n                // e.g. comment.id\n                const relatedId = utils.get(record, relatedIdAttribute)\n                if (\n                  (relatedId === undefined && toLink.indexOf(record) === -1) ||\n                  (relatedId !== undefined && !(relatedId in toLinkIds))\n                ) {\n                  // Update (unset) inverse relation\n                  if (records) {\n                    // e.g. comment.post_id = undefined\n                    safeSetProp(record, foreignKey, undefined)\n                    // e.g. CommentCollection.updateIndex(comment, { index: 'post_id' })\n                    self.getCollection(relation).updateIndex(record, updateOpts)\n                  }\n                  // e.g. comment.post = undefined\n                  safeSetLink(record, inverseLocalField, undefined)\n                }\n              })\n              toLink.forEach(record => {\n                // Update (set) inverse relation\n                // e.g. comment.post_id = post.id\n                safeSetProp(record, foreignKey, id)\n                // e.g. CommentCollection.updateIndex(comment, { index: 'post_id' })\n                self.getCollection(relation).updateIndex(record, updateOpts)\n                // e.g. comment.post = post\n                safeSetLink(record, inverseLocalField, this)\n              })\n            } else if (localKeys) {\n              // Update locals\n              // e.g. group.users = someUsers\n              // Update (set) inverse relation\n              const ids = toLink.map(child => utils.get(child, relatedIdAttribute)).filter(id => id !== undefined)\n              // e.g. group.user_ids = [1,2,3,...]\n              utils.set(this, localKeys, ids)\n              // Update (unset) inverse relation\n              if (inverseDef.foreignKeys) {\n                current.forEach(child => {\n                  const relatedId = utils.get(child, relatedIdAttribute)\n                  if (\n                    (relatedId === undefined && toLink.indexOf(child) === -1) ||\n                    (relatedId !== undefined && !(relatedId in toLinkIds))\n                  ) {\n                    // Update inverse relation\n                    // safeSetLink(child, inverseLocalField, undefined)\n                    const parents = utils.get(child, inverseLocalField) || []\n                    // e.g. someUser.groups.remove(group)\n                    if (id === undefined) {\n                      utils.remove(parents, parent => parent === this)\n                    } else {\n                      utils.remove(parents, parent => parent === this || id === utils.get(parent, idAttribute))\n                    }\n                  }\n                })\n                toLink.forEach(child => {\n                  // Update (set) inverse relation\n                  const parents = utils.get(child, inverseLocalField)\n                  // e.g. someUser.groups.push(group)\n                  if (id === undefined) {\n                    utils.noDupeAdd(parents, this, parent => parent === this)\n                  } else {\n                    utils.noDupeAdd(parents, this, parent => parent === this || id === utils.get(parent, idAttribute))\n                  }\n                })\n              }\n            } else if (foreignKeys) {\n              // e.g. user.groups = someGroups\n              // Update (unset) inverse relation\n              current.forEach(parent => {\n                const ids = utils.get(parent, foreignKeys) || []\n                // e.g. someGroup.user_ids.remove(user.id)\n                utils.remove(ids, _key => id === _key)\n                const children = utils.get(parent, inverseLocalField)\n                // e.g. someGroup.users.remove(user)\n                if (id === undefined) {\n                  utils.remove(children, child => child === this)\n                } else {\n                  utils.remove(children, child => child === this || id === utils.get(child, idAttribute))\n                }\n              })\n              // Update (set) inverse relation\n              toLink.forEach(parent => {\n                const ids = utils.get(parent, foreignKeys) || []\n                utils.noDupeAdd(ids, id, _key => id === _key)\n                const children = utils.get(parent, inverseLocalField)\n                if (id === undefined) {\n                  utils.noDupeAdd(children, this, child => child === this)\n                } else {\n                  utils.noDupeAdd(children, this, child => child === this || id === utils.get(child, idAttribute))\n                }\n              })\n            }\n\n            this._set(path, toLink)\n            return toLink\n          }\n        }\n      } else if (type === hasOneType) {\n        // TODO: Handle case when belongsTo relation isn't ever defined\n        if (self._collections[relation] && foreignKey && !self.getCollection(relation).indexes[foreignKey]) {\n          self.getCollection(relation).createIndex(foreignKey)\n        }\n        descriptor = {\n          get: getter,\n          // e.g. user.profile = someProfile\n          set (record) {\n            const current = this._get(path)\n            if (record === current) {\n              return current\n            }\n            const inverseLocalField = def.getInverse(mapper).localField\n            // Update (unset) inverse relation\n            if (current) {\n              safeSetProp(current, foreignKey, undefined)\n              self.getCollection(relation).updateIndex(current, updateOpts)\n              safeSetLink(current, inverseLocalField, undefined)\n            }\n            if (record) {\n              const relatedId = utils.get(record, def.getRelation().idAttribute)\n              // Prefer store record\n              if (relatedId !== undefined) {\n                record = self.get(relation, relatedId) || record\n              }\n\n              // Set locals\n              safeSetLink(this, localField, record)\n\n              // Update (set) inverse relation\n              safeSetProp(record, foreignKey, utils.get(this, idAttribute))\n              self.getCollection(relation).updateIndex(record, updateOpts)\n              safeSetLink(record, inverseLocalField, this)\n            } else {\n              // Unset locals\n              safeSetLink(this, localField, undefined)\n            }\n            return record\n          }\n        }\n      }\n\n      if (descriptor) {\n        descriptor.enumerable = def.enumerable === undefined ? false : def.enumerable\n        if (def.get) {\n          const origGet = descriptor.get\n          descriptor.get = function () {\n            return def.get(def, this, (...args) => origGet.apply(this, args))\n          }\n        }\n        if (def.set) {\n          const origSet = descriptor.set\n          descriptor.set = function (related) {\n            return def.set(def, this, related, value => origSet.call(this, value === undefined ? related : value))\n          }\n        }\n        Object.defineProperty(mapper.recordClass.prototype, localField, descriptor)\n      }\n    })\n\n    return mapper\n  }\n\n  destroy (name, id, opts: any = {}) {\n    return super.destroy(name, id, opts).then(result => {\n      let record\n      if (opts.raw) {\n        record = result.data\n      } else {\n        record = result\n      }\n\n      if (record && this.unlinkOnDestroy) {\n        const _opts = utils.plainCopy(opts)\n        _opts.withAll = true\n        utils.forEachRelation(this.getMapper(name), _opts, def => {\n          utils.set(record, def.localField, undefined)\n        })\n      }\n      return result\n    })\n  }\n\n  destroyAll (name, query, opts: any = {}) {\n    return super.destroyAll(name, query, opts).then(result => {\n      let records\n      if (opts.raw) {\n        records = result.data\n      } else {\n        records = result\n      }\n\n      if (records?.length && this.unlinkOnDestroy) {\n        const _opts = utils.plainCopy(opts)\n        _opts.withAll = true\n        utils.forEachRelation(this.getMapper(name), _opts, def => {\n          records.forEach(record => {\n            utils.set(record, def.localField, undefined)\n          })\n        })\n      }\n      return result\n    })\n  }\n}\n","/**\n * Registered as `js-data` in NPM.\n *\n * @example <caption>Install from NPM</caption>\n * npm i --save js-data\n * @example <caption>Install from NPM</caption>\n * yarn add js-data\n * @example <caption>Load into your app via CommonJS</caption>\n * var JSData = require('js-data');\n * @example <caption>Load into your app via ES2015 Modules</caption>\n * import * as JSData from 'js-data';\n */\n\n/**\n * JSData's utility methods.\n *\n * @example\n * import { utils } from 'js-data';\n * console.log(utils.isString('foo')); // true\n *\n * @name module:js-data.utils\n * @property {Function} Promise See {@link utils.Promise}.\n * @see utils\n * @since 3.0.0\n * @type {Object}\n */\nimport utils from './utils'\n\n/**\n * JSData's {@link Collection} class.\n *\n * @example\n * import { Collection } from 'js-data';\n * const collection = new Collection();\n *\n * @name module:js-data.Collection\n * @see Collection\n * @since 3.0.0\n * @tutorial [\"http://www.js-data.io/v3.0/docs/components-of-jsdata#collection\",\"Components of JSData: Collection\"]\n * @type {Constructor}\n */\nimport Collection from './Collection'\n\n/**\n * JSData's {@link Component} class. Most components in JSData extend this\n * class.\n *\n * @example\n * import { Component } from 'js-data';\n * // Make a custom component.\n * const MyComponent = Component.extend({\n *   myMethod (someArg) { ... }\n * });\n *\n * @name module:js-data.Component\n * @see Component\n * @since 3.0.0\n * @type {Constructor}\n */\nimport Component from './Component'\n\n/**\n * JSData's {@link Container} class. Defines and manages {@link Mapper}s. Used\n * in Node.js and in the browser, though in the browser you may want to use\n * {@link DataStore} instead.\n *\n * @example\n * import { Container } from 'js-data';\n * const store = new Container();\n *\n * @name module:js-data.Container\n * @see Container\n * @since 3.0.0\n * @tutorial [\"http://www.js-data.io/v3.0/docs/components-of-jsdata#container\",\"Components of JSData: Container\"]\n * @type {Constructor}\n */\nimport { Container } from './Container'\n\n/**\n * JSData's {@link DataStore} class. Primarily for use in the browser. In\n * Node.js you probably want to use {@link Container} instead.\n *\n * @example\n * import { DataStore } from 'js-data';\n * const store = new DataStore();\n *\n * @name module:js-data.DataStore\n * @see DataStore\n * @since 3.0.0\n * @tutorial [\"http://www.js-data.io/v3.0/docs/components-of-jsdata#datastore\",\"Components of JSData: DataStore\"]\n * @type {Constructor}\n */\nimport DataStore from './DataStore'\n\n/**\n * JSData's {@link Index} class, based on [mindex]{@link https://github.com/internalfx/mindex}.\n *\n * @name module:js-data.Index\n * @see Index\n * @since 3.0.0\n * @type {Constructor}\n */\nimport Index from './mindex'\n\n/**\n * JSData's {@link LinkedCollection} class. Used by the {@link DataStore}\n * component. If you need to create a collection manually, you should probably\n * use the {@link Collection} class.\n *\n * @name module:js-data.LinkedCollection\n * @see DataStore\n * @see LinkedCollection\n * @since 3.0.0\n * @type {Constructor}\n */\nimport LinkedCollection from './LinkedCollection'\n\n/**\n * JSData's {@link Mapper} class. The core of the ORM.\n *\n * @example <caption>Recommended use</caption>\n * import { Container } from 'js-data';\n * const store = new Container();\n * store.defineMapper('user');\n *\n * @example <caption>Create Mapper manually</caption>\n * import { Mapper } from 'js-data';\n * const UserMapper = new Mapper({ name: 'user' });\n *\n * @name module:js-data.Mapper\n * @see Container\n * @see Mapper\n * @since 3.0.0\n * @tutorial [\"http://www.js-data.io/v3.0/docs/modeling-your-data\",\"Modeling your data\"]\n * @tutorial [\"http://www.js-data.io/v3.0/docs/components-of-jsdata#mapper\",\"Components of JSData: Mapper\"]\n * @type {Constructor}\n */\nimport Mapper from './Mapper'\n\n/**\n * JSData's {@link Query} class. Used by the {@link Collection} component.\n *\n * @name module:js-data.Query\n * @see Query\n * @since 3.0.0\n * @type {Constructor}\n */\nimport Query from './Query'\n\n/**\n * JSData's {@link Record} class.\n *\n * @example\n * import { Container } from 'js-data';\n * const store = new Container();\n * store.defineMapper('user');\n * const user = store.createRecord('user');\n *\n * @name module:js-data.Record\n * @see Record\n * @since 3.0.0\n * @tutorial [\"http://www.js-data.io/v3.0/docs/components-of-jsdata#record\",\"Components of JSData: Record\"]\n * @type {Constructor}\n */\nimport Record from './Record'\n\n/**\n * JSData's {@link Schema} class. Implements http://json-schema.org/draft-04.\n *\n * @example\n * import { Container, Schema } from 'js-data';\n * const userSchema = new Schema({\n *   properties: {\n *     id: { type: 'string' },\n *     name: { type: 'string' }\n *   }\n * });\n * const store = new Container();\n * store.defineMapper('user', {\n *   schema: userSchema\n * });\n *\n * @name module:js-data.Schema\n * @see Schema\n * @see http://json-schema.org/\n * @since 3.0.0\n * @tutorial [\"http://www.js-data.io/v3.0/docs/components-of-jsdata#schema\",\"Components of JSData: schema\"]\n * @tutorial [\"http://www.js-data.io/v3.0/docs/schemas\",\"JSData's Schema Syntax\"]\n * @type {Constructor}\n */\nimport Schema from './Schema'\n\n/**\n * JSData's {@link Settable} class.\n *\n * @example\n * import { Settable } from 'js-data';\n * const obj = new Settable();\n * obj.set('secret', 'value');\n * console.log(JSON.stringify(obj)); // {}\n *\n * @name module:js-data.Settable\n * @see Settable\n * @since 3.0.0\n * @type {Constructor}\n */\nimport Settable from './Settable'\n\n/**\n * JSData's {@link SimpleStore} class. Primarily for use in the browser. In\n * Node.js you probably want to use {@link Container} instead.\n *\n * @example\n * import { SimpleStore } from 'js-data';\n * const store = new SimpleStore();\n *\n * @name module:js-data.SimpleStore\n * @see SimpleStore\n * @since 3.0.0\n * @tutorial [\"http://www.js-data.io/v3.0/docs/components-of-jsdata#SimpleStore\",\"Components of JSData: SimpleStore\"]\n * @type {Constructor}\n */\nimport SimpleStore from './SimpleStore'\n\n/**\n * Describes the version of this `JSData` object.\n *\n * @example\n * console.log(JSData.version.full); // \"3.0.0-beta.1\"\n *\n * @name version\n * @memberof module:js-data\n * @property {string} full The full semver value.\n * @property {number} major The major version number.\n * @property {number} minor The minor version number.\n * @property {number} patch The patch version number.\n * @property {(string|boolean)} alpha The alpha version value, otherwise `false`\n * if the current version is not alpha.\n * @property {(string|boolean)} beta The beta version value, otherwise `false`\n * if the current version is not beta.\n * @since 2.0.0\n * @type {Object}\n */\nexport const version = '<%= version %>'\n\nexport * from './decorators'\n\nexport {\n  Collection,\n  Component,\n  Container,\n  DataStore,\n  Index,\n  LinkedCollection,\n  Mapper,\n  Query,\n  Record,\n  Schema,\n  Settable,\n  SimpleStore,\n  utils\n}\n"],"names":["DOMAIN","noValidatePath","creatingPath","keepChangeHistoryPath"],"mappings":"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"}